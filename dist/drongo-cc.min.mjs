import{gfx,RenderComponent,Event as Event$1,Vec2,Node,game,director,macro,Color,Layers,Font,resources,Vec3,Rect as Rect$1,UITransform,UIOpacity,Component,Graphics,misc,Sprite,Size,view,ImageAsset,AudioClip,BufferAsset,AssetManager,Asset,assetManager,Texture2D,SpriteFrame,BitmapFont,sp,dragonBones,path,Label,LabelOutline,LabelShadow,SpriteAtlas,RichText,sys,EventMouse,EventTarget,Mask,math,isValid,View,AudioSourceComponent,EditBox,Prefab,instantiate,AudioSource,find}from"cc";import{EDITOR}from"cc/env";var ButtonMode,AutoSizeType,AlignType,VertAlignType,LoaderFillType,ListLayoutType,ListSelectionMode,OverflowType,PackageItemType,ObjectType,ProgressTitleType,ScrollBarDisplayType,ScrollType,FlipType,ChildrenRenderOrder,GroupLayoutType,PopupDirection,RelationType,FillMethod,FillOrigin,ObjectPropID,BlendMode;!function(t){t[t.Common=0]="Common",t[t.Check=1]="Check",t[t.Radio=2]="Radio"}(ButtonMode||(ButtonMode={})),function(t){t[t.None=0]="None",t[t.Both=1]="Both",t[t.Height=2]="Height",t[t.Shrink=3]="Shrink"}(AutoSizeType||(AutoSizeType={})),function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"}(AlignType||(AlignType={})),function(t){t[t.Top=0]="Top",t[t.Middle=1]="Middle",t[t.Bottom=2]="Bottom"}(VertAlignType||(VertAlignType={})),function(t){t[t.None=0]="None",t[t.Scale=1]="Scale",t[t.ScaleMatchHeight=2]="ScaleMatchHeight",t[t.ScaleMatchWidth=3]="ScaleMatchWidth",t[t.ScaleFree=4]="ScaleFree",t[t.ScaleNoBorder=5]="ScaleNoBorder"}(LoaderFillType||(LoaderFillType={})),function(t){t[t.SingleColumn=0]="SingleColumn",t[t.SingleRow=1]="SingleRow",t[t.FlowHorizontal=2]="FlowHorizontal",t[t.FlowVertical=3]="FlowVertical",t[t.Pagination=4]="Pagination"}(ListLayoutType||(ListLayoutType={})),function(t){t[t.Single=0]="Single",t[t.Multiple=1]="Multiple",t[t.Multiple_SingleClick=2]="Multiple_SingleClick",t[t.None=3]="None"}(ListSelectionMode||(ListSelectionMode={})),function(t){t[t.Visible=0]="Visible",t[t.Hidden=1]="Hidden",t[t.Scroll=2]="Scroll"}(OverflowType||(OverflowType={})),function(t){t[t.Image=0]="Image",t[t.MovieClip=1]="MovieClip",t[t.Sound=2]="Sound",t[t.Component=3]="Component",t[t.Atlas=4]="Atlas",t[t.Font=5]="Font",t[t.Swf=6]="Swf",t[t.Misc=7]="Misc",t[t.Unknown=8]="Unknown",t[t.Spine=9]="Spine",t[t.DragonBones=10]="DragonBones"}(PackageItemType||(PackageItemType={})),function(t){t[t.Image=0]="Image",t[t.MovieClip=1]="MovieClip",t[t.Swf=2]="Swf",t[t.Graph=3]="Graph",t[t.Loader=4]="Loader",t[t.Group=5]="Group",t[t.Text=6]="Text",t[t.RichText=7]="RichText",t[t.InputText=8]="InputText",t[t.Component=9]="Component",t[t.List=10]="List",t[t.Label=11]="Label",t[t.Button=12]="Button",t[t.ComboBox=13]="ComboBox",t[t.ProgressBar=14]="ProgressBar",t[t.Slider=15]="Slider",t[t.ScrollBar=16]="ScrollBar",t[t.Tree=17]="Tree",t[t.Loader3D=18]="Loader3D"}(ObjectType||(ObjectType={})),function(t){t[t.Percent=0]="Percent",t[t.ValueAndMax=1]="ValueAndMax",t[t.Value=2]="Value",t[t.Max=3]="Max"}(ProgressTitleType||(ProgressTitleType={})),function(t){t[t.Default=0]="Default",t[t.Visible=1]="Visible",t[t.Auto=2]="Auto",t[t.Hidden=3]="Hidden"}(ScrollBarDisplayType||(ScrollBarDisplayType={})),function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical",t[t.Both=2]="Both"}(ScrollType||(ScrollType={})),function(t){t[t.None=0]="None",t[t.Horizontal=1]="Horizontal",t[t.Vertical=2]="Vertical",t[t.Both=3]="Both"}(FlipType||(FlipType={})),function(t){t[t.Ascent=0]="Ascent",t[t.Descent=1]="Descent",t[t.Arch=2]="Arch"}(ChildrenRenderOrder||(ChildrenRenderOrder={})),function(t){t[t.None=0]="None",t[t.Horizontal=1]="Horizontal",t[t.Vertical=2]="Vertical"}(GroupLayoutType||(GroupLayoutType={})),function(t){t[t.Auto=0]="Auto",t[t.Up=1]="Up",t[t.Down=2]="Down"}(PopupDirection||(PopupDirection={})),function(t){t[t.Left_Left=0]="Left_Left",t[t.Left_Center=1]="Left_Center",t[t.Left_Right=2]="Left_Right",t[t.Center_Center=3]="Center_Center",t[t.Right_Left=4]="Right_Left",t[t.Right_Center=5]="Right_Center",t[t.Right_Right=6]="Right_Right",t[t.Top_Top=7]="Top_Top",t[t.Top_Middle=8]="Top_Middle",t[t.Top_Bottom=9]="Top_Bottom",t[t.Middle_Middle=10]="Middle_Middle",t[t.Bottom_Top=11]="Bottom_Top",t[t.Bottom_Middle=12]="Bottom_Middle",t[t.Bottom_Bottom=13]="Bottom_Bottom",t[t.Width=14]="Width",t[t.Height=15]="Height",t[t.LeftExt_Left=16]="LeftExt_Left",t[t.LeftExt_Right=17]="LeftExt_Right",t[t.RightExt_Left=18]="RightExt_Left",t[t.RightExt_Right=19]="RightExt_Right",t[t.TopExt_Top=20]="TopExt_Top",t[t.TopExt_Bottom=21]="TopExt_Bottom",t[t.BottomExt_Top=22]="BottomExt_Top",t[t.BottomExt_Bottom=23]="BottomExt_Bottom",t[t.Size=24]="Size"}(RelationType||(RelationType={})),function(t){t[t.None=0]="None",t[t.Horizontal=1]="Horizontal",t[t.Vertical=2]="Vertical",t[t.Radial90=3]="Radial90",t[t.Radial180=4]="Radial180",t[t.Radial360=5]="Radial360"}(FillMethod||(FillMethod={})),function(t){t[t.Top=0]="Top",t[t.Bottom=1]="Bottom",t[t.Left=2]="Left",t[t.Right=3]="Right"}(FillOrigin||(FillOrigin={})),function(t){t[t.Text=0]="Text",t[t.Icon=1]="Icon",t[t.Color=2]="Color",t[t.OutlineColor=3]="OutlineColor",t[t.Playing=4]="Playing",t[t.Frame=5]="Frame",t[t.DeltaTime=6]="DeltaTime",t[t.TimeScale=7]="TimeScale",t[t.FontSize=8]="FontSize",t[t.Selected=9]="Selected"}(ObjectPropID||(ObjectPropID={})),function(t){t[t.Normal=0]="Normal",t[t.None=1]="None",t[t.Add=2]="Add",t[t.Multiply=3]="Multiply",t[t.Screen=4]="Screen",t[t.Erase=5]="Erase",t[t.Mask=6]="Mask",t[t.Below=7]="Below",t[t.Off=8]="Off",t[t.Custom1=9]="Custom1",t[t.Custom2=10]="Custom2",t[t.Custom3=11]="Custom3"}(BlendMode||(BlendMode={}));class BlendModeUtils{static apply(t,e){let i=factors[e];t.getComponentsInChildren(RenderComponent).forEach(t=>{t.srcBlendFactor=i[0],t.dstBlendFactor=i[1]})}static override(t,e,i){factors[t][0]=e,factors[t][1]=i}}const factors=[[gfx.BlendFactor.SRC_ALPHA,gfx.BlendFactor.ONE_MINUS_SRC_ALPHA],[gfx.BlendFactor.ONE,gfx.BlendFactor.ONE],[gfx.BlendFactor.SRC_ALPHA,gfx.BlendFactor.ONE],[gfx.BlendFactor.DST_COLOR,gfx.BlendFactor.ONE_MINUS_SRC_ALPHA],[gfx.BlendFactor.ONE,gfx.BlendFactor.ONE_MINUS_SRC_COLOR],[gfx.BlendFactor.ZERO,gfx.BlendFactor.ONE_MINUS_SRC_ALPHA],[gfx.BlendFactor.ZERO,gfx.BlendFactor.SRC_ALPHA],[gfx.BlendFactor.ONE_MINUS_DST_ALPHA,gfx.BlendFactor.DST_ALPHA],[gfx.BlendFactor.ONE,gfx.BlendFactor.ZERO],[gfx.BlendFactor.SRC_ALPHA,gfx.BlendFactor.ONE_MINUS_SRC_ALPHA],[gfx.BlendFactor.SRC_ALPHA,gfx.BlendFactor.ONE_MINUS_SRC_ALPHA],[gfx.BlendFactor.SRC_ALPHA,gfx.BlendFactor.ONE_MINUS_SRC_ALPHA]];class FGUIEvent extends Event$1{constructor(t,e){super(t,e),this.pos=new Vec2,this.touchId=0,this.clickCount=0,this.button=0,this.keyModifiers=0,this.mouseWheelDelta=0}get sender(){return GObject.cast(this.currentTarget)}get isShiftDown(){return!1}get isCtrlDown(){return!1}captureTouch(){let t=GObject.cast(this.currentTarget);t&&this._processor.addTouchMonitor(this.touchId,t)}}FGUIEvent.TOUCH_BEGIN="fui_touch_begin",FGUIEvent.TOUCH_MOVE="fui_touch_move",FGUIEvent.TOUCH_END="fui_touch_end",FGUIEvent.CLICK="fui_click",FGUIEvent.ROLL_OVER="fui_roll_over",FGUIEvent.ROLL_OUT="fui_roll_out",FGUIEvent.MOUSE_WHEEL="fui_mouse_wheel",FGUIEvent.DISPLAY="fui_display",FGUIEvent.UNDISPLAY="fui_undisplay",FGUIEvent.GEAR_STOP="fui_gear_stop",FGUIEvent.LINK="fui_text_link",FGUIEvent.Submit="editing-return",FGUIEvent.TEXT_CHANGE="text-changed",FGUIEvent.STATUS_CHANGED="fui_status_changed",FGUIEvent.XY_CHANGED="fui_xy_changed",FGUIEvent.SIZE_CHANGED="fui_size_changed",FGUIEvent.SIZE_DELAY_CHANGE="fui_size_delay_change",FGUIEvent.DRAG_START="fui_drag_start",FGUIEvent.DRAG_MOVE="fui_drag_move",FGUIEvent.DRAG_END="fui_drag_end",FGUIEvent.DROP="fui_drop",FGUIEvent.SCROLL="fui_scroll",FGUIEvent.SCROLL_END="fui_scroll_end",FGUIEvent.PULL_DOWN_RELEASE="fui_pull_down_release",FGUIEvent.PULL_UP_RELEASE="fui_pull_up_release",FGUIEvent.CLICK_ITEM="fui_click_item";var EaseType,eventPool=new Array;function borrowEvent(t,e){let i;return eventPool.length?(i=eventPool.pop(),i.type=t,i.bubbles=e):i=new FGUIEvent(t,e),i}function returnEvent(t){t.initiator=null,t.unuse(),eventPool.push(t)}!function(t){t[t.Linear=0]="Linear",t[t.SineIn=1]="SineIn",t[t.SineOut=2]="SineOut",t[t.SineInOut=3]="SineInOut",t[t.QuadIn=4]="QuadIn",t[t.QuadOut=5]="QuadOut",t[t.QuadInOut=6]="QuadInOut",t[t.CubicIn=7]="CubicIn",t[t.CubicOut=8]="CubicOut",t[t.CubicInOut=9]="CubicInOut",t[t.QuartIn=10]="QuartIn",t[t.QuartOut=11]="QuartOut",t[t.QuartInOut=12]="QuartInOut",t[t.QuintIn=13]="QuintIn",t[t.QuintOut=14]="QuintOut",t[t.QuintInOut=15]="QuintInOut",t[t.ExpoIn=16]="ExpoIn",t[t.ExpoOut=17]="ExpoOut",t[t.ExpoInOut=18]="ExpoInOut",t[t.CircIn=19]="CircIn",t[t.CircOut=20]="CircOut",t[t.CircInOut=21]="CircInOut",t[t.ElasticIn=22]="ElasticIn",t[t.ElasticOut=23]="ElasticOut",t[t.ElasticInOut=24]="ElasticInOut",t[t.BackIn=25]="BackIn",t[t.BackOut=26]="BackOut",t[t.BackInOut=27]="BackInOut",t[t.BounceIn=28]="BounceIn",t[t.BounceOut=29]="BounceOut",t[t.BounceInOut=30]="BounceInOut",t[t.Custom=31]="Custom"}(EaseType||(EaseType={}));class GearBase{dispose(){this._tweenConfig&&this._tweenConfig._tweener&&(this._tweenConfig._tweener.kill(),this._tweenConfig._tweener=null)}get controller(){return this._controller}set controller(t){t!=this._controller&&(this._controller=t,this._controller&&this.init())}get tweenConfig(){return this._tweenConfig||(this._tweenConfig=new GearTweenConfig),this._tweenConfig}get allowTween(){return this._tweenConfig&&this._tweenConfig.tween&&0==constructingDepth.n&&!GearBase.disableAllTweenEffect}setup(t){var e,i;this._controller=this._owner.parent.getControllerAt(t.readShort()),this.init();var s=t.readShort();if("pages"in this)this.pages=t.readSArray(s);else{for(e=0;e<s;e++)null!=(i=t.readS())&&this.addStatus(i,t);t.readBool()&&this.addStatus(null,t)}if(t.readBool()&&(this._tweenConfig=new GearTweenConfig,this._tweenConfig.easeType=t.readByte(),this._tweenConfig.duration=t.readFloat(),this._tweenConfig.delay=t.readFloat()),t.version>=2)if("positionsInPercent"in this){if(t.readBool()){for(this.positionsInPercent=!0,e=0;e<s;e++)null!=(i=t.readS())&&this.addExtStatus(i,t);t.readBool()&&this.addExtStatus(null,t)}}else"condition"in this&&(this.condition=t.readByte())}updateFromRelations(t,e){}addStatus(t,e){}init(){}apply(){}updateState(){}}class GearTweenConfig{constructor(){this.tween=!0,this.easeType=EaseType.QuadOut,this.duration=.3,this.delay=0}}class GearAnimation extends GearBase{init(){this._default={playing:this._owner.getProp(ObjectPropID.Playing),frame:this._owner.getProp(ObjectPropID.Frame)},this._storage={}}addStatus(t,e){var i;t?(i={},this._storage[t]=i):i=this._default,i.playing=e.readBool(),i.frame=e.readInt()}apply(){this._owner._gearLocked=!0;var t=this._storage[this._controller.selectedPageId]||this._default;this._owner.setProp(ObjectPropID.Playing,t.playing),this._owner.setProp(ObjectPropID.Frame,t.frame),this._owner._gearLocked=!1}updateState(){var t=this._storage[this._controller.selectedPageId];t||(t={},this._storage[this._controller.selectedPageId]=t),t.playing=this._owner.getProp(ObjectPropID.Playing),t.frame=this._owner.getProp(ObjectPropID.Frame)}}class GearColor extends GearBase{init(){this._default={color:this._owner.getProp(ObjectPropID.Color),strokeColor:this._owner.getProp(ObjectPropID.OutlineColor)},this._storage={}}addStatus(t,e){var i;t?(i={},this._storage[t]=i):i=this._default,i.color=e.readColor(),i.strokeColor=e.readColor()}apply(){this._owner._gearLocked=!0;var t=this._storage[this._controller.selectedPageId]||this._default;this._owner.setProp(ObjectPropID.Color,t.color),this._owner.setProp(ObjectPropID.OutlineColor,t.strokeColor),this._owner._gearLocked=!1}updateState(){var t=this._storage[this._controller.selectedPageId];t||(t={},this._storage[this._controller.selectedPageId]=t),t.color=this._owner.getProp(ObjectPropID.Color),t.strokeColor=this._owner.getProp(ObjectPropID.OutlineColor)}}class GearDisplay extends GearBase{constructor(){super(...arguments),this.pages=null,this._visible=0,this._displayLockToken=1}init(){this.pages=null}addLock(){return this._visible++,this._displayLockToken}releaseLock(t){t==this._displayLockToken&&this._visible--}get connected(){return null==this._controller||this._visible>0}apply(){this._displayLockToken++,this._displayLockToken<=0&&(this._displayLockToken=1),null==this.pages||0==this.pages.length||-1!=this.pages.indexOf(this._controller.selectedPageId)?this._visible=1:this._visible=0}}class GearDisplay2 extends GearBase{constructor(){super(...arguments),this.pages=null,this.condition=0,this._visible=0}init(){this.pages=null}apply(){null==this.pages||0==this.pages.length||-1!=this.pages.indexOf(this._controller.selectedPageId)?this._visible=1:this._visible=0}evaluate(t){var e=null==this._controller||this._visible>0;return e=0==this.condition?e&&t:e||t}}class GearFontSize extends GearBase{constructor(){super(...arguments),this._default=0}init(){this._default=this._owner.getProp(ObjectPropID.FontSize),this._storage={}}addStatus(t,e){t?this._storage[t]=e.readInt():this._default=e.readInt()}apply(){this._owner._gearLocked=!0;var t=this._storage[this._controller.selectedPageId];void 0!==t?this._owner.setProp(ObjectPropID.FontSize,t):this._owner.setProp(ObjectPropID.FontSize,this._default),this._owner._gearLocked=!1}updateState(){this._storage[this._controller.selectedPageId]=this._owner.getProp(ObjectPropID.FontSize)}}class GearIcon extends GearBase{init(){this._default=this._owner.icon,this._storage={}}addStatus(t,e){t?this._storage[t]=e.readS():this._default=e.readS()}apply(){this._owner._gearLocked=!0;var t=this._storage[this._controller.selectedPageId];this._owner.icon=void 0!==t?t:this._default,this._owner._gearLocked=!1}updateState(){this._storage[this._controller.selectedPageId]=this._owner.icon}}let Pool$1=class{constructor(t,e,i){this.pool=[],this._init=e,this._reset=i,this._ct=t}borrow(...t){let e;return e=this.pool.length>0?this.pool.pop():new this._ct,this._init&&this._init(e,...t),e}returns(t){if(Array.isArray(t)){let e=t.length;for(let i=0;i<e;i++){let e=t[i];this._reset&&this._reset(e),this.pool.push(e)}t.length=0}else this._reset&&this._reset(t),this.pool.push(t)}};const _PiOver2=.5*Math.PI,_TwoPi=2*Math.PI;function evaluateEase(t,e,i,s,n){switch(t){case EaseType.Linear:return e/i;case EaseType.SineIn:return 1-Math.cos(e/i*_PiOver2);case EaseType.SineOut:return Math.sin(e/i*_PiOver2);case EaseType.SineInOut:return-.5*(Math.cos(Math.PI*e/i)-1);case EaseType.QuadIn:return(e/=i)*e;case EaseType.QuadOut:return-(e/=i)*(e-2);case EaseType.QuadInOut:return(e/=.5*i)<1?.5*e*e:-.5*(--e*(e-2)-1);case EaseType.CubicIn:return(e/=i)*e*e;case EaseType.CubicOut:return(e=e/i-1)*e*e+1;case EaseType.CubicInOut:return(e/=.5*i)<1?.5*e*e*e:.5*((e-=2)*e*e+2);case EaseType.QuartIn:return(e/=i)*e*e*e;case EaseType.QuartOut:return-((e=e/i-1)*e*e*e-1);case EaseType.QuartInOut:return(e/=.5*i)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2);case EaseType.QuintIn:return(e/=i)*e*e*e*e;case EaseType.QuintOut:return(e=e/i-1)*e*e*e*e+1;case EaseType.QuintInOut:return(e/=.5*i)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2);case EaseType.ExpoIn:return 0==e?0:Math.pow(2,10*(e/i-1));case EaseType.ExpoOut:return e==i?1:1-Math.pow(2,-10*e/i);case EaseType.ExpoInOut:return 0==e?0:e==i?1:(e/=.5*i)<1?.5*Math.pow(2,10*(e-1)):.5*(2-Math.pow(2,-10*--e));case EaseType.CircIn:return-(Math.sqrt(1-(e/=i)*e)-1);case EaseType.CircOut:return Math.sqrt(1-(e=e/i-1)*e);case EaseType.CircInOut:return(e/=.5*i)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1);case EaseType.ElasticIn:var r;return 0==e?0:1==(e/=i)?1:(0==n&&(n=.3*i),s<1?(s=1,r=n/4):r=n/_TwoPi*Math.asin(1/s),-s*Math.pow(2,10*(e-=1))*Math.sin((e*i-r)*_TwoPi/n));case EaseType.ElasticOut:var o;return 0==e?0:1==(e/=i)?1:(0==n&&(n=.3*i),s<1?(s=1,o=n/4):o=n/_TwoPi*Math.asin(1/s),s*Math.pow(2,-10*e)*Math.sin((e*i-o)*_TwoPi/n)+1);case EaseType.ElasticInOut:var h;return 0==e?0:2==(e/=.5*i)?1:(0==n&&(n=i*(.3*1.5)),s<1?(s=1,h=n/4):h=n/_TwoPi*Math.asin(1/s),e<1?s*Math.pow(2,10*(e-=1))*Math.sin((e*i-h)*_TwoPi/n)*-.5:s*Math.pow(2,-10*(e-=1))*Math.sin((e*i-h)*_TwoPi/n)*.5+1);case EaseType.BackIn:return(e/=i)*e*((s+1)*e-s);case EaseType.BackOut:return(e=e/i-1)*e*((s+1)*e+s)+1;case EaseType.BackInOut:return(e/=.5*i)<1?e*e*((1+(s*=1.525))*e-s)*.5:.5*((e-=2)*e*((1+(s*=1.525))*e+s)+2);case EaseType.BounceIn:return bounce_easeIn(e,i);case EaseType.BounceOut:return bounce_easeOut(e,i);case EaseType.BounceInOut:return bounce_easeInOut(e,i);default:return-(e/=i)*(e-2)}}function bounce_easeIn(t,e){return 1-bounce_easeOut(e-t,e)}function bounce_easeOut(t,e){return(t/=e)<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}function bounce_easeInOut(t,e){return t<.5*e?.5*bounce_easeIn(2*t,e):.5*bounce_easeOut(2*t-e,e)+.5}class TweenValue{constructor(){this.x=this.y=this.z=this.w=0}get color(){return(this.w<<24)+(this.x<<16)+(this.y<<8)+this.z}set color(t){this.x=(16711680&t)>>16,this.y=(65280&t)>>8,this.z=255&t,this.w=(4278190080&t)>>24}getField(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("Index out of bounds: "+t)}}setField(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("Index out of bounds: "+t)}}setZero(){this.x=this.y=this.z=this.w=0}}var s_vec2$5=new Vec2;class GTweener{constructor(){this._delay=0,this._duration=0,this._breakpoint=0,this._easeType=0,this._easeOvershootOrAmplitude=0,this._easePeriod=0,this._repeat=0,this._yoyo=!1,this._timeScale=1,this._snapping=!1,this._startValue=new TweenValue,this._endValue=new TweenValue,this._value=new TweenValue,this._deltaValue=new TweenValue,this._reset()}setDelay(t){return this._delay=t,this}get delay(){return this._delay}setDuration(t){return this._duration=t,this}get duration(){return this._duration}setBreakpoint(t){return this._breakpoint=t,this}setEase(t){return this._easeType=t,this}setEasePeriod(t){return this._easePeriod=t,this}setEaseOvershootOrAmplitude(t){return this._easeOvershootOrAmplitude=t,this}setRepeat(t,e){return this._repeat=t,this._yoyo=e,this}get repeat(){return this._repeat}setTimeScale(t){return this._timeScale=t,this}setSnapping(t){return this._snapping=t,this}setTarget(t,e){return this._target=t,this._propType=e,this}get target(){return this._target}setPath(t){return this._path=t,this}setUserData(t){return this._userData=t,this}get userData(){return this._userData}onUpdate(t,e){return this._onUpdate=t,this._onUpdateCaller=e,this}onStart(t,e){return this._onStart=t,this._onStartCaller=e,this}onComplete(t,e){return this._onComplete=t,this._onCompleteCaller=e,this}get startValue(){return this._startValue}get endValue(){return this._endValue}get value(){return this._value}get deltaValue(){return this._deltaValue}get normalizedTime(){return this._normalizedTime}get completed(){return 0!=this._ended}get allCompleted(){return 1==this._ended}setPaused(t){return this._paused=t,this}seek(t){if(!this._killed){if(this._elapsedTime=t,this._elapsedTime<this._delay){if(!this._started)return;this._elapsedTime=this._delay}this.update()}}kill(t){this._killed||(t&&(0==this._ended&&(this._breakpoint>=0?this._elapsedTime=this._delay+this._breakpoint:this._repeat>=0?this._elapsedTime=this._delay+this._duration*(this._repeat+1):this._elapsedTime=this._delay+2*this._duration,this.update()),this.callCompleteCallback()),this._killed=!0)}_to(t,e,i){return this._valueSize=1,this._startValue.x=t,this._endValue.x=e,this._value.x=t,this._duration=i,this}_to2(t,e,i,s,n){return this._valueSize=2,this._startValue.x=t,this._endValue.x=i,this._startValue.y=e,this._endValue.y=s,this._value.x=t,this._value.y=e,this._duration=n,this}_to3(t,e,i,s,n,r,o){return this._valueSize=3,this._startValue.x=t,this._endValue.x=s,this._startValue.y=e,this._endValue.y=n,this._startValue.z=i,this._endValue.z=r,this._value.x=t,this._value.y=e,this._value.z=i,this._duration=o,this}_to4(t,e,i,s,n,r,o,h,a){return this._valueSize=4,this._startValue.x=t,this._endValue.x=n,this._startValue.y=e,this._endValue.y=r,this._startValue.z=i,this._endValue.z=o,this._startValue.w=s,this._endValue.w=h,this._value.x=t,this._value.y=e,this._value.z=i,this._value.w=s,this._duration=a,this}_toColor(t,e,i){return this._valueSize=5,this._startValue.color=t,this._endValue.color=e,this._value.color=t,this._duration=i,this}_shake(t,e,i,s){return this._valueSize=6,this._startValue.x=t,this._startValue.y=e,this._startValue.w=i,this._duration=s,this}_init(){this._delay=0,this._duration=0,this._breakpoint=-1,this._easeType=EaseType.QuadOut,this._timeScale=1,this._easePeriod=0,this._easeOvershootOrAmplitude=1.70158,this._snapping=!1,this._repeat=0,this._yoyo=!1,this._valueSize=0,this._started=!1,this._paused=!1,this._killed=!1,this._elapsedTime=0,this._normalizedTime=0,this._ended=0}_reset(){this._target=null,this._propType=null,this._userData=null,this._path=null,this._onStart=this._onUpdate=this._onComplete=null,this._onStartCaller=this._onUpdateCaller=this._onCompleteCaller=null}_update(t){if(1!=this._timeScale&&(t*=this._timeScale),0!=t){if(0!=this._ended)return this.callCompleteCallback(),void(this._killed=!0);this._elapsedTime+=t,this.update(),0!=this._ended&&(this._killed||(this.callCompleteCallback(),this._killed=!0))}}update(){if(this._ended=0,0!=this._valueSize){if(!this._started){if(this._elapsedTime<this._delay)return;if(this._started=!0,this.callStartCallback(),this._killed)return}var t=!1,e=this._elapsedTime-this._delay;if(this._breakpoint>=0&&e>=this._breakpoint&&(e=this._breakpoint,this._ended=2),0!=this._repeat){var i=Math.floor(e/this._duration);e-=this._duration*i,this._yoyo&&(t=i%2==1),this._repeat>0&&this._repeat-i<0&&(this._yoyo&&(t=this._repeat%2==1),e=this._duration,this._ended=1)}else e>=this._duration&&(e=this._duration,this._ended=1);if(this._normalizedTime=evaluateEase(this._easeType,t?this._duration-e:e,this._duration,this._easeOvershootOrAmplitude,this._easePeriod),this._value.setZero(),this._deltaValue.setZero(),6==this._valueSize)if(0==this._ended){var s=this._startValue.w*(1-this._normalizedTime),n=s*(Math.random()>.5?1:-1),r=s*(Math.random()>.5?1:-1);this._deltaValue.x=n,this._deltaValue.y=r,this._value.x=this._startValue.x+n,this._value.y=this._startValue.y+r}else this._value.x=this._startValue.x,this._value.y=this._startValue.y;else if(this._path){let t=this._path.getPointAt(this._normalizedTime,s_vec2$5);this._snapping&&(t.x=Math.round(t.x),t.y=Math.round(t.y)),this._deltaValue.x=t.x-this._value.x,this._deltaValue.y=t.y-this._value.y,this._value.x=t.x,this._value.y=t.y}else{let t=Math.min(this._valueSize,4);for(var o=0;o<t;o++){var h=this._startValue.getField(o),a=h+(this._endValue.getField(o)-h)*this._normalizedTime;this._snapping&&(a=Math.round(a)),this._deltaValue.setField(o,a-this._value.getField(o)),this._value.setField(o,a)}}if(this._target&&this._propType)if(this._propType instanceof Function)switch(this._valueSize){case 1:this._propType.call(this._target,this._value.x);break;case 2:this._propType.call(this._target,this._value.x,this._value.y);break;case 3:this._propType.call(this._target,this._value.x,this._value.y,this._value.z);break;case 4:this._propType.call(this._target,this._value.x,this._value.y,this._value.z,this._value.w);break;case 5:this._propType.call(this._target,this._value.color);break;case 6:this._propType.call(this._target,this._value.x,this._value.y)}else 5==this._valueSize?this._target[this._propType]=this._value.color:this._target[this._propType]=this._value.x;this.callUpdateCallback()}else this._elapsedTime>=this._delay+this._duration&&(this._ended=1)}callStartCallback(){if(this._onStart)try{this._onStart.call(this._onStartCaller,this)}catch(t){console.log("error in start callback > "+t)}}callUpdateCallback(){if(this._onUpdate)try{this._onUpdate.call(this._onUpdateCaller,this)}catch(t){console.log("error in update callback > "+t)}}callCompleteCallback(){if(this._onComplete)try{this._onComplete.call(this._onCompleteCaller,this)}catch(t){console.log("error in complete callback > "+t)}}}class TweenManager{static createTween(){_root||(_root=new Node("[TweenManager]"),game.addPersistRootNode(_root),director.getScheduler().schedule(TweenManager.update,_root,0,macro.REPEAT_FOREVER,0,!1));var t=_tweenerPool.borrow();return _activeTweens[_totalActiveTweens++]=t,t}static isTweening(t,e){if(null==t)return!1;for(var i=!e,s=0;s<_totalActiveTweens;s++){var n=_activeTweens[s];if(n&&n.target==t&&!n._killed&&(i||n._propType==e))return!0}return!1}static killTweens(t,e,i){if(null==t)return!1;for(var s=!1,n=_totalActiveTweens,r=!i,o=0;o<n;o++){var h=_activeTweens[o];!h||h.target!=t||h._killed||!r&&h._propType!=i||(h.kill(e),s=!0)}return s}static getTween(t,e){if(null==t)return null;for(var i=_totalActiveTweens,s=!e,n=0;n<i;n++){var r=_activeTweens[n];if(r&&r.target==t&&!r._killed&&(s||r._propType==e))return r}return null}static update(t){let e=_activeTweens;for(var i=_totalActiveTweens,s=-1,n=0;n<i;n++){var r=e[n];null==r?-1==s&&(s=n):r._killed?(r._reset(),_tweenerPool.returns(r),e[n]=null,-1==s&&(s=n)):(r._target&&"isDisposed"in r._target&&r._target.isDisposed?r._killed=!0:r._paused||r._update(t),-1!=s&&(e[s]=r,e[n]=null,s++))}if(s>=0){if(_totalActiveTweens!=i){var o=i;for(i=_totalActiveTweens-i,n=0;n<i;n++)e[s++]=e[o++]}_totalActiveTweens=s}return!1}}var _root,_activeTweens=new Array,_tweenerPool=new Pool$1(GTweener,t=>t._init(),t=>t._reset()),_totalActiveTweens=0;class GTween{static to(t,e,i){return TweenManager.createTween()._to(t,e,i)}static to2(t,e,i,s,n){return TweenManager.createTween()._to2(t,e,i,s,n)}static to3(t,e,i,s,n,r,o){return TweenManager.createTween()._to3(t,e,i,s,n,r,o)}static to4(t,e,i,s,n,r,o,h,a){return TweenManager.createTween()._to4(t,e,i,s,n,r,o,h,a)}static toColor(t,e,i){return TweenManager.createTween()._toColor(t,e,i)}static delayedCall(t){return TweenManager.createTween().setDelay(t)}static shake(t,e,i,s){return TweenManager.createTween()._shake(t,e,i,s)}static isTweening(t,e){return TweenManager.isTweening(t,e)}static kill(t,e,i){TweenManager.killTweens(t,e,i)}static getTween(t,e){return TweenManager.getTween(t,e)}}GTween.catchCallbackExceptions=!0;class GearLook extends GearBase{init(){this._default={alpha:this._owner.alpha,rotation:this._owner.rotation,grayed:this._owner.grayed,touchable:this._owner.touchable},this._storage={}}addStatus(t,e){var i;t?(i={},this._storage[t]=i):i=this._default,i.alpha=e.readFloat(),i.rotation=e.readFloat(),i.grayed=e.readBool(),i.touchable=e.readBool()}apply(){var t=this._storage[this._controller.selectedPageId]||this._default;if(this.allowTween){if(this._owner._gearLocked=!0,this._owner.grayed=t.grayed,this._owner.touchable=t.touchable,this._owner._gearLocked=!1,this._tweenConfig._tweener){if(this._tweenConfig._tweener.endValue.x==t.alpha&&this._tweenConfig._tweener.endValue.y==t.rotation)return;this._tweenConfig._tweener.kill(!0),this._tweenConfig._tweener=null}var e=t.alpha!=this._owner.alpha,i=t.rotation!=this._owner.rotation;(e||i)&&(this._owner.checkGearController(0,this._controller)&&(this._tweenConfig._displayLockToken=this._owner.addDisplayLock()),this._tweenConfig._tweener=GTween.to2(this._owner.alpha,this._owner.rotation,t.alpha,t.rotation,this._tweenConfig.duration).setDelay(this._tweenConfig.delay).setEase(this._tweenConfig.easeType).setUserData((e?1:0)+(i?2:0)).setTarget(this).onUpdate(this.__tweenUpdate,this).onComplete(this.__tweenComplete,this))}else this._owner._gearLocked=!0,this._owner.grayed=t.grayed,this._owner.alpha=t.alpha,this._owner.rotation=t.rotation,this._owner.touchable=t.touchable,this._owner._gearLocked=!1}__tweenUpdate(t){var e=t.userData;this._owner._gearLocked=!0,0!=(1&e)&&(this._owner.alpha=t.value.x),0!=(2&e)&&(this._owner.rotation=t.value.y),this._owner._gearLocked=!1}__tweenComplete(){0!=this._tweenConfig._displayLockToken&&(this._owner.releaseDisplayLock(this._tweenConfig._displayLockToken),this._tweenConfig._displayLockToken=0),this._tweenConfig._tweener=null}updateState(){var t=this._storage[this._controller.selectedPageId];t||(t={},this._storage[this._controller.selectedPageId]=t),t.alpha=this._owner.alpha,t.rotation=this._owner.rotation,t.grayed=this._owner.grayed,t.touchable=this._owner.touchable}}class GearSize extends GearBase{init(){this._default={width:this._owner.width,height:this._owner.height,scaleX:this._owner.scaleX,scaleY:this._owner.scaleY},this._storage={}}addStatus(t,e){var i;t?(i={},this._storage[t]=i):i=this._default,i.width=e.readInt(),i.height=e.readInt(),i.scaleX=e.readFloat(),i.scaleY=e.readFloat()}apply(){var t=this._storage[this._controller.selectedPageId]||this._default;if(this.allowTween){if(this._tweenConfig._tweener){if(this._tweenConfig._tweener.endValue.x==t.width&&this._tweenConfig._tweener.endValue.y==t.height&&this._tweenConfig._tweener.endValue.z==t.scaleX&&this._tweenConfig._tweener.endValue.w==t.scaleY)return;this._tweenConfig._tweener.kill(!0),this._tweenConfig._tweener=null}var e=t.width!=this._owner.width||t.height!=this._owner.height,i=t.scaleX!=this._owner.scaleX||t.scaleY!=this._owner.scaleY;(e||i)&&(this._owner.checkGearController(0,this._controller)&&(this._tweenConfig._displayLockToken=this._owner.addDisplayLock()),this._tweenConfig._tweener=GTween.to4(this._owner.width,this._owner.height,this._owner.scaleX,this._owner.scaleY,t.width,t.height,t.scaleX,t.scaleY,this._tweenConfig.duration).setDelay(this._tweenConfig.delay).setEase(this._tweenConfig.easeType).setUserData((e?1:0)+(i?2:0)).setTarget(this).onUpdate(this.__tweenUpdate,this).onComplete(this.__tweenComplete,this))}else this._owner._gearLocked=!0,this._owner.setSize(t.width,t.height,this._owner.checkGearController(1,this._controller)),this._owner.setScale(t.scaleX,t.scaleY),this._owner._gearLocked=!1}__tweenUpdate(t){var e=t.userData;this._owner._gearLocked=!0,0!=(1&e)&&this._owner.setSize(t.value.x,t.value.y,this._owner.checkGearController(1,this._controller)),0!=(2&e)&&this._owner.setScale(t.value.z,t.value.w),this._owner._gearLocked=!1}__tweenComplete(){0!=this._tweenConfig._displayLockToken&&(this._owner.releaseDisplayLock(this._tweenConfig._displayLockToken),this._tweenConfig._displayLockToken=0),this._tweenConfig._tweener=null}updateState(){var t=this._storage[this._controller.selectedPageId];t||(t={},this._storage[this._controller.selectedPageId]=t),t.width=this._owner.width,t.height=this._owner.height,t.scaleX=this._owner.scaleX,t.scaleY=this._owner.scaleY}updateFromRelations(t,e){if(null!=this._controller&&null!=this._storage){for(var i in this._storage){var s=this._storage[i];s.width+=t,s.height+=e}this._default.width+=t,this._default.height+=e,this.updateState()}}}class GearText extends GearBase{init(){this._default=this._owner.text,this._storage={}}addStatus(t,e){null==t?this._default=e.readS():this._storage[t]=e.readS()}apply(){this._owner._gearLocked=!0;var t=this._storage[this._controller.selectedPageId];this._owner.text=void 0!==t?t:this._default,this._owner._gearLocked=!1}updateState(){this._storage[this._controller.selectedPageId]=this._owner.text}}class GearXY extends GearBase{init(){this._default={x:this._owner.x,y:this._owner.y,px:this._owner.x/this._owner.parent.width,py:this._owner.y/this._owner.parent.height},this._storage={}}addStatus(t,e){var i;t?(i={},this._storage[t]=i):i=this._default,i.x=e.readInt(),i.y=e.readInt()}addExtStatus(t,e){var i;(i=t?this._storage[t]:this._default).px=e.readFloat(),i.py=e.readFloat()}apply(){var t,e,i=this._storage[this._controller.selectedPageId]||this._default;if(this.positionsInPercent&&this._owner.parent?(t=i.px*this._owner.parent.width,e=i.py*this._owner.parent.height):(t=i.x,e=i.y),this.allowTween){if(this._tweenConfig._tweener){if(this._tweenConfig._tweener.endValue.x==t&&this._tweenConfig._tweener.endValue.y==e)return;this._tweenConfig._tweener.kill(!0),this._tweenConfig._tweener=null}var s=this._owner.x,n=this._owner.y;s==t&&n==e||(this._owner.checkGearController(0,this._controller)&&(this._tweenConfig._displayLockToken=this._owner.addDisplayLock()),this._tweenConfig._tweener=GTween.to2(s,n,t,e,this._tweenConfig.duration).setDelay(this._tweenConfig.delay).setEase(this._tweenConfig.easeType).setTarget(this).onUpdate(this.__tweenUpdate,this).onComplete(this.__tweenComplete,this))}else this._owner._gearLocked=!0,this._owner.setPosition(t,e),this._owner._gearLocked=!1}__tweenUpdate(t){this._owner._gearLocked=!0,this._owner.setPosition(t.value.x,t.value.y),this._owner._gearLocked=!1}__tweenComplete(){0!=this._tweenConfig._displayLockToken&&(this._owner.releaseDisplayLock(this._tweenConfig._displayLockToken),this._tweenConfig._displayLockToken=0),this._tweenConfig._tweener=null}updateState(){var t=this._storage[this._controller.selectedPageId];t||(t={},this._storage[this._controller.selectedPageId]=t),t.x=this._owner.x,t.y=this._owner.y,t.px=this._owner.x/this._owner.parent.width,t.py=this._owner.y/this._owner.parent.height}updateFromRelations(t,e){if(null!=this._controller&&null!=this._storage&&!this.positionsInPercent){for(var i in this._storage){var s=this._storage[i];s.x+=t,s.y+=e}this._default.x+=t,this._default.y+=e,this.updateState()}}}class RelationItem{constructor(t){this._owner=t,this._defs=new Array}get owner(){return this._owner}set target(t){this._target!=t&&(this._target&&this.releaseRefTarget(this._target),this._target=t,this._target&&this.addRefTarget(this._target))}get target(){return this._target}add(t,e){if(t==RelationType.Size)return this.add(RelationType.Width,e),void this.add(RelationType.Height,e);for(var i=this._defs.length,s=0;s<i;s++){if(this._defs[s].type==t)return}this.internalAdd(t,e)}internalAdd(t,e){if(t==RelationType.Size)return this.internalAdd(RelationType.Width,e),void this.internalAdd(RelationType.Height,e);var i=new RelationDef;i.percent=e,i.type=t,i.axis=t<=RelationType.Right_Right||t==RelationType.Width||t>=RelationType.LeftExt_Left&&t<=RelationType.RightExt_Right?0:1,this._defs.push(i)}remove(t){if(t==RelationType.Size)return this.remove(RelationType.Width),void this.remove(RelationType.Height);for(var e=this._defs.length,i=0;i<e;i++)if(this._defs[i].type==t){this._defs.splice(i,1);break}}copyFrom(t){this.target=t.target,this._defs.length=0;for(var e=t._defs.length,i=0;i<e;i++){var s=t._defs[i],n=new RelationDef;n.copyFrom(s),this._defs.push(n)}}dispose(){this._target&&(this.releaseRefTarget(this._target),this._target=null)}get isEmpty(){return 0==this._defs.length}applyOnSelfResized(t,e,i){for(var s=this._owner.x,n=this._owner.y,r=this._defs.length,o=0;o<r;o++){switch(this._defs[o].type){case RelationType.Center_Center:this._owner.x-=(.5-(i?this._owner.pivotX:0))*t;break;case RelationType.Right_Center:case RelationType.Right_Left:case RelationType.Right_Right:this._owner.x-=(1-(i?this._owner.pivotX:0))*t;break;case RelationType.Middle_Middle:this._owner.y-=(.5-(i?this._owner.pivotY:0))*e;break;case RelationType.Bottom_Middle:case RelationType.Bottom_Top:case RelationType.Bottom_Bottom:this._owner.y-=(1-(i?this._owner.pivotY:0))*e}}if((s!=this._owner.x||n!=this._owner.y)&&(s=this._owner.x-s,n=this._owner.y-n,this._owner.updateGearFromRelations(1,s,n),this._owner.parent)){var h=this._owner.parent._transitions.length;if(h>0)for(o=0;o<h;++o)this._owner.parent._transitions[o].updateFromRelations(this._owner.id,s,n)}}applyOnXYChanged(t,e,i){var s;switch(t.type){case RelationType.Left_Left:case RelationType.Left_Center:case RelationType.Left_Right:case RelationType.Center_Center:case RelationType.Right_Left:case RelationType.Right_Center:case RelationType.Right_Right:this._owner.x+=e;break;case RelationType.Top_Top:case RelationType.Top_Middle:case RelationType.Top_Bottom:case RelationType.Middle_Middle:case RelationType.Bottom_Top:case RelationType.Bottom_Middle:case RelationType.Bottom_Bottom:this._owner.y+=i;break;case RelationType.Width:case RelationType.Height:break;case RelationType.LeftExt_Left:case RelationType.LeftExt_Right:this._owner!=this._target.parent?(s=this._owner.xMin,this._owner.width=this._owner._rawWidth-e,this._owner.xMin=s+e):this._owner.width=this._owner._rawWidth-e;break;case RelationType.RightExt_Left:case RelationType.RightExt_Right:this._owner!=this._target.parent?(s=this._owner.xMin,this._owner.width=this._owner._rawWidth+e,this._owner.xMin=s):this._owner.width=this._owner._rawWidth+e;break;case RelationType.TopExt_Top:case RelationType.TopExt_Bottom:this._owner!=this._target.parent?(s=this._owner.yMin,this._owner.height=this._owner._rawHeight-i,this._owner.yMin=s+i):this._owner.height=this._owner._rawHeight-i;break;case RelationType.BottomExt_Top:case RelationType.BottomExt_Bottom:this._owner!=this._target.parent?(s=this._owner.yMin,this._owner.height=this._owner._rawHeight+i,this._owner.yMin=s):this._owner.height=this._owner._rawHeight+i}}applyOnSizeChanged(t){var e,i,s=0,n=0,r=0;switch(0==t.axis?(this._target!=this._owner.parent&&(s=this._target.x,this._target.pivotAsAnchor&&(n=this._target.pivotX)),t.percent?0!=this._targetWidth&&(r=this._target._width/this._targetWidth):r=this._target._width-this._targetWidth):(this._target!=this._owner.parent&&(s=this._target.y,this._target.pivotAsAnchor&&(n=this._target.pivotY)),t.percent?0!=this._targetHeight&&(r=this._target._height/this._targetHeight):r=this._target._height-this._targetHeight),t.type){case RelationType.Left_Left:t.percent?this._owner.xMin=s+(this._owner.xMin-s)*r:0!=n&&(this._owner.x+=r*-n);break;case RelationType.Left_Center:t.percent?this._owner.xMin=s+(this._owner.xMin-s)*r:this._owner.x+=r*(.5-n);break;case RelationType.Left_Right:t.percent?this._owner.xMin=s+(this._owner.xMin-s)*r:this._owner.x+=r*(1-n);break;case RelationType.Center_Center:t.percent?this._owner.xMin=s+(this._owner.xMin+.5*this._owner._rawWidth-s)*r-.5*this._owner._rawWidth:this._owner.x+=r*(.5-n);break;case RelationType.Right_Left:t.percent?this._owner.xMin=s+(this._owner.xMin+this._owner._rawWidth-s)*r-this._owner._rawWidth:0!=n&&(this._owner.x+=r*-n);break;case RelationType.Right_Center:t.percent?this._owner.xMin=s+(this._owner.xMin+this._owner._rawWidth-s)*r-this._owner._rawWidth:this._owner.x+=r*(.5-n);break;case RelationType.Right_Right:t.percent?this._owner.xMin=s+(this._owner.xMin+this._owner._rawWidth-s)*r-this._owner._rawWidth:this._owner.x+=r*(1-n);break;case RelationType.Top_Top:t.percent?this._owner.yMin=s+(this._owner.yMin-s)*r:0!=n&&(this._owner.y+=r*-n);break;case RelationType.Top_Middle:t.percent?this._owner.yMin=s+(this._owner.yMin-s)*r:this._owner.y+=r*(.5-n);break;case RelationType.Top_Bottom:t.percent?this._owner.yMin=s+(this._owner.yMin-s)*r:this._owner.y+=r*(1-n);break;case RelationType.Middle_Middle:t.percent?this._owner.yMin=s+(this._owner.yMin+.5*this._owner._rawHeight-s)*r-.5*this._owner._rawHeight:this._owner.y+=r*(.5-n);break;case RelationType.Bottom_Top:t.percent?this._owner.yMin=s+(this._owner.yMin+this._owner._rawHeight-s)*r-this._owner._rawHeight:0!=n&&(this._owner.y+=r*-n);break;case RelationType.Bottom_Middle:t.percent?this._owner.yMin=s+(this._owner.yMin+this._owner._rawHeight-s)*r-this._owner._rawHeight:this._owner.y+=r*(.5-n);break;case RelationType.Bottom_Bottom:t.percent?this._owner.yMin=s+(this._owner.yMin+this._owner._rawHeight-s)*r-this._owner._rawHeight:this._owner.y+=r*(1-n);break;case RelationType.Width:e=this._owner._underConstruct&&this._owner==this._target.parent?this._owner.sourceWidth-this._target.initWidth:this._owner._rawWidth-this._targetWidth,t.percent&&(e*=r),this._target==this._owner.parent?this._owner.pivotAsAnchor?(i=this._owner.xMin,this._owner.setSize(this._target._width+e,this._owner._rawHeight,!0),this._owner.xMin=i):this._owner.setSize(this._target._width+e,this._owner._rawHeight,!0):this._owner.width=this._target._width+e;break;case RelationType.Height:e=this._owner._underConstruct&&this._owner==this._target.parent?this._owner.sourceHeight-this._target.initHeight:this._owner._rawHeight-this._targetHeight,t.percent&&(e*=r),this._target==this._owner.parent?this._owner.pivotAsAnchor?(i=this._owner.yMin,this._owner.setSize(this._owner._rawWidth,this._target._height+e,!0),this._owner.yMin=i):this._owner.setSize(this._owner._rawWidth,this._target._height+e,!0):this._owner.height=this._target._height+e;break;case RelationType.LeftExt_Left:i=this._owner.xMin,e=t.percent?s+(i-s)*r-i:r*-n,this._owner.width=this._owner._rawWidth-e,this._owner.xMin=i+e;break;case RelationType.LeftExt_Right:i=this._owner.xMin,e=t.percent?s+(i-s)*r-i:r*(1-n),this._owner.width=this._owner._rawWidth-e,this._owner.xMin=i+e;break;case RelationType.RightExt_Left:i=this._owner.xMin,e=t.percent?s+(i+this._owner._rawWidth-s)*r-(i+this._owner._rawWidth):r*-n,this._owner.width=this._owner._rawWidth+e,this._owner.xMin=i;break;case RelationType.RightExt_Right:i=this._owner.xMin,t.percent?this._owner==this._target.parent?this._owner._underConstruct?this._owner.width=s+this._target._width-this._target._width*n+(this._owner.sourceWidth-s-this._target.initWidth+this._target.initWidth*n)*r:this._owner.width=s+(this._owner._rawWidth-s)*r:(e=s+(i+this._owner._rawWidth-s)*r-(i+this._owner._rawWidth),this._owner.width=this._owner._rawWidth+e,this._owner.xMin=i):this._owner==this._target.parent?this._owner._underConstruct?this._owner.width=this._owner.sourceWidth+(this._target._width-this._target.initWidth)*(1-n):this._owner.width=this._owner._rawWidth+r*(1-n):(e=r*(1-n),this._owner.width=this._owner._rawWidth+e,this._owner.xMin=i);break;case RelationType.TopExt_Top:i=this._owner.yMin,e=t.percent?s+(i-s)*r-i:r*-n,this._owner.height=this._owner._rawHeight-e,this._owner.yMin=i+e;break;case RelationType.TopExt_Bottom:i=this._owner.yMin,e=t.percent?s+(i-s)*r-i:r*(1-n),this._owner.height=this._owner._rawHeight-e,this._owner.yMin=i+e;break;case RelationType.BottomExt_Top:i=this._owner.yMin,e=t.percent?s+(i+this._owner._rawHeight-s)*r-(i+this._owner._rawHeight):r*-n,this._owner.height=this._owner._rawHeight+e,this._owner.yMin=i;break;case RelationType.BottomExt_Bottom:i=this._owner.yMin,t.percent?this._owner==this._target.parent?this._owner._underConstruct?this._owner.height=s+this._target._height-this._target._height*n+(this._owner.sourceHeight-s-this._target.initHeight+this._target.initHeight*n)*r:this._owner.height=s+(this._owner._rawHeight-s)*r:(e=s+(i+this._owner._rawHeight-s)*r-(i+this._owner._rawHeight),this._owner.height=this._owner._rawHeight+e,this._owner.yMin=i):this._owner==this._target.parent?this._owner._underConstruct?this._owner.height=this._owner.sourceHeight+(this._target._height-this._target.initHeight)*(1-n):this._owner.height=this._owner._rawHeight+r*(1-n):(e=r*(1-n),this._owner.height=this._owner._rawHeight+e,this._owner.yMin=i)}}addRefTarget(t){t!=this._owner.parent&&t.on(FGUIEvent.XY_CHANGED,this.__targetXYChanged,this),t.on(FGUIEvent.SIZE_CHANGED,this.__targetSizeChanged,this),t.on(FGUIEvent.SIZE_DELAY_CHANGE,this.__targetSizeWillChange,this),this._targetX=this._target.x,this._targetY=this._target.y,this._targetWidth=this._target._width,this._targetHeight=this._target._height}releaseRefTarget(t){t.node&&(t.off(FGUIEvent.XY_CHANGED,this.__targetXYChanged,this),t.off(FGUIEvent.SIZE_CHANGED,this.__targetSizeChanged,this),t.off(FGUIEvent.SIZE_DELAY_CHANGE,this.__targetSizeWillChange,this))}__targetXYChanged(t){if(null!=this._owner.relations.handling||null!=this._owner.group&&this._owner.group._updating)return this._targetX=this._target.x,void(this._targetY=this._target.y);this._owner.relations.handling=this._target;for(var e=this._owner.x,i=this._owner.y,s=this._target.x-this._targetX,n=this._target.y-this._targetY,r=this._defs.length,o=0;o<r;o++){var h=this._defs[o];this.applyOnXYChanged(h,s,n)}if(this._targetX=this._target.x,this._targetY=this._target.y,(e!=this._owner.x||i!=this._owner.y)&&(e=this._owner.x-e,i=this._owner.y-i,this._owner.updateGearFromRelations(1,e,i),this._owner.parent)){var a=this._owner.parent._transitions.length;if(a>0)for(o=0;o<a;++o)this._owner.parent._transitions[o].updateFromRelations(this._owner.id,e,i)}this._owner.relations.handling=null}__targetSizeChanged(t){if(null==this._owner.relations.handling){this._owner.relations.handling=this._target;for(var e=this._owner.x,i=this._owner.y,s=this._owner._rawWidth,n=this._owner._rawHeight,r=this._defs.length,o=0;o<r;o++){var h=this._defs[o];this.applyOnSizeChanged(h)}if(this._targetWidth=this._target._width,this._targetHeight=this._target._height,(e!=this._owner.x||i!=this._owner.y)&&(e=this._owner.x-e,i=this._owner.y-i,this._owner.updateGearFromRelations(1,e,i),this._owner.parent)){var a=this._owner.parent._transitions.length;if(a>0)for(o=0;o<a;++o)this._owner.parent._transitions[o].updateFromRelations(this._owner.id,e,i)}s==this._owner._rawWidth&&n==this._owner._rawHeight||(s=this._owner._rawWidth-s,n=this._owner._rawHeight-n,this._owner.updateGearFromRelations(2,s,n)),this._owner.relations.handling=null}}__targetSizeWillChange(t){this._owner.relations.sizeDirty=!0}}class RelationDef{constructor(){this.percent=!1,this.type=0,this.axis=0}copyFrom(t){this.percent=t.percent,this.type=t.type,this.axis=t.axis}}class Relations{constructor(t){this.sizeDirty=!1,this._owner=t,this._items=new Array}add(t,e,i){for(var s=this._items.length,n=0;n<s;n++){var r=this._items[n];if(r.target==t)return void r.add(e,i)}var o=new RelationItem(this._owner);o.target=t,o.add(e,i),this._items.push(o)}remove(t,e){e=e||0;for(var i=this._items.length,s=0;s<i;){var n=this._items[s];n.target==t?(n.remove(e),n.isEmpty?(n.dispose(),this._items.splice(s,1),i--):s++):s++}}contains(t){for(var e=this._items.length,i=0;i<e;i++){if(this._items[i].target==t)return!0}return!1}clearFor(t){for(var e=this._items.length,i=0;i<e;){var s=this._items[i];s.target==t?(s.dispose(),this._items.splice(i,1),e--):i++}}clearAll(){for(var t=this._items.length,e=0;e<t;e++){this._items[e].dispose()}this._items.length=0}copyFrom(t){this.clearAll();for(var e=t._items,i=e.length,s=0;s<i;s++){var n=e[s],r=new RelationItem(this._owner);r.copyFrom(n),this._items.push(r)}}dispose(){this.clearAll()}onOwnerSizeChanged(t,e,i){if(0!=this._items.length)for(var s=this._items.length,n=0;n<s;n++){this._items[n].applyOnSelfResized(t,e,i)}}ensureRelationsSizeCorrect(){if(0!=this._items.length){this.sizeDirty=!1;for(var t=this._items.length,e=0;e<t;e++){this._items[e].target.ensureSizeCorrect()}}}get empty(){return 0==this._items.length}setup(t,e){for(var i,s=t.readByte(),n=0;n<s;n++){var r=t.readShort();i=-1==r?this._owner.parent:e?this._owner.getChildAt(r):this._owner.parent.getChildAt(r);var o=new RelationItem(this._owner);o.target=i,this._items.push(o);for(var h=t.readByte(),a=0;a<h;a++){var l=t.readByte(),_=t.readBool();o.internalAdd(l,_)}}}}class UIConfig{constructor(){}}UIConfig.defaultFont="Arial",UIConfig.modalLayerColor=new Color(51,51,51,51),UIConfig.buttonSoundVolumeScale=1,UIConfig.defaultScrollStep=25,UIConfig.defaultScrollDecelerationRate=.967,UIConfig.defaultScrollBarDisplay=ScrollBarDisplayType.Visible,UIConfig.defaultScrollTouchEffect=!0,UIConfig.defaultScrollBounceEffect=!0,UIConfig.defaultComboBoxVisibleItemCount=10,UIConfig.touchScrollSensitivity=20,UIConfig.touchDragSensitivity=10,UIConfig.clickDragSensitivity=2,UIConfig.bringWindowToFrontOnClick=!0,UIConfig.frameTimeForAsyncUIConstruction=.002,UIConfig.linkUnderline=!0,UIConfig.defaultUILayer=Layers.Enum.UI_2D;let _fontRegistry={};function registerFont(t,e,i){e instanceof Font?_fontRegistry[t]=e:(i||resources).load(t,Font,(e,i)=>{_fontRegistry[t]=i})}function getFontByName(t){return _fontRegistry[t]}class GObject{constructor(){this._x=0,this._y=0,this._alpha=1,this._visible=!0,this._touchable=!0,this._skewX=0,this._skewY=0,this._sortingOrder=0,this._internalVisible=!0,this.sourceWidth=0,this.sourceHeight=0,this.initWidth=0,this.initHeight=0,this.minWidth=0,this.minHeight=0,this.maxWidth=0,this.maxHeight=0,this._width=0,this._height=0,this._rawWidth=0,this._rawHeight=0,this._underConstruct=!1,this._sizePercentInGroup=0,this._node=new Node,this._uiTrans=this._node.addComponent(UITransform),this._uiOpacity=this.node.addComponent(UIOpacity),this._node.$gobj=this,this._node.layer=UIConfig.defaultUILayer,this._uiTrans.setAnchorPoint(0,1),this._node.on(Node.EventType.ANCHOR_CHANGED,this.handleAnchorChanged,this),this._id=this._node.uuid,this._name="",this._relations=new Relations(this),this._gears=new Array(10),this._blendMode=BlendMode.Normal,this._partner=this._node.addComponent(GObjectPartner)}get id(){return this._id}get name(){return this._name}set name(t){this._name=t}get x(){return this._x}set x(t){this.setPosition(t,this._y)}get y(){return this._y}set y(t){this.setPosition(this._x,t)}setPosition(t,e){if(this._x!=t||this._y!=e){var i=t-this._x,s=e-this._y;this._x=t,this._y=e,this.handlePositionChanged(),this instanceof GGroup&&this.moveChildren(i,s),this.updateGear(1),this._parent&&!("setVirtual"in this._parent)&&(this._parent.setBoundsChangedFlag(),this._group&&this._group.setBoundsChangedFlag(!0),this._node.emit(FGUIEvent.XY_CHANGED,this)),GObject.draggingObject!=this||s_dragging||this.localToGlobalRect(0,0,this._width,this._height,sGlobalRect)}}get xMin(){return this._pivotAsAnchor?this._x-this._width*this._uiTrans.anchorX:this._x}set xMin(t){this._pivotAsAnchor?this.setPosition(t+this._width*this._uiTrans.anchorX,this._y):this.setPosition(t,this._y)}get yMin(){return this._pivotAsAnchor?this._y-this._height*(1-this._uiTrans.anchorY):this._y}set yMin(t){this._pivotAsAnchor?this.setPosition(this._x,t+this._height*(1-this._uiTrans.anchorY)):this.setPosition(this._x,t)}get pixelSnapping(){return this._pixelSnapping}set pixelSnapping(t){this._pixelSnapping!=t&&(this._pixelSnapping=t,this.handlePositionChanged())}center(t){var e;e=this._parent?this.parent:Decls$1.GRoot.inst,this.setPosition((e.width-this._width)/2,(e.height-this._height)/2),t&&(this.addRelation(e,RelationType.Center_Center),this.addRelation(e,RelationType.Middle_Middle))}get width(){return this.ensureSizeCorrect(),this._relations.sizeDirty&&this._relations.ensureRelationsSizeCorrect(),this._width}set width(t){this.setSize(t,this._rawHeight)}get height(){return this.ensureSizeCorrect(),this._relations.sizeDirty&&this._relations.ensureRelationsSizeCorrect(),this._height}set height(t){this.setSize(this._rawWidth,t)}setSize(t,e,i){if(this._rawWidth!=t||this._rawHeight!=e){this._rawWidth=t,this._rawHeight=e,t<this.minWidth&&(t=this.minWidth),e<this.minHeight&&(e=this.minHeight),this.maxWidth>0&&t>this.maxWidth&&(t=this.maxWidth),this.maxHeight>0&&e>this.maxHeight&&(e=this.maxHeight);var s=t-this._width,n=e-this._height;this._width=t,this._height=e,this.handleSizeChanged(),0==this._uiTrans.anchorX&&1==this._uiTrans.anchorY||this._pivotAsAnchor||i?this.handlePositionChanged():this.setPosition(this.x-this._uiTrans.anchorX*s,this.y-(1-this._uiTrans.anchorY)*n),this instanceof GGroup&&this.resizeChildren(s,n),this.updateGear(2),this._parent&&(this._relations.onOwnerSizeChanged(s,n,this._pivotAsAnchor||!i),this._parent.setBoundsChangedFlag(),this._group&&this._group.setBoundsChangedFlag()),this._node.emit(FGUIEvent.SIZE_CHANGED,this)}}makeFullScreen(){this.setSize(Decls$1.GRoot.inst.width,Decls$1.GRoot.inst.height)}ensureSizeCorrect(){}get actualWidth(){return this.width*Math.abs(this._node.scale.x)}get actualHeight(){return this.height*Math.abs(this._node.scale.y)}get scaleX(){return this._node.scale.x}set scaleX(t){this.setScale(t,this._node.scale.y)}get scaleY(){return this._node.scale.y}set scaleY(t){this.setScale(this._node.scale.x,t)}setScale(t,e){this._node.scale.x==t&&this._node.scale.y==e||(this._node.setScale(t,e),this.updateGear(2))}get skewX(){return this._skewX}get pivotX(){return this._uiTrans.anchorX}set pivotX(t){this._uiTrans.anchorX=t}get pivotY(){return 1-this._uiTrans.anchorY}set pivotY(t){this._uiTrans.anchorY=1-t}setPivot(t,e,i){this._uiTrans.anchorX!=t||this._uiTrans.anchorY!=1-e?(this._pivotAsAnchor=i,this._uiTrans.setAnchorPoint(t,1-e)):this._pivotAsAnchor!=i&&(this._pivotAsAnchor=i,this.handlePositionChanged())}get pivotAsAnchor(){return this._pivotAsAnchor}get touchable(){return this._touchable}set touchable(t){this._touchable!=t&&(this._touchable=t,this.updateGear(3))}get grayed(){return this._grayed}set grayed(t){this._grayed!=t&&(this._grayed=t,this.handleGrayedChanged(),this.updateGear(3))}get enabled(){return!this._grayed&&this._touchable}set enabled(t){this.grayed=!t,this.touchable=t}get rotation(){return-this._node.angle}set rotation(t){t=-t,this._node.angle!=t&&(this._node.angle=t,this.updateGear(3))}get alpha(){return this._alpha}set alpha(t){this._alpha!=t&&(this._alpha=t,this._uiOpacity.opacity=255*this._alpha,this instanceof GGroup&&this.handleAlphaChanged(),this.updateGear(3))}get visible(){return this._visible}set visible(t){this._visible!=t&&(this._visible=t,this.handleVisibleChanged(),this._group&&this._group.excludeInvisibles&&this._group.setBoundsChangedFlag())}get _finalVisible(){return this._visible&&this._internalVisible&&(!this._group||this._group._finalVisible)}get internalVisible3(){return this._visible&&this._internalVisible}get sortingOrder(){return this._sortingOrder}set sortingOrder(t){if(t<0&&(t=0),this._sortingOrder!=t){var e=this._sortingOrder;this._sortingOrder=t,this._parent&&this._parent.childSortingOrderChanged(this,e,this._sortingOrder)}}requestFocus(){}get tooltips(){return this._tooltips}set tooltips(t){this._tooltips&&(this._node.off(FGUIEvent.ROLL_OVER,this.onRollOver,this),this._node.off(FGUIEvent.ROLL_OUT,this.onRollOut,this)),this._tooltips=t,this._tooltips&&(this._node.on(FGUIEvent.ROLL_OVER,this.onRollOver,this),this._node.on(FGUIEvent.ROLL_OUT,this.onRollOut,this))}get blendMode(){return this._blendMode}set blendMode(t){this._blendMode!=t&&(this._blendMode=t,BlendModeUtils.apply(this._node,t))}get onStage(){return this._node&&this._node.activeInHierarchy}get resourceURL(){return this.packageItem?"ui://"+this.packageItem.owner.id+this.packageItem.id:null}set group(t){this._group!=t&&(this._group&&this._group.setBoundsChangedFlag(),this._group=t,this._group&&this._group.setBoundsChangedFlag())}get group(){return this._group}getGear(t){var e=this._gears[t];return e||(this._gears[t]=e=createGear(this,t)),e}updateGear(t){if(!this._underConstruct&&!this._gearLocked){var e=this._gears[t];e&&e.controller&&e.updateState()}}checkGearController(t,e){return this._gears[t]&&this._gears[t].controller==e}updateGearFromRelations(t,e,i){this._gears[t]&&this._gears[t].updateFromRelations(e,i)}addDisplayLock(){var t=this._gears[0];if(t&&t.controller){var e=t.addLock();return this.checkGearDisplay(),e}return 0}releaseDisplayLock(t){var e=this._gears[0];e&&e.controller&&(e.releaseLock(t),this.checkGearDisplay())}checkGearDisplay(){if(!this._handlingController){var t=null==this._gears[0]||this._gears[0].connected;this._gears[8]&&(t=this._gears[8].evaluate(t)),t!=this._internalVisible&&(this._internalVisible=t,this.handleVisibleChanged(),this._group&&this._group.excludeInvisibles&&this._group.setBoundsChangedFlag())}}get gearXY(){return this.getGear(1)}get gearSize(){return this.getGear(2)}get gearLook(){return this.getGear(3)}get relations(){return this._relations}addRelation(t,e,i){this._relations.add(t,e,i)}removeRelation(t,e){this._relations.remove(t,e)}get node(){return this._node}get parent(){return this._parent}removeFromParent(){this._parent&&this._parent.removeChild(this)}findParent(){if(this._parent)return this._parent;let t=this._node.parent;for(;t;){let e=t.$gobj;if(e)return e;t=t.parent}return null}get asCom(){return this}static cast(t){return t.$gobj}get text(){return null}set text(t){}get icon(){return null}set icon(t){}get treeNode(){return this._treeNode}get isDisposed(){return null==this._node}dispose(){let t=this._node;if(t){this.removeFromParent(),this._relations.dispose(),this._node=null,t.destroy();for(var e=0;e<10;e++){var i=this._gears[e];i&&i.dispose()}}}onEnable(){}onDisable(){}onUpdate(){}onDestroy(){}onClick(t,e){this._node.on(FGUIEvent.CLICK,t,e)}onceClick(t,e){this._node.once(FGUIEvent.CLICK,t,e)}offClick(t,e){this._node.off(FGUIEvent.CLICK,t,e)}clearClick(){this._node.off(FGUIEvent.CLICK)}hasClickListener(){return this._node.hasEventListener(FGUIEvent.CLICK)}on(t,e,i){t!=FGUIEvent.DISPLAY&&t!=FGUIEvent.UNDISPLAY||(this._partner._emitDisplayEvents=!0),this._node.on(t,e,i)}once(t,e,i){t!=FGUIEvent.DISPLAY&&t!=FGUIEvent.UNDISPLAY||(this._partner._emitDisplayEvents=!0),this._node.once(t,e,i)}off(t,e,i){this._node.off(t,e,i)}get draggable(){return this._draggable}set draggable(t){this._draggable!=t&&(this._draggable=t,this.initDrag())}get dragBounds(){return this._dragBounds}set dragBounds(t){this._dragBounds=t}startDrag(t){this._node.activeInHierarchy&&this.dragBegin(t)}stopDrag(){this.dragEnd()}get dragging(){return GObject.draggingObject==this}localToGlobal(t,e,i){return t=t||0,e=e||0,s_vec3$1.x=t,s_vec3$1.y=-e,this._pivotAsAnchor||(s_vec3$1.x-=this._uiTrans.anchorX*this._width,s_vec3$1.y+=(1-this._uiTrans.anchorY)*this._height),this._uiTrans.convertToWorldSpaceAR(s_vec3$1,s_vec3$1),s_vec3$1.y=Decls$1.GRoot.inst.height-s_vec3$1.y,(i=i||new Vec2).x=s_vec3$1.x,i.y=s_vec3$1.y,i}globalToLocal(t,e,i){return t=t||0,e=e||0,s_vec3$1.x=t,s_vec3$1.y=Decls$1.GRoot.inst.height-e,this._uiTrans.convertToNodeSpaceAR(s_vec3$1,s_vec3$1),this._pivotAsAnchor||(s_vec3$1.x+=this._uiTrans.anchorX*this._width,s_vec3$1.y-=(1-this._uiTrans.anchorY)*this._height),(i=i||new Vec2).x=s_vec3$1.x,i.y=-s_vec3$1.y,i}localToGlobalRect(t,e,i,s,n){t=t||0,e=e||0,i=i||0,s=s||0,n=n||new Rect$1;var r=this.localToGlobal(t,e);return n.x=r.x,n.y=r.y,r=this.localToGlobal(t+i,e+s,r),n.xMax=r.x,n.yMax=r.y,n}globalToLocalRect(t,e,i,s,n){t=t||0,e=e||0,i=i||0,s=s||0,n=n||new Rect$1;var r=this.globalToLocal(t,e);return n.x=r.x,n.y=r.y,r=this.globalToLocal(t+i,e+s,r),n.xMax=r.x,n.yMax=r.y,n}handleControllerChanged(t){this._handlingController=!0;for(var e=0;e<10;e++){var i=this._gears[e];i&&i.controller==t&&i.apply()}this._handlingController=!1,this.checkGearDisplay()}handleAnchorChanged(){this.handlePositionChanged()}handlePositionChanged(){var t=this._x,e=-this._y;this._pivotAsAnchor||(t+=this._uiTrans.anchorX*this._width,e-=(1-this._uiTrans.anchorY)*this._height),this._pixelSnapping&&(t=Math.round(t),e=Math.round(e)),this._node.setPosition(t,e)}handleSizeChanged(){this._uiTrans.setContentSize(this._width,this._height)}handleGrayedChanged(){}handleVisibleChanged(){this._node.active=this._finalVisible,this instanceof GGroup&&this.handleVisibleChanged(),this._parent&&this._parent.setBoundsChangedFlag()}hitTest(t,e){return null==e&&(e=!0),!e||!this._touchDisabled&&this._touchable&&this._node.activeInHierarchy?(this._hitTestPt||(this._hitTestPt=new Vec2),this.globalToLocal(t.x,t.y,this._hitTestPt),this._pivotAsAnchor&&(this._hitTestPt.x+=this._uiTrans.anchorX*this._width,this._hitTestPt.y+=(1-this._uiTrans.anchorY)*this._height),this._hitTest(this._hitTestPt,t)):null}_hitTest(t,e){return t.x>=0&&t.y>=0&&t.x<this._width&&t.y<this._height?this:null}getProp(t){switch(t){case ObjectPropID.Text:return this.text;case ObjectPropID.Icon:return this.icon;case ObjectPropID.Color:case ObjectPropID.OutlineColor:return null;case ObjectPropID.Playing:return!1;case ObjectPropID.Frame:case ObjectPropID.DeltaTime:return 0;case ObjectPropID.TimeScale:return 1;case ObjectPropID.FontSize:return 0;case ObjectPropID.Selected:return!1;default:return}}setProp(t,e){switch(t){case ObjectPropID.Text:this.text=e;break;case ObjectPropID.Icon:this.icon=e}}constructFromResource(){}setup_beforeAdd(t,e){var i,s;t.seek(e,0),t.skip(5),this._id=t.readS(),this._name=t.readS(),i=t.readInt(),s=t.readInt(),this.setPosition(i,s),t.readBool()&&(this.initWidth=t.readInt(),this.initHeight=t.readInt(),this.setSize(this.initWidth,this.initHeight,!0)),t.readBool()&&(this.minWidth=t.readInt(),this.maxWidth=t.readInt(),this.minHeight=t.readInt(),this.maxHeight=t.readInt()),t.readBool()&&(i=t.readFloat(),s=t.readFloat(),this.setScale(i,s)),t.readBool()&&(i=t.readFloat(),s=t.readFloat()),t.readBool()&&(i=t.readFloat(),s=t.readFloat(),this.setPivot(i,s,t.readBool())),1!=(i=t.readFloat())&&(this.alpha=i),0!=(i=t.readFloat())&&(this.rotation=i),t.readBool()||(this.visible=!1),t.readBool()||(this.touchable=!1),t.readBool()&&(this.grayed=!0),this.blendMode=t.readByte(),t.readByte();var n=t.readS();null!=n&&(this.data=n)}setup_afterAdd(t,e){t.seek(e,1);var i=t.readS();null!=i&&(this.tooltips=i);var s=t.readShort();s>=0&&(this.group=this.parent.getChildAt(s)),t.seek(e,2);for(var n=t.readShort(),r=0;r<n;r++){var o=t.readShort();o+=t.position,this.getGear(t.readByte()).setup(t),t.position=o}}onRollOver(){UIConfig.tooltipsManager?UIConfig.tooltipsManager.show(this.tooltips):Decls$1.GRoot.inst.showTooltips(this.tooltips)}onRollOut(){UIConfig.tooltipsManager?UIConfig.tooltipsManager.hide():Decls$1.GRoot.inst.hideTooltips()}initDrag(){this._draggable?(this.on(FGUIEvent.TOUCH_BEGIN,this.onTouchBegin_0,this),this.on(FGUIEvent.TOUCH_MOVE,this.onTouchMove_0,this),this.on(FGUIEvent.TOUCH_END,this.onTouchEnd_0,this)):(this.off(FGUIEvent.TOUCH_BEGIN,this.onTouchBegin_0,this),this.off(FGUIEvent.TOUCH_MOVE,this.onTouchMove_0,this),this.off(FGUIEvent.TOUCH_END,this.onTouchEnd_0,this))}dragBegin(t){if(GObject.draggingObject){let t=GObject.draggingObject;t.stopDrag(),GObject.draggingObject=null,t._node.emit(FGUIEvent.DRAG_END)}null==t&&(t=Decls$1.GRoot.inst.inputProcessor.getAllTouches()[0]),sGlobalDragStart.set(Decls$1.GRoot.inst.getTouchPosition(t)),this.localToGlobalRect(0,0,this._width,this._height,sGlobalRect),GObject.draggingObject=this,this._dragTesting=!1,Decls$1.GRoot.inst.inputProcessor.addTouchMonitor(t,this),this.on(FGUIEvent.TOUCH_MOVE,this.onTouchMove_0,this),this.on(FGUIEvent.TOUCH_END,this.onTouchEnd_0,this)}dragEnd(){GObject.draggingObject==this&&(this._dragTesting=!1,GObject.draggingObject=null),s_dragQuery=!1}onTouchBegin_0(t){null==this._dragStartPos&&(this._dragStartPos=new Vec2),this._dragStartPos.set(t.pos),this._dragTesting=!0,t.captureTouch()}onTouchMove_0(t){if(GObject.draggingObject!=this&&this._draggable&&this._dragTesting){var e=UIConfig.touchDragSensitivity;if(this._dragStartPos&&Math.abs(this._dragStartPos.x-t.pos.x)<e&&Math.abs(this._dragStartPos.y-t.pos.y)<e)return;this._dragTesting=!1,s_dragQuery=!0,this._node.emit(FGUIEvent.DRAG_START,t),s_dragQuery&&this.dragBegin(t.touchId)}if(GObject.draggingObject==this){var i=t.pos.x-sGlobalDragStart.x+sGlobalRect.x,s=t.pos.y-sGlobalDragStart.y+sGlobalRect.y;if(this._dragBounds){var n=Decls$1.GRoot.inst.localToGlobalRect(this._dragBounds.x,this._dragBounds.y,this._dragBounds.width,this._dragBounds.height,s_rect$1);(i<n.x||i+sGlobalRect.width>n.xMax&&(i=n.xMax-sGlobalRect.width)<n.x)&&(i=n.x),(s<n.y||s+sGlobalRect.height>n.yMax&&(s=n.yMax-sGlobalRect.height)<n.y)&&(s=n.y)}s_dragging=!0;var r=this.parent.globalToLocal(i,s,s_vec2$4);this.setPosition(Math.round(r.x),Math.round(r.y)),s_dragging=!1,this._node.emit(FGUIEvent.DRAG_MOVE,t)}}onTouchEnd_0(t){GObject.draggingObject==this&&(GObject.draggingObject=null,this._node.emit(FGUIEvent.DRAG_END,t))}}class GObjectPartner extends Component{callLater(t,e){director.getScheduler().isScheduled(t,this)||this.scheduleOnce(t,e)}onClickLink(t,e){this.node.emit(FGUIEvent.LINK,e,t)}onEnable(){this.node.$gobj.onEnable(),this._emitDisplayEvents&&this.node.emit(FGUIEvent.DISPLAY)}onDisable(){this.node.$gobj.onDisable(),this._emitDisplayEvents&&this.node.emit(FGUIEvent.UNDISPLAY)}update(t){this.node.$gobj.onUpdate(t)}onDestroy(){this.node.$gobj.onDestroy()}}let GearClasses=[GearDisplay,GearXY,GearSize,GearLook,GearColor,GearAnimation,GearText,GearIcon,GearDisplay2,GearFontSize];function createGear(t,e){let i=new GearClasses[e];return i._owner=t,i}var s_dragging,s_dragQuery,s_vec2$4=new Vec2,s_vec3$1=new Vec3,s_rect$1=new Rect$1,sGlobalDragStart=new Vec2,sGlobalRect=new Rect$1,Decls$1={},constructingDepth={n:0};class GGroup extends GObject{constructor(){super(),this._layout=0,this._lineGap=0,this._columnGap=0,this._mainGridIndex=-1,this._mainGridMinSize=50,this._mainChildIndex=-1,this._totalSize=0,this._numChildren=0,this._updating=0,this._node.name="GGroup",this._touchDisabled=!0}dispose(){this._boundsChanged=!1,super.dispose()}get layout(){return this._layout}set layout(t){this._layout!=t&&(this._layout=t,this.setBoundsChangedFlag())}get lineGap(){return this._lineGap}set lineGap(t){this._lineGap!=t&&(this._lineGap=t,this.setBoundsChangedFlag(!0))}get columnGap(){return this._columnGap}set columnGap(t){this._columnGap!=t&&(this._columnGap=t,this.setBoundsChangedFlag(!0))}get excludeInvisibles(){return this._excludeInvisibles}set excludeInvisibles(t){this._excludeInvisibles!=t&&(this._excludeInvisibles=t,this.setBoundsChangedFlag())}get autoSizeDisabled(){return this._autoSizeDisabled}set autoSizeDisabled(t){this._autoSizeDisabled=t}get mainGridMinSize(){return this._mainGridMinSize}set mainGridMinSize(t){this._mainGridMinSize!=t&&(this._mainGridMinSize=t,this.setBoundsChangedFlag())}get mainGridIndex(){return this._mainGridIndex}set mainGridIndex(t){this._mainGridIndex!=t&&(this._mainGridIndex=t,this.setBoundsChangedFlag())}setBoundsChangedFlag(t=!1){0==this._updating&&this._parent&&(t||(this._percentReady=!1),this._boundsChanged||(this._boundsChanged=!0,this._layout!=GroupLayoutType.None&&this._partner.callLater(this._ensureBoundsCorrect)))}_ensureBoundsCorrect(){GObject.cast(this.node).ensureBoundsCorrect()}ensureSizeCorrect(){null!=this._parent&&this._boundsChanged&&0!=this._layout&&(this._boundsChanged=!1,this._autoSizeDisabled?this.resizeChildren(0,0):(this.handleLayout(),this.updateBounds()))}ensureBoundsCorrect(){null!=this._parent&&this._boundsChanged&&(this._boundsChanged=!1,0==this._layout?this.updateBounds():this._autoSizeDisabled?this.resizeChildren(0,0):(this.handleLayout(),this.updateBounds()))}updateBounds(){this._partner.unschedule(this._ensureBoundsCorrect);var t,e,i,s=this._parent.numChildren,n=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,h=Number.NEGATIVE_INFINITY,a=!0;for(t=0;t<s;t++)(e=this._parent.getChildAt(t)).group!=this||this._excludeInvisibles&&!e.internalVisible3||((i=e.xMin)<n&&(n=i),(i=e.yMin)<r&&(r=i),(i=e.xMin+e.width)>o&&(o=i),(i=e.yMin+e.height)>h&&(h=i),a=!1);var l=0,_=0;a||(this._updating|=1,this.setPosition(n,r),this._updating&=2,l=o-n,_=h-r),0==(2&this._updating)?(this._updating|=2,this.setSize(l,_),this._updating&=1):(this._updating&=1,this.resizeChildren(this._width-l,this._height-_))}handleLayout(){var t,e,i;if(this._updating|=1,this._layout==GroupLayoutType.Horizontal){var s=this.x;for(i=this._parent.numChildren,e=0;e<i;e++)(t=this._parent.getChildAt(e)).group==this&&(this._excludeInvisibles&&!t.internalVisible3||(t.xMin=s,0!=t.width&&(s+=t.width+this._columnGap)))}else if(this._layout==GroupLayoutType.Vertical){var n=this.y;for(i=this._parent.numChildren,e=0;e<i;e++)(t=this._parent.getChildAt(e)).group==this&&(this._excludeInvisibles&&!t.internalVisible3||(t.yMin=n,0!=t.height&&(n+=t.height+this._lineGap)))}this._updating&=2}moveChildren(t,e){if(0==(1&this._updating)&&null!=this._parent){this._updating|=1;var i,s,n=this._parent.numChildren;for(i=0;i<n;i++)(s=this._parent.getChildAt(i)).group==this&&s.setPosition(s.x+t,s.y+e);this._updating&=2}}resizeChildren(t,e){if(this._layout!=GroupLayoutType.None&&0==(2&this._updating)&&null!=this._parent)if(this._updating|=2,!this._boundsChanged||(this._boundsChanged=!1,this._autoSizeDisabled)){var i,s,n=this._parent.numChildren;if(!this._percentReady){this._percentReady=!0,this._numChildren=0,this._totalSize=0,this._mainChildIndex=-1;var r=0;for(i=0;i<n;i++)(s=this._parent.getChildAt(i)).group==this&&(this._excludeInvisibles&&!s.internalVisible3||(r==this._mainGridIndex&&(this._mainChildIndex=i),this._numChildren++,1==this._layout?this._totalSize+=s.width:this._totalSize+=s.height),r++);for(-1!=this._mainChildIndex&&(1==this._layout?(s=this._parent.getChildAt(this._mainChildIndex),this._totalSize+=this._mainGridMinSize-s.width,s._sizePercentInGroup=this._mainGridMinSize/this._totalSize):(s=this._parent.getChildAt(this._mainChildIndex),this._totalSize+=this._mainGridMinSize-s.height,s._sizePercentInGroup=this._mainGridMinSize/this._totalSize)),i=0;i<n;i++)(s=this._parent.getChildAt(i)).group==this&&i!=this._mainChildIndex&&(this._totalSize>0?s._sizePercentInGroup=(1==this._layout?s.width:s.height)/this._totalSize:s._sizePercentInGroup=0)}var o=0,h=1,a=!1;if(1==this._layout){o=this.width-(this._numChildren-1)*this._columnGap,-1!=this._mainChildIndex&&o>=this._totalSize&&((s=this._parent.getChildAt(this._mainChildIndex)).setSize(o-(this._totalSize-this._mainGridMinSize),s._rawHeight+e,!0),o-=s.width,h-=s._sizePercentInGroup,a=!0);var l=this.x;for(i=0;i<n;i++)(s=this._parent.getChildAt(i)).group==this&&(!this._excludeInvisibles||s.internalVisible3?(a&&i==this._mainChildIndex||(s.setSize(Math.round(s._sizePercentInGroup/h*o),s._rawHeight+e,!0),h-=s._sizePercentInGroup,o-=s.width),s.xMin=l,0!=s.width&&(l+=s.width+this._columnGap)):s.setSize(s._rawWidth,s._rawHeight+e,!0))}else{o=this.height-(this._numChildren-1)*this._lineGap,-1!=this._mainChildIndex&&o>=this._totalSize&&((s=this._parent.getChildAt(this._mainChildIndex)).setSize(s._rawWidth+t,o-(this._totalSize-this._mainGridMinSize),!0),o-=s.height,h-=s._sizePercentInGroup,a=!0);var _=this.y;for(i=0;i<n;i++)(s=this._parent.getChildAt(i)).group==this&&(!this._excludeInvisibles||s.internalVisible3?(a&&i==this._mainChildIndex||(s.setSize(s._rawWidth+t,Math.round(s._sizePercentInGroup/h*o),!0),h-=s._sizePercentInGroup,o-=s.height),s.yMin=_,0!=s.height&&(_+=s.height+this._lineGap)):s.setSize(s._rawWidth+t,s._rawHeight,!0))}this._updating&=1}else this.updateBounds()}handleAlphaChanged(){if(!this._underConstruct)for(var t=this._parent.numChildren,e=0;e<t;e++){var i=this._parent.getChildAt(e);i.group==this&&(i.alpha=this.alpha)}}handleVisibleChanged(){if(this._parent)for(var t=this._parent.numChildren,e=0;e<t;e++){var i=this._parent.getChildAt(e);i.group==this&&i.handleVisibleChanged()}}setup_beforeAdd(t,e){super.setup_beforeAdd(t,e),t.seek(e,5),this._layout=t.readByte(),this._lineGap=t.readInt(),this._columnGap=t.readInt(),t.version>=2&&(this._excludeInvisibles=t.readBool(),this._autoSizeDisabled=t.readBool(),this._mainGridIndex=t.readShort())}setup_afterAdd(t,e){super.setup_afterAdd(t,e),this.visible||this.handleVisibleChanged()}}class GGraph extends GObject{constructor(){super(),this._type=0,this._lineSize=0,this._node.name="GGraph",this._lineSize=1,this._lineColor=new Color,this._fillColor=new Color(255,255,255,255),this._content=this._node.addComponent(Graphics)}drawRect(t,e,i,s){this._type=1,this._lineSize=t,this._lineColor.set(e),this._fillColor.set(i),this._cornerRadius=s,this.updateGraph()}drawEllipse(t,e,i){this._type=2,this._lineSize=t,this._lineColor.set(e),this._fillColor.set(i),this.updateGraph()}drawRegularPolygon(t,e,i,s,n,r){this._type=4,this._lineSize=t,this._lineColor.set(e),this._fillColor.set(i),this._sides=s,this._startAngle=n||0,this._distances=r,this.updateGraph()}drawPolygon(t,e,i,s){this._type=3,this._lineSize=t,this._lineColor.set(e),this._fillColor.set(i),this._polygonPoints=s,this.updateGraph()}get distances(){return this._distances}set distances(t){this._distances=t,3==this._type&&this.updateGraph()}clearGraphics(){this._type=0,this._hasContent&&(this._content.clear(),this._hasContent=!1)}get type(){return this._type}get color(){return this._fillColor}set color(t){this._fillColor.set(t),0!=this._type&&this.updateGraph()}updateGraph(){let t=this._content;this._hasContent&&(this._hasContent=!1,t.clear());var e=this._width,i=this._height;if(0==e||0==i)return;var s=-this.pivotX*this._width,n=this.pivotY*this._height;let r=this._lineSize/2;if(t.lineWidth=this._lineSize,t.strokeColor=this._lineColor,t.fillColor=this._fillColor,1==this._type)this._cornerRadius?t.roundRect(s+r,-i+n+r,e-this._lineSize,i-this._lineSize,this._cornerRadius[0]):t.rect(s+r,-i+n+r,e-this._lineSize,i-this._lineSize);else if(2==this._type)t.ellipse(e/2+s,-i/2+n,e/2-r,i/2-r);else if(3==this._type)this.drawPath(t,this._polygonPoints,s,n);else if(4==this._type){this._polygonPoints||(this._polygonPoints=[]);var o=Math.min(e,i)/2-r;this._polygonPoints.length=0;for(var h,a=misc.degreesToRadians(this._startAngle),l=2*Math.PI/this._sides,_=0;_<this._sides;_++){this._distances?(h=this._distances[_],isNaN(h)&&(h=1)):h=1;var d=o+o*h*Math.cos(a),c=o+o*h*Math.sin(a);this._polygonPoints.push(d,c),a+=l}this.drawPath(t,this._polygonPoints,s,n)}0!=r&&t.stroke(),0!=this._fillColor.a&&t.fill(),this._hasContent=!0}drawPath(t,e,i,s){var n=e.length;t.moveTo(e[0]+i,-e[1]+s);for(var r=2;r<n;r+=2)t.lineTo(e[r]+i,-e[r+1]+s);t.lineTo(e[0]+i,-e[1]+s)}handleSizeChanged(){super.handleSizeChanged(),0!=this._type&&this.updateGraph()}handleAnchorChanged(){super.handleAnchorChanged(),0!=this._type&&this.updateGraph()}getProp(t){return t==ObjectPropID.Color?this.color:super.getProp(t)}setProp(t,e){t==ObjectPropID.Color?this.color=e:super.setProp(t,e)}_hitTest(t){if(t.x>=0&&t.y>=0&&t.x<this._width&&t.y<this._height){if(3==this._type){let e,i=this._polygonPoints,s=i.length/2,n=s-1,r=!1;for(this._width,this._height,e=0;e<s;++e){let s=i[2*e],o=i[2*e+1],h=i[2*n],a=i[2*n+1];(o<t.y&&a>=t.y||a<t.y&&o>=t.y)&&(s<=t.x||h<=t.x)&&s+(t.y-o)/(a-o)*(h-s)<t.x&&(r=!r),n=e}return r?this:null}return this}return null}setup_beforeAdd(t,e){if(super.setup_beforeAdd(t,e),t.seek(e,5),this._type=t.readByte(),0!=this._type){var i,s;if(this._lineSize=t.readInt(),this._lineColor.set(t.readColor(!0)),this._fillColor.set(t.readColor(!0)),t.readBool())for(this._cornerRadius=new Array(4),i=0;i<4;i++)this._cornerRadius[i]=t.readFloat();if(3==this._type)for(s=t.readShort(),this._polygonPoints=[],this._polygonPoints.length=s,i=0;i<s;i++)this._polygonPoints[i]=t.readFloat();else if(4==this._type&&(this._sides=t.readShort(),this._startAngle=t.readFloat(),(s=t.readShort())>0))for(this._distances=[],i=0;i<s;i++)this._distances[i]=t.readFloat();this.updateGraph()}}}class Image extends Sprite{constructor(){super(),this._flip=FlipType.None,this._fillMethod=FillMethod.None,this._fillOrigin=FillOrigin.Left,this._fillAmount=0}get flip(){return this._flip}set flip(t){if(this._flip!=t){this._flip=t;let e=1,i=1;if(this._flip!=FlipType.Horizontal&&this._flip!=FlipType.Both||(e=-1),this._flip!=FlipType.Vertical&&this._flip!=FlipType.Both||(i=-1),1!=e||1!=i){this.node.getComponent(UITransform).setAnchorPoint(.5,.5)}this.node.setScale(e,i)}}get fillMethod(){return this._fillMethod}set fillMethod(t){this._fillMethod!=t&&(this._fillMethod=t,0!=this._fillMethod?(this.type=Sprite.Type.FILLED,this._fillMethod<=3?this.fillType=this._fillMethod-1:this.fillType=Sprite.FillType.RADIAL,this.fillCenter=new Vec2(.5,.5),this.setupFill()):this.type=Sprite.Type.SIMPLE)}get fillOrigin(){return this._fillOrigin}set fillOrigin(t){this._fillOrigin!=t&&(this._fillOrigin=t,0!=this._fillMethod&&this.setupFill())}get fillClockwise(){return this._fillClockwise}set fillClockwise(t){this._fillClockwise!=t&&(this._fillClockwise=t,0!=this._fillMethod&&this.setupFill())}get fillAmount(){return this._fillAmount}set fillAmount(t){this._fillAmount!=t&&(this._fillAmount=t,0!=this._fillMethod&&(this._fillClockwise?this.fillRange=-this._fillAmount:this.fillRange=this._fillAmount))}setupFill(){if(this._fillMethod==FillMethod.Horizontal)this._fillClockwise=this._fillOrigin==FillOrigin.Right||this._fillOrigin==FillOrigin.Bottom,this.fillStart=this._fillClockwise?1:0;else if(this._fillMethod==FillMethod.Vertical)this._fillClockwise=this._fillOrigin==FillOrigin.Left||this._fillOrigin==FillOrigin.Top,this.fillStart=this._fillClockwise?1:0;else switch(this._fillOrigin){case FillOrigin.Right:this.fillOrigin=0;break;case FillOrigin.Top:this.fillStart=.25;break;case FillOrigin.Left:this.fillStart=.5;break;case FillOrigin.Bottom:this.fillStart=.75}}}class GImage extends GObject{constructor(){super(),this._node.name="GImage",this._touchDisabled=!0,this._content=this._node.addComponent(Image),this._content.sizeMode=Sprite.SizeMode.CUSTOM,this._content.trim=!1}get color(){return this._content.color}set color(t){this._content.color=t,this.updateGear(4)}get flip(){return this._content.flip}set flip(t){this._content.flip=t}get fillMethod(){return this._content.fillMethod}set fillMethod(t){this._content.fillMethod=t}get fillOrigin(){return this._content.fillOrigin}set fillOrigin(t){this._content.fillOrigin=t}get fillClockwise(){return this._content.fillClockwise}set fillClockwise(t){this._content.fillClockwise=t}get fillAmount(){return this._content.fillAmount}set fillAmount(t){this._content.fillAmount=t}constructFromResource(){var t=this.packageItem.getBranch();this.sourceWidth=t.width,this.sourceHeight=t.height,this.initWidth=this.sourceWidth,this.initHeight=this.sourceHeight,this.setSize(this.sourceWidth,this.sourceHeight),(t=t.getHighResolution()).load(),t.scale9Grid?this._content.type=Sprite.Type.SLICED:t.scaleByTile&&(this._content.type=Sprite.Type.TILED),this._content.spriteFrame=t.asset}handleGrayedChanged(){this._content.grayscale=this._grayed}getProp(t){return t==ObjectPropID.Color?this.color:super.getProp(t)}setProp(t,e){t==ObjectPropID.Color?this.color=e:super.setProp(t,e)}setup_beforeAdd(t,e){super.setup_beforeAdd(t,e),t.seek(e,5),t.readBool()&&(this.color=t.readColor()),this._content.flip=t.readByte(),this._content.fillMethod=t.readByte(),0!=this._content.fillMethod&&(this._content.fillOrigin=t.readByte(),this._content.fillClockwise=t.readBool(),this._content.fillAmount=t.readFloat())}}class MovieClip extends Image{constructor(){super(),this.interval=0,this.swing=!1,this.repeatDelay=0,this.timeScale=1,this._playing=!0,this._frameCount=0,this._frame=0,this._start=0,this._end=0,this._times=0,this._endAt=0,this._status=0,this._smoothing=!0,this._frameElapsed=0,this._reversed=!1,this._repeatedCount=0}get frames(){return this._frames}set frames(t){this._frames=t,this._frames?(this._frameCount=this._frames.length,(-1==this._end||this._end>this._frameCount-1)&&(this._end=this._frameCount-1),(-1==this._endAt||this._endAt>this._frameCount-1)&&(this._endAt=this._frameCount-1),(this._frame<0||this._frame>this._frameCount-1)&&(this._frame=this._frameCount-1),this.type=Sprite.Type.SIMPLE,this.drawFrame(),this._frameElapsed=0,this._repeatedCount=0,this._reversed=!1):this._frameCount=0}get frameCount(){return this._frameCount}get frame(){return this._frame}set frame(t){this._frame!=t&&(this._frames&&t>=this._frameCount&&(t=this._frameCount-1),this._frame=t,this._frameElapsed=0,this.drawFrame())}get playing(){return this._playing}set playing(t){this._playing!=t&&(this._playing=t)}get smoothing(){return this._smoothing}set smoothing(t){this._smoothing=t}rewind(){this._frame=0,this._frameElapsed=0,this._reversed=!1,this._repeatedCount=0,this.drawFrame()}syncStatus(t){this._frame=t._frame,this._frameElapsed=t._frameElapsed,this._reversed=t._reversed,this._repeatedCount=t._repeatedCount,this.drawFrame()}advance(t){for(var e=this._frame,i=this._reversed,s=t;;){var n=this.interval+this._frames[this._frame].addDelay;if(0==this._frame&&this._repeatedCount>0&&(n+=this.repeatDelay),t<n){this._frameElapsed=0;break}if(t-=n,this.swing?this._reversed?(this._frame--,this._frame<=0&&(this._frame=0,this._repeatedCount++,this._reversed=!this._reversed)):(this._frame++,this._frame>this._frameCount-1&&(this._frame=Math.max(0,this._frameCount-2),this._repeatedCount++,this._reversed=!this._reversed)):(this._frame++,this._frame>this._frameCount-1&&(this._frame=0,this._repeatedCount++)),this._frame==e&&this._reversed==i){var r=s-t;t-=Math.floor(t/r)*r}}this.drawFrame()}setPlaySettings(t,e,i,s,n){null==t&&(t=0),null==e&&(e=-1),null==i&&(i=0),null==s&&(s=-1),this._start=t,this._end=e,(-1==this._end||this._end>this._frameCount-1)&&(this._end=this._frameCount-1),this._times=i,this._endAt=s,-1==this._endAt&&(this._endAt=this._end),this._status=0,this._callback=n,this.frame=t}update(t){if(this._playing&&0!=this._frameCount&&3!=this._status){1!=this.timeScale&&(t*=this.timeScale),this._frameElapsed+=t;var e=this.interval+this._frames[this._frame].addDelay;if(0==this._frame&&this._repeatedCount>0&&(e+=this.repeatDelay),!(this._frameElapsed<e)){if(this._frameElapsed-=e,this._frameElapsed>this.interval&&(this._frameElapsed=this.interval),this.swing?this._reversed?(this._frame--,this._frame<=0&&(this._frame=0,this._repeatedCount++,this._reversed=!this._reversed)):(this._frame++,this._frame>this._frameCount-1&&(this._frame=Math.max(0,this._frameCount-2),this._repeatedCount++,this._reversed=!this._reversed)):(this._frame++,this._frame>this._frameCount-1&&(this._frame=0,this._repeatedCount++)),1==this._status)this._frame=this._start,this._frameElapsed=0,this._status=0;else if(2==this._status){if(this._frame=this._endAt,this._frameElapsed=0,this._status=3,null!=this._callback){let t=this._callback;this._callback=null,t()}}else this._frame==this._end&&(this._times>0?(this._times--,0==this._times?this._status=2:this._status=1):0!=this._start&&(this._status=1));this.drawFrame()}}}drawFrame(){if(this._frameCount>0&&this._frame<this._frames.length){var t=this._frames[this._frame];this.spriteFrame=t.texture}}}class GMovieClip extends GObject{constructor(){super(),this._node.name="GMovieClip",this._touchDisabled=!0,this._content=this._node.addComponent(MovieClip),this._content.sizeMode=Sprite.SizeMode.CUSTOM,this._content.trim=!1,this._content.setPlaySettings()}get color(){return this._content.color}set color(t){this._content.color=t,this.updateGear(4)}get playing(){return this._content.playing}set playing(t){this._content.playing!=t&&(this._content.playing=t,this.updateGear(5))}get frame(){return this._content.frame}set frame(t){this._content.frame!=t&&(this._content.frame=t,this.updateGear(5))}get timeScale(){return this._content.timeScale}set timeScale(t){this._content.timeScale=t}rewind(){this._content.rewind()}syncStatus(t){this._content.syncStatus(t._content)}advance(t){this._content.advance(t)}setPlaySettings(t,e,i,s,n){this._content.setPlaySettings(t,e,i,s,n)}handleGrayedChanged(){this._content.grayscale=this._grayed}handleSizeChanged(){super.handleSizeChanged(),this._content.sizeMode=Sprite.SizeMode.CUSTOM}getProp(t){switch(t){case ObjectPropID.Color:return this.color;case ObjectPropID.Playing:return this.playing;case ObjectPropID.Frame:return this.frame;case ObjectPropID.TimeScale:return this.timeScale;default:return super.getProp(t)}}setProp(t,e){switch(t){case ObjectPropID.Color:this.color=e;break;case ObjectPropID.Playing:this.playing=e;break;case ObjectPropID.Frame:this.frame=e;break;case ObjectPropID.TimeScale:this.timeScale=e;break;case ObjectPropID.DeltaTime:this.advance(e);break;default:super.setProp(t,e)}}constructFromResource(){var t=this.packageItem.getBranch();this.sourceWidth=t.width,this.sourceHeight=t.height,this.initWidth=this.sourceWidth,this.initHeight=this.sourceHeight,this.setSize(this.sourceWidth,this.sourceHeight),(t=t.getHighResolution()).load(),this._content.interval=t.interval,this._content.swing=t.swing,this._content.repeatDelay=t.repeatDelay,this._content.frames=t.frames,this._content.smoothing=t.smoothing}setup_beforeAdd(t,e){super.setup_beforeAdd(t,e),t.seek(e,5),t.readBool()&&(this.color=t.readColor()),t.readByte(),this._content.frame=t.readInt(),this._content.playing=t.readBool()}}class UIContentScaler{}function updateScaler(){let t=view.getCanvasSize();t.width/=view.getScaleX(),t.height/=view.getScaleY(),UIContentScaler.rootSize.set(t);var e=Math.max(view.getScaleX(),view.getScaleY());UIContentScaler.scaleFactor=e,UIContentScaler.scaleLevel=e>=3.5?3:e>=2.5?2:e>=1.5?1:0}UIContentScaler.scaleFactor=1,UIContentScaler.scaleLevel=0,UIContentScaler.rootSize=new Size;class PackageItem{constructor(){this.width=0,this.height=0}load(){return this.owner.getItemAsset(this)}getBranch(){if(this.branches&&-1!=this.owner._branchIndex){var t=this.branches[this.owner._branchIndex];if(t)return this.owner.getItemById(t)}return this}getHighResolution(){if(this.highResolution&&UIContentScaler.scaleLevel>0){var t=this.highResolution[UIContentScaler.scaleLevel-1];if(t)return this.owner.getItemById(t)}return this}toString(){return this.name}}class TranslationHelper{static loadFromXML(t){TranslationHelper.strings={};let e=TranslationHelper.strings;for(var i=(new DOMParser).parseFromString(t,"text/xml").documentElement.childNodes,s=i.length,n=0;n<s;n++){var r=i[n];if("string"==r.tagName){var o=r.getAttribute("name"),h=r.childNodes.length>0?r.firstChild.nodeValue:"",a=o.indexOf("-");if(-1==a)continue;var l=o.substr(0,a),_=o.substr(a+1),d=e[l];d||(d={},e[l]=d),d[_]=h}}}static translateComponent(t){if(null!=TranslationHelper.strings){var e=TranslationHelper.strings[t.owner.id+t.id];if(null!=e){var i,s,n,r,o,h,a,l,_,d=t.rawData;d.seek(0,2);var c=d.readShort();for(o=0;o<c;o++){a=d.readShort(),l=d.position,d.seek(l,0);var u=d.readByte(),g=u;d.skip(4),i=d.readS(),g==ObjectType.Component&&d.seek(l,6)&&(g=d.readByte()),d.seek(l,1),null!=(s=e[i+"-tips"])&&d.writeS(s),d.seek(l,2);var p=d.readShort();for(h=0;h<p;h++){if(n=d.readShort(),n+=d.position,6==d.readByte()){for(d.skip(2),_=d.readShort(),m=0;m<_;m++)null!=d.readS()&&(null!=(s=e[i+"-texts_"+m])?d.writeS(s):d.skip(2));d.readBool()&&null!=(s=e[i+"-texts_def"])&&d.writeS(s)}d.position=n}if(u==ObjectType.Component&&d.version>=2){d.seek(l,4),d.skip(2),d.skip(4*d.readShort());for(var f=d.readShort(),m=0;m<f;m++){var y=d.readS();0==d.readShort()&&null!=(s=e[i+"-cp-"+y])?d.writeS(s):d.skip(2)}}switch(g){case ObjectType.Text:case ObjectType.RichText:case ObjectType.InputText:null!=(s=e[i])&&(d.seek(l,6),d.writeS(s)),null!=(s=e[i+"-prompt"])&&(d.seek(l,4),d.writeS(s));break;case ObjectType.List:case ObjectType.Tree:for(d.seek(l,8),d.skip(2),r=d.readShort(),h=0;h<r;h++){if(n=d.readShort(),n+=d.position,d.skip(2),g==ObjectType.Tree&&d.skip(2),null!=(s=e[i+"-"+h])?d.writeS(s):d.skip(2),null!=(s=e[i+"-"+h+"-0"])?d.writeS(s):d.skip(2),d.version>=2){d.skip(6),d.skip(4*d.readUshort());for(f=d.readUshort(),m=0;m<f;m++){y=d.readS();0==d.readUshort()&&null!=(s=e[i+"-"+h+"-"+y])?d.writeS(s):d.skip(2)}}d.position=n}break;case ObjectType.Label:d.seek(l,6)&&d.readByte()==g&&(null!=(s=e[i])?d.writeS(s):d.skip(2),d.skip(2),d.readBool()&&d.skip(4),d.skip(4),d.readBool()&&null!=(s=e[i+"-prompt"])&&d.writeS(s));break;case ObjectType.Button:d.seek(l,6)&&d.readByte()==g&&(null!=(s=e[i])?d.writeS(s):d.skip(2),null!=(s=e[i+"-0"])&&d.writeS(s));break;case ObjectType.ComboBox:if(d.seek(l,6)&&d.readByte()==g){for(r=d.readShort(),h=0;h<r;h++)n=d.readShort(),n+=d.position,null!=(s=e[i+"-"+h])&&d.writeS(s),d.position=n;null!=(s=e[i])&&d.writeS(s)}}d.position=l+a}}}}}class ByteBuffer{constructor(t,e,i){this.version=0,e=e||0,null!=i&&-1!=i||(i=t.byteLength-e),this._bytes=new Uint8Array(t,e,i),this._view=new DataView(this._bytes.buffer,e,i),this._pos=0,this._length=i}get data(){return this._bytes}get position(){return this._pos}set position(t){if(t>this._length)throw"Out of bounds";this._pos=t}skip(t){this._pos+=t}validate(t){if(this._pos+t>this._length)throw"Out of bounds"}readByte(){return this.validate(1),this._view.getUint8(this._pos++)}readBool(){return 1==this.readByte()}readShort(){this.validate(2);let t=this._view.getInt16(this._pos,this.littleEndian);return this._pos+=2,t}readUshort(){this.validate(2);let t=this._view.getUint16(this._pos,this.littleEndian);return this._pos+=2,t}readInt(){this.validate(4);let t=this._view.getInt32(this._pos,this.littleEndian);return this._pos+=4,t}readUint(){this.validate(4);let t=this._view.getUint32(this._pos,this.littleEndian);return this._pos+=4,t}readFloat(){this.validate(4);let t=this._view.getFloat32(this._pos,this.littleEndian);return this._pos+=4,t}readString(t){null==t&&(t=this.readUshort()),this.validate(t);let e="",i=this._pos+t,s=0,n=0,r=0,o=String.fromCharCode,h=this._bytes,a=this._pos;for(;a<i;)s=h[a++],s<128?0!=s&&(e+=o(s)):s<224?e+=o((63&s)<<6|127&h[a++]):s<240?(n=h[a++],e+=o((31&s)<<12|(127&n)<<6|127&h[a++])):(n=h[a++],r=h[a++],e+=o((15&s)<<18|(127&n)<<12|r<<6&127|127&h[a++]));return this._pos+=t,e}readS(){var t=this.readUshort();return 65534==t?null:65533==t?"":this.stringTable[t]}readSArray(t){for(var e=new Array(t),i=0;i<t;i++)e[i]=this.readS();return e}writeS(t){var e=this.readUshort();65534!=e&&65533!=e&&(this.stringTable[e]=t)}readColor(t){var e=this.readByte(),i=this.readByte(),s=this.readByte(),n=this.readByte();return new Color(e,i,s,t?n:255)}readChar(){var t=this.readUshort();return String.fromCharCode(t)}readBuffer(){var t=this.readUint();this.validate(t);var e=new ByteBuffer(this._bytes.buffer,this._bytes.byteOffset+this._pos,t);return e.stringTable=this.stringTable,e.version=this.version,this._pos+=t,e}seek(t,e){var i,s=this._pos;return this._pos=t,e<this.readByte()?(1==this.readByte()?(this._pos+=2*e,i=this.readUshort()):(this._pos+=4*e,i=this.readUint()),i>0?(this._pos=t+i,!0):(this._pos=s,!1)):(this._pos=s,!1)}}class PixelHitTest{constructor(t,e,i){this._data=t,this.offsetX=null==e?0:e,this.offsetY=null==i?0:i,this.scaleX=1,this.scaleY=1}hitTest(t){let e=Math.floor((t.x/this.scaleX-this.offsetX)*this._data.scale),i=Math.floor((t.y/this.scaleY-this.offsetY)*this._data.scale);if(e<0||i<0||e>=this._data.pixelWidth)return!1;var s=i*this._data.pixelWidth+e,n=Math.floor(s/8),r=s%8;return n>=0&&n<this._data.pixels.length&&1==(this._data.pixels[n]>>r&1)}}class PixelHitTestData{constructor(t){t.readInt(),this.pixelWidth=t.readInt(),this.scale=1/t.readByte(),this.pixels=t.readBuffer().data}}class ChildHitArea{constructor(t){this._child=t}hitTest(t,e){return null!=this._child.hitTest(e,!1)}}var PathUtils=path;class UIPackage{constructor(){this._items=[],this._itemsById={},this._itemsByName={},this._sprites={},this._dependencies=[],this._branches=[],this._branchIndex=-1}static get branch(){return _branch}static set branch(t){for(var e in _branch=t,_instById){var i=_instById[e];i._branches&&(i._branchIndex=i._branches.indexOf(t))}}static getVar(t){return _vars[t]}static setVar(t,e){_vars[t]=e}static getById(t){return _instById[t]}static getByName(t){return _instByName[t]}static addPackage(t){let e=_instById[t];if(e)return e;let i=resources.get(t,BufferAsset);if(!i)throw"Resource '"+t+"' not ready";if(!i._buffer)throw"Missing asset data.";return e=new UIPackage,e._bundle=resources,e.loadPackage(new ByteBuffer(i._buffer),t),_instById[e.id]=e,_instByName[e.name]=e,_instById[e._path]=e,e}static loadPackage(...t){let e,i,s,n;t[0]instanceof AssetManager.Bundle?(n=t[0],e=t[1],t.length>3?(i=t[2],s=t[3]):s=t[2]):(e=t[0],t.length>2?(i=t[1],s=t[2]):s=t[1]),n=n||resources,n.load(e,Asset,i,(t,r)=>{if(t)return void(null!=s&&s(t,null));let o=new UIPackage;o._bundle=n;let h=r.buffer?r.buffer():r._nativeAsset;o.loadPackage(new ByteBuffer(h),e);let a=o._items.length,l=[];for(var _=0;_<a;_++){var d=o._items[_];d.type!=PackageItemType.Atlas&&d.type!=PackageItemType.Sound||(ItemTypeToAssetType[d.type],l.push(d.file))}let c,u=l.length,g=(t,e)=>{u--,t&&(c=t),u<=0&&(_instById[o.id]=o,_instByName[o.name]=o,o._path&&(_instById[o._path]=o),null!=s&&s(c,o))};u>0?l.forEach((t,e)=>{n.load(t,Asset,i,g)}):g(null)})}static removePackage(t){var e=_instById[t];if(e||(e=_instByName[t]),!e)throw"No package found: "+t;e.dispose(),delete _instById[e.id],delete _instByName[e.name],e._path&&delete _instById[e._path]}static createObject(t,e,i){var s=UIPackage.getByName(t);return s?s.createObject(e,i):null}static createObjectFromURL(t,e){var i=UIPackage.getItemByURL(t);return i?i.owner.internalCreateObject(i,e):null}static getItemURL(t,e){var i=UIPackage.getByName(t);if(!i)return null;var s=i._itemsByName[e];return s?"ui://"+i.id+s.id:null}static getItemByURL(t){var e=t.indexOf("//");if(-1==e)return null;var i=t.indexOf("/",e+2);if(-1==i){if(t.length>13){var s=t.substr(5,8),n=UIPackage.getById(s);if(null!=n){var r=t.substr(13);return n.getItemById(r)}}}else{var o=t.substr(e+2,i-e-2);if(null!=(n=UIPackage.getByName(o))){var h=t.substr(i+1);return n.getItemByName(h)}}return null}static normalizeURL(t){if(null==t)return null;var e=t.indexOf("//");if(-1==e)return null;var i=t.indexOf("/",e+2);if(-1==i)return t;var s=t.substr(e+2,i-e-2),n=t.substr(i+1);return UIPackage.getItemURL(s,n)}static setStringsSource(t){TranslationHelper.loadFromXML(t)}loadPackage(t,e){if(1179080009!=t.readUint())throw"FairyGUI: old package format found in '"+e+"'";this._path=e,t.version=t.readInt();var i=t.version>=2;t.readBool(),this._id=t.readString(),this._name=t.readString(),t.skip(20);var s,n,r,o,h,a=t.position;t.seek(a,4),s=t.readInt();var l,_=new Array(s);for(t.stringTable=_,n=0;n<s;n++)_[n]=t.readString();if(t.seek(a,5))for(s=t.readInt(),n=0;n<s;n++){let e=t.readUshort(),i=t.readInt();_[e]=t.readString(i)}for(t.seek(a,0),s=t.readShort(),n=0;n<s;n++)this._dependencies.push({id:t.readS(),name:t.readS()});i&&((s=t.readShort())>0&&(this._branches=t.readSArray(s),_branch&&(this._branchIndex=this._branches.indexOf(_branch))),h=s>0),t.seek(a,1);let d=e.lastIndexOf("/"),c=-1==d?"":e.substr(0,d+1);for(e+="_",s=t.readShort(),n=0;n<s;n++){switch(r=t.readInt(),r+=t.position,(l=new PackageItem).owner=this,l.type=t.readByte(),l.id=t.readS(),l.name=t.readS(),t.readS(),l.file=t.readS(),t.readBool(),l.width=t.readInt(),l.height=t.readInt(),l.type){case PackageItemType.Image:l.objectType=ObjectType.Image;var u=t.readByte();1==u?(l.scale9Grid=new Rect$1,l.scale9Grid.x=t.readInt(),l.scale9Grid.y=t.readInt(),l.scale9Grid.width=t.readInt(),l.scale9Grid.height=t.readInt(),l.tileGridIndice=t.readInt()):2==u&&(l.scaleByTile=!0),l.smoothing=t.readBool();break;case PackageItemType.MovieClip:l.smoothing=t.readBool(),l.objectType=ObjectType.MovieClip,l.rawData=t.readBuffer();break;case PackageItemType.Font:l.rawData=t.readBuffer();break;case PackageItemType.Component:var g=t.readByte();l.objectType=g>0?g:ObjectType.Component,l.rawData=t.readBuffer(),Decls.UIObjectFactory.resolveExtension(l);break;case PackageItemType.Atlas:case PackageItemType.Sound:case PackageItemType.Misc:l.file=e+PathUtils.mainFileName(l.file);break;case PackageItemType.Spine:case PackageItemType.DragonBones:l.file=c+PathUtils.mainFileName(l.file),l.skeletonAnchor=new Vec2,l.skeletonAnchor.x=t.readFloat(),l.skeletonAnchor.y=t.readFloat()}if(i){(o=t.readS())&&(l.name=o+"/"+l.name);var p=t.readByte();p>0&&(h?l.branches=t.readSArray(p):this._itemsById[t.readS()]=l);var f=t.readByte();f>0&&(l.highResolution=t.readSArray(f))}this._items.push(l),this._itemsById[l.id]=l,null!=l.name&&(this._itemsByName[l.name]=l),t.position=r}for(t.seek(a,2),s=t.readShort(),n=0;n<s;n++){r=t.readShort(),r+=t.position;var m=t.readS();l=this._itemsById[t.readS()];let e=new Rect$1;e.x=t.readInt(),e.y=t.readInt(),e.width=t.readInt(),e.height=t.readInt();var y={atlas:l,rect:e,offset:new Vec2,originalSize:new Size(0,0)};y.rotated=t.readBool(),i&&t.readBool()?(y.offset.x=t.readInt(),y.offset.y=t.readInt(),y.originalSize.width=t.readInt(),y.originalSize.height=t.readInt()):(y.originalSize.width=y.rect.width,y.originalSize.height=y.rect.height),this._sprites[m]=y,t.position=r}if(t.seek(a,3))for(s=t.readShort(),n=0;n<s;n++)r=t.readInt(),r+=t.position,(l=this._itemsById[t.readS()])&&l.type==PackageItemType.Image&&(l.hitTestData=new PixelHitTestData(t)),t.position=r}dispose(){for(var t=this._items.length,e=0;e<t;e++){var i=this._items[e];i.asset&&assetManager.releaseAsset(i.asset)}}get id(){return this._id}get name(){return this._name}get path(){return this._path}get dependencies(){return this._dependencies}createObject(t,e){var i=this._itemsByName[t];return i?this.internalCreateObject(i,e):null}internalCreateObject(t,e){var i=Decls.UIObjectFactory.newObject(t,e);return null==i?null:(constructingDepth.n++,i.constructFromResource(),constructingDepth.n--,i)}getItemById(t){return this._itemsById[t]}getItemByName(t){return this._itemsByName[t]}getItemAssetByName(t){var e=this._itemsByName[t];if(null==e)throw"Resource not found -"+t;return this.getItemAsset(e)}getItemAsset(t){switch(t.type){case PackageItemType.Image:if(!t.decoded){t.decoded=!0;var e=this._sprites[t.id];if(e){let i=this.getItemAsset(e.atlas);if(i){let s=new SpriteFrame;s.texture=i,s.rect=e.rect,s.rotated=e.rotated,s.offset=new Vec2(e.offset.x-(e.originalSize.width-e.rect.width)/2,-(e.offset.y-(e.originalSize.height-e.rect.height)/2)),s.originalSize=e.originalSize,t.scale9Grid&&(s.insetLeft=t.scale9Grid.x,s.insetTop=t.scale9Grid.y,s.insetRight=t.width-t.scale9Grid.xMax,s.insetBottom=t.height-t.scale9Grid.yMax),t.asset=s}}}break;case PackageItemType.Atlas:case PackageItemType.Sound:if(!t.decoded)if(t.decoded=!0,t.asset=this._bundle.get(t.file,ItemTypeToAssetType[t.type]),t.asset)if(t.type==PackageItemType.Atlas){const e=t.asset;let i=e._texture;i||(i=new Texture2D,i.name=e.nativeUrl,i.image=e),t.asset=i}else t.asset=t.asset;else console.log("Resource '"+t.file+"' not found");break;case PackageItemType.Font:t.decoded||(t.decoded=!0,this.loadFont(t));break;case PackageItemType.MovieClip:t.decoded||(t.decoded=!0,this.loadMovieClip(t))}return t.asset}getItemAssetAsync(t,e){if(t.decoded)e(null,t);else if(t.loading)t.loading.push(e);else switch(t.type){case PackageItemType.Spine:t.loading=[e],this.loadSpine(t);break;case PackageItemType.DragonBones:t.loading=[e],this.loadDragonBones(t);break;default:this.getItemAsset(t),e(null,t)}}loadAllAssets(){for(var t=this._items.length,e=0;e<t;e++){var i=this._items[e];this.getItemAsset(i)}}loadMovieClip(t){var e=t.rawData;e.seek(0,0),t.interval=e.readInt()/1e3,t.swing=e.readBool(),t.repeatDelay=e.readInt()/1e3,e.seek(0,1);var i,s,n=e.readShort();t.frames=Array(n);for(var r=0;r<n;r++){var o=e.readShort();o+=e.position;let n=new Rect$1;n.x=e.readInt(),n.y=e.readInt(),n.width=e.readInt(),n.height=e.readInt();let h={rect:n,addDelay:e.readInt()/1e3,texture:null};if(null!=(i=e.readS())&&null!=(s=this._sprites[i])){let e=this.getItemAsset(s.atlas);if(e){t.width,h.rect.width;let i=new SpriteFrame;i.texture=e,i.rect=s.rect,i.rotated=s.rotated,i.offset=new Vec2(h.rect.x-(t.width-h.rect.width)/2,-(h.rect.y-(t.height-h.rect.height)/2)),i.originalSize=new Size(t.width,t.height),h.texture=i}}t.frames[r]=h,e.position=o}}loadFont(t){var e=new BitmapFont;t.asset=e,e.fntConfig={commonHeight:0,fontSize:0,kerningDict:{},fontDefDictionary:{}};let i=e.fntConfig.fontDefDictionary;var s=t.rawData;s.seek(0,0);let n=s.readBool(),r=s.readBool(),o=s.readBool();s.readBool();let h=s.readInt();var a=s.readInt(),l=s.readInt();let _;var d,c=this._sprites[t.id];c&&(_=this.getItemAsset(c.atlas)),s.seek(0,1);for(var u=s.readInt(),g=0;g<u;g++){var p=s.readShort();p+=s.position,d={},i[s.readUshort()]=d;let t=new Rect$1;d.rect=t;var f=s.readS();if(t.x=s.readInt(),t.y=s.readInt(),d.xOffset=s.readInt(),d.yOffset=s.readInt(),t.width=s.readInt(),t.height=s.readInt(),d.xAdvance=s.readInt(),d.channel=s.readByte(),1==d.channel?d.channel=3:2==d.channel?d.channel=2:3==d.channel&&(d.channel=1),n)t.x+=c.rect.x,t.y+=c.rect.y;else{let e=this._sprites[f];e&&(t.set(e.rect),d.xOffset+=e.offset.x,d.yOffset+=e.offset.y,0==h&&(h=e.originalSize.height),_||(e.atlas.load(),_=e.atlas.asset)),0==d.xAdvance&&(d.xAdvance=0==a?d.xOffset+d.rect.width:a)}s.position=p}e.fontSize=h,e.fntConfig.fontSize=h,e.fntConfig.commonHeight=0==l?h:l,e.fntConfig.resizable=o,e.fntConfig.canTint=r;let m=new SpriteFrame;m.texture=_,e.spriteFrame=m,e.onLoaded()}loadSpine(t){this._bundle.load(t.file,sp.SkeletonData,(e,i)=>{t.decoded=!0,t.asset=i;let s=t.loading;delete t.loading,s.forEach(i=>i(e,t))})}loadDragonBones(t){this._bundle.load(t.file,dragonBones.DragonBonesAsset,(e,i)=>{if(e){t.decoded=!0;let i=t.loading;return delete t.loading,void i.forEach(i=>i(e,t))}t.asset=i;let s=t.file.replace("_ske","_tex"),n=s.lastIndexOf(".");-1!=n&&(s=s.substr(0,n+1)+"json"),this._bundle.load(s,dragonBones.DragonBonesAtlasAsset,(e,i)=>{t.decoded=!0,t.atlasAsset=i;let s=t.loading;delete t.loading,s.forEach(i=>i(e,t))})})}}const ItemTypeToAssetType={[PackageItemType.Atlas]:ImageAsset,[PackageItemType.Sound]:AudioClip};var _instById={},_instByName={},_branch="",_vars={},Decls={};function toGrayedColor(t){let e=.299*t.r+.587*t.g+.114*t.b;return new Color(e,e,e,t.a)}class UBBParser{constructor(){this._readPos=0,this._handlers={},this._handlers.url=this.onTag_URL,this._handlers.img=this.onTag_IMG,this._handlers.b=this.onTag_Simple,this._handlers.i=this.onTag_Simple,this._handlers.u=this.onTag_Simple,this._handlers.color=this.onTag_COLOR,this._handlers.size=this.onTag_SIZE}onTag_URL(t,e,i){if(e){let t="";return this.linkColor&&(t+="</color>"),this.linkUnderline&&(t+="</u>"),t+="</on>",t}{let t;if(null!=i)t='<on click="onClickLink" param="'+i+'">';else t='<on click="onClickLink" param="'+this.getTagText()+'">';return this.linkUnderline&&(t+="<u>"),this.linkColor&&(t+="<color="+this.linkColor+">"),t}}onTag_IMG(t,e,i){if(e)return null;var s=this.getTagText(!0);return s?'<img src="'+s+'"/>':null}onTag_Simple(t,e,i){return e?"</"+t+">":"<"+t+">"}onTag_COLOR(t,e,i){return e?"</color>":(this.lastColor=i,"<color="+i+">")}onTag_FONT(t,e,i){return e?"</font>":'<font face="'+i+'">'}onTag_SIZE(t,e,i){return e?"</size>":(this.lastSize=i,"<size="+i+">")}getTagText(t){for(var e,i=this._readPos,s="";-1!=(e=this._text.indexOf("[",i));){if(92!=this._text.charCodeAt(e-1)){s+=this._text.substring(i,e);break}s+=this._text.substring(i,e-1),s+="[",i=e+1}return-1==e?null:(t&&(this._readPos=e),s)}parse(t,e){this._text=t,this.lastColor=null,this.lastSize=null;for(var i,s,n,r,o,h,a,l=0,_="";-1!=(i=this._text.indexOf("[",l));)if(i>0&&92==this._text.charCodeAt(i-1))_+=this._text.substring(l,i-1),_+="[",l=i+1;else{if(_+=this._text.substring(l,i),l=i,-1==(i=this._text.indexOf("]",l)))break;n="/"==this._text.charAt(l+1),r=this._text.substring(n?l+2:l+1,i),this._readPos=i+1,o=null,h=null,-1!=(s=r.indexOf("="))&&(o=r.substring(s+1),r=r.substring(0,s)),r=r.toLowerCase(),null!=(a=this._handlers[r])?null==(h=a.call(this,r,n,o))||e||(_+=h):_+=this._text.substring(l,this._readPos),l=this._readPos}return l<this._text.length&&(_+=this._text.substr(l)),this._text=null,_}}var defaultParser=new UBBParser;class GTextField extends GObject{constructor(){super(),this._fontSize=0,this._leading=0,this._node.name="GTextField",this._touchDisabled=!0,this._text="",this._color=new Color(255,255,255,255),this.createRenderer(),this.fontSize=12,this.leading=3,this.singleLine=!1,this._sizeDirty=!1,this._node.on(Node.EventType.SIZE_CHANGED,this.onLabelSizeChanged,this)}createRenderer(){this._label=this._node.addComponent(Label),this._label.string="",this.autoSize=AutoSizeType.Both}set text(t){this._text=t,null==this._text&&(this._text=""),this.updateGear(6),this.markSizeChanged(),this.updateText()}get text(){return this._text}get font(){return this._font}set font(t){if(this._font!=t||!t){this._font=t,this.markSizeChanged();let i=t||UIConfig.defaultFont;if(i.startsWith("ui://")){var e=UIPackage.getItemByURL(i);i=e?e.owner.getItemAsset(e):UIConfig.defaultFont}this._realFont=i,this.updateFont()}}get fontSize(){return this._fontSize}set fontSize(t){t<0||this._fontSize!=t&&(this._fontSize=t,this.markSizeChanged(),this.updateFontSize())}get color(){return this._color}set color(t){this._color.set(t),this.updateGear(4),this.updateFontColor()}get align(){return this._label?this._label.horizontalAlign:0}set align(t){this._label&&(this._label.horizontalAlign=t)}get verticalAlign(){return this._label?this._label.verticalAlign:0}set verticalAlign(t){this._label&&(this._label.verticalAlign=t)}get leading(){return this._leading}set leading(t){this._leading!=t&&(this._leading=t,this.markSizeChanged(),this.updateFontSize())}get letterSpacing(){return this._label?this._label.spacingX:0}set letterSpacing(t){this._label&&this._label.spacingX!=t&&(this.markSizeChanged(),this._label.spacingX=t)}get underline(){return!!this._label&&this._label.isUnderline}set underline(t){this._label&&(this._label.isUnderline=t)}get bold(){return!!this._label&&this._label.isBold}set bold(t){this._label&&(this._label.isBold=t)}get italic(){return!!this._label&&this._label.isItalic}set italic(t){this._label&&(this._label.isItalic=t)}get singleLine(){return!!this._label&&!this._label.enableWrapText}set singleLine(t){this._label&&(this._label.enableWrapText=!t)}get stroke(){return this._outline&&this._outline.enabled?this._outline.width:0}set stroke(t){0==t?this._outline&&(this._outline.enabled=!1):(this._outline?this._outline.enabled=!0:(this._outline=this._node.addComponent(LabelOutline),this.updateStrokeColor()),this._outline.width=t)}get strokeColor(){return this._strokeColor}set strokeColor(t){this._strokeColor||(this._strokeColor=new Color),this._strokeColor.set(t),this.updateGear(4),this.updateStrokeColor()}get shadowOffset(){return this._shadowOffset}set shadowOffset(t){this._shadowOffset||(this._shadowOffset=new Vec2),this._shadowOffset.set(t),0!=this._shadowOffset.x||0!=this._shadowOffset.y?(this._shadow?this._shadow.enabled=!0:(this._shadow=this._node.addComponent(LabelShadow),this.updateShadowColor()),this._shadow.offset.x=t.x,this._shadow.offset.y=-t.y):this._shadow&&(this._shadow.enabled=!1)}get shadowColor(){return this._shadowColor}set shadowColor(t){this._shadowColor||(this._shadowColor=new Color),this._shadowColor.set(t),this.updateShadowColor()}set ubbEnabled(t){this._ubbEnabled!=t&&(this._ubbEnabled=t,this.markSizeChanged(),this.updateText())}get ubbEnabled(){return this._ubbEnabled}set autoSize(t){this._autoSize!=t&&(this._autoSize=t,this.markSizeChanged(),this.updateOverflow())}get autoSize(){return this._autoSize}parseTemplate(t){for(var e,i,s,n,r=0,o="";-1!=(e=t.indexOf("{",r));)if(e>0&&92==t.charCodeAt(e-1))o+=t.substring(r,e-1),o+="{",r=e+1;else{if(o+=t.substring(r,e),r=e,-1==(e=t.indexOf("}",r)))break;e!=r+1?(-1!=(i=(s=t.substring(r+1,e)).indexOf("="))?o+=null==(n=this._templateVars[s.substring(0,i)])?s.substring(i+1):n:null!=(n=this._templateVars[s])&&(o+=n),r=e+1):(o+=t.substr(r,2),r=e+1)}return r<t.length&&(o+=t.substr(r)),o}get templateVars(){return this._templateVars}set templateVars(t){null==this._templateVars&&null==t||(this._templateVars=t,this.flushVars())}setVar(t,e){return this._templateVars||(this._templateVars={}),this._templateVars[t]=e,this}flushVars(){this.markSizeChanged(),this.updateText()}get textWidth(){return this.ensureSizeCorrect(),this._node._uiProps.uiTransformComp.width}ensureSizeCorrect(){this._sizeDirty&&(this._label.updateRenderData(!0),this._sizeDirty=!1)}updateText(){var t=this._text;this._templateVars&&(t=this.parseTemplate(t)),this._ubbEnabled&&(t=defaultParser.parse(t,!0)),this._label.string=t}assignFont(t,e){if(e instanceof Font)t.font=e;else{let i=getFontByName(e);i?t.font=i:(t.fontFamily=e,t.useSystemFont=!0)}}assignFontColor(t,e){let i=t.font;i instanceof BitmapFont&&!i.fntConfig.canTint&&(e=Color.WHITE),this._grayed&&(e=toGrayedColor(e)),t.color=e}updateFont(){this.assignFont(this._label,this._realFont)}updateFontColor(){this.assignFontColor(this._label,this._color)}updateStrokeColor(){this._outline&&(this._strokeColor||(this._strokeColor=new Color),this._grayed?this._outline.color=toGrayedColor(this._strokeColor):this._outline.color=this._strokeColor)}updateShadowColor(){this._shadow&&(this._shadowColor||(this._shadowColor=new Color),this._grayed?this._shadow.color=toGrayedColor(this._shadowColor):this._shadow.color=this._shadowColor)}updateFontSize(){let t=this._label.font;if(t instanceof BitmapFont){let e=t.fntConfig;e.resizable?this._label.fontSize=this._fontSize:this._label.fontSize=e.fontSize,this._label.lineHeight=e.fontSize+(this._leading+4)*e.fontSize/this._label.fontSize}else this._label.fontSize=this._fontSize,this._label.lineHeight=this._fontSize+this._leading}updateOverflow(){this._autoSize==AutoSizeType.Both?this._label.overflow=Label.Overflow.NONE:this._autoSize==AutoSizeType.Height?(this._label.overflow=Label.Overflow.RESIZE_HEIGHT,this._node._uiProps.uiTransformComp.width=this._width):this._autoSize==AutoSizeType.Shrink?(this._label.overflow=Label.Overflow.SHRINK,this._node._uiProps.uiTransformComp.setContentSize(this._width,this._height)):(this._label.overflow=Label.Overflow.CLAMP,this._node._uiProps.uiTransformComp.setContentSize(this._width,this._height))}markSizeChanged(){this._underConstruct||this._autoSize!=AutoSizeType.Both&&this._autoSize!=AutoSizeType.Height||this._sizeDirty||(this._node.emit(FGUIEvent.SIZE_DELAY_CHANGE),this._sizeDirty=!0)}onLabelSizeChanged(){this._sizeDirty=!1,this._underConstruct||this._autoSize!=AutoSizeType.Both&&this._autoSize!=AutoSizeType.Height||(this._updatingSize=!0,this.setSize(this._node._uiProps.uiTransformComp.width,this._node._uiProps.uiTransformComp.height),this._updatingSize=!1)}handleSizeChanged(){this._updatingSize||(this._autoSize==AutoSizeType.None||this._autoSize==AutoSizeType.Shrink?this._node._uiProps.uiTransformComp.setContentSize(this._width,this._height):this._autoSize==AutoSizeType.Height&&(this._node._uiProps.uiTransformComp.width=this._width))}handleGrayedChanged(){this.updateFontColor(),this.updateStrokeColor()}getProp(t){switch(t){case ObjectPropID.Color:return this.color;case ObjectPropID.OutlineColor:return this.strokeColor;case ObjectPropID.FontSize:return this.fontSize;default:return super.getProp(t)}}setProp(t,e){switch(t){case ObjectPropID.Color:this.color=e;break;case ObjectPropID.OutlineColor:this.strokeColor=e;break;case ObjectPropID.FontSize:this.fontSize=e;break;default:super.setProp(t,e)}}setup_beforeAdd(t,e){if(super.setup_beforeAdd(t,e),t.seek(e,5),this.font=t.readS(),this.fontSize=t.readShort(),this.color=t.readColor(),this.align=t.readByte(),this.verticalAlign=t.readByte(),this.leading=t.readShort(),this.letterSpacing=t.readShort(),this._ubbEnabled=t.readBool(),this.autoSize=t.readByte(),this.underline=t.readBool(),this.italic=t.readBool(),this.bold=t.readBool(),this.singleLine=t.readBool(),t.readBool()&&(this.strokeColor=t.readColor(),this.stroke=t.readFloat()),t.readBool()){this.shadowColor=t.readColor();let e=t.readFloat(),i=t.readFloat();this.shadowOffset=new Vec2(e,i)}t.readBool()&&(this._templateVars={})}setup_afterAdd(t,e){super.setup_afterAdd(t,e),t.seek(e,6);var i=t.readS();null!=i&&(this.text=i)}}class RichTextImageAtlas extends SpriteAtlas{getSpriteFrame(t){let e=UIPackage.getItemByURL(t);if(e){if(e.load(),e.type==PackageItemType.Image)return e.asset;if(e.type==PackageItemType.MovieClip)return e.frames[0].texture}return super.getSpriteFrame(t)}}const imageAtlas=new RichTextImageAtlas;class GRichTextField extends GTextField{constructor(){super(),this._node.name="GRichTextField",this._touchDisabled=!1,this.linkUnderline=UIConfig.linkUnderline}createRenderer(){this._richText=this._node.addComponent(RichText),this._richText.handleTouchEvent=!1,this.autoSize=AutoSizeType.None,this._richText.imageAtlas=imageAtlas}get align(){return this._richText.horizontalAlign}set align(t){this._richText.horizontalAlign=t}get underline(){return this._underline}set underline(t){this._underline!=t&&(this._underline=t,this.updateText())}get bold(){return this._bold}set bold(t){this._bold!=t&&(this._bold=t,this.updateText())}get italic(){return this._italics}set italic(t){this._italics!=t&&(this._italics=t,this.updateText())}markSizeChanged(){}updateText(){var t=this._text;this._templateVars&&(t=this.parseTemplate(t)),this._ubbEnabled&&(defaultParser.linkUnderline=this.linkUnderline,defaultParser.linkColor=this.linkColor,t=defaultParser.parse(t)),this._bold&&(t="<b>"+t+"</b>"),this._italics&&(t="<i>"+t+"</i>"),this._underline&&(t="<u>"+t+"</u>");let e=this._color;this._grayed&&(e=toGrayedColor(e)),t="<color="+e.toHEX("#rrggbb")+">"+t+"</color>",this._autoSize==AutoSizeType.Both?(0!=this._richText.maxWidth&&(this._richText._maxWidth=0),this._richText.string=t,0!=this.maxWidth&&this._node._uiProps.uiTransformComp.contentSize.width>this.maxWidth&&(this._richText.maxWidth=this.maxWidth)):this._richText.string=t}updateFont(){this.assignFont(this._richText,this._realFont)}updateFontColor(){this.assignFontColor(this._richText,this._color)}updateFontSize(){let t=this._fontSize,e=this._richText.font;e instanceof BitmapFont&&(e.fntConfig.resizable||(t=e.fntConfig.fontSize)),this._richText.fontSize=t,this._richText.lineHeight=t+2*this._leading}updateOverflow(){this._autoSize==AutoSizeType.Both?this._richText.maxWidth=0:this._richText.maxWidth=this._width}handleSizeChanged(){this._updatingSize||this._autoSize!=AutoSizeType.Both&&(this._richText.maxWidth=this._width)}}class InputProcessor extends Component{constructor(){super(),this._touches=new Array,this._rollOutChain=new Array,this._rollOverChain=new Array,this._touchPos=new Vec2}onLoad(){this._owner=GObject.cast(this.node)}onEnable(){let t=this.node;t.on(Node.EventType.TOUCH_START,this.touchBeginHandler,this),t.on(Node.EventType.TOUCH_MOVE,this.touchMoveHandler,this),t.on(Node.EventType.TOUCH_END,this.touchEndHandler,this),t.on(Node.EventType.TOUCH_CANCEL,this.touchCancelHandler,this),t.on(Node.EventType.MOUSE_DOWN,this.mouseDownHandler,this),t.on(Node.EventType.MOUSE_MOVE,this.mouseMoveHandler,this),t.on(Node.EventType.MOUSE_UP,this.mouseUpHandler,this),t.on(Node.EventType.MOUSE_WHEEL,this.mouseWheelHandler,this),this._touchListener=this.node.eventProcessor.touchListener}onDisable(){let t=this.node;t.off(Node.EventType.TOUCH_START,this.touchBeginHandler,this),t.off(Node.EventType.TOUCH_MOVE,this.touchMoveHandler,this),t.off(Node.EventType.TOUCH_END,this.touchEndHandler,this),t.off(Node.EventType.TOUCH_CANCEL,this.touchCancelHandler,this),t.off(Node.EventType.MOUSE_DOWN,this.mouseDownHandler,this),t.off(Node.EventType.MOUSE_MOVE,this.mouseMoveHandler,this),t.off(Node.EventType.MOUSE_UP,this.mouseUpHandler,this),t.off(Node.EventType.MOUSE_WHEEL,this.mouseWheelHandler,this),this._touchListener=null}getAllTouches(t){t=t||new Array;let e=this._touches.length;for(let i=0;i<e;i++){let e=this._touches[i];-1!=e.touchId&&t.push(e.touchId)}return t}getTouchPosition(t){void 0===t&&(t=-1);let e=this._touches.length;for(let i=0;i<e;i++){let e=this._touches[i];if(-1!=e.touchId&&(-1==t||e.touchId==t))return e.pos}return Vec2.ZERO}getTouchTarget(){let t=this._touches.length;for(let e=0;e<t;e++){let t=this._touches[e];if(-1!=t.touchId)return t.target}return null}addTouchMonitor(t,e){let i=this.getInfo(t,!1);i&&-1==i.touchMonitors.indexOf(e)&&i.touchMonitors.push(e)}removeTouchMonitor(t){let e=this._touches.length;for(let i=0;i<e;i++){let e=this._touches[i],s=e.touchMonitors.indexOf(t);-1!=s&&e.touchMonitors.splice(s,1)}}cancelClick(t){let e=this.getInfo(t,!1);e&&(e.clickCancelled=!0)}simulateClick(t){let e;e=borrowEvent(FGUIEvent.TOUCH_BEGIN,!0),e.initiator=t,e.pos.set(t.localToGlobal()),e.touchId=0,e.clickCount=1,e.button=0,e._processor=this,this._captureCallback&&this._captureCallback.call(this._owner,e),t.node.dispatchEvent(e),e.unuse(),e.type=FGUIEvent.TOUCH_END,e.bubbles=!0,t.node.dispatchEvent(e),e.unuse(),e.type=FGUIEvent.CLICK,e.bubbles=!0,t.node.dispatchEvent(e),returnEvent(e)}touchBeginHandler(t){let e=this.updateInfo(t.getID(),t.getLocation());if(this.setBegin(e),this._touchListener)this._touchListener.setSwallowTouches(e.target!=this._owner);else{t.preventSwallow=e.target==this._owner}let i=this.getEvent(e,e.target,FGUIEvent.TOUCH_BEGIN,!0);return this._captureCallback&&this._captureCallback.call(this._owner,i),e.target.node.dispatchEvent(i),this.handleRollOver(e,e.target),!0}touchMoveHandler(t){let e=this.updateInfo(t.getID(),t.getLocation());if(!this._touchListener){t.preventSwallow=e.target==this._owner}if(this.handleRollOver(e,e.target),e.began){let t=this.getEvent(e,e.target,FGUIEvent.TOUCH_MOVE,!1),i=!1,s=e.touchMonitors.length;for(let n=0;n<s;n++){let s=e.touchMonitors[n];null!=s.node&&s.node.activeInHierarchy&&(t.unuse(),t.type=FGUIEvent.TOUCH_MOVE,s.node.dispatchEvent(t),s==this._owner&&(i=!0))}!i&&this.node&&(t.unuse(),t.type=FGUIEvent.TOUCH_MOVE,this.node.dispatchEvent(t)),returnEvent(t)}}touchEndHandler(t){let e=this.updateInfo(t.getID(),t.getLocation());if(!this._touchListener){t.preventSwallow=e.target==this._owner}this.setEnd(e);let i=this.getEvent(e,e.target,FGUIEvent.TOUCH_END,!1),s=e.touchMonitors.length;for(let t=0;t<s;t++){let s=e.touchMonitors[t];s==e.target||null==s.node||!s.node.activeInHierarchy||"isAncestorOf"in s&&s.isAncestorOf(e.target)||(i.unuse(),i.type=FGUIEvent.TOUCH_END,s.node.dispatchEvent(i))}e.touchMonitors.length=0,e.target&&e.target.node&&(e.target instanceof GRichTextField&&e.target.node.getComponent(RichText)._onTouchEnded(t),i.unuse(),i.type=FGUIEvent.TOUCH_END,i.bubbles=!0,e.target.node.dispatchEvent(i)),returnEvent(i),e.target=this.clickTest(e),e.target&&(i=this.getEvent(e,e.target,FGUIEvent.CLICK,!0),e.target.node.dispatchEvent(i),returnEvent(i)),sys.isMobile?this.handleRollOver(e,null):this.handleRollOver(e,e.target),e.target=null,e.touchId=-1,e.button=-1}touchCancelHandler(t){let e=this.updateInfo(t.getID(),t.getLocation());if(!this._touchListener){t.preventSwallow=e.target==this._owner}let i=this.getEvent(e,e.target,FGUIEvent.TOUCH_END,!1),s=e.touchMonitors.length;for(let t=0;t<s;t++){let s=e.touchMonitors[t];s==e.target||null==s.node||!s.node.activeInHierarchy||"isAncestorOf"in s&&s.isAncestorOf(e.target)||(i.initiator=s,s.node.dispatchEvent(i))}e.touchMonitors.length=0,e.target&&e.target.node&&(i.bubbles=!0,e.target.node.dispatchEvent(i)),returnEvent(i),this.handleRollOver(e,null),e.target=null,e.touchId=-1,e.button=-1}mouseDownHandler(t){this.getInfo(0,!0).button=t.getButton()}mouseUpHandler(t){this.getInfo(0,!0).button=t.getButton()}mouseMoveHandler(t){let e=this.getInfo(0,!1);if(!(e&&Math.abs(e.pos.x-t.getLocationX())<1&&Math.abs(e.pos.y-(UIContentScaler.rootSize.height-t.getLocationY()))<1)&&(e=this.updateInfo(0,t.getLocation()),this.handleRollOver(e,e.target),e.began)){let t=this.getEvent(e,e.target,FGUIEvent.TOUCH_MOVE,!1),i=!1,s=e.touchMonitors.length;for(let n=0;n<s;n++){let s=e.touchMonitors[n];null!=s.node&&s.node.activeInHierarchy&&(t.initiator=s,s.node.dispatchEvent(t),s==this._owner&&(i=!0))}!i&&this.node&&(t.initiator=this._owner,this.node.dispatchEvent(t),returnEvent(t)),returnEvent(t)}}mouseWheelHandler(t){let e=this.updateInfo(0,t.getLocation());e.mouseWheelDelta=Math.max(t.getScrollX(),t.getScrollY());let i=this.getEvent(e,e.target,FGUIEvent.MOUSE_WHEEL,!0);e.target.node.dispatchEvent(i),returnEvent(i)}updateInfo(t,e){const i=director.root.batcher2D.getFirstRenderCamera(this.node);i?(s_vec3.set(e.x,e.y),i.screenToWorld(s_vec3_2,s_vec3),this._touchPos.set(s_vec3_2.x,s_vec3_2.y)):this._touchPos.set(e),this._touchPos.y=UIContentScaler.rootSize.height-this._touchPos.y;let s=this._owner.hitTest(this._touchPos);s||(s=this._owner);let n=this.getInfo(t);return n.target=s,n.pos.set(this._touchPos),n.button=EventMouse.BUTTON_LEFT,n.touchId=t,n}getInfo(t,e){void 0===e&&(e=!0);let i=null,s=this._touches.length;for(let e=0;e<s;e++){let s=this._touches[e];if(s.touchId==t)return s;-1==s.touchId&&(i=s)}if(!i){if(!e)return null;i=new TouchInfo,this._touches.push(i)}return i.touchId=t,i}setBegin(t){t.began=!0,t.clickCancelled=!1,t.downPos.set(t.pos),t.downTargets.length=0;let e=t.target;for(;e;)t.downTargets.push(e),e=e.findParent()}setEnd(t){t.began=!1;let e=game.totalTime/1e3;e-t.lastClickTime<.45?2==t.clickCount?t.clickCount=1:t.clickCount++:t.clickCount=1,t.lastClickTime=e}clickTest(t){if(0==t.downTargets.length||t.clickCancelled||Math.abs(t.pos.x-t.downPos.x)>50||Math.abs(t.pos.y-t.downPos.y)>50)return null;let e=t.downTargets[0];if(e&&e.node&&e.node.activeInHierarchy)return e;for(e=t.target;e;){if(-1!=t.downTargets.indexOf(e)&&e.node&&e.node.activeInHierarchy)break;e=e.findParent()}return e}handleRollOver(t,e){if(t.lastRollOver==e)return;let i=t.lastRollOver;for(;i&&i.node;)this._rollOutChain.push(i),i=i.findParent();for(i=e;i&&i.node;){let t=this._rollOutChain.indexOf(i);if(-1!=t){this._rollOutChain.length=t;break}this._rollOverChain.push(i),i=i.findParent()}t.lastRollOver=e;let s=this._rollOutChain.length;for(let e=0;e<s;e++)if(i=this._rollOutChain[e],i.node&&i.node.activeInHierarchy){let e=this.getEvent(t,i,FGUIEvent.ROLL_OUT,!1);i.node.dispatchEvent(e),returnEvent(e)}s=this._rollOverChain.length;for(let e=0;e<s;e++)if(i=this._rollOverChain[e],i.node&&i.node.activeInHierarchy){let e=this.getEvent(t,i,FGUIEvent.ROLL_OVER,!1);i.node.dispatchEvent(e),returnEvent(e)}this._rollOutChain.length=0,this._rollOverChain.length=0}getEvent(t,e,i,s){let n=borrowEvent(i,s);return n.initiator=e,n.pos.set(t.pos),n.touchId=t.touchId,n.clickCount=t.clickCount,n.button=t.button,n.mouseWheelDelta=t.mouseWheelDelta,n._processor=this,n}}class TouchInfo{constructor(){this.pos=new Vec2,this.touchId=0,this.clickCount=0,this.mouseWheelDelta=0,this.button=-1,this.downPos=new Vec2,this.began=!1,this.clickCancelled=!1,this.lastClickTime=0,this.downTargets=new Array,this.touchMonitors=new Array}}var s_vec3=new Vec3,s_vec3_2=new Vec3;class ControllerAction{constructor(){}run(t,e,i){this.fromPage&&0!=this.fromPage.length&&-1==this.fromPage.indexOf(e)||this.toPage&&0!=this.toPage.length&&-1==this.toPage.indexOf(i)?this.leave(t):this.enter(t)}enter(t){}leave(t){}setup(t){var e,i;for(e=t.readShort(),this.fromPage=[],i=0;i<e;i++)this.fromPage[i]=t.readS();for(e=t.readShort(),this.toPage=[],i=0;i<e;i++)this.toPage[i]=t.readS()}}class PlayTransitionAction extends ControllerAction{constructor(){super(),this.playTimes=1,this.delay=0}enter(t){var e=t.parent.getTransition(this.transitionName);e&&(this._currentTransition&&this._currentTransition.playing?e.changePlayTimes(this.playTimes):e.play(null,this.playTimes,this.delay),this._currentTransition=e)}leave(t){this.stopOnExit&&this._currentTransition&&(this._currentTransition.stop(),this._currentTransition=null)}setup(t){super.setup(t),this.transitionName=t.readS(),this.playTimes=t.readInt(),this.delay=t.readFloat(),this.stopOnExit=t.readBool()}}class ChangePageAction extends ControllerAction{constructor(){super()}enter(t){var e;if(this.controllerName&&(e=this.objectId?t.parent.getChildById(this.objectId):t.parent)){var i=e.getController(this.controllerName);i&&i!=t&&!i.changing&&("~1"==this.targetPage?t.selectedIndex<i.pageCount&&(i.selectedIndex=t.selectedIndex):"~2"==this.targetPage?i.selectedPage=t.selectedPage:i.selectedPageId=this.targetPage)}}setup(t){super.setup(t),this.objectId=t.readS(),this.controllerName=t.readS(),this.targetPage=t.readS()}}var _nextPageId=0;class Controller extends EventTarget{constructor(){super(),this._pageIds=[],this._pageNames=[],this._selectedIndex=-1,this._previousIndex=-1}dispose(){}get selectedIndex(){return this._selectedIndex}set selectedIndex(t){if(this._selectedIndex!=t){if(t>this._pageIds.length-1)throw"index out of bounds: "+t;this.changing=!0,this._previousIndex=this._selectedIndex,this._selectedIndex=t,this.parent.applyController(this),this.emit(FGUIEvent.STATUS_CHANGED,this),this.changing=!1}}onChanged(t,e){this.on(FGUIEvent.STATUS_CHANGED,t,e)}offChanged(t,e){this.off(FGUIEvent.STATUS_CHANGED,t,e)}setSelectedIndex(t){if(this._selectedIndex!=t){if(t>this._pageIds.length-1)throw"index out of bounds: "+t;this.changing=!0,this._previousIndex=this._selectedIndex,this._selectedIndex=t,this.parent.applyController(this),this.changing=!1}}get previsousIndex(){return this._previousIndex}get selectedPage(){return-1==this._selectedIndex?null:this._pageNames[this._selectedIndex]}set selectedPage(t){var e=this._pageNames.indexOf(t);-1==e&&(e=0),this.selectedIndex=e}setSelectedPage(t){var e=this._pageNames.indexOf(t);-1==e&&(e=0),this.setSelectedIndex(e)}get previousPage(){return-1==this._previousIndex?null:this._pageNames[this._previousIndex]}get pageCount(){return this._pageIds.length}getPageName(t){return this._pageNames[t]}addPage(t){t=t||"",this.addPageAt(t,this._pageIds.length)}addPageAt(t,e){t=t||"";var i=""+_nextPageId++;null==e||e==this._pageIds.length?(this._pageIds.push(i),this._pageNames.push(t)):(this._pageIds.splice(e,0,i),this._pageNames.splice(e,0,t))}removePage(t){var e=this._pageNames.indexOf(t);-1!=e&&(this._pageIds.splice(e,1),this._pageNames.splice(e,1),this._selectedIndex>=this._pageIds.length?this.selectedIndex=this._selectedIndex-1:this.parent.applyController(this))}removePageAt(t){this._pageIds.splice(t,1),this._pageNames.splice(t,1),this._selectedIndex>=this._pageIds.length?this.selectedIndex=this._selectedIndex-1:this.parent.applyController(this)}clearPages(){this._pageIds.length=0,this._pageNames.length=0,-1!=this._selectedIndex?this.selectedIndex=-1:this.parent.applyController(this)}hasPage(t){return-1!=this._pageNames.indexOf(t)}getPageIndexById(t){return this._pageIds.indexOf(t)}getPageIdByName(t){var e=this._pageNames.indexOf(t);return-1!=e?this._pageIds[e]:null}getPageNameById(t){var e=this._pageIds.indexOf(t);return-1!=e?this._pageNames[e]:null}getPageId(t){return this._pageIds[t]}get selectedPageId(){return-1==this._selectedIndex?null:this._pageIds[this._selectedIndex]}set selectedPageId(t){var e=this._pageIds.indexOf(t);this.selectedIndex=e}set oppositePageId(t){this._pageIds.indexOf(t)>0?this.selectedIndex=0:this._pageIds.length>1&&(this.selectedIndex=1)}get previousPageId(){return-1==this._previousIndex?null:this._pageIds[this._previousIndex]}runActions(){if(this._actions)for(var t=this._actions.length,e=0;e<t;e++)this._actions[e].run(this,this.previousPageId,this.selectedPageId)}setup(t){var e,i,s=t.position;t.seek(s,0),this.name=t.readS(),t.readBool()&&(this.autoRadioGroupDepth=!0),t.seek(s,1);var n=t.readShort();for(e=0;e<n;e++)this._pageIds.push(t.readS()),this._pageNames.push(t.readS());var r=0;if(t.version>=2)switch(t.readByte()){case 1:r=t.readShort();break;case 2:-1==(r=this._pageNames.indexOf(UIPackage.branch))&&(r=0);break;case 3:-1==(r=this._pageNames.indexOf(UIPackage.getVar(t.readS())))&&(r=0)}if(t.seek(s,2),(n=t.readShort())>0)for(this._actions||(this._actions=new Array),e=0;e<n;e++){i=t.readShort(),i+=t.position;var o=createAction(t.readByte());o.setup(t),this._actions.push(o),t.position=i}this.parent&&this._pageIds.length>0?this._selectedIndex=r:this._selectedIndex=-1}}function createAction(t){switch(t){case 0:return new PlayTransitionAction;case 1:return new ChangePageAction}return null}class Margin{constructor(){this.left=0,this.right=0,this.top=0,this.bottom=0}copy(t){this.top=t.top,this.bottom=t.bottom,this.left=t.left,this.right=t.right}isNone(){return 0==this.left&&0==this.right&&0==this.top&&0==this.bottom}}class ScrollPane extends Component{constructor(){super(...arguments),this._aniFlag=0}setup(t){const e=this._owner=GObject.cast(this.node);this._maskContainer=new Node("ScrollPane"),this._maskContainer.layer=UIConfig.defaultUILayer,this._maskContainer.addComponent(UITransform).setAnchorPoint(0,1),this._maskContainer.parent=e.node,this._container=e._container,this._container.parent=this._maskContainer,this._scrollBarMargin=new Margin,this._mouseWheelEnabled=!0,this._xPos=0,this._yPos=0,this._aniFlag=0,this._tweening=0,this._footerLockedSize=0,this._headerLockedSize=0,this._viewSize=new Vec2,this._contentSize=new Vec2,this._pageSize=new Vec2(1,1),this._overlapSize=new Vec2,this._tweenTime=new Vec2,this._tweenStart=new Vec2,this._tweenDuration=new Vec2,this._tweenChange=new Vec2,this._velocity=new Vec2,this._containerPos=new Vec2,this._beginTouchPos=new Vec2,this._lastTouchPos=new Vec2,this._lastTouchGlobalPos=new Vec2,this._scrollStep=UIConfig.defaultScrollStep,this._mouseWheelStep=2*this._scrollStep,this._decelerationRate=UIConfig.defaultScrollDecelerationRate,this._snappingPolicy=0,e.on(FGUIEvent.TOUCH_BEGIN,this.onTouchBegin,this),e.on(FGUIEvent.TOUCH_MOVE,this.onTouchMove,this),e.on(FGUIEvent.TOUCH_END,this.onTouchEnd,this),e.on(FGUIEvent.MOUSE_WHEEL,this.onMouseWheel,this),this._scrollType=t.readByte();var i=t.readByte(),s=t.readInt();t.readBool()&&(this._scrollBarMargin.top=t.readInt(),this._scrollBarMargin.bottom=t.readInt(),this._scrollBarMargin.left=t.readInt(),this._scrollBarMargin.right=t.readInt());var n=t.readS(),r=t.readS(),o=t.readS(),h=t.readS();if(0!=(1&s)&&(this._displayOnLeft=!0),0!=(2&s)&&(this._snapToItem=!0),0!=(4&s)&&(this._displayInDemand=!0),0!=(8&s)&&(this._pageMode=!0),this._touchEffect=!!(16&s)||!(32&s)&&UIConfig.defaultScrollTouchEffect,this._bouncebackEffect=!!(64&s)||!(128&s)&&UIConfig.defaultScrollBounceEffect,0!=(256&s)&&(this._inertiaDisabled=!0),0==(512&s)&&this._maskContainer.addComponent(Mask),0!=(1024&s)&&(this._floating=!0),0!=(2048&s)&&(this._dontClipMargin=!0),i==ScrollBarDisplayType.Default&&(i=UIConfig.defaultScrollBarDisplay),i!=ScrollBarDisplayType.Hidden){var a;if(this._scrollType==ScrollType.Both||this._scrollType==ScrollType.Vertical)if(a=n||UIConfig.verticalScrollBar){if(this._vtScrollBar=UIPackage.createObjectFromURL(a),!this._vtScrollBar)throw"cannot create scrollbar from "+a;this._vtScrollBar.setScrollPane(this,!0),this._vtScrollBar.node.parent=e.node}if(this._scrollType==ScrollType.Both||this._scrollType==ScrollType.Horizontal)if(a=r||UIConfig.horizontalScrollBar){if(this._hzScrollBar=UIPackage.createObjectFromURL(a),!this._hzScrollBar)throw"cannot create scrollbar from "+a;this._hzScrollBar.setScrollPane(this,!1),this._hzScrollBar.node.parent=e.node}i==ScrollBarDisplayType.Auto&&(this._scrollBarDisplayAuto=!0),this._scrollBarDisplayAuto&&(this._vtScrollBar&&(this._vtScrollBar.node.active=!1),this._hzScrollBar&&(this._hzScrollBar.node.active=!1),e.on(FGUIEvent.ROLL_OVER,this.onRollOver,this),e.on(FGUIEvent.ROLL_OUT,this.onRollOut,this))}if(o){if(this._header=UIPackage.createObjectFromURL(o),null==this._header)throw"cannot create scrollPane header from "+o;this._maskContainer.insertChild(this._header.node,0)}if(h){if(this._footer=UIPackage.createObjectFromURL(h),null==this._footer)throw"cannot create scrollPane footer from "+h;this._maskContainer.insertChild(this._footer.node,0)}this._refreshBarAxis=this._scrollType==ScrollType.Both||this._scrollType==ScrollType.Vertical?"y":"x",this.setSize(e.width,e.height)}onDestroy(){delete this._pageController,this._hzScrollBar&&this._hzScrollBar.dispose(),this._vtScrollBar&&this._vtScrollBar.dispose(),this._header&&this._header.dispose(),this._footer&&this._footer.dispose()}hitTest(t,e){let i;return this._vtScrollBar&&(i=this._vtScrollBar.hitTest(e),i)||this._hzScrollBar&&(i=this._hzScrollBar.hitTest(e),i)||this._header&&this._header.node.activeInHierarchy&&(i=this._header.hitTest(e),i)||this._footer&&this._footer.node.activeInHierarchy&&(i=this._footer.hitTest(e),i)?i:t.x>=this._owner.margin.left&&t.y>=this._owner.margin.top&&t.x<this._owner.margin.left+this._viewSize.x&&t.y<this._owner.margin.top+this._viewSize.y?this._owner:null}get owner(){return this._owner}get hzScrollBar(){return this._hzScrollBar}get vtScrollBar(){return this._vtScrollBar}get header(){return this._header}get footer(){return this._footer}get bouncebackEffect(){return this._bouncebackEffect}set bouncebackEffect(t){this._bouncebackEffect=t}get touchEffect(){return this._touchEffect}set touchEffect(t){this._touchEffect=t}set scrollStep(t){this._scrollStep=t,0==this._scrollStep&&(this._scrollStep=UIConfig.defaultScrollStep),this._mouseWheelStep=2*this._scrollStep}get decelerationRate(){return this._decelerationRate}set decelerationRate(t){this._decelerationRate=t}get scrollStep(){return this._scrollStep}get snapToItem(){return this._snapToItem}set snapToItem(t){this._snapToItem=t}get snappingPolicy(){return this._snappingPolicy}set snappingPolicy(t){this._snappingPolicy=t}get mouseWheelEnabled(){return this._mouseWheelEnabled}set mouseWheelEnabled(t){this._mouseWheelEnabled=t}get isDragged(){return this._dragged}get percX(){return 0==this._overlapSize.x?0:this._xPos/this._overlapSize.x}set percX(t){this.setPercX(t,!1)}setPercX(t,e){this._owner.ensureBoundsCorrect(),this.setPosX(this._overlapSize.x*math.clamp01(t),e)}get percY(){return 0==this._overlapSize.y?0:this._yPos/this._overlapSize.y}set percY(t){this.setPercY(t,!1)}setPercY(t,e){this._owner.ensureBoundsCorrect(),this.setPosY(this._overlapSize.y*math.clamp01(t),e)}get posX(){return this._xPos}set posX(t){this.setPosX(t,!1)}setPosX(t,e){this._owner.ensureBoundsCorrect(),1==this._loop&&(t=this.loopCheckingNewPos(t,"x")),(t=math.clamp(t,0,this._overlapSize.x))!=this._xPos&&(this._xPos=t,this.posChanged(e))}get posY(){return this._yPos}set posY(t){this.setPosY(t,!1)}setPosY(t,e){this._owner.ensureBoundsCorrect(),1==this._loop&&(t=this.loopCheckingNewPos(t,"y")),(t=math.clamp(t,0,this._overlapSize.y))!=this._yPos&&(this._yPos=t,this.posChanged(e))}get contentWidth(){return this._contentSize.x}get contentHeight(){return this._contentSize.y}get viewWidth(){return this._viewSize.x}set viewWidth(t){t=t+this._owner.margin.left+this._owner.margin.right,this._vtScrollBar&&!this._floating&&(t+=this._vtScrollBar.width),this._owner.width=t}get viewHeight(){return this._viewSize.y}set viewHeight(t){t=t+this._owner.margin.top+this._owner.margin.bottom,this._hzScrollBar&&!this._floating&&(t+=this._hzScrollBar.height),this._owner.height=t}get currentPageX(){if(!this._pageMode)return 0;var t=Math.floor(this._xPos/this._pageSize.x);return this._xPos-t*this._pageSize.x>.5*this._pageSize.x&&t++,t}set currentPageX(t){this.setCurrentPageX(t,!1)}get currentPageY(){if(!this._pageMode)return 0;var t=Math.floor(this._yPos/this._pageSize.y);return this._yPos-t*this._pageSize.y>.5*this._pageSize.y&&t++,t}set currentPageY(t){this.setCurrentPageY(t,!1)}setCurrentPageX(t,e){this._pageMode&&(this._owner.ensureBoundsCorrect(),this._overlapSize.x>0&&this.setPosX(t*this._pageSize.x,e))}setCurrentPageY(t,e){this._pageMode&&(this._owner.ensureBoundsCorrect(),this._overlapSize.y>0&&this.setPosY(t*this._pageSize.y,e))}get isBottomMost(){return this._yPos==this._overlapSize.y||0==this._overlapSize.y}get isRightMost(){return this._xPos==this._overlapSize.x||0==this._overlapSize.x}get pageController(){return this._pageController}set pageController(t){this._pageController=t}get scrollingPosX(){return math.clamp(-this._container.position.x,0,this._overlapSize.x)}get scrollingPosY(){return math.clamp(- -this._container.position.y,0,this._overlapSize.y)}scrollTop(t){this.setPercY(0,t)}scrollBottom(t){this.setPercY(1,t)}scrollUp(t,e){null==t&&(t=1),this._pageMode?this.setPosY(this._yPos-this._pageSize.y*t,e):this.setPosY(this._yPos-this._scrollStep*t,e)}scrollDown(t,e){null==t&&(t=1),this._pageMode?this.setPosY(this._yPos+this._pageSize.y*t,e):this.setPosY(this._yPos+this._scrollStep*t,e)}scrollLeft(t,e){null==t&&(t=1),this._pageMode?this.setPosX(this._xPos-this._pageSize.x*t,e):this.setPosX(this._xPos-this._scrollStep*t,e)}scrollRight(t,e){null==t&&(t=1),this._pageMode?this.setPosX(this._xPos+this._pageSize.x*t,e):this.setPosX(this._xPos+this._scrollStep*t,e)}scrollToView(t,e,i){var s;if(this._owner.ensureBoundsCorrect(),this._needRefresh&&this.refresh(),t instanceof GObject?t.parent!=this._owner?(t.parent.localToGlobalRect(t.x,t.y,t.width,t.height,s_rect),s=this._owner.globalToLocalRect(s_rect.x,s_rect.y,s_rect.width,s_rect.height,s_rect)):((s=s_rect).x=t.x,s.y=t.y,s.width=t.width,s.height=t.height):s=t,this._overlapSize.y>0){var n=this._yPos+this._viewSize.y;i||s.y<=this._yPos||s.height>=this._viewSize.y?this._pageMode?this.setPosY(Math.floor(s.y/this._pageSize.y)*this._pageSize.y,e):this.setPosY(s.y,e):s.y+s.height>n&&(this._pageMode?this.setPosY(Math.floor(s.y/this._pageSize.y)*this._pageSize.y,e):s.height<=this._viewSize.y/2?this.setPosY(s.y+2*s.height-this._viewSize.y,e):this.setPosY(s.y+s.height-this._viewSize.y,e))}if(this._overlapSize.x>0){var r=this._xPos+this._viewSize.x;i||s.x<=this._xPos||s.width>=this._viewSize.x?this._pageMode?this.setPosX(Math.floor(s.x/this._pageSize.x)*this._pageSize.x,e):this.setPosX(s.x,e):s.x+s.width>r&&(this._pageMode?this.setPosX(Math.floor(s.x/this._pageSize.x)*this._pageSize.x,e):s.width<=this._viewSize.x/2?this.setPosX(s.x+2*s.width-this._viewSize.x,e):this.setPosX(s.x+s.width-this._viewSize.x,e))}!e&&this._needRefresh&&this.refresh()}isChildInView(t){if(this._overlapSize.y>0){var e=t.y+-this._container.position.y;if(e<-t.height||e>this._viewSize.y)return!1}return!(this._overlapSize.x>0&&((e=t.x+this._container.position.x)<-t.width||e>this._viewSize.x))}cancelDragging(){ScrollPane.draggingPane==this&&(ScrollPane.draggingPane=null),_gestureFlag=0,this._dragged=!1}lockHeader(t){if(this._headerLockedSize==t)return;let e=this._container.position.x,i=-this._container.position.y,s="x"==this._refreshBarAxis?e:i;this._headerLockedSize=t,!this._refreshEventDispatching&&s>=0&&(this._tweenStart.x=e,this._tweenStart.y=i,this._tweenChange.set(Vec2.ZERO),this._tweenChange[this._refreshBarAxis]=this._headerLockedSize-this._tweenStart[this._refreshBarAxis],this._tweenDuration.x=this._tweenDuration.y=TWEEN_TIME_DEFAULT,this.startTween(2))}lockFooter(t){if(this._footerLockedSize==t)return;let e=this._container.position.x,i=-this._container.position.y,s="x"==this._refreshBarAxis?e:i;if(this._footerLockedSize=t,!this._refreshEventDispatching&&s<=-this._overlapSize[this._refreshBarAxis]){this._tweenStart.x=e,this._tweenStart.y=i,this._tweenChange.set(Vec2.ZERO);var n=this._overlapSize[this._refreshBarAxis];0==n?n=Math.max(this._contentSize[this._refreshBarAxis]+this._footerLockedSize-this._viewSize[this._refreshBarAxis],0):n+=this._footerLockedSize,this._tweenChange[this._refreshBarAxis]=-n-this._tweenStart[this._refreshBarAxis],this._tweenDuration.x=this._tweenDuration.y=TWEEN_TIME_DEFAULT,this.startTween(2)}}onOwnerSizeChanged(){this.setSize(this._owner.width,this._owner.height),this.posChanged(!1)}handleControllerChanged(t){this._pageController==t&&(this._scrollType==ScrollType.Horizontal?this.setCurrentPageX(t.selectedIndex,!0):this.setCurrentPageY(t.selectedIndex,!0))}updatePageController(){var t;if(this._pageController&&!this._pageController.changing&&(t=this._scrollType==ScrollType.Horizontal?this.currentPageX:this.currentPageY)<this._pageController.pageCount){var e=this._pageController;this._pageController=null,e.selectedIndex=t,this._pageController=e}}adjustMaskContainer(){var t=0;this._displayOnLeft&&this._vtScrollBar&&!this._floating&&(t=this._vtScrollBar.width);const e=this._owner;this._dontClipMargin?this._maskContainer._uiProps.uiTransformComp.setAnchorPoint((e.margin.left+e._alignOffset.x)/e.width,1-(e.margin.top+e._alignOffset.y)/e.height):this._maskContainer._uiProps.uiTransformComp.setAnchorPoint(e._alignOffset.x/this._viewSize.x,1-e._alignOffset.y/this._viewSize.y),e._customMask?this._maskContainer.setPosition(t+e._alignOffset.x,-e._alignOffset.y):this._maskContainer.setPosition(e._pivotCorrectX+t+e._alignOffset.x,e._pivotCorrectY-e._alignOffset.y)}setSize(t,e){this._hzScrollBar&&(this._hzScrollBar.y=e-this._hzScrollBar.height,this._vtScrollBar?(this._hzScrollBar.width=t-this._vtScrollBar.width-this._scrollBarMargin.left-this._scrollBarMargin.right,this._displayOnLeft?this._hzScrollBar.x=this._scrollBarMargin.left+this._vtScrollBar.width:this._hzScrollBar.x=this._scrollBarMargin.left):(this._hzScrollBar.width=t-this._scrollBarMargin.left-this._scrollBarMargin.right,this._hzScrollBar.x=this._scrollBarMargin.left)),this._vtScrollBar&&(this._displayOnLeft||(this._vtScrollBar.x=t-this._vtScrollBar.width),this._hzScrollBar?this._vtScrollBar.height=e-this._hzScrollBar.height-this._scrollBarMargin.top-this._scrollBarMargin.bottom:this._vtScrollBar.height=e-this._scrollBarMargin.top-this._scrollBarMargin.bottom,this._vtScrollBar.y=this._scrollBarMargin.top),this._viewSize.x=t,this._viewSize.y=e,this._hzScrollBar&&!this._floating&&(this._viewSize.y-=this._hzScrollBar.height),this._vtScrollBar&&!this._floating&&(this._viewSize.x-=this._vtScrollBar.width),this._viewSize.x-=this._owner.margin.left+this._owner.margin.right,this._viewSize.y-=this._owner.margin.top+this._owner.margin.bottom,this._viewSize.x=Math.max(1,this._viewSize.x),this._viewSize.y=Math.max(1,this._viewSize.y),this._pageSize.x=this._viewSize.x,this._pageSize.y=this._viewSize.y,this.adjustMaskContainer(),this.handleSizeChanged()}setContentSize(t,e){this._contentSize.x==t&&this._contentSize.y==e||(this._contentSize.x=t,this._contentSize.y=e,this.handleSizeChanged(),this._snapToItem&&0!=this._snappingPolicy&&0==this._xPos&&0==this._yPos&&this.posChanged(!1))}changeContentSizeOnScrolling(t,e,i,s){var n=this._xPos==this._overlapSize.x,r=this._yPos==this._overlapSize.y;this._contentSize.x+=t,this._contentSize.y+=e,this.handleSizeChanged(),1==this._tweening?(0!=t&&n&&this._tweenChange.x<0&&(this._xPos=this._overlapSize.x,this._tweenChange.x=-this._xPos-this._tweenStart.x),0!=e&&r&&this._tweenChange.y<0&&(this._yPos=this._overlapSize.y,this._tweenChange.y=-this._yPos-this._tweenStart.y)):2==this._tweening?(0!=i&&(this._container.setPosition(this._container.position.x-i,this._container.position.y),this._tweenStart.x-=i,this._xPos=-this._container.position.x),0!=s&&(this._container.setPosition(this._container.position.x,this._container.position.y+s),this._tweenStart.y-=s,this._yPos=- -this._container.position.y)):this._dragged?(0!=i&&(this._container.setPosition(this._container.position.x-i,this._container.position.y),this._containerPos.x-=i,this._xPos=-this._container.position.x),0!=s&&(this._container.setPosition(this._container.position.x,this._container.position.y+s),this._containerPos.y-=s,this._yPos=- -this._container.position.y)):(0!=t&&n&&(this._xPos=this._overlapSize.x,this._container.setPosition(-this._xPos,this._container.position.y)),0!=e&&r&&(this._yPos=this._overlapSize.y,this._container.setPosition(this._container.position.x,this._yPos))),this._pageMode&&this.updatePageController()}handleSizeChanged(){this._displayInDemand&&(this._vScrollNone=this._contentSize.y<=this._viewSize.y,this._hScrollNone=this._contentSize.x<=this._viewSize.x),this._vtScrollBar&&(0==this._contentSize.y?this._vtScrollBar.setDisplayPerc(0):this._vtScrollBar.setDisplayPerc(Math.min(1,this._viewSize.y/this._contentSize.y))),this._hzScrollBar&&(0==this._contentSize.x?this._hzScrollBar.setDisplayPerc(0):this._hzScrollBar.setDisplayPerc(Math.min(1,this._viewSize.x/this._contentSize.x))),this.updateScrollBarVisible();var t=this._viewSize.x,e=this._viewSize.y;this._vScrollNone&&this._vtScrollBar&&(t+=this._vtScrollBar.width),this._hScrollNone&&this._hzScrollBar&&(e+=this._hzScrollBar.height),this._dontClipMargin&&(t+=this._owner.margin.left+this._owner.margin.right,e+=this._owner.margin.top+this._owner.margin.bottom),this._maskContainer._uiProps.uiTransformComp.setContentSize(t,e),this._vtScrollBar&&this._vtScrollBar.handlePositionChanged(),this._hzScrollBar&&this._hzScrollBar.handlePositionChanged(),this._header&&this._header.handlePositionChanged(),this._footer&&this._footer.handlePositionChanged(),this._scrollType==ScrollType.Horizontal||this._scrollType==ScrollType.Both?this._overlapSize.x=Math.ceil(Math.max(0,this._contentSize.x-this._viewSize.x)):this._overlapSize.x=0,this._scrollType==ScrollType.Vertical||this._scrollType==ScrollType.Both?this._overlapSize.y=Math.ceil(Math.max(0,this._contentSize.y-this._viewSize.y)):this._overlapSize.y=0,this._xPos=math.clamp(this._xPos,0,this._overlapSize.x),this._yPos=math.clamp(this._yPos,0,this._overlapSize.y);var i=this._overlapSize[this._refreshBarAxis];0==i?i=Math.max(this._contentSize[this._refreshBarAxis]+this._footerLockedSize-this._viewSize[this._refreshBarAxis],0):i+=this._footerLockedSize,"x"==this._refreshBarAxis?this._container.setPosition(math.clamp(this._container.position.x,-i,this._headerLockedSize),-math.clamp(-this._container.position.y,-this._overlapSize.y,0)):this._container.setPosition(math.clamp(this._container.position.x,-this._overlapSize.x,0),-math.clamp(-this._container.position.y,-i,this._headerLockedSize)),this._header&&("x"==this._refreshBarAxis?this._header.height=this._viewSize.y:this._header.width=this._viewSize.x),this._footer&&("y"==this._refreshBarAxis?this._footer.height=this._viewSize.y:this._footer.width=this._viewSize.x),this.updateScrollBarPos(),this._pageMode&&this.updatePageController()}posChanged(t){0==this._aniFlag?this._aniFlag=t?1:-1:1!=this._aniFlag||t||(this._aniFlag=-1),this._needRefresh=!0,director.getScheduler().isScheduled(this.refresh,this)||this.scheduleOnce(this.refresh)}refresh(t){this._needRefresh=!1,this.unschedule(this.refresh),(this._pageMode||this._snapToItem)&&(sEndPos.x=-this._xPos,sEndPos.y=-this._yPos,this.alignPosition(sEndPos,!1),this._xPos=-sEndPos.x,this._yPos=-sEndPos.y),this.refresh2(),this._owner.node.emit(FGUIEvent.SCROLL,this._owner),this._needRefresh&&(this._needRefresh=!1,this.unschedule(this.refresh),this.refresh2()),this.updateScrollBarPos(),this._aniFlag=0}refresh2(){var t,e;1!=this._aniFlag||this._dragged?(0!=this._tweening&&this.killTween(),this._container.setPosition(Math.floor(-this._xPos),-Math.floor(-this._yPos)),this.loopCheckingCurrent()):(this._overlapSize.x>0?t=-Math.floor(this._xPos):(0!=this._container.position.x&&this._container.setPosition(0,this._container.position.y),t=0),this._overlapSize.y>0?e=-Math.floor(this._yPos):(0!=this._container.position.y&&this._container.setPosition(this._container.position.x,0),e=0),t!=this._container.position.x||e!=-this._container.position.y?(this._tweenDuration.x=this._tweenDuration.y=TWEEN_TIME_GO,this._tweenStart.x=this._container.position.x,this._tweenStart.y=-this._container.position.y,this._tweenChange.x=t-this._tweenStart.x,this._tweenChange.y=e-this._tweenStart.y,this.startTween(1)):0!=this._tweening&&this.killTween());this._pageMode&&this.updatePageController()}onTouchBegin(t){if(this._touchEffect){t.captureTouch(),0!=this._tweening?(this.killTween(),Decls$1.GRoot.inst.inputProcessor.cancelClick(t.touchId),this._dragged=!0):this._dragged=!1;var e=this._owner.globalToLocal(t.pos.x,t.pos.y,s_vec2$3);this._containerPos.x=this._container.position.x,this._containerPos.y=-this._container.position.y,this._beginTouchPos.set(e),this._lastTouchPos.set(e),this._lastTouchGlobalPos.set(t.pos),this._isHoldAreaDone=!1,this._velocity.set(Vec2.ZERO),this._velocityScale=1,this._lastMoveTime=game.totalTime/1e3}}onTouchMove(t){if(isValid(this._owner.node)&&this._touchEffect&&!(GObject.draggingObject&&GObject.draggingObject.onStage||ScrollPane.draggingPane&&ScrollPane.draggingPane!=this&&ScrollPane.draggingPane._owner.onStage)){var e,i,s,n=this._owner.globalToLocal(t.pos.x,t.pos.y,s_vec2$3),r=UIConfig.touchScrollSensitivity;if(this._scrollType==ScrollType.Vertical){if(!this._isHoldAreaDone){if(_gestureFlag|=1,(e=Math.abs(this._beginTouchPos.y-n.y))<r)return;if(0!=(2&_gestureFlag)&&e<Math.abs(this._beginTouchPos.x-n.x))return}i=!0}else if(this._scrollType==ScrollType.Horizontal){if(!this._isHoldAreaDone){if(_gestureFlag|=2,(e=Math.abs(this._beginTouchPos.x-n.x))<r)return;if(0!=(1&_gestureFlag)&&e<Math.abs(this._beginTouchPos.y-n.y))return}s=!0}else{if(_gestureFlag=3,!this._isHoldAreaDone&&(e=Math.abs(this._beginTouchPos.y-n.y))<r&&(e=Math.abs(this._beginTouchPos.x-n.x))<r)return;i=s=!0}var o=Math.floor(this._containerPos.x+n.x-this._beginTouchPos.x),h=Math.floor(this._containerPos.y+n.y-this._beginTouchPos.y);i&&(h>0?this._bouncebackEffect?this._header&&0!=this._header.maxHeight?this._container.setPosition(this._container.position.x,-Math.floor(Math.min(.5*h,this._header.maxHeight))):this._container.setPosition(this._container.position.x,-Math.floor(Math.min(.5*h,this._viewSize.y*PULL_RATIO))):this._container.setPosition(this._container.position.x,0):h<-this._overlapSize.y?this._bouncebackEffect?this._footer&&this._footer.maxHeight>0?this._container.setPosition(this._container.position.x,-Math.floor(Math.max(.5*(h+this._overlapSize.y),-this._footer.maxHeight)-this._overlapSize.y)):this._container.setPosition(this._container.position.x,-Math.floor(Math.max(.5*(h+this._overlapSize.y),-this._viewSize.y*PULL_RATIO)-this._overlapSize.y)):this._container.setPosition(this._container.position.x,this._overlapSize.y):this._container.setPosition(this._container.position.x,-h)),s&&(o>0?this._bouncebackEffect?this._header&&0!=this._header.maxWidth?this._container.setPosition(Math.floor(Math.min(.5*o,this._header.maxWidth)),this._container.position.y):this._container.setPosition(Math.floor(Math.min(.5*o,this._viewSize.x*PULL_RATIO)),this._container.position.y):this._container.setPosition(0,this._container.position.y):o<0-this._overlapSize.x?this._bouncebackEffect?this._footer&&this._footer.maxWidth>0?this._container.setPosition(Math.floor(Math.max(.5*(o+this._overlapSize.x),-this._footer.maxWidth)-this._overlapSize.x),this._container.position.y):this._container.setPosition(Math.floor(Math.max(.5*(o+this._overlapSize.x),-this._viewSize.x*PULL_RATIO)-this._overlapSize.x),this._container.position.y):this._container.setPosition(-this._overlapSize.x,this._container.position.y):this._container.setPosition(o,this._container.position.y));var a=game.totalTime/1e3,l=Math.max(a-this._lastMoveTime,1/60),_=n.x-this._lastTouchPos.x,d=n.y-this._lastTouchPos.y;if(s||(_=0),i||(d=0),0!=l){var c=60*l-1;if(c>1){var u=Math.pow(.833,c);this._velocity.x=this._velocity.x*u,this._velocity.y=this._velocity.y*u}this._velocity.x=math.lerp(this._velocity.x,60*_/60/l,10*l),this._velocity.y=math.lerp(this._velocity.y,60*d/60/l,10*l)}var g=this._lastTouchGlobalPos.x-t.pos.x,p=this._lastTouchGlobalPos.y-t.pos.y;0!=_?this._velocityScale=Math.abs(g/_):0!=d&&(this._velocityScale=Math.abs(p/d)),this._lastTouchPos.set(n),this._lastTouchGlobalPos.set(t.pos),this._lastMoveTime=a,this._overlapSize.x>0&&(this._xPos=math.clamp(-this._container.position.x,0,this._overlapSize.x)),this._overlapSize.y>0&&(this._yPos=math.clamp(- -this._container.position.y,0,this._overlapSize.y)),0!=this._loop&&(o=this._container.position.x,h=-this._container.position.y,this.loopCheckingCurrent()&&(this._containerPos.x+=this._container.position.x-o,this._containerPos.y+=-this._container.position.y-h)),ScrollPane.draggingPane=this,this._isHoldAreaDone=!0,this._dragged=!0,this.updateScrollBarPos(),this.updateScrollBarVisible(),this._pageMode&&this.updatePageController(),this._owner.node.emit(FGUIEvent.SCROLL)}}onTouchEnd(t){if(ScrollPane.draggingPane==this&&(ScrollPane.draggingPane=null),_gestureFlag=0,this._dragged&&this._touchEffect&&this._owner.node.activeInHierarchy){this._dragged=!1,this._tweenStart.x=this._container.position.x,this._tweenStart.y=-this._container.position.y,sEndPos.set(this._tweenStart);var e=!1;if(this._container.position.x>0?(sEndPos.x=0,e=!0):this._container.position.x<-this._overlapSize.x&&(sEndPos.x=-this._overlapSize.x,e=!0),-this._container.position.y>0?(sEndPos.y=0,e=!0):-this._container.position.y<-this._overlapSize.y&&(sEndPos.y=-this._overlapSize.y,e=!0),e){if(this._tweenChange.x=sEndPos.x-this._tweenStart.x,this._tweenChange.y=sEndPos.y-this._tweenStart.y,this._tweenChange.x<-UIConfig.touchDragSensitivity||this._tweenChange.y<-UIConfig.touchDragSensitivity?(this._refreshEventDispatching=!0,this._owner.node.emit(FGUIEvent.PULL_DOWN_RELEASE),this._owner,this._refreshEventDispatching=!1):(this._tweenChange.x>UIConfig.touchDragSensitivity||this._tweenChange.y>UIConfig.touchDragSensitivity)&&(this._refreshEventDispatching=!0,this._owner.node.emit(FGUIEvent.PULL_UP_RELEASE,this._owner),this._refreshEventDispatching=!1),this._headerLockedSize>0&&0==sEndPos[this._refreshBarAxis])sEndPos[this._refreshBarAxis]=this._headerLockedSize,this._tweenChange.x=sEndPos.x-this._tweenStart.x,this._tweenChange.y=sEndPos.y-this._tweenStart.y;else if(this._footerLockedSize>0&&sEndPos[this._refreshBarAxis]==-this._overlapSize[this._refreshBarAxis]){var i=this._overlapSize[this._refreshBarAxis];0==i?i=Math.max(this._contentSize[this._refreshBarAxis]+this._footerLockedSize-this._viewSize[this._refreshBarAxis],0):i+=this._footerLockedSize,sEndPos[this._refreshBarAxis]=-i,this._tweenChange.x=sEndPos.x-this._tweenStart.x,this._tweenChange.y=sEndPos.y-this._tweenStart.y}this._tweenDuration.x=this._tweenDuration.y=TWEEN_TIME_DEFAULT}else{if(this._inertiaDisabled)this._tweenDuration.x=this._tweenDuration.y=TWEEN_TIME_DEFAULT;else{var s=60*(game.totalTime/1e3-this._lastMoveTime)-1;if(s>1){var n=Math.pow(.833,s);this._velocity.x=this._velocity.x*n,this._velocity.y=this._velocity.y*n}this.updateTargetAndDuration(this._tweenStart,sEndPos)}if(sOldChange.x=sEndPos.x-this._tweenStart.x,sOldChange.y=sEndPos.y-this._tweenStart.y,this.loopCheckingTarget(sEndPos),(this._pageMode||this._snapToItem)&&this.alignPosition(sEndPos,!0),this._tweenChange.x=sEndPos.x-this._tweenStart.x,this._tweenChange.y=sEndPos.y-this._tweenStart.y,0==this._tweenChange.x&&0==this._tweenChange.y)return void this.updateScrollBarVisible();(this._pageMode||this._snapToItem)&&(this.fixDuration("x",sOldChange.x),this.fixDuration("y",sOldChange.y))}this.startTween(2)}else this._dragged=!1}onRollOver(){this._hover=!0,this.updateScrollBarVisible()}onRollOut(){this._hover=!1,this.updateScrollBarVisible()}onMouseWheel(t){if(!this._mouseWheelEnabled)return;let e=t.mouseWheelDelta>0?-1:1;this._overlapSize.x>0&&0==this._overlapSize.y?this._pageMode?this.setPosX(this._xPos+this._pageSize.x*e,!1):this.setPosX(this._xPos+this._mouseWheelStep*e,!1):this._pageMode?this.setPosY(this._yPos+this._pageSize.y*e,!1):this.setPosY(this._yPos+this._mouseWheelStep*e,!1)}updateScrollBarPos(){this._vtScrollBar&&this._vtScrollBar.setScrollPerc(0==this._overlapSize.y?0:math.clamp(this._container.position.y,0,this._overlapSize.y)/this._overlapSize.y),this._hzScrollBar&&this._hzScrollBar.setScrollPerc(0==this._overlapSize.x?0:math.clamp(-this._container.position.x,0,this._overlapSize.x)/this._overlapSize.x),this.checkRefreshBar()}updateScrollBarVisible(){this._vtScrollBar&&(this._viewSize.y<=this._vtScrollBar.minSize||this._vScrollNone?this._vtScrollBar.node.active=!1:this.updateScrollBarVisible2(this._vtScrollBar)),this._hzScrollBar&&(this._viewSize.x<=this._hzScrollBar.minSize||this._hScrollNone?this._hzScrollBar.node.active=!1:this.updateScrollBarVisible2(this._hzScrollBar))}updateScrollBarVisible2(t){this._scrollBarDisplayAuto&&GTween.kill(t,!1,"alpha"),!this._scrollBarDisplayAuto||this._hover||0!=this._tweening||this._dragged||t.gripDragging?(t.alpha=1,t.node.active=!0):t.node.active&&GTween.to(1,0,.5).setDelay(.5).onComplete(this.__barTweenComplete,this).setTarget(t,"alpha")}__barTweenComplete(t){var e=t.target;e.alpha=1,e.node.active=!1}getLoopPartSize(t,e){return(this._contentSize[e]+("x"==e?this._owner.columnGap:this._owner.lineGap))/t}loopCheckingCurrent(){var t=!1;return 1==this._loop&&this._overlapSize.x>0?this._xPos<.001?(this._xPos+=this.getLoopPartSize(2,"x"),t=!0):this._xPos>=this._overlapSize.x&&(this._xPos-=this.getLoopPartSize(2,"x"),t=!0):2==this._loop&&this._overlapSize.y>0&&(this._yPos<.001?(this._yPos+=this.getLoopPartSize(2,"y"),t=!0):this._yPos>=this._overlapSize.y&&(this._yPos-=this.getLoopPartSize(2,"y"),t=!0)),t&&this._container.setPosition(Math.floor(-this._xPos),-Math.floor(-this._yPos)),t}loopCheckingTarget(t){1==this._loop&&this.loopCheckingTarget2(t,"x"),2==this._loop&&this.loopCheckingTarget2(t,"y")}loopCheckingTarget2(t,e){var i,s;t[e]>0?(i=this.getLoopPartSize(2,e),(s=this._tweenStart[e]-i)<=0&&s>=-this._overlapSize[e]&&(t[e]-=i,this._tweenStart[e]=s)):t[e]<-this._overlapSize[e]&&(i=this.getLoopPartSize(2,e),(s=this._tweenStart[e]+i)<=0&&s>=-this._overlapSize[e]&&(t[e]+=i,this._tweenStart[e]=s))}loopCheckingNewPos(t,e){if(0==this._overlapSize[e])return t;var i,s="x"==e?this._xPos:this._yPos,n=!1;return t<.001?(t+=this.getLoopPartSize(2,e))>s&&(i=this.getLoopPartSize(6,e),i=Math.ceil((t-s)/i)*i,s=math.clamp(s+i,0,this._overlapSize[e]),n=!0):t>=this._overlapSize[e]&&(t-=this.getLoopPartSize(2,e))<s&&(i=this.getLoopPartSize(6,e),i=Math.ceil((s-t)/i)*i,s=math.clamp(s-i,0,this._overlapSize[e]),n=!0),n&&("x"==e?this._container.setPosition(-Math.floor(s),this._container.position.y):this._container.setPosition(this._container.position.x,Math.floor(s))),t}alignPosition(t,e){let i=0,s=0;if(1==this._snappingPolicy){if(this._owner.numChildren>0){let t=this._owner.getChildAt(0);i=Math.floor(.5*this._viewSize.x-.5*t.width),s=Math.floor(.5*this._viewSize.y-.5*t.height)}}else if(2==this._snappingPolicy&&this._owner.numChildren>0){let t=this._owner.getChildAt(0);i=Math.floor(this._viewSize.x-t.width),s=Math.floor(this._viewSize.y-t.height)}if(t.x-=i,t.y-=s,this._pageMode)t.x=this.alignByPage(t.x,"x",e),t.y=this.alignByPage(t.y,"y",e);else if(this._snapToItem){var n=this._owner.getSnappingPosition(-t.x,-t.y,s_vec2$3);t.x<0&&t.x>-this._overlapSize.x&&(t.x=-n.x),t.y<0&&t.y>-this._overlapSize.y&&(t.y=-n.y)}t.x+=i,t.y+=s}alignByPage(t,e,i){var s;if(t>0)s=0;else if(t<-this._overlapSize[e])s=Math.ceil(this._contentSize[e]/this._pageSize[e])-1;else{s=Math.floor(-t/this._pageSize[e]);var n=i?t-this._containerPos[e]:t-("x"==e?this._container.position.x:-this._container.position.y),r=Math.min(this._pageSize[e],this._contentSize[e]-(s+1)*this._pageSize[e]),o=-t-s*this._pageSize[e];Math.abs(n)>this._pageSize[e]?o>.5*r&&s++:o>r*(n<0?.3:.7)&&s++,(t=-s*this._pageSize[e])<-this._overlapSize[e]&&(t=-this._overlapSize[e])}if(i){var h,a=this._tweenStart[e];h=a>0?0:a<-this._overlapSize[e]?Math.ceil(this._contentSize[e]/this._pageSize[e])-1:Math.floor(-a/this._pageSize[e]);var l=Math.floor(-this._containerPos[e]/this._pageSize[e]);Math.abs(s-l)>1&&Math.abs(h-l)<=1&&(t=-(s=s>l?l+1:l-1)*this._pageSize[e])}return t}updateTargetAndDuration(t,e){e.x=this.updateTargetAndDuration2(t.x,"x"),e.y=this.updateTargetAndDuration2(t.y,"y")}updateTargetAndDuration2(t,e){var i=this._velocity[e],s=0;if(t>0)t=0;else if(t<-this._overlapSize[e])t=-this._overlapSize[e];else{var n=sys.isMobile,r=Math.abs(i)*this._velocityScale;const h=View.instance.getCanvasSize();n&&(r*=1136/Math.max(h.width,h.height));var o=0;if(this._pageMode||!n?r>500&&(o=Math.pow((r-500)/500,2)):r>1e3&&(o=Math.pow((r-1e3)/1e3,2)),0!=o)o>1&&(o=1),r*=o,i*=o,this._velocity[e]=i,s=Math.log(60/r)/Math.log(this._decelerationRate)/60,t+=Math.floor(i*s*.4)}return s<TWEEN_TIME_DEFAULT&&(s=TWEEN_TIME_DEFAULT),this._tweenDuration[e]=s,t}fixDuration(t,e){if(!(0==this._tweenChange[t]||Math.abs(this._tweenChange[t])>=Math.abs(e))){var i=Math.abs(this._tweenChange[t]/e)*this._tweenDuration[t];i<TWEEN_TIME_DEFAULT&&(i=TWEEN_TIME_DEFAULT),this._tweenDuration[t]=i}}startTween(t){this._tweenTime.set(Vec2.ZERO),this._tweening=t,this.updateScrollBarVisible()}killTween(){1==this._tweening&&(this._container.setPosition(this._tweenStart.x+this._tweenChange.x,-(this._tweenStart.y+this._tweenChange.y)),this._owner.node.emit(FGUIEvent.SCROLL,this._owner)),this._tweening=0,this.updateScrollBarVisible(),this._owner.node.emit(FGUIEvent.SCROLL_END,this._owner)}checkRefreshBar(){if(null!=this._header||null!=this._footer){var t="x"==this._refreshBarAxis?this._container.position.x:-this._container.position.y;if(this._header)if(t>0){this._header.node.active=!0;var e=s_vec2$3;e.x=this._header.width,e.y=this._header.height,e[this._refreshBarAxis]=t,this._header.setSize(e.x,e.y)}else this._header.node.active=!1;if(this._footer){var i=this._overlapSize[this._refreshBarAxis];t<-i||0==i&&this._footerLockedSize>0?(this._footer.node.active=!0,(e=s_vec2$3).x=this._footer.x,e.y=this._footer.y,e[this._refreshBarAxis]=i>0?t+this._contentSize[this._refreshBarAxis]:Math.max(Math.min(t+this._viewSize[this._refreshBarAxis],this._viewSize[this._refreshBarAxis]-this._footerLockedSize),this._viewSize[this._refreshBarAxis]-this._contentSize[this._refreshBarAxis]),this._footer.setPosition(e.x,e.y),e.x=this._footer.width,e.y=this._footer.height,e[this._refreshBarAxis]=i>0?-i-t:this._viewSize[this._refreshBarAxis]-this._footer[this._refreshBarAxis],this._footer.setSize(e.x,e.y)):this._footer.node.active=!1}}}update(t){if(0!=this._tweening){var e=this.runTween("x",t),i=this.runTween("y",t);return this._container.setPosition(e,-i),2==this._tweening&&(this._overlapSize.x>0&&(this._xPos=math.clamp(-e,0,this._overlapSize.x)),this._overlapSize.y>0&&(this._yPos=math.clamp(-i,0,this._overlapSize.y)),this._pageMode&&this.updatePageController()),0==this._tweenChange.x&&0==this._tweenChange.y?(this._tweening=0,this.loopCheckingCurrent(),this.updateScrollBarPos(),this.updateScrollBarVisible(),this._owner.node.emit(FGUIEvent.SCROLL,this._owner),this._owner.node.emit(FGUIEvent.SCROLL_END,this._owner)):(this.updateScrollBarPos(),this._owner.node.emit(FGUIEvent.SCROLL,this._owner)),!0}}runTween(t,e){var i;if(0!=this._tweenChange[t]){if(this._tweenTime[t]+=e,this._tweenTime[t]>=this._tweenDuration[t])i=this._tweenStart[t]+this._tweenChange[t],this._tweenChange[t]=0;else{var s=easeFunc(this._tweenTime[t],this._tweenDuration[t]);i=this._tweenStart[t]+Math.floor(this._tweenChange[t]*s)}var n=0,r=-this._overlapSize[t];if(this._headerLockedSize>0&&this._refreshBarAxis==t&&(n=this._headerLockedSize),this._footerLockedSize>0&&this._refreshBarAxis==t){var o=this._overlapSize[this._refreshBarAxis];0==o?o=Math.max(this._contentSize[this._refreshBarAxis]+this._footerLockedSize-this._viewSize[this._refreshBarAxis],0):o+=this._footerLockedSize,r=-o}2==this._tweening&&this._bouncebackEffect?i>20+n&&this._tweenChange[t]>0||i>n&&0==this._tweenChange[t]?(this._tweenTime[t]=0,this._tweenDuration[t]=TWEEN_TIME_DEFAULT,this._tweenChange[t]=-i+n,this._tweenStart[t]=i):(i<r-20&&this._tweenChange[t]<0||i<r&&0==this._tweenChange[t])&&(this._tweenTime[t]=0,this._tweenDuration[t]=TWEEN_TIME_DEFAULT,this._tweenChange[t]=r-i,this._tweenStart[t]=i):i>n?(i=n,this._tweenChange[t]=0):i<r&&(i=r,this._tweenChange[t]=0)}else i="x"==t?this._container.position.x:-this._container.position.y;return i}}var _gestureFlag=0;const TWEEN_TIME_GO=.5,TWEEN_TIME_DEFAULT=.3,PULL_RATIO=.5;var CurveType,s_vec2$3=new Vec2,s_rect=new Rect$1,sEndPos=new Vec2,sOldChange=new Vec2;function easeFunc(t,e){return(t=t/e-1)*t*t+1}!function(t){t[t.CRSpline=0]="CRSpline",t[t.Bezier=1]="Bezier",t[t.CubicBezier=2]="CubicBezier",t[t.Straight=3]="Straight"}(CurveType||(CurveType={}));class GPathPoint{constructor(){this.x=0,this.y=0,this.control1_x=0,this.control1_y=0,this.control2_x=0,this.control2_y=0,this.curveType=0}static newPoint(t,e,i){var s=new GPathPoint;return s.x=t||0,s.y=e||0,s.control1_x=0,s.control1_y=0,s.control2_x=0,s.control2_y=0,s.curveType=i||CurveType.CRSpline,s}static newBezierPoint(t,e,i,s){var n=new GPathPoint;return n.x=t||0,n.y=e||0,n.control1_x=i||0,n.control1_y=s||0,n.control2_x=0,n.control2_y=0,n.curveType=CurveType.Bezier,n}static newCubicBezierPoint(t,e,i,s,n,r){var o=new GPathPoint;return o.x=t||0,o.y=e||0,o.control1_x=i||0,o.control1_y=s||0,o.control2_x=n||0,o.control2_y=r||0,o.curveType=CurveType.CubicBezier,o}clone(){var t=new GPathPoint;return t.x=this.x,t.y=this.y,t.control1_x=this.control1_x,t.control1_y=this.control1_y,t.control2_x=this.control2_x,t.control2_y=this.control2_y,t.curveType=this.curveType,t}}class GPath{constructor(){this._segments=new Array,this._points=new Array}get length(){return this._fullLength}create2(t,e,i,s){var n=new Array;n.push(t),n.push(e),i&&n.push(i),s&&n.push(s),this.create(n)}create(t){this._segments.length=0,this._points.length=0,this._fullLength=0;var e=t.length;if(0!=e){var i=[],s=t[0];s.curveType==CurveType.CRSpline&&i.push(new Vec2(s.x,s.y));for(var n=1;n<e;n++){var r=t[n];if(s.curveType!=CurveType.CRSpline){var o={};o.type=s.curveType,o.ptStart=this._points.length,s.curveType==CurveType.Straight?(o.ptCount=2,this._points.push(new Vec2(s.x,s.y)),this._points.push(new Vec2(r.x,r.y))):s.curveType==CurveType.Bezier?(o.ptCount=3,this._points.push(new Vec2(s.x,s.y)),this._points.push(new Vec2(r.x,r.y)),this._points.push(new Vec2(s.control1_x,s.control1_y))):s.curveType==CurveType.CubicBezier&&(o.ptCount=4,this._points.push(new Vec2(s.x,s.y)),this._points.push(new Vec2(r.x,r.y)),this._points.push(new Vec2(s.control1_x,s.control1_y)),this._points.push(new Vec2(s.control2_x,s.control2_y))),o.length=distance(s.x,s.y,r.x,r.y),this._fullLength+=o.length,this._segments.push(o)}r.curveType!=CurveType.CRSpline?i.length>0&&(i.push(new Vec2(r.x,r.y)),this.createSplineSegment(i)):i.push(new Vec2(r.x,r.y)),s=r}i.length>1&&this.createSplineSegment(i)}}createSplineSegment(t){var e=t.length;t.splice(0,0,t[0]),t.push(t[e]),t.push(t[e]),e+=3;var i={};i.type=CurveType.CRSpline,i.ptStart=this._points.length,i.ptCount=e,this._points=this._points.concat(t),i.length=0;for(var s=1;s<e;s++)i.length+=distance(t[s-1].x,t[s-1].y,t[s].x,t[s].y);this._fullLength+=i.length,this._segments.push(i),t.length=0}clear(){this._segments.length=0,this._points.length=0}getPointAt(t,e){e?e.set(0,0):e=new Vec2,t=math.clamp01(t);var i,s=this._segments.length;if(0==s)return e;if(1==t)return(i=this._segments[s-1]).type==CurveType.Straight?(e.x=math.lerp(this._points[i.ptStart].x,this._points[i.ptStart+1].x,t),e.y=math.lerp(this._points[i.ptStart].y,this._points[i.ptStart+1].y,t),e):i.type==CurveType.Bezier||i.type==CurveType.CubicBezier?this.onBezierCurve(i.ptStart,i.ptCount,t,e):this.onCRSplineCurve(i.ptStart,i.ptCount,t,e);for(var n=t*this._fullLength,r=0;r<s;r++)if((n-=(i=this._segments[r]).length)<0){t=1+n/i.length,i.type==CurveType.Straight?(e.x=math.lerp(this._points[i.ptStart].x,this._points[i.ptStart+1].x,t),e.y=math.lerp(this._points[i.ptStart].y,this._points[i.ptStart+1].y,t)):e=i.type==CurveType.Bezier||i.type==CurveType.CubicBezier?this.onBezierCurve(i.ptStart,i.ptCount,t,e):this.onCRSplineCurve(i.ptStart,i.ptCount,t,e);break}return e}get segmentCount(){return this._segments.length}getAnchorsInSegment(t,e){null==e&&(e=new Array);for(var i=this._segments[t],s=0;s<i.ptCount;s++)e.push(new Vec2(this._points[i.ptStart+s].x,this._points[i.ptStart+s].y));return e}getPointsInSegment(t,e,i,s,n,r){null==s&&(s=new Array),r&&!isNaN(r)||(r=.1),n&&n.push(e);var o=this._segments[t];if(o.type==CurveType.Straight)s.push(new Vec2(math.lerp(this._points[o.ptStart].x,this._points[o.ptStart+1].x,e),math.lerp(this._points[o.ptStart].y,this._points[o.ptStart+1].y,e))),s.push(new Vec2(math.lerp(this._points[o.ptStart].x,this._points[o.ptStart+1].x,i),math.lerp(this._points[o.ptStart].y,this._points[o.ptStart+1].y,i)));else{var h;h=o.type==CurveType.Bezier||o.type==CurveType.CubicBezier?this.onBezierCurve:this.onCRSplineCurve,s.push(h.call(this,o.ptStart,o.ptCount,e,new Vec2));for(var a=Math.min(o.length*r,50),l=0;l<=a;l++){var _=l/a;_>e&&_<i&&(s.push(h.call(this,o.ptStart,o.ptCount,_,new Vec2)),n&&n.push(_))}s.push(h.call(this,o.ptStart,o.ptCount,i,new Vec2))}return n&&n.push(i),s}getAllPoints(t,e,i){null==t&&(t=new Array),i&&!isNaN(i)||(i=.1);for(var s=this._segments.length,n=0;n<s;n++)this.getPointsInSegment(n,0,1,t,e,i);return t}onCRSplineCurve(t,e,i,s){var n=Math.floor(i*(e-4))+t,r=this._points[n].x,o=this._points[n].y,h=this._points[n+1].x,a=this._points[n+1].y,l=this._points[n+2].x,_=this._points[n+2].y,d=this._points[n+3].x,c=this._points[n+3].y,u=1==i?1:math.repeat(i*(e-4),1),g=((2-u)*u-1)*u*.5,p=.5*((3*u-5)*u*u+2),f=((-3*u+4)*u+1)*u*.5,m=(u-1)*u*u*.5;return s.x=r*g+h*p+l*f+d*m,s.y=o*g+a*p+_*f+c*m,s}onBezierCurve(t,e,i,s){var n=1-i,r=this._points[t].x,o=this._points[t].y,h=this._points[t+1].x,a=this._points[t+1].y,l=this._points[t+2].x,_=this._points[t+2].y;if(4==e){var d=this._points[t+3].x,c=this._points[t+3].y;s.x=n*n*n*r+3*n*n*i*l+3*n*i*i*d+i*i*i*h,s.y=n*n*n*o+3*n*n*i*_+3*n*i*i*c+i*i*i*a}else s.x=n*n*r+2*n*i*l+i*i*h,s.y=n*n*o+2*n*i*_+i*i*a;return s}}function distance(t,e,i,s){return Math.sqrt(Math.pow(t-i,2)+Math.pow(e-s,2))}class Transition{constructor(t){this._ownerBaseX=0,this._ownerBaseY=0,this._totalTimes=0,this._totalTasks=0,this._options=0,this._totalDuration=0,this._autoPlayTimes=1,this._autoPlayDelay=0,this._timeScale=1,this._startTime=0,this._endTime=0,this._owner=t,this._items=new Array}play(t,e,i,s,n){this._play(t,e,i,s,n,!1)}playReverse(t,e,i){this._play(t,e,i,0,-1,!0)}changePlayTimes(t){this._totalTimes=t}setAutoPlay(t,e,i){null==e&&(e=-1),null==i&&(i=0),this._autoPlay!=t&&(this._autoPlay=t,this._autoPlayTimes=e,this._autoPlayDelay=i,this._autoPlay?this._owner.onStage&&this.play(null,this._autoPlayTimes,this._autoPlayDelay):this._owner.onStage||this.stop(!1,!0))}_play(t,e,i,s,n,r){null==e&&(e=1),null==i&&(i=0),null==s&&(s=0),null==n&&(n=-1),this.stop(!0,!0),this._totalTimes=e,this._reversed=r,this._startTime=s,this._endTime=n,this._playing=!0,this._paused=!1,this._onComplete=t;for(var o=this._items.length,h=0;h<o;h++){var a=this._items[h];if(null==a.target?a.targetId?a.target=this._owner.getChildById(a.targetId):a.target=this._owner:a.target!=this._owner&&a.target.parent!=this._owner&&(a.target=null),a.target&&a.type==ActionType.Transition){var l=a.target.getTransition(a.value.transName);if(l==this&&(l=null),l)if(0==a.value.playTimes){var _;for(_=h-1;_>=0;_--){var d=this._items[_];if(d.type==ActionType.Transition&&d.value.trans==l){d.value.stopTime=a.time-d.time;break}}_<0?a.value.stopTime=0:l=null}else a.value.stopTime=-1;a.value.trans=l}}0==i?this.onDelayedPlay():GTween.delayedCall(i).setTarget(this).onComplete(this.onDelayedPlay,this)}stop(t,e){if(null==t&&(t=!0),this._playing){this._playing=!1,this._totalTasks=0,this._totalTimes=0;var i=this._onComplete;this._onComplete=null,GTween.kill(this);var s=this._items.length;if(this._reversed)for(var n=s-1;n>=0;n--){var r=this._items[n];null!=r.target&&this.stopItem(r,t)}else for(n=0;n<s;n++)null!=(r=this._items[n]).target&&this.stopItem(r,t);e&&null!=i&&i()}}stopItem(t,e){if(0!=t.displayLockToken&&(t.target.releaseDisplayLock(t.displayLockToken),t.displayLockToken=0),t.tweener&&(t.tweener.kill(e),t.tweener=null,t.type!=ActionType.Shake||e||(t.target._gearLocked=!0,t.target.setPosition(t.target.x-t.value.lastOffsetX,t.target.y-t.value.lastOffsetY),t.target._gearLocked=!1)),t.type==ActionType.Transition){var i=t.value.trans;i&&i.stop(e,!1)}}setPaused(t){if(this._playing&&this._paused!=t){this._paused=t;var e=GTween.getTween(this);e&&e.setPaused(t);for(var i=this._items.length,s=0;s<i;s++){var n=this._items[s];null!=n.target&&(n.type==ActionType.Transition?n.value.trans&&n.value.trans.setPaused(t):n.type==ActionType.Animation&&(t?(n.value.flag=n.target.getProp(ObjectPropID.Playing),n.target.setProp(ObjectPropID.Playing,!1)):n.target.setProp(ObjectPropID.Playing,n.value.flag)),n.tweener&&n.tweener.setPaused(t))}}}dispose(){this._playing&&GTween.kill(this);for(var t=this._items.length,e=0;e<t;e++){var i=this._items[e];i.tweener&&(i.tweener.kill(),i.tweener=null),i.target=null,i.hook=null,i.tweenConfig&&(i.tweenConfig.endHook=null)}this._items.length=0,this._playing=!1,this._onComplete=null}get playing(){return this._playing}setValue(t,...e){for(var i,s=this._items.length,n=0;n<s;n++){var r=this._items[n];if(r.label==t)i=r.tweenConfig?r.tweenConfig.startValue:r.value;else{if(!r.tweenConfig||r.tweenConfig.endLabel!=t)continue;i=r.tweenConfig.endValue}switch(r.type){case ActionType.XY:case ActionType.Size:case ActionType.Pivot:case ActionType.Scale:case ActionType.Skew:i.b1=!0,i.b2=!0,i.f1=parseFloat(e[0]),i.f2=parseFloat(e[1]);break;case ActionType.Alpha:case ActionType.Rotation:case ActionType.Color:i.f1=parseFloat(e[0]);break;case ActionType.Animation:i.frame=parseInt(e[0]),e.length>1&&(i.playing=e[1]);break;case ActionType.Visible:i.visible=e[0];break;case ActionType.Sound:i.sound=e[0],e.length>1&&(i.volume=parseFloat(e[1]));break;case ActionType.Transition:i.transName=e[0],e.length>1&&(i.playTimes=parseInt(e[1]));break;case ActionType.Shake:i.amplitude=parseFloat(e[0]),e.length>1&&(i.duration=parseFloat(e[1]));break;case ActionType.ColorFilter:i.f1=parseFloat(e[0]),i.f2=parseFloat(e[1]),i.f3=parseFloat(e[2]),i.f4=parseFloat(e[3]);break;case ActionType.Text:case ActionType.Icon:i.text=e[0]}}}setHook(t,e){for(var i=this._items.length,s=0;s<i;s++){var n=this._items[s];if(n.label==t){n.hook=e;break}if(n.tweenConfig&&n.tweenConfig.endLabel==t){n.tweenConfig.endHook=e;break}}}clearHooks(){for(var t=this._items.length,e=0;e<t;e++){var i=this._items[e];i.hook=null,i.tweenConfig&&(i.tweenConfig.endHook=null)}}setTarget(t,e){for(var i=this._items.length,s=0;s<i;s++){var n=this._items[s];n.label==t&&(n.targetId=e.id,n.target=null)}}setDuration(t,e){for(var i=this._items.length,s=0;s<i;s++){var n=this._items[s];n.tweenConfig&&n.label==t&&(n.tweenConfig.duration=e)}}getLabelTime(t){for(var e=this._items.length,i=0;i<e;i++){var s=this._items[i];if(s.label==t)return s.time;if(s.tweenConfig&&s.tweenConfig.endLabel==t)return s.time+s.tweenConfig.duration}return Number.NaN}get timeScale(){return this._timeScale}set timeScale(t){if(this._timeScale!=t&&(this._timeScale=t,this._playing))for(var e=this._items.length,i=0;i<e;i++){var s=this._items[i];s.tweener?s.tweener.setTimeScale(t):s.type==ActionType.Transition?s.value.trans&&(s.value.trans.timeScale=t):s.type==ActionType.Animation&&s.target&&s.target.setProp(ObjectPropID.TimeScale,t)}}updateFromRelations(t,e,i){var s=this._items.length;if(0!=s)for(var n=0;n<s;n++){var r=this._items[n];r.type==ActionType.XY&&r.targetId==t&&(r.tweenConfig?(r.tweenConfig.startValue.f1+=e,r.tweenConfig.startValue.f2+=i,r.tweenConfig.endValue.f1+=e,r.tweenConfig.endValue.f2+=i):(r.value.f1+=e,r.value.f2+=i))}}onEnable(){this._autoPlay&&!this._playing&&this.play(null,this._autoPlayTimes,this._autoPlayDelay)}onDisable(){0==(this._options&OPTION_AUTO_STOP_DISABLED)&&this.stop(0!=(this._options&OPTION_AUTO_STOP_AT_END),!1)}onDelayedPlay(){if(this.internalPlay(),this._playing=this._totalTasks>0,this._playing){if(0!=(this._options&OPTION_IGNORE_DISPLAY_CONTROLLER))for(var t=this._items.length,e=0;e<t;e++){var i=this._items[e];i.target&&i.target!=this._owner&&(i.displayLockToken=i.target.addDisplayLock())}}else if(null!=this._onComplete){var s=this._onComplete;this._onComplete=null,s()}}internalPlay(){this._ownerBaseX=this._owner.x,this._ownerBaseY=this._owner.y,this._totalTasks=1;var t,e,i=this._items.length,s=!1;if(this._reversed)for(e=i-1;e>=0;e--)null!=(t=this._items[e]).target&&this.playItem(t);else for(e=0;e<i;e++)null!=(t=this._items[e]).target&&(t.type==ActionType.Animation&&0!=this._startTime&&t.time<=this._startTime?(s=!0,t.value.flag=!1):this.playItem(t));s&&this.skipAnimations(),this._totalTasks--}playItem(t){var e;if(t.tweenConfig){if(e=this._reversed?this._totalDuration-t.time-t.tweenConfig.duration:t.time,-1==this._endTime||e<=this._endTime){var i,s;switch(this._reversed?(i=t.tweenConfig.endValue,s=t.tweenConfig.startValue):(i=t.tweenConfig.startValue,s=t.tweenConfig.endValue),t.value.b1=i.b1||s.b1,t.value.b2=i.b2||s.b2,t.type){case ActionType.XY:case ActionType.Size:case ActionType.Scale:case ActionType.Skew:t.tweener=GTween.to2(i.f1,i.f2,s.f1,s.f2,t.tweenConfig.duration);break;case ActionType.Alpha:case ActionType.Rotation:t.tweener=GTween.to(i.f1,s.f1,t.tweenConfig.duration);break;case ActionType.Color:t.tweener=GTween.toColor(i.f1,s.f1,t.tweenConfig.duration);break;case ActionType.ColorFilter:t.tweener=GTween.to4(i.f1,i.f2,i.f3,i.f4,s.f1,s.f2,s.f3,s.f4,t.tweenConfig.duration)}t.tweener.setDelay(e).setEase(t.tweenConfig.easeType).setRepeat(t.tweenConfig.repeat,t.tweenConfig.yoyo).setTimeScale(this._timeScale).setTarget(t).onStart(this.onTweenStart,this).onUpdate(this.onTweenUpdate,this).onComplete(this.onTweenComplete,this),this._endTime>=0&&t.tweener.setBreakpoint(this._endTime-e),this._totalTasks++}}else t.type==ActionType.Shake?(e=this._reversed?this._totalDuration-t.time-t.value.duration:t.time,t.value.offsetX=t.value.offsetY=0,t.value.lastOffsetX=t.value.lastOffsetY=0,t.tweener=GTween.shake(0,0,t.value.amplitude,t.value.duration).setDelay(e).setTimeScale(this._timeScale).setTarget(t).onUpdate(this.onTweenUpdate,this).onComplete(this.onTweenComplete,this),this._endTime>=0&&t.tweener.setBreakpoint(this._endTime-t.time),this._totalTasks++):(e=this._reversed?this._totalDuration-t.time:t.time)<=this._startTime?(this.applyValue(t),this.callHook(t,!1)):(-1==this._endTime||e<=this._endTime)&&(this._totalTasks++,t.tweener=GTween.delayedCall(e).setTimeScale(this._timeScale).setTarget(t).onComplete(this.onDelayedPlayItem,this));t.tweener&&t.tweener.seek(this._startTime)}skipAnimations(){for(var t,e,i,s,n,r,o=this._items.length,h=0;h<o;h++)if(!((r=this._items[h]).type!=ActionType.Animation||r.time>this._startTime||(s=r.value).flag)){t=(n=r.target).getProp(ObjectPropID.Frame),e=n.getProp(ObjectPropID.Playing)?0:-1,i=0;for(var a=h;a<o;a++)(r=this._items[a]).type!=ActionType.Animation||r.target!=n||r.time>this._startTime||((s=r.value).flag=!0,-1!=s.frame?(t=s.frame,e=s.playing?r.time:-1,i=0):s.playing?e<0&&(e=r.time):(e>=0&&(i+=r.time-e),e=-1),this.callHook(r,!1));e>=0&&(i+=this._startTime-e),n.setProp(ObjectPropID.Playing,e>=0),n.setProp(ObjectPropID.Frame,t),i>0&&n.setProp(ObjectPropID.DeltaTime,i)}}onDelayedPlayItem(t){var e=t.target;e.tweener=null,this._totalTasks--,this.applyValue(e),this.callHook(e,!1),this.checkAllComplete()}onTweenStart(t){var e,i,s=t.target;s.type!=ActionType.XY&&s.type!=ActionType.Size||(this._reversed?(e=s.tweenConfig.endValue,i=s.tweenConfig.startValue):(e=s.tweenConfig.startValue,i=s.tweenConfig.endValue),s.type==ActionType.XY?s.target!=this._owner?(e.b1?e.b3&&(t.startValue.x=e.f1*this._owner.width):t.startValue.x=s.target.x,e.b2?e.b3&&(t.startValue.y=e.f2*this._owner.height):t.startValue.y=s.target.y,i.b1?i.b3&&(t.endValue.x=i.f1*this._owner.width):t.endValue.x=t.startValue.x,i.b2?i.b3&&(t.endValue.y=i.f2*this._owner.height):t.endValue.y=t.startValue.y):(e.b1||(t.startValue.x=s.target.x-this._ownerBaseX),e.b2||(t.startValue.y=s.target.y-this._ownerBaseY),i.b1||(t.endValue.x=t.startValue.x),i.b2||(t.endValue.y=t.startValue.y)):(e.b1||(t.startValue.x=s.target.width),e.b2||(t.startValue.y=s.target.height),i.b1||(t.endValue.x=t.startValue.x),i.b2||(t.endValue.y=t.startValue.y)),s.tweenConfig.path&&(s.value.b1=s.value.b2=!0,t.setPath(s.tweenConfig.path)));this.callHook(s,!1)}onTweenUpdate(t){var e=t.target;switch(e.type){case ActionType.XY:case ActionType.Size:case ActionType.Scale:case ActionType.Skew:e.value.f1=t.value.x,e.value.f2=t.value.y,e.tweenConfig.path&&(e.value.f1+=t.startValue.x,e.value.f2+=t.startValue.y);break;case ActionType.Alpha:case ActionType.Rotation:e.value.f1=t.value.x;break;case ActionType.Color:e.value.f1=t.value.color;break;case ActionType.ColorFilter:e.value.f1=t.value.x,e.value.f2=t.value.y,e.value.f3=t.value.z,e.value.f4=t.value.w;break;case ActionType.Shake:e.value.offsetX=t.deltaValue.x,e.value.offsetY=t.deltaValue.y}this.applyValue(e)}onTweenComplete(t){var e=t.target;e.tweener=null,this._totalTasks--,t.allCompleted&&this.callHook(e,!0),this.checkAllComplete()}onPlayTransCompleted(t){this._totalTasks--,this.checkAllComplete()}callHook(t,e){e?t.tweenConfig&&null!=t.tweenConfig.endHook&&t.tweenConfig.endHook(t.label):t.time>=this._startTime&&null!=t.hook&&t.hook(t.label)}checkAllComplete(){if(this._playing&&0==this._totalTasks)if(this._totalTimes<0)this.internalPlay(),0==this._totalTasks&&GTween.delayedCall(0).setTarget(this).onComplete(this.checkAllComplete,this);else if(this._totalTimes--,this._totalTimes>0)this.internalPlay(),0==this._totalTasks&&GTween.delayedCall(0).setTarget(this).onComplete(this.checkAllComplete,this);else{this._playing=!1;for(var t=this._items.length,e=0;e<t;e++){var i=this._items[e];i.target&&0!=i.displayLockToken&&(i.target.releaseDisplayLock(i.displayLockToken),i.displayLockToken=0)}if(null!=this._onComplete){var s=this._onComplete;this._onComplete=null,s()}}}applyValue(t){t.target._gearLocked=!0;var e=t.value;switch(t.type){case ActionType.XY:t.target==this._owner?e.b1&&e.b2?t.target.setPosition(e.f1+this._ownerBaseX,e.f2+this._ownerBaseY):e.b1?t.target.x=e.f1+this._ownerBaseX:t.target.y=e.f2+this._ownerBaseY:e.b3?e.b1&&e.b2?t.target.setPosition(e.f1*this._owner.width,e.f2*this._owner.height):e.b1?t.target.x=e.f1*this._owner.width:e.b2&&(t.target.y=e.f2*this._owner.height):e.b1&&e.b2?t.target.setPosition(e.f1,e.f2):e.b1?t.target.x=e.f1:e.b2&&(t.target.y=e.f2);break;case ActionType.Size:e.b1||(e.f1=t.target.width),e.b2||(e.f2=t.target.height),t.target.setSize(e.f1,e.f2);break;case ActionType.Pivot:t.target.setPivot(e.f1,e.f2,t.target.pivotAsAnchor);break;case ActionType.Alpha:t.target.alpha=e.f1;break;case ActionType.Rotation:t.target.rotation=e.f1;break;case ActionType.Scale:t.target.setScale(e.f1,e.f2);break;case ActionType.Skew:break;case ActionType.Color:let o=t.target.getProp(ObjectPropID.Color);if(o instanceof Color){let i=Math.floor(e.f1);o.r=i>>16&255,o.g=i>>8&255,o.b=255&i,t.target.setProp(ObjectPropID.Color,o)}break;case ActionType.Animation:e.frame>=0&&t.target.setProp(ObjectPropID.Frame,e.frame),t.target.setProp(ObjectPropID.Playing,e.playing),t.target.setProp(ObjectPropID.TimeScale,this._timeScale);break;case ActionType.Visible:t.target.visible=e.visible;break;case ActionType.Transition:if(this._playing){var i=e.trans;if(i){this._totalTasks++;var s=this._startTime>t.time?this._startTime-t.time:0,n=this._endTime>=0?this._endTime-t.time:-1;e.stopTime>=0&&(n<0||n>e.stopTime)&&(n=e.stopTime),i.timeScale=this._timeScale;let r=this;i._play(()=>{r.onPlayTransCompleted(t)},e.playTimes,0,s,n,this._reversed)}}break;case ActionType.Sound:if(this._playing&&t.time>=this._startTime){if(null==e.audioClip){var r=UIPackage.getItemByURL(e.sound);r&&(e.audioClip=r.owner.getItemAsset(r))}e.audioClip&&Decls$1.GRoot.inst.playOneShotSound(e.audioClip,e.volume)}break;case ActionType.Shake:t.target.setPosition(t.target.x-e.lastOffsetX+e.offsetX,t.target.y-e.lastOffsetY+e.offsetY),e.lastOffsetX=e.offsetX,e.lastOffsetY=e.offsetY;break;case ActionType.ColorFilter:break;case ActionType.Text:t.target.text=e.text;break;case ActionType.Icon:t.target.icon=e.text}t.target._gearLocked=!1}setup(t){this.name=t.readS(),this._options=t.readInt(),this._autoPlay=t.readBool(),this._autoPlayTimes=t.readInt(),this._autoPlayDelay=t.readFloat();for(var e=t.readShort(),i=0;i<e;i++){var s=t.readShort(),n=t.position;t.seek(n,0);var r=new Item(t.readByte());this._items[i]=r,r.time=t.readFloat();var o=t.readShort();if(r.targetId=o<0?"":this._owner.getChildAt(o).id,r.label=t.readS(),t.readBool()){if(t.seek(n,1),r.tweenConfig=new TweenConfig,r.tweenConfig.duration=t.readFloat(),r.time+r.tweenConfig.duration>this._totalDuration&&(this._totalDuration=r.time+r.tweenConfig.duration),r.tweenConfig.easeType=t.readByte(),r.tweenConfig.repeat=t.readInt(),r.tweenConfig.yoyo=t.readBool(),r.tweenConfig.endLabel=t.readS(),t.seek(n,2),this.decodeValue(r,t,r.tweenConfig.startValue),t.seek(n,3),this.decodeValue(r,t,r.tweenConfig.endValue),t.version>=2){var h=t.readInt();if(h>0){r.tweenConfig.path=new GPath;for(var a=new Array,l=0;l<h;l++){var _=t.readByte();switch(_){case CurveType.Bezier:a.push(GPathPoint.newBezierPoint(t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat()));break;case CurveType.CubicBezier:a.push(GPathPoint.newCubicBezierPoint(t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat()));break;default:a.push(GPathPoint.newPoint(t.readFloat(),t.readFloat(),_))}}r.tweenConfig.path.create(a)}}}else r.time>this._totalDuration&&(this._totalDuration=r.time),t.seek(n,2),this.decodeValue(r,t,r.value);t.position=n+s}}decodeValue(t,e,i){switch(t.type){case ActionType.XY:case ActionType.Size:case ActionType.Pivot:case ActionType.Skew:i.b1=e.readBool(),i.b2=e.readBool(),i.f1=e.readFloat(),i.f2=e.readFloat(),e.version>=2&&t.type==ActionType.XY&&(i.b3=e.readBool());break;case ActionType.Alpha:case ActionType.Rotation:i.f1=e.readFloat();break;case ActionType.Scale:i.f1=e.readFloat(),i.f2=e.readFloat();break;case ActionType.Color:let s=e.readColor();i.f1=(s.r<<16)+(s.g<<8)+s.b;break;case ActionType.Animation:i.playing=e.readBool(),i.frame=e.readInt();break;case ActionType.Visible:i.visible=e.readBool();break;case ActionType.Sound:i.sound=e.readS(),i.volume=e.readFloat();break;case ActionType.Transition:i.transName=e.readS(),i.playTimes=e.readInt();break;case ActionType.Shake:i.amplitude=e.readFloat(),i.duration=e.readFloat();break;case ActionType.ColorFilter:i.f1=e.readFloat(),i.f2=e.readFloat(),i.f3=e.readFloat(),i.f4=e.readFloat();break;case ActionType.Text:case ActionType.Icon:i.text=e.readS()}}}const OPTION_IGNORE_DISPLAY_CONTROLLER=1,OPTION_AUTO_STOP_DISABLED=2,OPTION_AUTO_STOP_AT_END=4;var ActionType;!function(t){t[t.XY=0]="XY",t[t.Size=1]="Size",t[t.Scale=2]="Scale",t[t.Pivot=3]="Pivot",t[t.Alpha=4]="Alpha",t[t.Rotation=5]="Rotation",t[t.Color=6]="Color",t[t.Animation=7]="Animation",t[t.Visible=8]="Visible",t[t.Sound=9]="Sound",t[t.Transition=10]="Transition",t[t.Shake=11]="Shake",t[t.ColorFilter=12]="ColorFilter",t[t.Skew=13]="Skew",t[t.Text=14]="Text",t[t.Icon=15]="Icon",t[t.Unknown=16]="Unknown"}(ActionType||(ActionType={}));class Item{constructor(t){this.type=t,this.value={},this.displayLockToken=0}}class TweenConfig{constructor(){this.easeType=EaseType.QuadOut,this.startValue={b1:!0,b2:!0},this.endValue={b1:!0,b2:!0}}}class GComponent extends GObject{constructor(){super(),this._sortingChildCount=0,this._childrenRenderOrder=ChildrenRenderOrder.Ascent,this._apexIndex=0,this._node.name="GComponent",this._children=new Array,this._controllers=new Array,this._transitions=new Array,this._margin=new Margin,this._alignOffset=new Vec2,this._container=new Node("Container"),this._container.layer=UIConfig.defaultUILayer,this._container.addComponent(UITransform).setAnchorPoint(0,1),this._node.addChild(this._container)}dispose(){var t,e;for(e=this._transitions.length,t=0;t<e;++t){this._transitions[t].dispose()}for(e=this._controllers.length,t=0;t<e;++t){this._controllers[t].dispose()}for(this._scrollPane&&this._scrollPane.destroy(),t=(e=this._children.length)-1;t>=0;--t){var i=this._children[t];i._parent=null,i.dispose()}this._boundsChanged=!1,super.dispose()}get displayListContainer(){return this._container}addChild(t){return this.addChildAt(t,this._children.length),t}addChildAt(t,e){if(!t)throw"child is null";var i=this._children.length;if(e>=0&&e<=i){if(t.parent==this)this.setChildIndex(t,e);else{t.removeFromParent(),t._parent=this;var s=this._children.length;0!=t.sortingOrder?(this._sortingChildCount++,e=this.getInsertPosForSortingChild(t)):this._sortingChildCount>0&&e>s-this._sortingChildCount&&(e=s-this._sortingChildCount),e==s?this._children.push(t):this._children.splice(e,0,t),this.onChildAdd(t,e),this.setBoundsChangedFlag()}return t}throw"Invalid child index"}getInsertPosForSortingChild(t){var e=this._children.length,i=0;for(i=0;i<e;i++){var s=this._children[i];if(s!=t&&t.sortingOrder<s.sortingOrder)break}return i}removeChild(t,e){var i=this._children.indexOf(t);return-1!=i&&this.removeChildAt(i,e),t}removeChildAt(t,e){if(t>=0&&t<this.numChildren){var i=this._children[t];return i._parent=null,0!=i.sortingOrder&&this._sortingChildCount--,this._children.splice(t,1),i.group=null,this._container.removeChild(i.node),this._childrenRenderOrder==ChildrenRenderOrder.Arch&&this._partner.callLater(this.buildNativeDisplayList),e?i.dispose():i.node.parent=null,this.setBoundsChangedFlag(),i}throw"Invalid child index"}removeChildren(t,e,i){null==t&&(t=0),null==e&&(e=-1),(e<0||e>=this.numChildren)&&(e=this.numChildren-1);for(var s=t;s<=e;++s)this.removeChildAt(t,i)}getChildAt(t,e){if(t>=0&&t<this.numChildren)return this._children[t];throw"Invalid child index"}getChild(t,e){for(var i=this._children.length,s=0;s<i;++s)if(this._children[s].name==t)return this._children[s];return null}getChildByPath(t,e){for(var i,s=t.split("."),n=s.length,r=this,o=0;o<n&&(i=r.getChild(s[o]));++o)if(o!=n-1){if(!(i instanceof GComponent)){i=null;break}r=i}return i}getVisibleChild(t){for(var e=this._children.length,i=0;i<e;++i){var s=this._children[i];if(s._finalVisible&&s.name==t)return s}return null}getChildInGroup(t,e){for(var i=this._children.length,s=0;s<i;++s){var n=this._children[s];if(n.group==e&&n.name==t)return n}return null}getChildById(t){for(var e=this._children.length,i=0;i<e;++i)if(this._children[i]._id==t)return this._children[i];return null}getChildIndex(t){return this._children.indexOf(t)}setChildIndex(t,e){var i=this._children.indexOf(t);if(-1==i)throw"Not a child of this container";if(0==t.sortingOrder){var s=this._children.length;this._sortingChildCount>0&&e>s-this._sortingChildCount-1&&(e=s-this._sortingChildCount-1),this._setChildIndex(t,i,e)}}setChildIndexBefore(t,e){var i=this._children.indexOf(t);if(-1==i)throw"Not a child of this container";if(0!=t.sortingOrder)return i;var s=this._children.length;return this._sortingChildCount>0&&e>s-this._sortingChildCount-1&&(e=s-this._sortingChildCount-1),i<e?this._setChildIndex(t,i,e-1):this._setChildIndex(t,i,e)}_setChildIndex(t,e,i){var s=this._children.length;return i>s&&(i=s),e==i?e:(this._children.splice(e,1),this._children.splice(i,0,t),this._childrenRenderOrder==ChildrenRenderOrder.Ascent?t.node.setSiblingIndex(i):this._childrenRenderOrder==ChildrenRenderOrder.Descent?t.node.setSiblingIndex(s-i):this._partner.callLater(this.buildNativeDisplayList),this.setBoundsChangedFlag(),i)}swapChildren(t,e){var i=this._children.indexOf(t),s=this._children.indexOf(e);if(-1==i||-1==s)throw"Not a child of this container";this.swapChildrenAt(i,s)}swapChildrenAt(t,e){var i=this._children[t],s=this._children[e];this.setChildIndex(i,e),this.setChildIndex(s,t)}get numChildren(){return this._children.length}isAncestorOf(t){if(null==t)return!1;for(var e=t.parent;e;){if(e==this)return!0;e=e.parent}return!1}addController(t){this._controllers.push(t),t.parent=this,this.applyController(t)}getControllerAt(t){return this._controllers[t]}getController(t){for(var e=this._controllers.length,i=0;i<e;++i){var s=this._controllers[i];if(s.name==t)return s}return null}removeController(t){var e=this._controllers.indexOf(t);if(-1==e)throw"controller not exists";t.parent=null,this._controllers.splice(e,1);for(var i=this._children.length,s=0;s<i;s++){this._children[s].handleControllerChanged(t)}}get controllers(){return this._controllers}onChildAdd(t,e){if(t.node.parent=this._container,t.node.active=t._finalVisible,this._buildingDisplayList)return;let i=this._children.length;this._childrenRenderOrder==ChildrenRenderOrder.Ascent?t.node.setSiblingIndex(e):this._childrenRenderOrder==ChildrenRenderOrder.Descent?t.node.setSiblingIndex(i-e):this._partner.callLater(this.buildNativeDisplayList)}buildNativeDisplayList(t){if(!isNaN(t)){return void GObject.cast(this.node).buildNativeDisplayList()}let e,i=this._children.length;if(0!=i)switch(this._childrenRenderOrder){case ChildrenRenderOrder.Ascent:{let t=0;for(let s=0;s<i;s++)e=this._children[s],e.node.setSiblingIndex(t++)}break;case ChildrenRenderOrder.Descent:{let t=0;for(let s=i-1;s>=0;s--)e=this._children[s],e.node.setSiblingIndex(t++)}break;case ChildrenRenderOrder.Arch:{let t=0;for(let i=0;i<this._apexIndex;i++)e=this._children[i],e.node.setSiblingIndex(t++);for(let s=i-1;s>=this._apexIndex;s--)e=this._children[s],e.node.setSiblingIndex(t++)}}}applyController(t){this._applyingController=t;for(var e=this._children.length,i=0;i<e;i++)this._children[i].handleControllerChanged(t);this._applyingController=null,t.runActions()}applyAllControllers(){for(var t=this._controllers.length,e=0;e<t;++e)this.applyController(this._controllers[e])}adjustRadioGroupDepth(t,e){var i,s,n=this._children.length,r=-1,o=-1;for(i=0;i<n;i++)(s=this._children[i])==t?r=i:"relatedController"in s&&s.relatedController==e&&i>o&&(o=i);r<o&&(this._applyingController&&this._children[o].handleControllerChanged(this._applyingController),this.swapChildrenAt(r,o))}getTransitionAt(t){return this._transitions[t]}getTransition(t){for(var e=this._transitions.length,i=0;i<e;++i){var s=this._transitions[i];if(s.name==t)return s}return null}isChildInView(t){return this._rectMask?t.x+t.width>=0&&t.x<=this.width&&t.y+t.height>=0&&t.y<=this.height:!this._scrollPane||this._scrollPane.isChildInView(t)}getFirstChildInView(){for(var t=this._children.length,e=0;e<t;++e){var i=this._children[e];if(this.isChildInView(i))return e}return-1}get scrollPane(){return this._scrollPane}get opaque(){return this._opaque}set opaque(t){this._opaque=t}get margin(){return this._margin}set margin(t){this._margin.copy(t),this.handleSizeChanged()}get childrenRenderOrder(){return this._childrenRenderOrder}set childrenRenderOrder(t){this._childrenRenderOrder!=t&&(this._childrenRenderOrder=t,this.buildNativeDisplayList())}get apexIndex(){return this._apexIndex}set apexIndex(t){this._apexIndex!=t&&(this._apexIndex=t,this._childrenRenderOrder==ChildrenRenderOrder.Arch&&this.buildNativeDisplayList())}get mask(){return this._maskContent}set mask(t){this.setMask(t,!1)}setMask(t,e){if(this._maskContent&&(this._maskContent.node.off(Node.EventType.TRANSFORM_CHANGED,this.onMaskContentChanged,this),this._maskContent.node.off(Node.EventType.SIZE_CHANGED,this.onMaskContentChanged,this),this._maskContent.node.off(Node.EventType.ANCHOR_CHANGED,this.onMaskContentChanged,this),this._maskContent.visible=!0),this._maskContent=t,this._maskContent){if(!(t instanceof GImage||t instanceof GGraph))return;if(!this._customMask){let t=new Node("Mask");t.layer=UIConfig.defaultUILayer,t.addComponent(UITransform),t.parent=this._node,this._scrollPane?this._container.parent.parent=t:this._container.parent=t,this._customMask=t.addComponent(Mask)}t.visible=!1,t.node.on(Node.EventType.TRANSFORM_CHANGED,this.onMaskContentChanged,this),t.node.on(Node.EventType.SIZE_CHANGED,this.onMaskContentChanged,this),t.node.on(Node.EventType.ANCHOR_CHANGED,this.onMaskContentChanged,this),this._customMask.inverted=e,this._node.activeInHierarchy?this.onMaskReady():this.on(FGUIEvent.DISPLAY,this.onMaskReady,this),this.onMaskContentChanged(),this._scrollPane?this._scrollPane.adjustMaskContainer():this._container.setPosition(0,0)}else this._customMask&&(this._scrollPane?this._container.parent.parent=this._node:this._container.parent=this._node,this._customMask.node.destroy(),this._customMask=null,this._scrollPane?this._scrollPane.adjustMaskContainer():this._container.setPosition(this._pivotCorrectX,this._pivotCorrectY))}onMaskReady(){this.off(FGUIEvent.DISPLAY,this.onMaskReady,this),this._maskContent instanceof GImage?(this._customMask.type=Mask.Type.SPRITE_STENCIL,this._customMask.alphaThreshold=1e-4,this._customMask.spriteFrame=this._maskContent._content.spriteFrame):this._maskContent instanceof GGraph&&(2==this._maskContent.type?this._customMask.type=Mask.Type.GRAPHICS_ELLIPSE:this._customMask.type=Mask.Type.GRAPHICS_RECT)}onMaskContentChanged(){let t=this._customMask.node,e=t.getComponent(UITransform),i=this._maskContent.node,s=this._maskContent._uiTrans,n=this._maskContent.width*this._maskContent.scaleX,r=this._maskContent.height*this._maskContent.scaleY;e.setContentSize(n,r);let o=i.position.x-s.anchorX*n,h=i.position.y-s.anchorY*r;e.setAnchorPoint(-o/e.width,-h/e.height),t.setPosition(this._pivotCorrectX,this._pivotCorrectY)}get _pivotCorrectX(){return-this.pivotX*this._width+this._margin.left}get _pivotCorrectY(){return this.pivotY*this._height-this._margin.top}get baseUserData(){var t=this.packageItem.rawData;return t.seek(0,4),t.readS()}setupScroll(t){this._scrollPane=this._node.addComponent(ScrollPane),this._scrollPane.setup(t)}setupOverflow(t){t==OverflowType.Hidden&&(this._rectMask=this._container.addComponent(Mask)),this._margin.isNone||this.handleSizeChanged()}handleAnchorChanged(){super.handleAnchorChanged(),this._customMask?this._customMask.node.setPosition(this._pivotCorrectX,this._pivotCorrectY):this._scrollPane?this._scrollPane.adjustMaskContainer():this._container.setPosition(this._pivotCorrectX+this._alignOffset.x,this._pivotCorrectY-this._alignOffset.y)}handleSizeChanged(){super.handleSizeChanged(),this._customMask?this._customMask.node.setPosition(this._pivotCorrectX,this._pivotCorrectY):this._scrollPane||this._container.setPosition(this._pivotCorrectX,this._pivotCorrectY),this._scrollPane?this._scrollPane.onOwnerSizeChanged():this._container._uiProps.uiTransformComp.setContentSize(this.viewWidth,this.viewHeight)}handleGrayedChanged(){var t=this.getController("grayed");if(t)t.selectedIndex=this.grayed?1:0;else for(var e=this.grayed,i=this._children.length,s=0;s<i;++s)this._children[s].grayed=e}handleControllerChanged(t){super.handleControllerChanged(t),this._scrollPane&&this._scrollPane.handleControllerChanged(t)}_hitTest(t,e){if(this._customMask){if(s_vec2$2.set(e),s_vec2$2.y=UIContentScaler.rootSize.height-e.y,!(this._customMask.isHit(s_vec2$2)||!1))return null}if(this.hitArea){if(!this.hitArea.hitTest(t,e))return null}else if(this._rectMask){s_vec2$2.set(t),s_vec2$2.x+=this._container.position.x,s_vec2$2.y+=this._container.position.y;let e=this._container._uiProps.uiTransformComp.contentSize;if(s_vec2$2.x<0||s_vec2$2.y<0||s_vec2$2.x>=e.width||s_vec2$2.y>=e.height)return null}if(this._scrollPane){let i=this._scrollPane.hitTest(t,e);if(!i)return null;if(i!=this)return i}let i=null;for(let t=this._children.length-1;t>=0;t--){let s=this._children[t];if(this._maskContent!=s&&!s._touchDisabled&&(i=s.hitTest(e),i))break}return!i&&this._opaque&&(this.hitArea||t.x>=0&&t.y>=0&&t.x<this._width&&t.y<this._height)&&(i=this),i}setBoundsChangedFlag(){(this._scrollPane||this._trackBounds)&&(this._boundsChanged||(this._boundsChanged=!0,this._partner.callLater(this.refresh)))}refresh(t){if(isNaN(t)){if(this._boundsChanged){var e=this._children.length;if(e>0)for(var i=0;i<e;i++){this._children[i].ensureSizeCorrect()}this.updateBounds()}}else{GObject.cast(this.node).refresh()}}ensureBoundsCorrect(){var t=this._children.length;if(t>0)for(var e=0;e<t;e++){this._children[e].ensureSizeCorrect()}this._boundsChanged&&this.updateBounds()}updateBounds(){var t=0,e=0,i=0,s=0,n=this._children.length;if(n>0){t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY;var r=Number.NEGATIVE_INFINITY,o=Number.NEGATIVE_INFINITY,h=0,a=0;for(a=0;a<n;a++){var l=this._children[a];(h=l.x)<t&&(t=h),(h=l.y)<e&&(e=h),(h=l.x+l.actualWidth)>r&&(r=h),(h=l.y+l.actualHeight)>o&&(o=h)}i=r-t,s=o-e}this.setBounds(t,e,i,s)}setBounds(t,e,i,s=0){this._boundsChanged=!1,this._scrollPane&&this._scrollPane.setContentSize(Math.round(t+i),Math.round(e+s))}get viewWidth(){return this._scrollPane?this._scrollPane.viewWidth:this.width-this._margin.left-this._margin.right}set viewWidth(t){this._scrollPane?this._scrollPane.viewWidth=t:this.width=t+this._margin.left+this._margin.right}get viewHeight(){return this._scrollPane?this._scrollPane.viewHeight:this.height-this._margin.top-this._margin.bottom}set viewHeight(t){this._scrollPane?this._scrollPane.viewHeight=t:this.height=t+this._margin.top+this._margin.bottom}getSnappingPosition(t,e,i){i||(i=new Vec2);var s=this._children.length;if(0==s)return i.x=0,i.y=0,i;this.ensureBoundsCorrect();var n=null,r=null,o=0;if(0!=e){for(;o<s;o++)if(e<(n=this._children[o]).y){if(0==o){e=0;break}e=e<(r=this._children[o-1]).y+r.actualHeight/2?r.y:n.y;break}o==s&&(e=n.y)}if(0!=t){for(o>0&&o--;o<s;o++)if(t<(n=this._children[o]).x){if(0==o){t=0;break}t=t<(r=this._children[o-1]).x+r.actualWidth/2?r.x:n.x;break}o==s&&(t=n.x)}return i.x=t,i.y=e,i}childSortingOrderChanged(t,e,i=0){if(0==i)this._sortingChildCount--,this.setChildIndex(t,this._children.length);else{0==e&&this._sortingChildCount++;var s=this._children.indexOf(t),n=this.getInsertPosForSortingChild(t);s<n?this._setChildIndex(t,s,n-1):this._setChildIndex(t,s,n)}}constructFromResource(){this.constructFromResource2(null,0)}constructFromResource2(t,e){var i,s,n,r,o,h,a,l,_=this.packageItem.getBranch();_.decoded||(_.decoded=!0,TranslationHelper.translateComponent(_));var d=_.rawData;d.seek(0,0),this._underConstruct=!0,this.sourceWidth=d.readInt(),this.sourceHeight=d.readInt(),this.initWidth=this.sourceWidth,this.initHeight=this.sourceHeight,this.setSize(this.sourceWidth,this.sourceHeight),d.readBool()&&(this.minWidth=d.readInt(),this.maxWidth=d.readInt(),this.minHeight=d.readInt(),this.maxHeight=d.readInt()),d.readBool()&&(o=d.readFloat(),h=d.readFloat(),this.setPivot(o,h,d.readBool())),d.readBool()&&(this._margin.top=d.readInt(),this._margin.bottom=d.readInt(),this._margin.left=d.readInt(),this._margin.right=d.readInt());var c=d.readByte();if(c==OverflowType.Scroll){var u=d.position;d.seek(0,7),this.setupScroll(d),d.position=u}else this.setupOverflow(c);d.readBool()&&d.skip(8),this._buildingDisplayList=!0,d.seek(0,1);var g,p=d.readShort();for(i=0;i<p;i++){r=d.readShort(),r+=d.position;var f=new Controller;this._controllers.push(f),f.parent=this,f.setup(d),d.position=r}d.seek(0,2);var m=d.readShort();for(i=0;i<m;i++){if(s=d.readShort(),n=d.position,t)g=t[e+i];else{d.seek(n,0);var y,w=d.readByte(),C=d.readS(),v=d.readS(),S=null;if(null!=C)S=(y=null!=v?UIPackage.getById(v):_.owner)?y.getItemById(C):null;S?(g=Decls.UIObjectFactory.newObject(S)).constructFromResource():g=Decls.UIObjectFactory.newObject(w)}g._underConstruct=!0,g.setup_beforeAdd(d,n),g._parent=this,g.node.parent=this._container,this._children.push(g),d.position=n+s}for(d.seek(0,3),this.relations.setup(d,!0),d.seek(0,2),d.skip(2),i=0;i<m;i++)r=d.readShort(),r+=d.position,d.seek(d.position,3),this._children[i].relations.setup(d,!1),d.position=r;for(d.seek(0,2),d.skip(2),i=0;i<m;i++)r=d.readShort(),r+=d.position,(g=this._children[i]).setup_afterAdd(d,d.position),g._underConstruct=!1,d.position=r;d.seek(0,4),d.skip(2),this.opaque=d.readBool();var I=d.readShort();-1!=I&&this.setMask(this.getChildAt(I),d.readBool());var b=d.readS();a=d.readInt(),l=d.readInt(),null!=b?(S=_.owner.getItemById(b))&&S.hitTestData&&(this.hitArea=new PixelHitTest(S.hitTestData,a,l)):0!=a&&-1!=l&&(this.hitArea=new ChildHitArea(this.getChildAt(l))),d.seek(0,5);var T=d.readShort();for(i=0;i<T;i++){r=d.readShort(),r+=d.position;var x=new Transition(this);x.setup(d),this._transitions.push(x),d.position=r}this.applyAllControllers(),this._buildingDisplayList=!1,this._underConstruct=!1,this.buildNativeDisplayList(),this.setBoundsChangedFlag(),_.objectType!=ObjectType.Component&&this.constructExtension(d),this.onConstruct()}constructExtension(t){}onConstruct(){}setup_afterAdd(t,e){super.setup_afterAdd(t,e),t.seek(e,4);var i=t.readShort();-1!=i&&this._scrollPane&&(this._scrollPane.pageController=this._parent.getControllerAt(i));for(var s=t.readShort(),n=0;n<s;n++){var r=this.getController(t.readS()),o=t.readS();r&&(r.selectedPageId=o)}if(t.version>=2)for(s=t.readShort(),n=0;n<s;n++){var h=t.readS(),a=t.readShort(),l=t.readS(),_=this.getChildByPath(h);_&&_.setProp(a,l)}}onEnable(){let t=this._transitions.length;for(let e=0;e<t;++e)this._transitions[e].onEnable()}onDisable(){let t=this._transitions.length;for(let e=0;e<t;++e)this._transitions[e].onDisable()}}var s_vec2$2=new Vec2;class Window extends GComponent{constructor(){super(),this._requestingCmd=0,this._uiSources=new Array,this.bringToFontOnClick=UIConfig.bringWindowToFrontOnClick,this._node.on(FGUIEvent.TOUCH_BEGIN,this.onTouchBegin_1,this,!0)}addUISource(t){this._uiSources.push(t)}set contentPane(t){this._contentPane!=t&&(this._contentPane&&this.removeChild(this._contentPane),this._contentPane=t,this._contentPane&&(this.addChild(this._contentPane),this.setSize(this._contentPane.width,this._contentPane.height),this._contentPane.addRelation(this,RelationType.Size),this._frame=this._contentPane.getChild("frame"),this._frame&&(this.closeButton=this._frame.getChild("closeButton"),this.dragArea=this._frame.getChild("dragArea"),this.contentArea=this._frame.getChild("contentArea"))))}get contentPane(){return this._contentPane}get frame(){return this._frame}get closeButton(){return this._closeButton}set closeButton(t){this._closeButton&&this._closeButton.offClick(this.closeEventHandler,this),this._closeButton=t,this._closeButton&&this._closeButton.onClick(this.closeEventHandler,this)}get dragArea(){return this._dragArea}set dragArea(t){this._dragArea!=t&&(this._dragArea&&(this._dragArea.draggable=!1,this._dragArea.off(FGUIEvent.DRAG_START,this.onDragStart_1,this)),this._dragArea=t,this._dragArea&&(this._dragArea.draggable=!0,this._dragArea.on(FGUIEvent.DRAG_START,this.onDragStart_1,this)))}get contentArea(){return this._contentArea}set contentArea(t){this._contentArea=t}show(){GRoot.inst.showWindow(this)}showOn(t){t.showWindow(this)}hide(){this.isShowing&&this.doHideAnimation()}hideImmediately(){var t=this.parent instanceof GRoot?this.parent:null;t||(t=GRoot.inst),t.hideWindowImmediately(this)}centerOn(t,e){this.setPosition(Math.round((t.width-this.width)/2),Math.round((t.height-this.height)/2)),e&&(this.addRelation(t,RelationType.Center_Center),this.addRelation(t,RelationType.Middle_Middle))}toggleStatus(){this.isTop?this.hide():this.show()}get isShowing(){return null!=this.parent}get isTop(){return this.parent&&this.parent.getChildIndex(this)==this.parent.numChildren-1}get modal(){return this._modal}set modal(t){this._modal=t}bringToFront(){GRoot.inst.bringToFront(this)}showModalWait(t){null!=t&&(this._requestingCmd=t),UIConfig.windowModalWaiting&&(this._modalWaitPane||(this._modalWaitPane=UIPackage.createObjectFromURL(UIConfig.windowModalWaiting)),this.layoutModalWaitPane(),this.addChild(this._modalWaitPane))}layoutModalWaitPane(){if(this._contentArea){var t=this._frame.localToGlobal();t=this.globalToLocal(t.x,t.y,t),this._modalWaitPane.setPosition(t.x+this._contentArea.x,t.y+this._contentArea.y),this._modalWaitPane.setSize(this._contentArea.width,this._contentArea.height)}else this._modalWaitPane.setSize(this.width,this.height)}closeModalWait(t){return(null==t||this._requestingCmd==t)&&(this._requestingCmd=0,this._modalWaitPane&&this._modalWaitPane.parent&&this.removeChild(this._modalWaitPane),!0)}get modalWaiting(){return this._modalWaitPane&&null!=this._modalWaitPane.parent}init(){if(!this._inited&&!this._loading)if(this._uiSources.length>0){this._loading=!1;for(var t=this._uiSources.length,e=0;e<t;e++){var i=this._uiSources[e];i.loaded||(i.load(this.__uiLoadComplete,this),this._loading=!0)}this._loading||this._init()}else this._init()}onInit(){}onShown(){}onHide(){}doShowAnimation(){this.onShown()}doHideAnimation(){this.hideImmediately()}__uiLoadComplete(){for(var t=this._uiSources.length,e=0;e<t;e++){if(!this._uiSources[e].loaded)return}this._loading=!1,this._init()}_init(){this._inited=!0,this.onInit(),this.isShowing&&this.doShowAnimation()}dispose(){this.parent&&this.hideImmediately(),super.dispose()}closeEventHandler(t){this.hide()}onEnable(){super.onEnable(),this._inited?this.doShowAnimation():this.init()}onDisable(){super.onDisable(),this.closeModalWait(),this.onHide()}onTouchBegin_1(t){this.isShowing&&this.bringToFontOnClick&&this.bringToFront()}onDragStart_1(t){GObject.cast(t.currentTarget).stopDrag(),this.startDrag(t.touchId)}}class GRoot extends GComponent{static get inst(){if(!GRoot._inst)throw"Call GRoot.create first!";return GRoot._inst}static create(t){return GRoot._inst=new GRoot,t?t.addChild(GRoot._inst.node):director.getScene().getChildByName("Canvas").addChild(GRoot._inst.node),GRoot._inst.onWinResize(),GRoot._inst}constructor(){super(),this._node.name="GRoot",this.opaque=!1,this._volumeScale=1,this._popupStack=new Array,this._justClosedPopups=new Array,this._modalLayer=new GGraph,this._modalLayer.setSize(this.width,this.height),this._modalLayer.drawRect(0,Color.TRANSPARENT,UIConfig.modalLayerColor),this._modalLayer.addRelation(this,RelationType.Size),this._thisOnResized=this.onWinResize.bind(this),this._inputProcessor=this.node.addComponent(InputProcessor),this._inputProcessor._captureCallback=this.onTouchBegin_1,View.instance.on("design-resolution-changed",this.onWinResize,this),EDITOR||(View.instance.on("canvas-resize",this._thisOnResized),window.addEventListener("orientationchange",this._thisOnResized))}onDestroy(){View.instance.off("design-resolution-changed",this.onWinResize,this),EDITOR||(View.instance.off("canvas-resize",this._thisOnResized),window.removeEventListener("orientationchange",this._thisOnResized)),this==GRoot._inst&&(GRoot._inst=null)}getTouchPosition(t){return this._inputProcessor.getTouchPosition(t)}get touchTarget(){return this._inputProcessor.getTouchTarget()}get inputProcessor(){return this._inputProcessor}showWindow(t){this.addChild(t),t.requestFocus(),t.x>this.width?t.x=this.width-t.width:t.x+t.width<0&&(t.x=0),t.y>this.height?t.y=this.height-t.height:t.y+t.height<0&&(t.y=0),this.adjustModalLayer()}hideWindow(t){t.hide()}hideWindowImmediately(t){t.parent==this&&this.removeChild(t),this.adjustModalLayer()}bringToFront(t){var e,i=this.numChildren;for(e=this._modalLayer.parent&&!t.modal?this.getChildIndex(this._modalLayer)-1:i-1;e>=0;e--){var s=this.getChildAt(e);if(s==t)return;if(s instanceof Window)break}e>=0&&this.setChildIndex(t,e)}showModalWait(t){null!=UIConfig.globalModalWaiting&&(null==this._modalWaitPane&&(this._modalWaitPane=UIPackage.createObjectFromURL(UIConfig.globalModalWaiting)),this._modalWaitPane.setSize(this.width,this.height),this._modalWaitPane.addRelation(this,RelationType.Size),this.addChild(this._modalWaitPane),this._modalWaitPane.text=t)}closeModalWait(){this._modalWaitPane&&this._modalWaitPane.parent&&this.removeChild(this._modalWaitPane)}closeAllExceptModals(){for(var t=this._children.slice(),e=t.length,i=0;i<e;i++){var s=t[i];s instanceof Window&&!s.modal&&s.hide()}}closeAllWindows(){for(var t=this._children.slice(),e=t.length,i=0;i<e;i++){var s=t[i];s instanceof Window&&s.hide()}}getTopWindow(){for(var t=this.numChildren-1;t>=0;t--){var e=this.getChildAt(t);if(e instanceof Window)return e}return null}get modalLayer(){return this._modalLayer}get hasModalWindow(){return null!=this._modalLayer.parent}get modalWaiting(){return this._modalWaitPane&&this._modalWaitPane.node.activeInHierarchy}getPopupPosition(t,e,i,s){let n=s||new Vec2;var r=0,o=0;if(e){n=e.localToGlobal();let t=e.localToGlobal(e.width,e.height);r=t.x-n.x,o=t.y-n.y}else n=this.getTouchPosition(),n=this.globalToLocal(n.x,n.y);return n.x+t.width>this.width&&(n.x=n.x+r-t.width),n.y+=o,((void 0===i||i===PopupDirection.Auto)&&n.y+t.height>this.height||!1===i||i===PopupDirection.Up)&&(n.y=n.y-o-t.height-1,n.y<0&&(n.y=0,n.x+=r/2)),n}showPopup(t,e,i){if(this._popupStack.length>0){var s=this._popupStack.indexOf(t);if(-1!=s)for(var n=this._popupStack.length-1;n>=s;n--)this.removeChild(this._popupStack.pop())}if(this._popupStack.push(t),e)for(var r=e;r;){if(r.parent==this){t.sortingOrder<r.sortingOrder&&(t.sortingOrder=r.sortingOrder);break}r=r.parent}this.addChild(t),this.adjustModalLayer();let o=this.getPopupPosition(t,e,i);t.setPosition(o.x,o.y)}togglePopup(t,e,i){-1==this._justClosedPopups.indexOf(t)&&this.showPopup(t,e,i)}hidePopup(t){if(t){var e=this._popupStack.indexOf(t);if(-1!=e)for(var i=this._popupStack.length-1;i>=e;i--)this.closePopup(this._popupStack.pop())}else{for(i=this._popupStack.length-1;i>=0;i--)this.closePopup(this._popupStack[i]);this._popupStack.length=0}}get hasAnyPopup(){return 0!=this._popupStack.length}closePopup(t){t.parent&&(t instanceof Window?t.hide():this.removeChild(t))}showTooltips(t){if(null==this._defaultTooltipWin){var e=UIConfig.tooltipsWin;if(!e)return void console.error("UIConfig.tooltipsWin not defined");this._defaultTooltipWin=UIPackage.createObjectFromURL(e)}this._defaultTooltipWin.text=t,this.showTooltipsWin(this._defaultTooltipWin)}showTooltipsWin(t){this.hideTooltips(),this._tooltipWin=t;let e=this.getTouchPosition();e.x+=10,e.y+=20,this.globalToLocal(e.x,e.y,e),e.x+this._tooltipWin.width>this.width&&(e.x=e.x-this._tooltipWin.width-1,e.x<0&&(e.x=10)),e.y+this._tooltipWin.height>this.height&&(e.y=e.y-this._tooltipWin.height-1,e.y<0&&(e.y=10)),this._tooltipWin.setPosition(e.x,e.y),this.addChild(this._tooltipWin)}hideTooltips(){this._tooltipWin&&(this._tooltipWin.parent&&this.removeChild(this._tooltipWin),this._tooltipWin=null)}get volumeScale(){return this._volumeScale}set volumeScale(t){this._volumeScale=t}playOneShotSound(t,e){this.audioEngine||(this.audioEngine=this.node.addComponent(AudioSourceComponent)),void 0===e&&(e=1),this.audioEngine.isValid&&(this.audioEngine.clip=t,this.audioEngine.volume=this._volumeScale*e,this.audioEngine.loop=!1,this.audioEngine.play())}adjustModalLayer(){var t=this.numChildren;this._modalWaitPane&&this._modalWaitPane.parent&&this.setChildIndex(this._modalWaitPane,t-1);for(var e=t-1;e>=0;e--){var i=this.getChildAt(e);if(i instanceof Window&&i.modal)return void(null==this._modalLayer.parent?this.addChildAt(this._modalLayer,e):this.setChildIndexBefore(this._modalLayer,e))}this._modalLayer.parent&&this.removeChild(this._modalLayer)}onTouchBegin_1(t){if(this._tooltipWin&&this.hideTooltips(),this._justClosedPopups.length=0,this._popupStack.length>0){let i=t.initiator;for(;i&&i!=this;){let t=this._popupStack.indexOf(i);if(-1!=t){for(let i=this._popupStack.length-1;i>t;i--){var e=this._popupStack.pop();this.closePopup(e),this._justClosedPopups.push(e)}return}i=i.findParent()}for(let t=this._popupStack.length-1;t>=0;t--)e=this._popupStack[t],this.closePopup(e),this._justClosedPopups.push(e);this._popupStack.length=0}}onWinResize(){updateScaler(),this.setSize(UIContentScaler.rootSize.width,UIContentScaler.rootSize.height);let t=this.node.getParent()._uiProps.uiTransformComp.anchorPoint;this.node.setPosition(-this._width*t.x,this._height*(1-t.y))}handlePositionChanged(){}}Decls$1.GRoot=GRoot;class GTextInput extends GTextField{constructor(){super(),this._node.name="GTextInput",this._touchDisabled=!1}createRenderer(){this._editBox=this._node.addComponent(MyEditBox),this._editBox.maxLength=-1,this._editBox._updateTextLabel(),this._node.on("text-changed",this.onTextChanged,this),this.on(FGUIEvent.TOUCH_END,this.onTouchEnd1,this),this.autoSize=AutoSizeType.None}set editable(t){this._editBox.enabled=t}get editable(){return this._editBox.enabled}set maxLength(t){0==t&&(t=-1),this._editBox.maxLength=t}get maxLength(){return this._editBox.maxLength}set promptText(t){this._promptText=t;let e=!this._editBox.placeholderLabel;if(this._editBox._updatePlaceholderLabel(),e&&this.assignFont(this._editBox.placeholderLabel,this._realFont),this._editBox.placeholderLabel.string=defaultParser.parse(this._promptText,!0),defaultParser.lastColor){let t=this._editBox.placeholderLabel.color;t||(t=new Color),t.fromHEX(defaultParser.lastColor),this.assignFontColor(this._editBox.placeholderLabel,t)}else this.assignFontColor(this._editBox.placeholderLabel,this._color);defaultParser.lastSize?this._editBox.placeholderLabel.fontSize=parseInt(defaultParser.lastSize):this._editBox.placeholderLabel.fontSize=this._fontSize}get promptText(){return this._promptText}set restrict(t){}get restrict(){return""}get password(){return this._editBox.inputFlag==EditBox.InputFlag.PASSWORD}set password(t){this._editBox.inputFlag=t?EditBox.InputFlag.PASSWORD:EditBox.InputFlag.DEFAULT}get align(){return this._editBox.textLabel.horizontalAlign}set align(t){this._editBox.textLabel.horizontalAlign=t,this._editBox.placeholderLabel&&(this._editBox.placeholderLabel.horizontalAlign=t)}get verticalAlign(){return this._editBox.textLabel.verticalAlign}set verticalAlign(t){this._editBox.textLabel.verticalAlign=t,this._editBox.placeholderLabel&&(this._editBox.placeholderLabel.verticalAlign=t)}get singleLine(){return this._editBox.inputMode!=EditBox.InputMode.ANY}set singleLine(t){this._editBox.inputMode=t?EditBox.InputMode.SINGLE_LINE:EditBox.InputMode.ANY}requestFocus(){this._editBox.focus()}markSizeChanged(){}updateText(){var t=this._text;this._templateVars&&(t=this.parseTemplate(t)),this._ubbEnabled&&(t=defaultParser.parse(t,!0)),this._editBox.string=t}updateFont(){this.assignFont(this._editBox.textLabel,this._realFont),this._editBox.placeholderLabel&&this.assignFont(this._editBox.placeholderLabel,this._realFont)}updateFontColor(){this.assignFontColor(this._editBox.textLabel,this._color)}updateFontSize(){this._editBox.textLabel.fontSize=this._fontSize,this._editBox.textLabel.lineHeight=this._fontSize+this._leading,this._editBox.placeholderLabel&&(this._editBox.placeholderLabel.fontSize=this._editBox.textLabel.fontSize)}updateOverflow(){}onTextChanged(){this._text=this._editBox.string}onTouchEnd1(t){this._editBox.openKeyboard()}setup_beforeAdd(t,e){super.setup_beforeAdd(t,e),t.seek(e,4);var i=t.readS();null!=i?this.promptText=i:this._editBox.placeholderLabel&&(this._editBox.placeholderLabel.string=""),null!=(i=t.readS())&&(this.restrict=i);var s=t.readInt();if(0!=s&&(this.maxLength=s),s=t.readInt(),t.readBool()&&(this.password=!0),this._editBox.placeholderLabel){let t=this._editBox.textLabel.horizontalAlign;this._editBox.placeholderLabel.horizontalAlign=t;let e=this._editBox.textLabel.verticalAlign;this._editBox.placeholderLabel.verticalAlign=e}}}class MyEditBox extends EditBox{_registerEvent(){}openKeyboard(){let t=this._impl;t&&t.beginEditing()}}class GObjectPool{constructor(){this._count=0,this._pool={}}clear(){for(var t in this._pool)for(var e=this._pool[t],i=e.length,s=0;s<i;s++)e[s].dispose();this._pool={},this._count=0}get count(){return this._count}getObject(t){if(null==(t=UIPackage.normalizeURL(t)))return null;var e=this._pool[t];return e&&e.length?(this._count--,e.shift()):UIPackage.createObjectFromURL(t)}returnObject(t){var e=t.resourceURL;if(e){var i=this._pool[e];null==i&&(i=new Array,this._pool[e]=i),this._count++,i.push(t)}}}class GLoader extends GObject{constructor(){super(),this._frame=0,this._node.name="GLoader",this._playing=!0,this._url="",this._fill=LoaderFillType.None,this._align=AlignType.Left,this._verticalAlign=VertAlignType.Top,this._showErrorSign=!0,this._color=new Color(255,255,255,255),this._container=new Node("Image"),this._container.layer=UIConfig.defaultUILayer,this._container.addComponent(UITransform).setAnchorPoint(0,1),this._node.addChild(this._container),this._content=this._container.addComponent(MovieClip),this._content.sizeMode=Sprite.SizeMode.CUSTOM,this._content.trim=!1,this._content.setPlaySettings()}dispose(){null==this._contentItem&&this._content.spriteFrame&&this.freeExternal(this._content.spriteFrame),this._content2&&this._content2.dispose(),super.dispose()}get url(){return this._url}set url(t){this._url!=t&&(this._url=t,this.loadContent(),this.updateGear(7))}get icon(){return this._url}set icon(t){this.url=t}get align(){return this._align}set align(t){this._align!=t&&(this._align=t,this.updateLayout())}get verticalAlign(){return this._verticalAlign}set verticalAlign(t){this._verticalAlign!=t&&(this._verticalAlign=t,this.updateLayout())}get fill(){return this._fill}set fill(t){this._fill!=t&&(this._fill=t,this.updateLayout())}get shrinkOnly(){return this._shrinkOnly}set shrinkOnly(t){this._shrinkOnly!=t&&(this._shrinkOnly=t,this.updateLayout())}get autoSize(){return this._autoSize}set autoSize(t){this._autoSize!=t&&(this._autoSize=t,this.updateLayout())}get playing(){return this._playing}set playing(t){this._playing!=t&&(this._playing=t,this._content instanceof MovieClip&&(this._content.playing=t),this.updateGear(5))}get frame(){return this._frame}set frame(t){this._frame!=t&&(this._frame=t,this._content instanceof MovieClip&&(this._content.frame=t),this.updateGear(5))}get color(){return this._color}set color(t){this._color.set(t),this.updateGear(4),this._content.color=t}get fillMethod(){return this._content.fillMethod}set fillMethod(t){this._content.fillMethod=t}get fillOrigin(){return this._content.fillOrigin}set fillOrigin(t){this._content.fillOrigin=t}get fillClockwise(){return this._content.fillClockwise}set fillClockwise(t){this._content.fillClockwise=t}get fillAmount(){return this._content.fillAmount}set fillAmount(t){this._content.fillAmount=t}get showErrorSign(){return this._showErrorSign}set showErrorSign(t){this._showErrorSign=t}get component(){return this._content2}get texture(){return this._content.spriteFrame}set texture(t){this.url=null,this._content.spriteFrame=t,this._content.type=Sprite.Type.SIMPLE,null!=t?(this.sourceWidth=t.getRect().width,this.sourceHeight=t.getRect().height):this.sourceWidth=this.sourceHeight=0,this.updateLayout()}loadContent(){this.clearContent(),this._url&&("string"==typeof this._url&&this._url.startsWith("ui://")?this.loadFromPackage(this._url):this.loadExternal())}loadFromPackage(t){if(this._contentItem=UIPackage.getItemByURL(t),this._contentItem)if(this._contentItem=this._contentItem.getBranch(),this.sourceWidth=this._contentItem.width,this.sourceHeight=this._contentItem.height,this._contentItem=this._contentItem.getHighResolution(),this._contentItem.load(),this._autoSize&&this.setSize(this.sourceWidth,this.sourceHeight),this._contentItem.type==PackageItemType.Image)this._contentItem.asset?(this._content.spriteFrame=this._contentItem.asset,0==this._content.fillMethod&&(this._contentItem.scale9Grid?this._content.type=Sprite.Type.SLICED:this._contentItem.scaleByTile?this._content.type=Sprite.Type.TILED:this._content.type=Sprite.Type.SIMPLE),this.updateLayout()):this.setErrorState();else if(this._contentItem.type==PackageItemType.MovieClip)this._content.interval=this._contentItem.interval,this._content.swing=this._contentItem.swing,this._content.repeatDelay=this._contentItem.repeatDelay,this._content.frames=this._contentItem.frames,this.updateLayout();else if(this._contentItem.type==PackageItemType.Component){var e=UIPackage.createObjectFromURL(t);e?e instanceof GComponent?(this._content2=e,this._container.addChild(this._content2.node),this.updateLayout()):(e.dispose(),this.setErrorState()):this.setErrorState()}else this.setErrorState();else this.setErrorState()}loadExternal(){let t=this.url,e=(e,i)=>{if(this._url==t&&isValid(this._node))if(e&&console.warn(e),i instanceof SpriteFrame)this.onExternalLoadSuccess(i);else if(i instanceof Texture2D){let t=new SpriteFrame;t.texture=i,this.onExternalLoadSuccess(t)}else if(i instanceof ImageAsset){let t=new SpriteFrame,e=new Texture2D;e.image=i,t.texture=e,this.onExternalLoadSuccess(t)}};if("string"!=typeof this._url)throw new Error("fgui底层未实现CCURL的非string资源加载！");this._url.startsWith("http://")||this._url.startsWith("https://")||this._url.startsWith("/")?assetManager.loadRemote(this._url,e):resources.load(this._url+"/spriteFrame",Asset,e)}freeExternal(t){}onExternalLoadSuccess(t){this._content.spriteFrame=t,this._content.type=Sprite.Type.SIMPLE,this.sourceWidth=t.getRect().width,this.sourceHeight=t.getRect().height,this._autoSize&&this.setSize(this.sourceWidth,this.sourceHeight),this.updateLayout()}onExternalLoadFailed(){this.setErrorState()}setErrorState(){this._showErrorSign&&(null==this._errorSign&&null!=UIConfig.loaderErrorSign&&(this._errorSign=GLoader._errorSignPool.getObject(UIConfig.loaderErrorSign)),this._errorSign&&(this._errorSign.setSize(this.width,this.height),this._container.addChild(this._errorSign.node)))}clearErrorState(){this._errorSign&&(this._container.removeChild(this._errorSign.node),GLoader._errorSignPool.returnObject(this._errorSign),this._errorSign=null)}updateLayout(){if(null==this._content2&&null==this._content)return void(this._autoSize&&(this._updatingLayout=!0,this.setSize(50,30),this._updatingLayout=!1));let t=this.sourceWidth,e=this.sourceHeight,i=-this.pivotX*this._width,s=this.pivotY*this._height;if(!this._autoSize||(this._updatingLayout=!0,0==t&&(t=50),0==e&&(e=30),this.setSize(t,e),this._updatingLayout=!1,this._container._uiProps.uiTransformComp.setContentSize(this._width,this._height),this._container.setPosition(i,s),this._content2&&(this._content2.setPosition(i+this._width*this.pivotX,s-this._height*this.pivotY),this._content2.setScale(1,1)),t!=this._width||e!=this._height)){var n,r,o=1,h=1;this._fill!=LoaderFillType.None&&(o=this.width/this.sourceWidth,h=this.height/this.sourceHeight,1==o&&1==h||(this._fill==LoaderFillType.ScaleMatchHeight?o=h:this._fill==LoaderFillType.ScaleMatchWidth?h=o:this._fill==LoaderFillType.Scale?o>h?o=h:h=o:this._fill==LoaderFillType.ScaleNoBorder&&(o>h?h=o:o=h),this._shrinkOnly&&(o>1&&(o=1),h>1&&(h=1)),t=this.sourceWidth*o,e=this.sourceHeight*h)),this._container._uiProps.uiTransformComp.setContentSize(t,e),this._content2&&(this._content2.setPosition(i+this._width*this.pivotX,s-this._height*this.pivotY),this._content2.setScale(o,h)),n=this._align==AlignType.Left?0:this._align==AlignType.Center?Math.floor((this._width-t)/2):this._width-t,r=-(r=this._verticalAlign==VertAlignType.Top?0:this._verticalAlign==VertAlignType.Middle?Math.floor((this._height-e)/2):this._height-e),this._container.setPosition(i+n,s+r)}}clearContent(){if(this.clearErrorState(),!this._contentItem){var t=this._content.spriteFrame;t&&this.freeExternal(t)}this._content2&&(this._container.removeChild(this._content2.node),this._content2.dispose(),this._content2=null),this._content.frames=null,this._content.spriteFrame=null,this._contentItem=null}handleSizeChanged(){super.handleSizeChanged(),this._updatingLayout||this.updateLayout()}handleAnchorChanged(){super.handleAnchorChanged(),this._updatingLayout||this.updateLayout()}handleGrayedChanged(){this._content.grayscale=this._grayed}_hitTest(t,e){if(this._content2){let t=this._content2.hitTest(e);if(t)return t}return t.x>=0&&t.y>=0&&t.x<this._width&&t.y<this._height?this:null}getProp(t){switch(t){case ObjectPropID.Color:return this.color;case ObjectPropID.Playing:return this.playing;case ObjectPropID.Frame:return this.frame;case ObjectPropID.TimeScale:return this._content.timeScale;default:return super.getProp(t)}}setProp(t,e){switch(t){case ObjectPropID.Color:this.color=e;break;case ObjectPropID.Playing:this.playing=e;break;case ObjectPropID.Frame:this.frame=e;break;case ObjectPropID.TimeScale:this._content.timeScale=e;break;case ObjectPropID.DeltaTime:this._content.advance(e);break;default:super.setProp(t,e)}}setup_beforeAdd(t,e){super.setup_beforeAdd(t,e),t.seek(e,5),this._url=t.readS(),this._align=t.readByte(),this._verticalAlign=t.readByte(),this._fill=t.readByte(),this._shrinkOnly=t.readBool(),this._autoSize=t.readBool(),this._showErrorSign=t.readBool(),this._playing=t.readBool(),this._frame=t.readInt(),t.readBool()&&(this.color=t.readColor()),this._content.fillMethod=t.readByte(),0!=this._content.fillMethod&&(this._content.fillOrigin=t.readByte(),this._content.fillClockwise=t.readBool(),this._content.fillAmount=t.readFloat()),this._url&&this.loadContent()}}GLoader._errorSignPool=new GObjectPool;class GLoader3D extends GObject{constructor(){super(),this._frame=0,this._node.name="GLoader3D",this._playing=!0,this._url="",this._fill=LoaderFillType.None,this._align=AlignType.Left,this._verticalAlign=VertAlignType.Top,this._color=new Color(255,255,255,255),this._container=new Node("Wrapper"),this._container.layer=UIConfig.defaultUILayer,this._container.addComponent(UITransform).setAnchorPoint(0,1),this._node.addChild(this._container)}dispose(){super.dispose()}get url(){return this._url}set url(t){this._url!=t&&(this._url=t,this.loadContent(),this.updateGear(7))}get icon(){return this._url}set icon(t){this.url=t}get align(){return this._align}set align(t){this._align!=t&&(this._align=t,this.updateLayout())}get verticalAlign(){return this._verticalAlign}set verticalAlign(t){this._verticalAlign!=t&&(this._verticalAlign=t,this.updateLayout())}get fill(){return this._fill}set fill(t){this._fill!=t&&(this._fill=t,this.updateLayout())}get shrinkOnly(){return this._shrinkOnly}set shrinkOnly(t){this._shrinkOnly!=t&&(this._shrinkOnly=t,this.updateLayout())}get autoSize(){return this._autoSize}set autoSize(t){this._autoSize!=t&&(this._autoSize=t,this.updateLayout())}get playing(){return this._playing}set playing(t){this._playing!=t&&(this._playing=t,this.updateGear(5),this.onChange())}get frame(){return this._frame}set frame(t){this._frame!=t&&(this._frame=t,this.updateGear(5),this.onChange())}get animationName(){return this._animationName}set animationName(t){this._animationName!=t&&(this._animationName=t,this.onChange())}get skinName(){return this._skinName}set skinName(t){this._skinName!=t&&(this._skinName=t,this.onChange())}get loop(){return this._loop}set loop(t){this._loop!=t&&(this._loop=t,this.onChange())}get color(){return this._color}set color(t){this._color.set(t),this.updateGear(4),this._content&&(this._content.color=t)}get content(){return this._content}loadContent(){this.clearContent(),this._url&&(this._url.startsWith("ui://")?this.loadFromPackage(this._url):this.loadExternal())}loadFromPackage(t){this._contentItem=UIPackage.getItemByURL(t),this._contentItem&&(this._contentItem=this._contentItem.getBranch(),this.sourceWidth=this._contentItem.width,this.sourceHeight=this._contentItem.height,this._contentItem=this._contentItem.getHighResolution(),this._autoSize&&this.setSize(this.sourceWidth,this.sourceHeight),this._contentItem.type!=PackageItemType.Spine&&this._contentItem.type!=PackageItemType.DragonBones||this._contentItem.owner.getItemAssetAsync(this._contentItem,this.onLoaded.bind(this)))}onLoaded(t,e){this._contentItem==e&&(t&&console.warn(t),this._contentItem.asset&&(this._contentItem.type==PackageItemType.Spine?this.setSpine(this._contentItem.asset,this._contentItem.skeletonAnchor):this._contentItem.type==PackageItemType.DragonBones&&this.setDragonBones(this._contentItem.asset,this._contentItem.atlasAsset,this._contentItem.skeletonAnchor)))}setSpine(t,e,i){this.freeSpine();let s=new Node;this._container.addChild(s),s.layer=UIConfig.defaultUILayer,s.setPosition(e.x,-e.y),this._content=s.addComponent(sp.Skeleton),this._content.premultipliedAlpha=i,this._content.skeletonData=t,this._content.color=this._color,this.onChangeSpine(),this.updateLayout()}freeSpine(){this._content&&this._content.destroy()}setDragonBones(t,e,i,s){this.freeDragonBones();let n=new Node;n.layer=UIConfig.defaultUILayer,this._container.addChild(n),n.setPosition(i.x,-i.y),this._content=n.addComponent(dragonBones.ArmatureDisplay),this._content.premultipliedAlpha=s,this._content.dragonAsset=t,this._content.dragonAtlasAsset=e,this._content.color=this._color;let r=t.init(e._factory,e._uuid),o=this._content._factory.getDragonBonesData(r);this._content.armatureName=o.armatureNames[0],this.onChangeDragonBones(),this.updateLayout()}freeDragonBones(){this._content&&this._content.destroy()}onChange(){null!=this._contentItem&&(this._contentItem.type==PackageItemType.Spine&&this.onChangeSpine(),this._contentItem.type==PackageItemType.DragonBones&&this.onChangeDragonBones())}onChangeSpine(){if(!(this._content instanceof sp.Skeleton))return;if(this._animationName){let t=this._content.getCurrent(0);(!t||t.animation.name!=this._animationName||t.isComplete()&&!t.loop)&&(this._content.animation=this._animationName,t=this._content.setAnimation(0,this._animationName,this._loop)),this._playing?this._content.paused=!1:(this._content.paused=!0,t.trackTime=math.lerp(0,t.animationEnd-t.animationStart,this._frame/100))}else this._content.clearTrack(0);let t=this._skinName||this._content.skeletonData.getRuntimeData().skins[0].name;this._content._skeleton.skin.name!=t&&this._content.setSkin(t)}onChangeDragonBones(){this._content instanceof dragonBones.ArmatureDisplay&&(this._animationName?this._playing?this._content.playAnimation(this._animationName,this._loop?0:1):this._content.armature().animation.gotoAndStopByFrame(this._animationName,this._frame):this._content.armature().animation.reset())}loadExternal(){this._url.startsWith("http://")||this._url.startsWith("https://")||this._url.startsWith("/")?assetManager.loadRemote(this._url,sp.SkeletonData,this.onLoaded2.bind(this)):resources.load(this._url,sp.SkeletonData,this.onLoaded2.bind(this))}onLoaded2(t,e){this._url&&isValid(this._node)&&t&&console.warn(t)}updateLayout(){let t=this.sourceWidth,e=this.sourceHeight,i=-this.pivotX*this._width,s=this.pivotY*this._height;if(this._autoSize&&(this._updatingLayout=!0,0==t&&(t=50),0==e&&(e=30),this.setSize(t,e),this._updatingLayout=!1,t==this._width&&e==this._height))return this._container.setScale(1,1),void this._container.setPosition(i,s);var n,r,o=1,h=1;this._fill!=LoaderFillType.None&&(o=this.width/this.sourceWidth,h=this.height/this.sourceHeight,1==o&&1==h||(this._fill==LoaderFillType.ScaleMatchHeight?o=h:this._fill==LoaderFillType.ScaleMatchWidth?h=o:this._fill==LoaderFillType.Scale?o>h?o=h:h=o:this._fill==LoaderFillType.ScaleNoBorder&&(o>h?h=o:o=h),this._shrinkOnly&&(o>1&&(o=1),h>1&&(h=1)),t=this.sourceWidth*o,e=this.sourceHeight*h)),this._container.setScale(o,h),n=this._align==AlignType.Left?0:this._align==AlignType.Center?Math.floor((this._width-t)/2):this._width-t,r=-(r=this._verticalAlign==VertAlignType.Top?0:this._verticalAlign==VertAlignType.Middle?Math.floor((this._height-e)/2):this._height-e),this._container.setPosition(i+n,s+r)}clearContent(){this._contentItem=null,this._content&&(this._content.node.destroy(),this._content=null)}handleSizeChanged(){super.handleSizeChanged(),this._updatingLayout||this.updateLayout()}handleAnchorChanged(){super.handleAnchorChanged(),this._updatingLayout||this.updateLayout()}handleGrayedChanged(){}getProp(t){switch(t){case ObjectPropID.Color:return this.color;case ObjectPropID.Playing:return this.playing;case ObjectPropID.Frame:return this.frame;case ObjectPropID.TimeScale:return 1;default:return super.getProp(t)}}setProp(t,e){switch(t){case ObjectPropID.Color:this.color=e;break;case ObjectPropID.Playing:this.playing=e;break;case ObjectPropID.Frame:this.frame=e;break;case ObjectPropID.TimeScale:case ObjectPropID.DeltaTime:break;default:super.setProp(t,e)}}setup_beforeAdd(t,e){super.setup_beforeAdd(t,e),t.seek(e,5),this._url=t.readS(),this._align=t.readByte(),this._verticalAlign=t.readByte(),this._fill=t.readByte(),this._shrinkOnly=t.readBool(),this._autoSize=t.readBool(),this._animationName=t.readS(),this._skinName=t.readS(),this._playing=t.readBool(),this._frame=t.readInt(),this._loop=t.readBool(),t.readBool()&&(this.color=t.readColor()),this._url&&this.loadContent()}}class GLabel extends GComponent{constructor(){super(),this._node.name="GLabel"}get icon(){if(this._iconObject)return this._iconObject.icon}set icon(t){this._iconObject&&(this._iconObject.icon=t),this.updateGear(7)}get title(){return this._titleObject?this._titleObject.text:null}set title(t){this._titleObject&&(this._titleObject.text=t),this.updateGear(6)}get text(){return this.title}set text(t){this.title=t}get titleColor(){var t=this.getTextField();return t?t.color:Color.WHITE}set titleColor(t){var e=this.getTextField();e&&(e.color=t),this.updateGear(4)}get titleFontSize(){var t=this.getTextField();return t?t.fontSize:0}set titleFontSize(t){var e=this.getTextField();e&&(e.fontSize=t)}set editable(t){this._titleObject&&this._titleObject instanceof GTextInput&&(this._titleObject.editable=t)}get editable(){return!!(this._titleObject&&this._titleObject instanceof GTextInput)&&this._titleObject.editable}getTextField(){return this._titleObject instanceof GTextField?this._titleObject:"getTextField"in this._titleObject?this._titleObject.getTextField():null}getProp(t){switch(t){case ObjectPropID.Color:return this.titleColor;case ObjectPropID.OutlineColor:var e=this.getTextField();return e?e.strokeColor:0;case ObjectPropID.FontSize:return this.titleFontSize;default:return super.getProp(t)}}setProp(t,e){switch(t){case ObjectPropID.Color:this.titleColor=e;break;case ObjectPropID.OutlineColor:var i=this.getTextField();i&&(i.strokeColor=e);break;case ObjectPropID.FontSize:this.titleFontSize=e;break;default:super.setProp(t,e)}}constructExtension(t){this._titleObject=this.getChild("title"),this._iconObject=this.getChild("icon")}setup_afterAdd(t,e){if(super.setup_afterAdd(t,e),t.seek(e,6)&&t.readByte()==this.packageItem.objectType){var i;null!=(i=t.readS())&&(this.title=i),null!=(i=t.readS())&&(this.icon=i),t.readBool()&&(this.titleColor=t.readColor());var s=t.readInt();if(0!=s&&(this.titleFontSize=s),t.readBool()){var n=this.getTextField();n instanceof GTextInput?(null!=(i=t.readS())&&(n.promptText=i),null!=(i=t.readS())&&(n.restrict=i),0!=(s=t.readInt())&&(n.maxLength=s),s=t.readInt(),t.readBool()&&(n.password=!0)):t.skip(13)}null!=(i=t.readS())&&(this._sound=i,t.readBool()&&(this._soundVolumeScale=t.readFloat()),this._node.on(FGUIEvent.CLICK,this.onClick_1,this))}}onClick_1(){if(this._sound){var t=UIPackage.getItemByURL(this._sound);if(t){var e=t.owner.getItemAsset(t);e&&GRoot.inst.playOneShotSound(e,this._soundVolumeScale)}}}}class GButton extends GComponent{constructor(){super(),this._node.name="GButton",this._mode=ButtonMode.Common,this._title="",this._icon="",this._sound=UIConfig.buttonSound,this._soundVolumeScale=UIConfig.buttonSoundVolumeScale,this._changeStateOnClick=!0,this._downEffect=0,this._downEffectValue=.8}get icon(){return this._icon}set icon(t){this._icon=t,t=this._selected&&this._selectedIcon?this._selectedIcon:this._icon,this._iconObject&&(this._iconObject.icon=t),this.updateGear(7)}get selectedIcon(){return this._selectedIcon}set selectedIcon(t){this._selectedIcon=t,t=this._selected&&this._selectedIcon?this._selectedIcon:this._icon,this._iconObject&&(this._iconObject.icon=t)}get title(){return this._title}set title(t){this._title=t,this._titleObject&&(this._titleObject.text=this._selected&&this._selectedTitle?this._selectedTitle:this._title),this.updateGear(6)}get text(){return this.title}set text(t){this.title=t}get selectedTitle(){return this._selectedTitle}set selectedTitle(t){this._selectedTitle=t,this._titleObject&&(this._titleObject.text=this._selected&&this._selectedTitle?this._selectedTitle:this._title)}get titleColor(){var t=this.getTextField();return t?t.color:Color.BLACK}set titleColor(t){var e=this.getTextField();e&&(e.color=t)}get titleFontSize(){var t=this.getTextField();return t?t.fontSize:0}set titleFontSize(t){var e=this.getTextField();e&&(e.fontSize=t)}get sound(){return this._sound}set sound(t){this._sound=t}get soundVolumeScale(){return this._soundVolumeScale}set soundVolumeScale(t){this._soundVolumeScale=t}set selected(t){if(this._mode!=ButtonMode.Common&&this._selected!=t){if(this._selected=t,this.setCurrentState(),this._selectedTitle&&this._titleObject&&(this._titleObject.text=this._selected?this._selectedTitle:this._title),this._selectedIcon){var e=this._selected?this._selectedIcon:this._icon;this._iconObject&&(this._iconObject.icon=e)}this._relatedController&&this._parent&&!this._parent._buildingDisplayList&&(this._selected?(this._relatedController.selectedPageId=this._relatedPageId,this._relatedController.autoRadioGroupDepth&&this._parent.adjustRadioGroupDepth(this,this._relatedController)):this._mode==ButtonMode.Check&&this._relatedController.selectedPageId==this._relatedPageId&&(this._relatedController.oppositePageId=this._relatedPageId))}}get selected(){return this._selected}get mode(){return this._mode}set mode(t){this._mode!=t&&(t==ButtonMode.Common&&(this.selected=!1),this._mode=t)}get relatedController(){return this._relatedController}set relatedController(t){this._relatedController=t}get relatedPageId(){return this._relatedPageId}set relatedPageId(t){this._relatedPageId=t}get changeStateOnClick(){return this._changeStateOnClick}set changeStateOnClick(t){this._changeStateOnClick=t}get linkedPopup(){return this._linkedPopup}set linkedPopup(t){this._linkedPopup=t}getTextField(){return this._titleObject instanceof GTextField?this._titleObject:"getTextField"in this._titleObject?this._titleObject.getTextField():null}fireClick(){GRoot.inst.inputProcessor.simulateClick(this)}setState(t){if(this._buttonController&&(this._buttonController.selectedPage=t),1==this._downEffect){var e=this.numChildren;if(t==GButton.DOWN||t==GButton.SELECTED_OVER||t==GButton.SELECTED_DISABLED){this._downColor||(this._downColor=new Color);var i=255*this._downEffectValue;this._downColor.r=this._downColor.g=this._downColor.b=i;for(var s=0;s<e;s++){(n=this.getChildAt(s))instanceof GTextField||n.setProp(ObjectPropID.Color,this._downColor)}}else for(s=0;s<e;s++){var n;(n=this.getChildAt(s))instanceof GTextField||n.setProp(ObjectPropID.Color,Color.WHITE)}}else 2==this._downEffect&&(t==GButton.DOWN||t==GButton.SELECTED_OVER||t==GButton.SELECTED_DISABLED?this._downScaled||(this._downScaled=!0,this.setScale(this.scaleX*this._downEffectValue,this.scaleY*this._downEffectValue)):this._downScaled&&(this._downScaled=!1,this.setScale(this.scaleX/this._downEffectValue,this.scaleY/this._downEffectValue)))}setCurrentState(){this.grayed&&this._buttonController&&this._buttonController.hasPage(GButton.DISABLED)?this._selected?this.setState(GButton.SELECTED_DISABLED):this.setState(GButton.DISABLED):this._selected?this.setState(this._over?GButton.SELECTED_OVER:GButton.DOWN):this.setState(this._over?GButton.OVER:GButton.UP)}handleControllerChanged(t){super.handleControllerChanged(t),this._relatedController==t&&(this.selected=this._relatedPageId==t.selectedPageId)}handleGrayedChanged(){this._buttonController&&this._buttonController.hasPage(GButton.DISABLED)?this.grayed?this._selected&&this._buttonController.hasPage(GButton.SELECTED_DISABLED)?this.setState(GButton.SELECTED_DISABLED):this.setState(GButton.DISABLED):this._selected?this.setState(GButton.DOWN):this.setState(GButton.UP):super.handleGrayedChanged()}getProp(t){switch(t){case ObjectPropID.Color:return this.titleColor;case ObjectPropID.OutlineColor:var e=this.getTextField();return e?e.strokeColor:0;case ObjectPropID.FontSize:return this.titleFontSize;case ObjectPropID.Selected:return this.selected;default:return super.getProp(t)}}setProp(t,e){switch(t){case ObjectPropID.Color:this.titleColor=e;break;case ObjectPropID.OutlineColor:var i=this.getTextField();i&&(i.strokeColor=e);break;case ObjectPropID.FontSize:this.titleFontSize=e;break;case ObjectPropID.Selected:this.selected=e;break;default:super.setProp(t,e)}}constructExtension(t){t.seek(0,6),this._mode=t.readByte();var e=t.readS();e&&(this._sound=e),this._soundVolumeScale=t.readFloat(),this._downEffect=t.readByte(),this._downEffectValue=t.readFloat(),2==this._downEffect&&this.setPivot(.5,.5,this.pivotAsAnchor),this._buttonController=this.getController("button"),this._titleObject=this.getChild("title"),this._iconObject=this.getChild("icon"),this._titleObject&&(this._title=this._titleObject.text),this._iconObject&&(this._icon=this._iconObject.icon),this._mode==ButtonMode.Common&&this.setState(GButton.UP),this._node.on(FGUIEvent.TOUCH_BEGIN,this.onTouchBegin_1,this),this._node.on(FGUIEvent.TOUCH_END,this.onTouchEnd_1,this),this._node.on(FGUIEvent.ROLL_OVER,this.onRollOver_1,this),this._node.on(FGUIEvent.ROLL_OUT,this.onRollOut_1,this),this._node.on(FGUIEvent.CLICK,this.onClick_1,this)}setup_afterAdd(t,e){var i,s;(super.setup_afterAdd(t,e),t.seek(e,6))&&(t.readByte()==this.packageItem.objectType&&(null!=(i=t.readS())&&(this.title=i),null!=(i=t.readS())&&(this.selectedTitle=i),null!=(i=t.readS())&&(this.icon=i),null!=(i=t.readS())&&(this.selectedIcon=i),t.readBool()&&(this.titleColor=t.readColor()),0!=(s=t.readInt())&&(this.titleFontSize=s),(s=t.readShort())>=0&&(this._relatedController=this.parent.getControllerAt(s)),this._relatedPageId=t.readS(),null!=(i=t.readS())&&(this._sound=i),t.readBool()&&(this._soundVolumeScale=t.readFloat()),this.selected=t.readBool()))}onRollOver_1(){this._buttonController&&this._buttonController.hasPage(GButton.OVER)&&(this._over=!0,this._down||this.grayed&&this._buttonController.hasPage(GButton.DISABLED)||this.setState(this._selected?GButton.SELECTED_OVER:GButton.OVER))}onRollOut_1(){this._buttonController&&this._buttonController.hasPage(GButton.OVER)&&(this._over=!1,this._down||this.grayed&&this._buttonController.hasPage(GButton.DISABLED)||this.setState(this._selected?GButton.DOWN:GButton.UP))}onTouchBegin_1(t){t.button==EventMouse.BUTTON_LEFT&&(this._down=!0,t.captureTouch(),this._mode==ButtonMode.Common&&(this.grayed&&this._buttonController&&this._buttonController.hasPage(GButton.DISABLED)?this.setState(GButton.SELECTED_DISABLED):this.setState(GButton.DOWN)),this._linkedPopup&&(this._linkedPopup instanceof Window?this._linkedPopup.toggleStatus():GRoot.inst.togglePopup(this._linkedPopup,this)))}onTouchEnd_1(t){if(t.button==EventMouse.BUTTON_LEFT&&this._down){if(this._down=!1,null==this._node)return;this._mode==ButtonMode.Common?this.grayed&&this._buttonController&&this._buttonController.hasPage(GButton.DISABLED)?this.setState(GButton.DISABLED):this._over?this.setState(GButton.OVER):this.setState(GButton.UP):this._over||null==this._buttonController||this._buttonController.selectedPage!=GButton.OVER&&this._buttonController.selectedPage!=GButton.SELECTED_OVER||this.setCurrentState()}}onClick_1(){if(this._sound){var t=UIPackage.getItemByURL(this._sound);if(t){var e=t.owner.getItemAsset(t);e&&GRoot.inst.playOneShotSound(e,this._soundVolumeScale)}}this._mode==ButtonMode.Check?this._changeStateOnClick&&(this.selected=!this._selected,this._node.emit(FGUIEvent.STATUS_CHANGED,this)):this._mode==ButtonMode.Radio?this._changeStateOnClick&&!this._selected&&(this.selected=!0,this._node.emit(FGUIEvent.STATUS_CHANGED,this)):this._relatedController&&(this._relatedController.selectedPageId=this._relatedPageId)}}GButton.UP="up",GButton.DOWN="down",GButton.OVER="over",GButton.SELECTED_OVER="selectedOver",GButton.DISABLED="disabled",GButton.SELECTED_DISABLED="selectedDisabled";class GList extends GComponent{constructor(){super(),this.scrollItemToViewOnClick=!0,this.foldInvisibleItems=!1,this._lineCount=0,this._columnCount=0,this._lineGap=0,this._columnGap=0,this._lastSelectedIndex=0,this._numItems=0,this._realNumItems=0,this._firstIndex=0,this._curLineItemCount=0,this._curLineItemCount2=0,this._virtualListChanged=0,this.itemInfoVer=0,this._node.name="GList",this._trackBounds=!0,this._pool=new GObjectPool,this._layout=ListLayoutType.SingleColumn,this._autoResizeItem=!0,this._lastSelectedIndex=-1,this._selectionMode=ListSelectionMode.Single,this.opaque=!0,this._align=AlignType.Left,this._verticalAlign=VertAlignType.Top}dispose(){this._partner.unschedule(this._refreshVirtualList),this._pool.clear(),super.dispose()}get layout(){return this._layout}set layout(t){this._layout!=t&&(this._layout=t,this.setBoundsChangedFlag(),this._virtual&&this.setVirtualListChangedFlag(!0))}get lineCount(){return this._lineCount}set lineCount(t){this._lineCount!=t&&(this._lineCount=t,this.setBoundsChangedFlag(),this._virtual&&this.setVirtualListChangedFlag(!0))}get columnCount(){return this._columnCount}set columnCount(t){this._columnCount!=t&&(this._columnCount=t,this.setBoundsChangedFlag(),this._virtual&&this.setVirtualListChangedFlag(!0))}get lineGap(){return this._lineGap}set lineGap(t){this._lineGap!=t&&(this._lineGap=t,this.setBoundsChangedFlag(),this._virtual&&this.setVirtualListChangedFlag(!0))}get columnGap(){return this._columnGap}set columnGap(t){this._columnGap!=t&&(this._columnGap=t,this.setBoundsChangedFlag(),this._virtual&&this.setVirtualListChangedFlag(!0))}get align(){return this._align}set align(t){this._align!=t&&(this._align=t,this.setBoundsChangedFlag(),this._virtual&&this.setVirtualListChangedFlag(!0))}get verticalAlign(){return this._verticalAlign}set verticalAlign(t){this._verticalAlign!=t&&(this._verticalAlign=t,this.setBoundsChangedFlag(),this._virtual&&this.setVirtualListChangedFlag(!0))}get virtualItemSize(){return this._itemSize}set virtualItemSize(t){this._virtual&&(null==this._itemSize&&(this._itemSize=new Size(0,0)),this._itemSize.width=t.width,this._itemSize.height=t.height,this.setVirtualListChangedFlag(!0))}get defaultItem(){return this._defaultItem}set defaultItem(t){this._defaultItem=UIPackage.normalizeURL(t)}get autoResizeItem(){return this._autoResizeItem}set autoResizeItem(t){this._autoResizeItem!=t&&(this._autoResizeItem=t,this.setBoundsChangedFlag(),this._virtual&&this.setVirtualListChangedFlag(!0))}get selectionMode(){return this._selectionMode}set selectionMode(t){this._selectionMode=t}get selectionController(){return this._selectionController}set selectionController(t){this._selectionController=t}get itemPool(){return this._pool}getFromPool(t){t||(t=this._defaultItem);var e=this._pool.getObject(t);return e&&(e.visible=!0),e}returnToPool(t){this._pool.returnObject(t)}addChildAt(t,e){return super.addChildAt(t,e),t instanceof GButton&&(t.selected=!1,t.changeStateOnClick=!1),t.on(FGUIEvent.CLICK,this.onClickItem,this),t}addItem(t){return t||(t=this._defaultItem),this.addChild(UIPackage.createObjectFromURL(t))}addItemFromPool(t){return this.addChild(this.getFromPool(t))}removeChildAt(t,e){var i=super.removeChildAt(t,e);return e||i.off(FGUIEvent.CLICK,this.onClickItem,this),i}removeChildToPoolAt(t){var e=super.removeChildAt(t);this.returnToPool(e)}removeChildToPool(t){super.removeChild(t),this.returnToPool(t)}removeChildrenToPool(t,e){null==t&&(t=0),null==e&&(e=-1),(e<0||e>=this._children.length)&&(e=this._children.length-1);for(var i=t;i<=e;++i)this.removeChildToPoolAt(t)}get selectedIndex(){var t;if(this._virtual)for(t=0;t<this._realNumItems;t++){var e=this._virtualItems[t];if(e.obj instanceof GButton&&e.obj.selected||!e.obj&&e.selected)return this._loop?t%this._numItems:t}else{var i=this._children.length;for(t=0;t<i;t++){var s=this._children[t];if(s instanceof GButton&&s.selected)return t}}return-1}set selectedIndex(t){t>=0&&t<this.numItems?(this._selectionMode!=ListSelectionMode.Single&&this.clearSelection(),this.addSelection(t)):this.clearSelection()}getSelection(t){var e;if(t||(t=new Array),this._virtual)for(e=0;e<this._realNumItems;e++){var i=this._virtualItems[e];if(i.obj instanceof GButton&&i.obj.selected||!i.obj&&i.selected){var s=e;if(this._loop&&(s=e%this._numItems,-1!=t.indexOf(s)))continue;t.push(s)}}else{var n=this._children.length;for(e=0;e<n;e++){var r=this._children[e];r instanceof GButton&&r.selected&&t.push(e)}}return t}addSelection(t,e){if(this._selectionMode!=ListSelectionMode.None){var i;if(this.checkVirtualList(),this._selectionMode==ListSelectionMode.Single&&this.clearSelection(),e&&this.scrollToView(t),this._lastSelectedIndex=t,this._virtual){var s=this._virtualItems[t];s.obj&&(i=s.obj),s.selected=!0}else i=this.getChildAt(t);i instanceof GButton&&!i.selected&&(i.selected=!0,this.updateSelectionController(t))}}removeSelection(t){if(this._selectionMode!=ListSelectionMode.None){var e;if(this._virtual){var i=this._virtualItems[t];i.obj&&(e=i.obj),i.selected=!1}else e=this.getChildAt(t);e instanceof GButton&&(e.selected=!1)}}clearSelection(){var t;if(this._virtual)for(t=0;t<this._realNumItems;t++){var e=this._virtualItems[t];e.obj instanceof GButton&&(e.obj.selected=!1),e.selected=!1}else{var i=this._children.length;for(t=0;t<i;t++){var s=this._children[t];s instanceof GButton&&(s.selected=!1)}}}clearSelectionExcept(t){var e;if(this._virtual)for(e=0;e<this._realNumItems;e++){var i=this._virtualItems[e];i.obj!=t&&(i.obj instanceof GButton&&(i.obj.selected=!1),i.selected=!1)}else{var s=this._children.length;for(e=0;e<s;e++){var n=this._children[e];n instanceof GButton&&n!=t&&(n.selected=!1)}}}selectAll(){this.checkVirtualList();var t,e=-1;if(this._virtual)for(t=0;t<this._realNumItems;t++){var i=this._virtualItems[t];i.obj instanceof GButton&&!i.obj.selected&&(i.obj.selected=!0,e=t),i.selected=!0}else{var s=this._children.length;for(t=0;t<s;t++){var n=this._children[t];n instanceof GButton&&!n.selected&&(n.selected=!0,e=t)}}-1!=e&&this.updateSelectionController(e)}selectNone(){this.clearSelection()}selectReverse(){this.checkVirtualList();var t,e=-1;if(this._virtual)for(t=0;t<this._realNumItems;t++){var i=this._virtualItems[t];i.obj instanceof GButton&&(i.obj.selected=!i.obj.selected,i.obj.selected&&(e=t)),i.selected=!i.selected}else{var s=this._children.length;for(t=0;t<s;t++){var n=this._children[t];n instanceof GButton&&(n.selected=!n.selected,n.selected&&(e=t))}}-1!=e&&this.updateSelectionController(e)}handleArrowKey(t){var e=this.selectedIndex;if(-1!=e)switch(t){case 1:if(this._layout==ListLayoutType.SingleColumn||this._layout==ListLayoutType.FlowVertical)--e>=0&&(this.clearSelection(),this.addSelection(e,!0));else if(this._layout==ListLayoutType.FlowHorizontal||this._layout==ListLayoutType.Pagination){for(var i=this._children[e],s=0,n=e-1;n>=0;n--){var r=this._children[n];if(r.y!=i.y){i=r;break}s++}for(;n>=0;n--)if((r=this._children[n]).y!=i.y){this.clearSelection(),this.addSelection(n+s+1,!0);break}}break;case 3:if(this._layout==ListLayoutType.SingleRow||this._layout==ListLayoutType.FlowHorizontal||this._layout==ListLayoutType.Pagination)++e<this._children.length&&(this.clearSelection(),this.addSelection(e,!0));else if(this._layout==ListLayoutType.FlowVertical){i=this._children[e],s=0;var o=this._children.length;for(n=e+1;n<o;n++){if((r=this._children[n]).x!=i.x){i=r;break}s++}for(;n<o;n++)if((r=this._children[n]).x!=i.x){this.clearSelection(),this.addSelection(n-s-1,!0);break}}break;case 5:if(this._layout==ListLayoutType.SingleColumn||this._layout==ListLayoutType.FlowVertical)++e<this._children.length&&(this.clearSelection(),this.addSelection(e,!0));else if(this._layout==ListLayoutType.FlowHorizontal||this._layout==ListLayoutType.Pagination){for(i=this._children[e],s=0,o=this._children.length,n=e+1;n<o;n++){if((r=this._children[n]).y!=i.y){i=r;break}s++}for(;n<o;n++)if((r=this._children[n]).y!=i.y){this.clearSelection(),this.addSelection(n-s-1,!0);break}}break;case 7:if(this._layout==ListLayoutType.SingleRow||this._layout==ListLayoutType.FlowHorizontal||this._layout==ListLayoutType.Pagination)--e>=0&&(this.clearSelection(),this.addSelection(e,!0));else if(this._layout==ListLayoutType.FlowVertical){for(i=this._children[e],s=0,n=e-1;n>=0;n--){if((r=this._children[n]).x!=i.x){i=r;break}s++}for(;n>=0;n--)if((r=this._children[n]).x!=i.x){this.clearSelection(),this.addSelection(n+s+1,!0);break}}}}onClickItem(t){if(!this._scrollPane||!this._scrollPane.isDragged){var e=GObject.cast(t.currentTarget);this.setSelectionOnEvent(e,t),this._scrollPane&&this.scrollItemToViewOnClick&&this._scrollPane.scrollToView(e,!0),this.dispatchItemEvent(e,t)}}dispatchItemEvent(t,e){this._node.emit(FGUIEvent.CLICK_ITEM,t,e)}setSelectionOnEvent(t,e){if(t instanceof GButton&&this._selectionMode!=ListSelectionMode.None){var i=!1,s=this.childIndexToItemIndex(this.getChildIndex(t));if(this._selectionMode==ListSelectionMode.Single)t.selected||(this.clearSelectionExcept(t),t.selected=!0);else if(e.isShiftDown){if(!t.selected)if(-1!=this._lastSelectedIndex){var n,r=Math.min(this._lastSelectedIndex,s),o=Math.max(this._lastSelectedIndex,s);if(o=Math.min(o,this.numItems-1),this._virtual)for(n=r;n<=o;n++){var h=this._virtualItems[n];h.obj instanceof GButton&&(h.obj.selected=!0),h.selected=!0}else for(n=r;n<=o;n++){var a=this.getChildAt(n);a instanceof GButton&&(a.selected=!0)}i=!0}else t.selected=!0}else e.isCtrlDown||this._selectionMode==ListSelectionMode.Multiple_SingleClick?t.selected=!t.selected:t.selected?this.clearSelectionExcept(t):(this.clearSelectionExcept(t),t.selected=!0);i||(this._lastSelectedIndex=s),t.selected&&this.updateSelectionController(s)}}resizeToFit(t=Number.POSITIVE_INFINITY,e=0){this.ensureBoundsCorrect();var i=this.numItems;if(t>i&&(t=i),this._virtual){var s=Math.ceil(t/this._curLineItemCount);this._layout==ListLayoutType.SingleColumn||this._layout==ListLayoutType.FlowHorizontal?this.viewHeight=s*this._itemSize.height+Math.max(0,s-1)*this._lineGap:this.viewWidth=s*this._itemSize.width+Math.max(0,s-1)*this._columnGap}else if(0==t)this._layout==ListLayoutType.SingleColumn||this._layout==ListLayoutType.FlowHorizontal?this.viewHeight=e:this.viewWidth=e;else{for(var n=t-1,r=null;n>=0&&(r=this.getChildAt(n),this.foldInvisibleItems&&!r.visible);)n--;if(n<0)this._layout==ListLayoutType.SingleColumn||this._layout==ListLayoutType.FlowHorizontal?this.viewHeight=e:this.viewWidth=e;else{var o=0;this._layout==ListLayoutType.SingleColumn||this._layout==ListLayoutType.FlowHorizontal?((o=r.y+r.height)<e&&(o=e),this.viewHeight=o):((o=r.x+r.width)<e&&(o=e),this.viewWidth=o)}}}getMaxItemWidth(){for(var t=this._children.length,e=0,i=0;i<t;i++){var s=this.getChildAt(i);s.width>e&&(e=s.width)}return e}handleSizeChanged(){super.handleSizeChanged(),this.setBoundsChangedFlag(),this._virtual&&this.setVirtualListChangedFlag(!0)}handleControllerChanged(t){super.handleControllerChanged(t),this._selectionController==t&&(this.selectedIndex=t.selectedIndex)}updateSelectionController(t){if(this._selectionController&&!this._selectionController.changing&&t<this._selectionController.pageCount){var e=this._selectionController;this._selectionController=null,e.selectedIndex=t,this._selectionController=e}}getSnappingPosition(t,e,i){var s,n;return this._virtual?(i=i||new Vec2,this._layout==ListLayoutType.SingleColumn||this._layout==ListLayoutType.FlowHorizontal?(s=e,s_n=e,n=this.getIndexOnPos1(!1),e=s_n,n<this._virtualItems.length&&s-e>this._virtualItems[n].height/2&&n<this._realNumItems&&(e+=this._virtualItems[n].height+this._lineGap)):this._layout==ListLayoutType.SingleRow||this._layout==ListLayoutType.FlowVertical?(s=t,s_n=t,n=this.getIndexOnPos2(!1),t=s_n,n<this._virtualItems.length&&s-t>this._virtualItems[n].width/2&&n<this._realNumItems&&(t+=this._virtualItems[n].width+this._columnGap)):(s=t,s_n=t,n=this.getIndexOnPos3(!1),t=s_n,n<this._virtualItems.length&&s-t>this._virtualItems[n].width/2&&n<this._realNumItems&&(t+=this._virtualItems[n].width+this._columnGap)),i.x=t,i.y=e,i):super.getSnappingPosition(t,e,i)}scrollToView(t,e,i){if(this._virtual){if(0==this._numItems)return;if(this.checkVirtualList(),t>=this._virtualItems.length)throw"Invalid child index: "+t+">"+this._virtualItems.length;var s;this._loop&&(t=Math.floor(this._firstIndex/this._numItems)*this._numItems+t);var n,r=this._virtualItems[t],o=0;if(this._layout==ListLayoutType.SingleColumn||this._layout==ListLayoutType.FlowHorizontal){for(n=this._curLineItemCount-1;n<t;n+=this._curLineItemCount)o+=this._virtualItems[n].height+this._lineGap;s=new Rect$1(0,o,this._itemSize.width,r.height)}else if(this._layout==ListLayoutType.SingleRow||this._layout==ListLayoutType.FlowVertical){for(n=this._curLineItemCount-1;n<t;n+=this._curLineItemCount)o+=this._virtualItems[n].width+this._columnGap;s=new Rect$1(o,0,r.width,this._itemSize.height)}else{var h=t/(this._curLineItemCount*this._curLineItemCount2);s=new Rect$1(h*this.viewWidth+t%this._curLineItemCount*(r.width+this._columnGap),t/this._curLineItemCount%this._curLineItemCount2*(r.height+this._lineGap),r.width,r.height)}this._scrollPane&&this._scrollPane.scrollToView(s,e,i)}else{var a=this.getChildAt(t);a&&(this._scrollPane?this._scrollPane.scrollToView(a,e,i):this.parent&&this.parent.scrollPane&&this.parent.scrollPane.scrollToView(a,e,i))}}getFirstChildInView(){return this.childIndexToItemIndex(super.getFirstChildInView())}childIndexToItemIndex(t){if(!this._virtual)return t;if(this._layout==ListLayoutType.Pagination){for(var e=this._firstIndex;e<this._realNumItems;e++)if(this._virtualItems[e].obj&&--t<0)return e;return t}return t+=this._firstIndex,this._loop&&this._numItems>0&&(t%=this._numItems),t}itemIndexToChildIndex(t){if(!this._virtual)return t;if(this._layout==ListLayoutType.Pagination)return this.getChildIndex(this._virtualItems[t].obj);if(this._loop&&this._numItems>0){var e=this._firstIndex%this._numItems;t>=e?t-=e:t=this._numItems-e+t}else t-=this._firstIndex;return t}setVirtual(){this._setVirtual(!1)}setVirtualAndLoop(){this._setVirtual(!0)}_setVirtual(t){if(!this._virtual){if(!this._scrollPane)throw"Virtual list must be scrollable!";if(t){if(this._layout==ListLayoutType.FlowHorizontal||this._layout==ListLayoutType.FlowVertical)throw"Loop list is not supported for FlowHorizontal or FlowVertical layout!";this._scrollPane.bouncebackEffect=!1}if(this._virtual=!0,this._loop=t,this._virtualItems=new Array,this.removeChildrenToPool(),null==this._itemSize){this._itemSize=new Size(0,0);var e=this.getFromPool(null);if(!e)throw"Virtual List must have a default list item resource.";this._itemSize.width=e.width,this._itemSize.height=e.height,this.returnToPool(e)}this._layout==ListLayoutType.SingleColumn||this._layout==ListLayoutType.FlowHorizontal?(this._scrollPane.scrollStep=this._itemSize.height,this._loop&&(this._scrollPane._loop=2)):(this._scrollPane.scrollStep=this._itemSize.width,this._loop&&(this._scrollPane._loop=1)),this._node.on(FGUIEvent.SCROLL,this.__scrolled,this),this.setVirtualListChangedFlag(!0)}}get numItems(){return this._virtual?this._numItems:this._children.length}set numItems(t){if(this._virtual){if(null==this.itemRenderer)throw"Set itemRenderer first!";this._numItems=t,this._loop?this._realNumItems=6*this._numItems:this._realNumItems=this._numItems;var e=this._virtualItems.length;if(this._realNumItems>e)for(n=e;n<this._realNumItems;n++){var i={width:this._itemSize.width,height:this._itemSize.height,updateFlag:0};this._virtualItems.push(i)}else for(n=this._realNumItems;n<e;n++)this._virtualItems[n].selected=!1;0!=this._virtualListChanged&&this._partner.unschedule(this._refreshVirtualList),this._refreshVirtualList()}else{var s=this._children.length;if(t>s)for(var n=s;n<t;n++)null==this.itemProvider?this.addItemFromPool():this.addItemFromPool(this.itemProvider(n));else this.removeChildrenToPool(t,s);if(null!=this.itemRenderer)for(n=0;n<t;n++)this.itemRenderer(n,this.getChildAt(n))}}refreshVirtualList(){this.setVirtualListChangedFlag(!1)}checkVirtualList(){0!=this._virtualListChanged&&(this._refreshVirtualList(),this._partner.unschedule(this._refreshVirtualList))}setVirtualListChangedFlag(t){t?this._virtualListChanged=2:0==this._virtualListChanged&&(this._virtualListChanged=1),this._partner.callLater(this._refreshVirtualList)}_refreshVirtualList(t){if(isNaN(t)){var e=2==this._virtualListChanged;this._virtualListChanged=0,this._eventLocked=!0,e&&(this._layout==ListLayoutType.SingleColumn||this._layout==ListLayoutType.SingleRow?this._curLineItemCount=1:this._layout==ListLayoutType.FlowHorizontal?this._columnCount>0?this._curLineItemCount=this._columnCount:(this._curLineItemCount=Math.floor((this._scrollPane.viewWidth+this._columnGap)/(this._itemSize.width+this._columnGap)),this._curLineItemCount<=0&&(this._curLineItemCount=1)):this._layout==ListLayoutType.FlowVertical?this._lineCount>0?this._curLineItemCount=this._lineCount:(this._curLineItemCount=Math.floor((this._scrollPane.viewHeight+this._lineGap)/(this._itemSize.height+this._lineGap)),this._curLineItemCount<=0&&(this._curLineItemCount=1)):(this._columnCount>0?this._curLineItemCount=this._columnCount:(this._curLineItemCount=Math.floor((this._scrollPane.viewWidth+this._columnGap)/(this._itemSize.width+this._columnGap)),this._curLineItemCount<=0&&(this._curLineItemCount=1)),this._lineCount>0?this._curLineItemCount2=this._lineCount:(this._curLineItemCount2=Math.floor((this._scrollPane.viewHeight+this._lineGap)/(this._itemSize.height+this._lineGap)),this._curLineItemCount2<=0&&(this._curLineItemCount2=1))));var i=0,s=0;if(this._realNumItems>0){var n,r=Math.ceil(this._realNumItems/this._curLineItemCount)*this._curLineItemCount,o=Math.min(this._curLineItemCount,this._realNumItems);if(this._layout==ListLayoutType.SingleColumn||this._layout==ListLayoutType.FlowHorizontal){for(n=0;n<r;n+=this._curLineItemCount)i+=this._virtualItems[n].height+this._lineGap;if(i>0&&(i-=this._lineGap),this._autoResizeItem)s=this._scrollPane.viewWidth;else{for(n=0;n<o;n++)s+=this._virtualItems[n].width+this._columnGap;s>0&&(s-=this._columnGap)}}else if(this._layout==ListLayoutType.SingleRow||this._layout==ListLayoutType.FlowVertical){for(n=0;n<r;n+=this._curLineItemCount)s+=this._virtualItems[n].width+this._columnGap;if(s>0&&(s-=this._columnGap),this._autoResizeItem)i=this._scrollPane.viewHeight;else{for(n=0;n<o;n++)i+=this._virtualItems[n].height+this._lineGap;i>0&&(i-=this._lineGap)}}else{s=Math.ceil(r/(this._curLineItemCount*this._curLineItemCount2))*this.viewWidth,i=this.viewHeight}}this.handleAlign(s,i),this._scrollPane.setContentSize(s,i),this._eventLocked=!1,this.handleScroll(!0)}else{GObject.cast(this.node)._refreshVirtualList()}}__scrolled(t){this.handleScroll(!1)}getIndexOnPos1(t){if(this._realNumItems<this._curLineItemCount)return s_n=0,0;var e,i,s;if(this.numChildren>0&&!t){if((i=this.getChildAt(0).y)>s_n){for(e=this._firstIndex-this._curLineItemCount;e>=0;e-=this._curLineItemCount)if((i-=this._virtualItems[e].height+this._lineGap)<=s_n)return s_n=i,e;return s_n=0,0}for(e=this._firstIndex;e<this._realNumItems;e+=this._curLineItemCount){if((s=i+this._virtualItems[e].height+this._lineGap)>s_n)return s_n=i,e;i=s}return s_n=i,this._realNumItems-this._curLineItemCount}for(i=0,e=0;e<this._realNumItems;e+=this._curLineItemCount){if((s=i+this._virtualItems[e].height+this._lineGap)>s_n)return s_n=i,e;i=s}return s_n=i,this._realNumItems-this._curLineItemCount}getIndexOnPos2(t){if(this._realNumItems<this._curLineItemCount)return s_n=0,0;var e,i,s;if(this.numChildren>0&&!t){if((i=this.getChildAt(0).x)>s_n){for(e=this._firstIndex-this._curLineItemCount;e>=0;e-=this._curLineItemCount)if((i-=this._virtualItems[e].width+this._columnGap)<=s_n)return s_n=i,e;return s_n=0,0}for(e=this._firstIndex;e<this._realNumItems;e+=this._curLineItemCount){if((s=i+this._virtualItems[e].width+this._columnGap)>s_n)return s_n=i,e;i=s}return s_n=i,this._realNumItems-this._curLineItemCount}for(i=0,e=0;e<this._realNumItems;e+=this._curLineItemCount){if((s=i+this._virtualItems[e].width+this._columnGap)>s_n)return s_n=i,e;i=s}return s_n=i,this._realNumItems-this._curLineItemCount}getIndexOnPos3(t){if(this._realNumItems<this._curLineItemCount)return s_n=0,0;var e,i,s=this.viewWidth,n=Math.floor(s_n/s),r=n*(this._curLineItemCount*this._curLineItemCount2),o=n*s;for(e=0;e<this._curLineItemCount;e++){if((i=o+this._virtualItems[r+e].width+this._columnGap)>s_n)return s_n=o,r+e;o=i}return s_n=o,r+this._curLineItemCount-1}handleScroll(t){if(!this._eventLocked){if(this._layout==ListLayoutType.SingleColumn||this._layout==ListLayoutType.FlowHorizontal){for(var e=0;this.handleScroll1(t);)if(t=!1,++e>20){console.log("FairyGUI: list will never be filled as the item renderer function always returns a different size.");break}this.handleArchOrder1()}else if(this._layout==ListLayoutType.SingleRow||this._layout==ListLayoutType.FlowVertical){for(e=0;this.handleScroll2(t);)if(t=!1,++e>20){console.log("FairyGUI: list will never be filled as the item renderer function always returns a different size.");break}this.handleArchOrder2()}else this.handleScroll3(t);this._boundsChanged=!1}}handleScroll1(t){var e=this._scrollPane.scrollingPosY,i=e+this._scrollPane.viewHeight,s=i==this._scrollPane.contentHeight;s_n=e;var n=this.getIndexOnPos1(t);if(e=s_n,n==this._firstIndex&&!t)return!1;var r=this._firstIndex;this._firstIndex=n;var o,h,a,l,_,d=n,c=r>n,u=this.numChildren,g=r+u-1,p=c?g:r,f=0,m=e,y=0,w=0,C=this._defaultItem,v=(this._scrollPane.viewWidth-this._columnGap*(this._curLineItemCount-1))/this._curLineItemCount;for(this.itemInfoVer++;d<this._realNumItems&&(s||m<i);){if((h=this._virtualItems[d]).obj&&!t||(null!=this.itemProvider&&(null==(C=this.itemProvider(d%this._numItems))&&(C=this._defaultItem),C=UIPackage.normalizeURL(C)),h.obj&&h.obj.resourceURL!=C&&(h.obj instanceof GButton&&(h.selected=h.obj.selected),this.removeChildToPool(h.obj),h.obj=null)),h.obj)o=t;else{if(c){for(_=p;_>=r;_--)if((a=this._virtualItems[_]).obj&&a.updateFlag!=this.itemInfoVer&&a.obj.resourceURL==C){a.obj instanceof GButton&&(a.selected=a.obj.selected),h.obj=a.obj,a.obj=null,_==p&&p--;break}}else for(_=p;_<=g;_++)if((a=this._virtualItems[_]).obj&&a.updateFlag!=this.itemInfoVer&&a.obj.resourceURL==C){a.obj instanceof GButton&&(a.selected=a.obj.selected),h.obj=a.obj,a.obj=null,_==p&&p++;break}h.obj?this.setChildIndex(h.obj,c?d-n:this.numChildren):(h.obj=this._pool.getObject(C),c?this.addChildAt(h.obj,d-n):this.addChild(h.obj)),h.obj instanceof GButton&&(h.obj.selected=h.selected),o=!0}o&&(this._autoResizeItem&&(this._layout==ListLayoutType.SingleColumn||this._columnCount>0)&&h.obj.setSize(v,h.obj.height,!0),this.itemRenderer(d%this._numItems,h.obj),d%this._curLineItemCount==0&&(y+=Math.ceil(h.obj.height)-h.height,d==n&&r>n&&(w=Math.ceil(h.obj.height)-h.height)),h.width=Math.ceil(h.obj.width),h.height=Math.ceil(h.obj.height)),h.updateFlag=this.itemInfoVer,h.obj.setPosition(f,m),d==n&&(i+=h.height),f+=h.width+this._columnGap,d%this._curLineItemCount==this._curLineItemCount-1&&(f=0,m+=h.height+this._lineGap),d++}for(l=0;l<u;l++)(h=this._virtualItems[r+l]).updateFlag!=this.itemInfoVer&&h.obj&&(h.obj instanceof GButton&&(h.selected=h.obj.selected),this.removeChildToPool(h.obj),h.obj=null);for(u=this._children.length,l=0;l<u;l++){let t=this._virtualItems[n+l].obj;this._children[l]!=t&&this.setChildIndex(t,l)}return 0==y&&0==w||this._scrollPane.changeContentSizeOnScrolling(0,y,0,w),d>0&&this.numChildren>0&&this._container.position.y<=0&&this.getChildAt(0).y>-this._container.position.y}handleScroll2(t){var e=this._scrollPane.scrollingPosX,i=e+this._scrollPane.viewWidth,s=e==this._scrollPane.contentWidth;s_n=e;var n=this.getIndexOnPos2(t);if(e=s_n,n==this._firstIndex&&!t)return!1;var r=this._firstIndex;this._firstIndex=n;var o,h,a,l,_,d=n,c=r>n,u=this.numChildren,g=r+u-1,p=c?g:r,f=e,m=0,y=0,w=0,C=this._defaultItem,v=(this._scrollPane.viewHeight-this._lineGap*(this._curLineItemCount-1))/this._curLineItemCount;for(this.itemInfoVer++;d<this._realNumItems&&(s||f<i);){if((h=this._virtualItems[d]).obj&&!t||(null!=this.itemProvider&&(null==(C=this.itemProvider(d%this._numItems))&&(C=this._defaultItem),C=UIPackage.normalizeURL(C)),h.obj&&h.obj.resourceURL!=C&&(h.obj instanceof GButton&&(h.selected=h.obj.selected),this.removeChildToPool(h.obj),h.obj=null)),h.obj)o=t;else{if(c){for(_=p;_>=r;_--)if((a=this._virtualItems[_]).obj&&a.updateFlag!=this.itemInfoVer&&a.obj.resourceURL==C){a.obj instanceof GButton&&(a.selected=a.obj.selected),h.obj=a.obj,a.obj=null,_==p&&p--;break}}else for(_=p;_<=g;_++)if((a=this._virtualItems[_]).obj&&a.updateFlag!=this.itemInfoVer&&a.obj.resourceURL==C){a.obj instanceof GButton&&(a.selected=a.obj.selected),h.obj=a.obj,a.obj=null,_==p&&p++;break}h.obj?this.setChildIndex(h.obj,c?d-n:this.numChildren):(h.obj=this._pool.getObject(C),c?this.addChildAt(h.obj,d-n):this.addChild(h.obj)),h.obj instanceof GButton&&(h.obj.selected=h.selected),o=!0}o&&(this._autoResizeItem&&(this._layout==ListLayoutType.SingleRow||this._lineCount>0)&&h.obj.setSize(h.obj.width,v,!0),this.itemRenderer(d%this._numItems,h.obj),d%this._curLineItemCount==0&&(y+=Math.ceil(h.obj.width)-h.width,d==n&&r>n&&(w=Math.ceil(h.obj.width)-h.width)),h.width=Math.ceil(h.obj.width),h.height=Math.ceil(h.obj.height)),h.updateFlag=this.itemInfoVer,h.obj.setPosition(f,m),d==n&&(i+=h.width),m+=h.height+this._lineGap,d%this._curLineItemCount==this._curLineItemCount-1&&(m=0,f+=h.width+this._columnGap),d++}for(l=0;l<u;l++)(h=this._virtualItems[r+l]).updateFlag!=this.itemInfoVer&&h.obj&&(h.obj instanceof GButton&&(h.selected=h.obj.selected),this.removeChildToPool(h.obj),h.obj=null);for(u=this._children.length,l=0;l<u;l++){let t=this._virtualItems[n+l].obj;this._children[l]!=t&&this.setChildIndex(t,l)}return 0==y&&0==w||this._scrollPane.changeContentSizeOnScrolling(y,0,w,0),d>0&&this.numChildren>0&&this._container.position.x<=0&&this.getChildAt(0).x>-this._container.position.x}handleScroll3(t){var e=this._scrollPane.scrollingPosX;s_n=e;var i=this.getIndexOnPos3(t);if(e=s_n,i!=this._firstIndex||t){var s=this._firstIndex;this._firstIndex=i;var n,r,o,h,a,l=s,_=this._virtualItems.length,d=this._curLineItemCount*this._curLineItemCount2,c=i%this._curLineItemCount,u=this.viewWidth,g=Math.floor(i/d)*d,p=g+2*d,f=this._defaultItem,m=(this._scrollPane.viewWidth-this._columnGap*(this._curLineItemCount-1))/this._curLineItemCount,y=(this._scrollPane.viewHeight-this._lineGap*(this._curLineItemCount2-1))/this._curLineItemCount2;for(this.itemInfoVer++,r=g;r<p;r++)if(!(r>=this._realNumItems)){if(a=r%this._curLineItemCount,r-g<d){if(a<c)continue}else if(a>c)continue;(o=this._virtualItems[r]).updateFlag=this.itemInfoVer}var w=null,C=0;for(r=g;r<p;r++)if(!(r>=this._realNumItems)&&(o=this._virtualItems[r]).updateFlag==this.itemInfoVer){if(o.obj)n=t,C=-1,w=o.obj;else{for(;l<_;){if((h=this._virtualItems[l]).obj&&h.updateFlag!=this.itemInfoVer){h.obj instanceof GButton&&(h.selected=h.obj.selected),o.obj=h.obj,h.obj=null;break}l++}-1==C&&(C=this.getChildIndex(w)+1),o.obj?C=this.setChildIndexBefore(o.obj,C):(null!=this.itemProvider&&(null==(f=this.itemProvider(r%this._numItems))&&(f=this._defaultItem),f=UIPackage.normalizeURL(f)),o.obj=this._pool.getObject(f),this.addChildAt(o.obj,C)),C++,o.obj instanceof GButton&&(o.obj.selected=o.selected),n=!0}n&&(this._autoResizeItem&&(this._curLineItemCount==this._columnCount&&this._curLineItemCount2==this._lineCount?o.obj.setSize(m,y,!0):this._curLineItemCount==this._columnCount?o.obj.setSize(m,o.obj.height,!0):this._curLineItemCount2==this._lineCount&&o.obj.setSize(o.obj.width,y,!0)),this.itemRenderer(r%this._numItems,o.obj),o.width=Math.ceil(o.obj.width),o.height=Math.ceil(o.obj.height))}var v=g/d*u,S=v,I=0,b=0;for(r=g;r<p;r++)r>=this._realNumItems||((o=this._virtualItems[r]).updateFlag==this.itemInfoVer&&o.obj.setPosition(S,I),o.height>b&&(b=o.height),r%this._curLineItemCount==this._curLineItemCount-1?(S=v,I+=b+this._lineGap,b=0,r==g+d-1&&(S=v+=u,I=0)):S+=o.width+this._columnGap);for(r=l;r<_;r++)(o=this._virtualItems[r]).updateFlag!=this.itemInfoVer&&o.obj&&(o.obj instanceof GButton&&(o.selected=o.obj.selected),this.removeChildToPool(o.obj),o.obj=null)}}handleArchOrder1(){if(this._childrenRenderOrder==ChildrenRenderOrder.Arch){for(var t=this._scrollPane.posY+this.viewHeight/2,e=Number.POSITIVE_INFINITY,i=0,s=0,n=this.numChildren,r=0;r<n;r++){var o=this.getChildAt(r);this.foldInvisibleItems&&!o.visible||(i=Math.abs(t-o.y-o.height/2))<e&&(e=i,s=r)}this.apexIndex=s}}handleArchOrder2(){if(this._childrenRenderOrder==ChildrenRenderOrder.Arch){for(var t=this._scrollPane.posX+this.viewWidth/2,e=Number.POSITIVE_INFINITY,i=0,s=0,n=this.numChildren,r=0;r<n;r++){var o=this.getChildAt(r);this.foldInvisibleItems&&!o.visible||(i=Math.abs(t-o.x-o.width/2))<e&&(e=i,s=r)}this.apexIndex=s}}handleAlign(t,e){var i=0,s=0;e<this.viewHeight&&(this._verticalAlign==VertAlignType.Middle?s=Math.floor((this.viewHeight-e)/2):this._verticalAlign==VertAlignType.Bottom&&(s=this.viewHeight-e)),t<this.viewWidth&&(this._align==AlignType.Center?i=Math.floor((this.viewWidth-t)/2):this._align==AlignType.Right&&(i=this.viewWidth-t)),i==this._alignOffset.x&&s==this._alignOffset.y||(this._alignOffset.x=i,this._alignOffset.y=s,this._scrollPane?this._scrollPane.adjustMaskContainer():this._container.setPosition(this._pivotCorrectX+this._alignOffset.x,this._pivotCorrectY-this._alignOffset.y))}updateBounds(){if(!this._virtual){var t,e,i=0,s=0,n=0,r=0,o=0,h=0,a=0,l=0,_=0,d=this._children.length,c=this.viewWidth,u=this.viewHeight,g=0,p=0,f=0;if(this._layout==ListLayoutType.SingleColumn){for(t=0;t<d;t++)e=this.getChildAt(t),this.foldInvisibleItems&&!e.visible||(0!=s&&(s+=this._lineGap),e.y=s,this._autoResizeItem&&e.setSize(c,e.height,!0),s+=Math.ceil(e.height),e.width>n&&(n=e.width));if((h=s)<=u&&this._autoResizeItem&&this._scrollPane&&this._scrollPane._displayInDemand&&this._scrollPane.vtScrollBar)for(c+=this._scrollPane.vtScrollBar.width,t=0;t<d;t++)e=this.getChildAt(t),this.foldInvisibleItems&&!e.visible||(e.setSize(c,e.height,!0),e.width>n&&(n=e.width));o=Math.ceil(n)}else if(this._layout==ListLayoutType.SingleRow){for(t=0;t<d;t++)e=this.getChildAt(t),this.foldInvisibleItems&&!e.visible||(0!=i&&(i+=this._columnGap),e.x=i,this._autoResizeItem&&e.setSize(e.width,u,!0),i+=Math.ceil(e.width),e.height>r&&(r=e.height));if((o=i)<=c&&this._autoResizeItem&&this._scrollPane&&this._scrollPane._displayInDemand&&this._scrollPane.hzScrollBar)for(u+=this._scrollPane.hzScrollBar.height,t=0;t<d;t++)e=this.getChildAt(t),this.foldInvisibleItems&&!e.visible||(e.setSize(e.width,u,!0),e.height>r&&(r=e.height));h=Math.ceil(r)}else if(this._layout==ListLayoutType.FlowHorizontal)if(this._autoResizeItem&&this._columnCount>0){for(t=0;t<d;t++)if(e=this.getChildAt(t),(!this.foldInvisibleItems||e.visible)&&(g+=e.sourceWidth,++a==this._columnCount||t==d-1)){for(f=(c-g-(a-1)*this._columnGap)/g,i=0,a=p;a<=t;a++)e=this.getChildAt(a),this.foldInvisibleItems&&!e.visible||(e.setPosition(i,s),a<t?(e.setSize(e.sourceWidth+Math.round(e.sourceWidth*f),e.height,!0),i+=Math.ceil(e.width)+this._columnGap):e.setSize(c-i,e.height,!0),e.height>r&&(r=e.height));s+=Math.ceil(r)+this._lineGap,r=0,a=0,p=t+1,g=0}h=s+Math.ceil(r),o=c}else{for(t=0;t<d;t++)e=this.getChildAt(t),this.foldInvisibleItems&&!e.visible||(0!=i&&(i+=this._columnGap),(0!=this._columnCount&&a>=this._columnCount||0==this._columnCount&&i+e.width>c&&0!=r)&&(i=0,s+=Math.ceil(r)+this._lineGap,r=0,a=0),e.setPosition(i,s),(i+=Math.ceil(e.width))>n&&(n=i),e.height>r&&(r=e.height),a++);h=s+Math.ceil(r),o=Math.ceil(n)}else if(this._layout==ListLayoutType.FlowVertical)if(this._autoResizeItem&&this._lineCount>0){for(t=0;t<d;t++)if(e=this.getChildAt(t),(!this.foldInvisibleItems||e.visible)&&(g+=e.sourceHeight,++a==this._lineCount||t==d-1)){for(f=(u-g-(a-1)*this._lineGap)/g,s=0,a=p;a<=t;a++)e=this.getChildAt(a),this.foldInvisibleItems&&!e.visible||(e.setPosition(i,s),a<t?(e.setSize(e.width,e.sourceHeight+Math.round(e.sourceHeight*f),!0),s+=Math.ceil(e.height)+this._lineGap):e.setSize(e.width,u-s,!0),e.width>n&&(n=e.width));i+=Math.ceil(n)+this._columnGap,n=0,a=0,p=t+1,g=0}o=i+Math.ceil(n),h=u}else{for(t=0;t<d;t++)e=this.getChildAt(t),this.foldInvisibleItems&&!e.visible||(0!=s&&(s+=this._lineGap),(0!=this._lineCount&&a>=this._lineCount||0==this._lineCount&&s+e.height>u&&0!=n)&&(s=0,i+=Math.ceil(n)+this._columnGap,n=0,a=0),e.setPosition(i,s),(s+=Math.ceil(e.height))>r&&(r=s),e.width>n&&(n=e.width),a++);o=i+Math.ceil(n),h=Math.ceil(r)}else{var m;if(this._autoResizeItem&&this._lineCount>0&&(m=Math.floor((u-(this._lineCount-1)*this._lineGap)/this._lineCount)),this._autoResizeItem&&this._columnCount>0){for(t=0;t<d;t++)if(e=this.getChildAt(t),(!this.foldInvisibleItems||e.visible)&&(0==a&&(0!=this._lineCount&&_>=this._lineCount||0==this._lineCount&&s+(this._lineCount>0?m:e.height)>u)&&(l++,s=0,_=0),g+=e.sourceWidth,++a==this._columnCount||t==d-1)){for(f=(c-g-(a-1)*this._columnGap)/g,i=0,a=p;a<=t;a++)e=this.getChildAt(a),this.foldInvisibleItems&&!e.visible||(e.setPosition(l*c+i,s),a<t?(e.setSize(e.sourceWidth+Math.round(e.sourceWidth*f),this._lineCount>0?m:e.height,!0),i+=Math.ceil(e.width)+this._columnGap):e.setSize(c-i,this._lineCount>0?m:e.height,!0),e.height>r&&(r=e.height));s+=Math.ceil(r)+this._lineGap,r=0,a=0,p=t+1,g=0,_++}}else for(t=0;t<d;t++)e=this.getChildAt(t),this.foldInvisibleItems&&!e.visible||(0!=i&&(i+=this._columnGap),this._autoResizeItem&&this._lineCount>0&&e.setSize(e.width,m,!0),(0!=this._columnCount&&a>=this._columnCount||0==this._columnCount&&i+e.width>c&&0!=r)&&(i=0,s+=Math.ceil(r)+this._lineGap,r=0,a=0,_++,(0!=this._lineCount&&_>=this._lineCount||0==this._lineCount&&s+e.height>u&&0!=n)&&(l++,s=0,_=0)),e.setPosition(l*c+i,s),(i+=Math.ceil(e.width))>n&&(n=i),e.height>r&&(r=e.height),a++);h=l>0?u:s+Math.ceil(r),o=(l+1)*c}this.handleAlign(o,h),this.setBounds(0,0,o,h)}}setup_beforeAdd(t,e){super.setup_beforeAdd(t,e),t.seek(e,5),this._layout=t.readByte(),this._selectionMode=t.readByte(),this._align=t.readByte(),this._verticalAlign=t.readByte(),this._lineGap=t.readShort(),this._columnGap=t.readShort(),this._lineCount=t.readShort(),this._columnCount=t.readShort(),this._autoResizeItem=t.readBool(),this._childrenRenderOrder=t.readByte(),this._apexIndex=t.readShort(),t.readBool()&&(this._margin.top=t.readInt(),this._margin.bottom=t.readInt(),this._margin.left=t.readInt(),this._margin.right=t.readInt());var i=t.readByte();if(i==OverflowType.Scroll){var s=t.position;t.seek(e,7),this.setupScroll(t),t.position=s}else this.setupOverflow(i);t.readBool()&&t.skip(8),t.version>=2&&(this.scrollItemToViewOnClick=t.readBool(),this.foldInvisibleItems=t.readBool()),t.seek(e,8),this._defaultItem=t.readS(),this.readItems(t)}readItems(t){var e,i,s,n;for(e=t.readShort(),i=0;i<e;i++)if(s=t.readShort(),s+=t.position,null!=(n=t.readS())||(n=this._defaultItem)){var r=this.getFromPool(n);r&&(this.addChild(r),this.setupItem(t,r)),t.position=s}else t.position=s}setupItem(t,e){var i,s,n;if(null!=(i=t.readS())&&(e.text=i),null!=(i=t.readS())&&e instanceof GButton&&(e.selectedTitle=i),null!=(i=t.readS())&&(e.icon=i),null!=(i=t.readS())&&e instanceof GButton&&(e.selectedIcon=i),null!=(i=t.readS())&&(e.name=i),e instanceof GComponent){for(s=t.readShort(),n=0;n<s;n++){var r=e.getController(t.readS());i=t.readS(),r&&(r.selectedPageId=i)}if(t.version>=2)for(s=t.readShort(),n=0;n<s;n++){var o=t.readS(),h=t.readShort(),a=t.readS(),l=e.getChildByPath(o);l&&l.setProp(h,a)}}}setup_afterAdd(t,e){super.setup_afterAdd(t,e),t.seek(e,6);var i=t.readShort();-1!=i&&(this._selectionController=this.parent.getControllerAt(i))}}var s_n=0;class GComboBox extends GComponent{constructor(){super(),this._visibleItemCount=0,this._selectedIndex=0,this._popupDirection=PopupDirection.Auto,this._node.name="GComboBox",this._visibleItemCount=UIConfig.defaultComboBoxVisibleItemCount,this._itemsUpdated=!0,this._selectedIndex=-1,this._items=[],this._values=[]}get text(){return this._titleObject?this._titleObject.text:null}set text(t){this._titleObject&&(this._titleObject.text=t),this.updateGear(6)}get icon(){return this._iconObject?this._iconObject.icon:null}set icon(t){this._iconObject&&(this._iconObject.icon=t),this.updateGear(7)}get titleColor(){var t=this.getTextField();return t?t.color:Color.BLACK}set titleColor(t){var e=this.getTextField();e&&(e.color=t)}get titleFontSize(){var t=this.getTextField();return t?t.fontSize:0}set titleFontSize(t){var e=this.getTextField();e&&(e.fontSize=t)}get visibleItemCount(){return this._visibleItemCount}set visibleItemCount(t){this._visibleItemCount=t}get popupDirection(){return this._popupDirection}set popupDirection(t){this._popupDirection=t}get items(){return this._items}set items(t){t?this._items=t.concat():this._items.length=0,this._items.length>0?(this._selectedIndex>=this._items.length?this._selectedIndex=this._items.length-1:-1==this._selectedIndex&&(this._selectedIndex=0),this.text=this._items[this._selectedIndex],this._icons&&this._selectedIndex<this._icons.length&&(this.icon=this._icons[this._selectedIndex])):(this.text="",this._icons&&(this.icon=null),this._selectedIndex=-1),this._itemsUpdated=!0}get icons(){return this._icons}set icons(t){this._icons=t,this._icons&&-1!=this._selectedIndex&&this._selectedIndex<this._icons.length&&(this.icon=this._icons[this._selectedIndex])}get values(){return this._values}set values(t){t?this._values=t.concat():this._values.length=0}get selectedIndex(){return this._selectedIndex}set selectedIndex(t){this._selectedIndex!=t&&(this._selectedIndex=t,this._selectedIndex>=0&&this._selectedIndex<this._items.length?(this.text=this._items[this._selectedIndex],this._icons&&this._selectedIndex<this._icons.length&&(this.icon=this._icons[this._selectedIndex])):(this.text="",this._icons&&(this.icon=null)),this.updateSelectionController())}get value(){return this._values[this._selectedIndex]}set value(t){var e=this._values.indexOf(t);-1==e&&null==t&&(e=this._values.indexOf("")),this.selectedIndex=e}get selectionController(){return this._selectionController}set selectionController(t){this._selectionController=t}getTextField(){return this._titleObject instanceof GTextField?this._titleObject:"getTextField"in this._titleObject?this._titleObject.getTextField():null}setState(t){this._buttonController&&(this._buttonController.selectedPage=t)}getProp(t){switch(t){case ObjectPropID.Color:return this.titleColor;case ObjectPropID.OutlineColor:var e=this.getTextField();return e?e.strokeColor:0;case ObjectPropID.FontSize:return(e=this.getTextField())?e.fontSize:0;default:return super.getProp(t)}}setProp(t,e){switch(t){case ObjectPropID.Color:this.titleColor=e;break;case ObjectPropID.OutlineColor:var i=this.getTextField();i&&(i.strokeColor=e);break;case ObjectPropID.FontSize:(i=this.getTextField())&&(i.fontSize=e);break;default:super.setProp(t,e)}}constructExtension(t){var e;if(this._buttonController=this.getController("button"),this._titleObject=this.getChild("title"),this._iconObject=this.getChild("icon"),e=t.readS()){let t=UIPackage.createObjectFromURL(e);if(!(t instanceof GComponent))return void console.error("下拉框必须为元件");if(this.dropdown=t,this.dropdown.name="this.dropdown",this._list=this.dropdown.getChild("list",GList),null==this._list)return void console.error(this.resourceURL+": 下拉框的弹出元件里必须包含名为list的列表");this._list.on(FGUIEvent.CLICK_ITEM,this.onClickItem,this),this._list.addRelation(this.dropdown,RelationType.Width),this._list.removeRelation(this.dropdown,RelationType.Height),this.dropdown.addRelation(this._list,RelationType.Height),this.dropdown.removeRelation(this._list,RelationType.Width),this.dropdown.on(FGUIEvent.UNDISPLAY,this.onPopupClosed,this)}this._node.on(FGUIEvent.TOUCH_BEGIN,this.onTouchBegin_1,this),this._node.on(FGUIEvent.TOUCH_END,this.onTouchEnd_1,this),this._node.on(FGUIEvent.ROLL_OVER,this.onRollOver_1,this),this._node.on(FGUIEvent.ROLL_OUT,this.onRollOut_1,this)}handleControllerChanged(t){super.handleControllerChanged(t),this._selectionController==t&&(this.selectedIndex=t.selectedIndex)}updateSelectionController(){if(this._selectionController&&!this._selectionController.changing&&this._selectedIndex<this._selectionController.pageCount){var t=this._selectionController;this._selectionController=null,t.selectedIndex=this._selectedIndex,this._selectionController=t}}dispose(){this.dropdown&&(this.dropdown.dispose(),this.dropdown=null),super.dispose()}setup_afterAdd(t,e){if(super.setup_afterAdd(t,e),t.seek(e,6)&&t.readByte()==this.packageItem.objectType){var i,s,n,r,o=t.readShort();for(i=0;i<o;i++)n=t.readShort(),n+=t.position,this._items[i]=t.readS(),this._values[i]=t.readS(),null!=(r=t.readS())&&(null==this._icons&&(this._icons=new Array),this._icons[i]=r),t.position=n;null!=(r=t.readS())?(this.text=r,this._selectedIndex=this._items.indexOf(r)):this._items.length>0?(this._selectedIndex=0,this.text=this._items[0]):this._selectedIndex=-1,null!=(r=t.readS())&&(this.icon=r),t.readBool()&&(this.titleColor=t.readColor()),(s=t.readInt())>0&&(this._visibleItemCount=s),this._popupDirection=t.readByte(),(s=t.readShort())>=0&&(this._selectionController=this.parent.getControllerAt(s))}}showDropdown(){if(this._itemsUpdated){this._itemsUpdated=!1,this._list.removeChildrenToPool();for(var t=this._items.length,e=0;e<t;e++){var i=this._list.addItemFromPool();i.name=e<this._values.length?this._values[e]:"",i.text=this._items[e],i.icon=this._icons&&e<this._icons.length?this._icons[e]:null}this._list.resizeToFit(this._visibleItemCount)}this._list.selectedIndex=-1,this.dropdown.width=this.width,this._list.ensureBoundsCorrect(),GRoot.inst.togglePopup(this.dropdown,this,this._popupDirection),this.dropdown.parent&&this.setState(GButton.DOWN)}onPopupClosed(){this._over?this.setState(GButton.OVER):this.setState(GButton.UP)}onClickItem(t){let e=this,i=this._list.getChildIndex(t);this._partner.callLater(t=>{e.onClickItem2(i)},.1)}onClickItem2(t){this.dropdown.parent instanceof GRoot&&this.dropdown.parent.hidePopup(),this._selectedIndex=-1,this.selectedIndex=t,this._node.emit(FGUIEvent.STATUS_CHANGED,this)}onRollOver_1(){this._over=!0,this._down||this.dropdown&&this.dropdown.parent||this.setState(GButton.OVER)}onRollOut_1(){this._over=!1,this._down||this.dropdown&&this.dropdown.parent||this.setState(GButton.UP)}onTouchBegin_1(t){t.button==EventMouse.BUTTON_LEFT&&(t.initiator instanceof GTextInput&&t.initiator.editable||(this._down=!0,t.captureTouch(),this.dropdown&&this.showDropdown()))}onTouchEnd_1(t){t.button==EventMouse.BUTTON_LEFT&&this._down&&(this._down=!1,this.dropdown&&!this.dropdown.parent&&(this._over?this.setState(GButton.OVER):this.setState(GButton.UP)))}}class GSlider extends GComponent{constructor(){super(),this._min=0,this._max=0,this._value=0,this._barMaxWidth=0,this._barMaxHeight=0,this._barMaxWidthDelta=0,this._barMaxHeightDelta=0,this._clickPercent=0,this._barStartX=0,this._barStartY=0,this.changeOnClick=!0,this.canDrag=!0,this._node.name="GSlider",this._titleType=ProgressTitleType.Percent,this._value=50,this._max=100,this._clickPos=new Vec2}get titleType(){return this._titleType}set titleType(t){this._titleType=t}get wholeNumbers(){return this._wholeNumbers}set wholeNumbers(t){this._wholeNumbers!=t&&(this._wholeNumbers=t,this.update())}get min(){return this._min}set min(t){this._min!=t&&(this._min=t,this.update())}get max(){return this._max}set max(t){this._max!=t&&(this._max=t,this.update())}get value(){return this._value}set value(t){this._value!=t&&(this._value=t,this.update())}update(){this.updateWithPercent((this._value-this._min)/(this._max-this._min))}updateWithPercent(t,e){if(t=math.clamp01(t),e){var i=math.clamp(this._min+(this._max-this._min)*t,this._min,this._max);this._wholeNumbers&&(i=Math.round(i),t=math.clamp01((i-this._min)/(this._max-this._min))),i!=this._value&&(this._value=i,this._node.emit(FGUIEvent.STATUS_CHANGED,this))}if(this._titleObject)switch(this._titleType){case ProgressTitleType.Percent:this._titleObject.text=Math.floor(100*t)+"%";break;case ProgressTitleType.ValueAndMax:this._titleObject.text=this._value+"/"+this._max;break;case ProgressTitleType.Value:this._titleObject.text=""+this._value;break;case ProgressTitleType.Max:this._titleObject.text=""+this._max}var s=this.width-this._barMaxWidthDelta,n=this.height-this._barMaxHeightDelta;this._reverse?(this._barObjectH&&(this._barObjectH.width=Math.round(s*t),this._barObjectH.x=this._barStartX+(s-this._barObjectH.width)),this._barObjectV&&(this._barObjectV.height=Math.round(n*t),this._barObjectV.y=this._barStartY+(n-this._barObjectV.height))):(this._barObjectH&&(this._barObjectH.width=Math.round(s*t)),this._barObjectV&&(this._barObjectV.height=Math.round(n*t)))}constructExtension(t){t.seek(0,6),this._titleType=t.readByte(),this._reverse=t.readBool(),t.version>=2&&(this._wholeNumbers=t.readBool(),this.changeOnClick=t.readBool()),this._titleObject=this.getChild("title"),this._barObjectH=this.getChild("bar"),this._barObjectV=this.getChild("bar_v"),this._gripObject=this.getChild("grip"),this._barObjectH&&(this._barMaxWidth=this._barObjectH.width,this._barMaxWidthDelta=this.width-this._barMaxWidth,this._barStartX=this._barObjectH.x),this._barObjectV&&(this._barMaxHeight=this._barObjectV.height,this._barMaxHeightDelta=this.height-this._barMaxHeight,this._barStartY=this._barObjectV.y),this._gripObject&&(this._gripObject.on(FGUIEvent.TOUCH_BEGIN,this.onGripTouchBegin,this),this._gripObject.on(FGUIEvent.TOUCH_MOVE,this.onGripTouchMove,this)),this._node.on(FGUIEvent.TOUCH_BEGIN,this.onBarTouchBegin,this)}handleSizeChanged(){super.handleSizeChanged(),this._barObjectH&&(this._barMaxWidth=this.width-this._barMaxWidthDelta),this._barObjectV&&(this._barMaxHeight=this.height-this._barMaxHeightDelta),this._underConstruct||this.update()}setup_afterAdd(t,e){super.setup_afterAdd(t,e),t.seek(e,6)&&t.readByte()==this.packageItem.objectType?(this._value=t.readInt(),this._max=t.readInt(),t.version>=2&&(this._min=t.readInt()),this.update()):this.update()}onGripTouchBegin(t){this.canDrag=!0,t.propagationStopped=!0,t.captureTouch(),this._clickPos=this.globalToLocal(t.pos.x,t.pos.y),this._clickPercent=math.clamp01((this._value-this._min)/(this._max-this._min))}onGripTouchMove(t){if(this.canDrag){var e,i=this.globalToLocal(t.pos.x,t.pos.y,s_vec2$1),s=i.x-this._clickPos.x,n=i.y-this._clickPos.y;this._reverse&&(s=-s,n=-n),e=this._barObjectH?this._clickPercent+s/this._barMaxWidth:this._clickPercent+n/this._barMaxHeight,this.updateWithPercent(e,!0)}}onBarTouchBegin(t){if(this.changeOnClick){var e=this._gripObject.globalToLocal(t.pos.x,t.pos.y,s_vec2$1),i=math.clamp01((this._value-this._min)/(this._max-this._min)),s=0;null!=this._barObjectH&&(s=(e.x-this._gripObject.width/2)/this._barMaxWidth),null!=this._barObjectV&&(s=(e.y-this._gripObject.height/2)/this._barMaxHeight),this._reverse?i-=s:i+=s,this.updateWithPercent(i,!0)}}}var s_vec2$1=new Vec2;class GProgressBar extends GComponent{constructor(){super(),this._min=0,this._max=0,this._value=0,this._barMaxWidth=0,this._barMaxHeight=0,this._barMaxWidthDelta=0,this._barMaxHeightDelta=0,this._barStartX=0,this._barStartY=0,this._node.name="GProgressBar",this._titleType=ProgressTitleType.Percent,this._value=50,this._max=100}get titleType(){return this._titleType}set titleType(t){this._titleType!=t&&(this._titleType=t,this.update(this._value))}get min(){return this._min}set min(t){this._min!=t&&(this._min=t,this.update(this._value))}get max(){return this._max}set max(t){this._max!=t&&(this._max=t,this.update(this._value))}get value(){return this._value}set value(t){this._value!=t&&(GTween.kill(this,!1,this.update),this._value=t,this.update(t))}tweenValue(t,e){var i,s=GTween.getTween(this,this.update);return s?(i=s.value.x,s.kill()):i=this._value,this._value=t,GTween.to(i,this._value,e).setTarget(this,this.update).setEase(EaseType.Linear)}update(t){var e=math.clamp01((t-this._min)/(this._max-this._min));if(this._titleObject)switch(this._titleType){case ProgressTitleType.Percent:this._titleObject.text=Math.floor(100*e)+"%";break;case ProgressTitleType.ValueAndMax:this._titleObject.text=Math.floor(t)+"/"+Math.floor(this._max);break;case ProgressTitleType.Value:this._titleObject.text=""+Math.floor(t);break;case ProgressTitleType.Max:this._titleObject.text=""+Math.floor(this._max)}var i=this.width-this._barMaxWidthDelta,s=this.height-this._barMaxHeightDelta;this._reverse?(this._barObjectH&&(this.setFillAmount(this._barObjectH,1-e)||(this._barObjectH.width=Math.round(i*e),this._barObjectH.x=this._barStartX+(i-this._barObjectH.width))),this._barObjectV&&(this.setFillAmount(this._barObjectV,1-e)||(this._barObjectV.height=Math.round(s*e),this._barObjectV.y=this._barStartY+(s-this._barObjectV.height)))):(this._barObjectH&&(this.setFillAmount(this._barObjectH,e)||(this._barObjectH.width=Math.round(i*e))),this._barObjectV&&(this.setFillAmount(this._barObjectV,e)||(this._barObjectV.height=Math.round(s*e)))),this._aniObject&&this._aniObject.setProp(ObjectPropID.Frame,Math.floor(100*e))}setFillAmount(t,e){return(t instanceof GImage||t instanceof GLoader)&&t.fillMethod!=FillMethod.None&&(t.fillAmount=e,!0)}constructExtension(t){t.seek(0,6),this._titleType=t.readByte(),this._reverse=t.readBool(),this._titleObject=this.getChild("title"),this._barObjectH=this.getChild("bar"),this._barObjectV=this.getChild("bar_v"),this._aniObject=this.getChild("ani"),this._barObjectH&&(this._barMaxWidth=this._barObjectH.width,this._barMaxWidthDelta=this.width-this._barMaxWidth,this._barStartX=this._barObjectH.x),this._barObjectV&&(this._barMaxHeight=this._barObjectV.height,this._barMaxHeightDelta=this.height-this._barMaxHeight,this._barStartY=this._barObjectV.y)}handleSizeChanged(){super.handleSizeChanged(),this._barObjectH&&(this._barMaxWidth=this.width-this._barMaxWidthDelta),this._barObjectV&&(this._barMaxHeight=this.height-this._barMaxHeightDelta),this._underConstruct||this.update(this._value)}setup_afterAdd(t,e){super.setup_afterAdd(t,e),t.seek(e,6)&&t.readByte()==this.packageItem.objectType?(this._value=t.readInt(),this._max=t.readInt(),t.version>=2&&(this._min=t.readInt()),this.update(this._value)):this.update(this._value)}}class GScrollBar extends GComponent{constructor(){super(),this._node.name="GScrollBar",this._dragOffset=new Vec2,this._scrollPerc=0}setScrollPane(t,e){this._target=t,this._vertical=e}setDisplayPerc(t){this._vertical?(this._fixedGripSize||(this._grip.height=Math.floor(t*this._bar.height)),this._grip.y=this._bar.y+(this._bar.height-this._grip.height)*this._scrollPerc):(this._fixedGripSize||(this._grip.width=Math.floor(t*this._bar.width)),this._grip.x=this._bar.x+(this._bar.width-this._grip.width)*this._scrollPerc),this._grip.visible=0!=t&&1!=t}setScrollPerc(t){this._scrollPerc=t,this._vertical?this._grip.y=this._bar.y+(this._bar.height-this._grip.height)*this._scrollPerc:this._grip.x=this._bar.x+(this._bar.width-this._grip.width)*this._scrollPerc}get minSize(){return this._vertical?(this._arrowButton1?this._arrowButton1.height:0)+(this._arrowButton2?this._arrowButton2.height:0):(this._arrowButton1?this._arrowButton1.width:0)+(this._arrowButton2?this._arrowButton2.width:0)}get gripDragging(){return this._gripDragging}constructExtension(t){t.seek(0,6),this._fixedGripSize=t.readBool(),this._grip=this.getChild("grip"),this._grip?(this._bar=this.getChild("bar"),this._bar?(this._arrowButton1=this.getChild("arrow1"),this._arrowButton2=this.getChild("arrow2"),this._grip.on(FGUIEvent.TOUCH_BEGIN,this.onGripTouchDown,this),this._grip.on(FGUIEvent.TOUCH_MOVE,this.onGripTouchMove,this),this._grip.on(FGUIEvent.TOUCH_END,this.onGripTouchEnd,this),this._arrowButton1&&this._arrowButton1.on(FGUIEvent.TOUCH_BEGIN,this.onClickArrow1,this),this._arrowButton2&&this._arrowButton2.on(FGUIEvent.TOUCH_BEGIN,this.onClickArrow2,this),this.on(FGUIEvent.TOUCH_BEGIN,this.onBarTouchBegin,this)):console.error("需要定义bar")):console.error("需要定义grip")}onGripTouchDown(t){t.propagationStopped=!0,t.captureTouch(),this._gripDragging=!0,this._target.updateScrollBarVisible(),this.globalToLocal(t.pos.x,t.pos.y,this._dragOffset),this._dragOffset.x-=this._grip.x,this._dragOffset.y-=this._grip.y}onGripTouchMove(t){if(this.onStage){var e=this.globalToLocal(t.pos.x,t.pos.y,s_vec2);if(this._vertical){var i=e.y-this._dragOffset.y;this._target.setPercY((i-this._bar.y)/(this._bar.height-this._grip.height),!1)}else{var s=e.x-this._dragOffset.x;this._target.setPercX((s-this._bar.x)/(this._bar.width-this._grip.width),!1)}}}onGripTouchEnd(t){this.onStage&&(this._gripDragging=!1,this._target.updateScrollBarVisible())}onClickArrow1(t){t.propagationStopped=!0,this._vertical?this._target.scrollUp():this._target.scrollLeft()}onClickArrow2(t){t.propagationStopped=!0,this._vertical?this._target.scrollDown():this._target.scrollRight()}onBarTouchBegin(t){var e=this._grip.globalToLocal(t.pos.x,t.pos.y,s_vec2);this._vertical?e.y<0?this._target.scrollUp(4):this._target.scrollDown(4):e.x<0?this._target.scrollLeft(4):this._target.scrollRight(4)}}var s_vec2=new Vec2;class GTreeNode{constructor(t,e){this._level=0,this._resURL=e,t&&(this._children=new Array)}set expanded(t){null!=this._children&&this._expanded!=t&&(this._expanded=t,this._tree&&(this._expanded?this._tree._afterExpanded(this):this._tree._afterCollapsed(this)))}get expanded(){return this._expanded}get isFolder(){return null!=this._children}get parent(){return this._parent}get text(){return this._cell?this._cell.text:null}set text(t){this._cell&&(this._cell.text=t)}get icon(){return this._cell?this._cell.icon:null}set icon(t){this._cell&&(this._cell.icon=t)}get cell(){return this._cell}get level(){return this._level}_setLevel(t){this._level=t}addChild(t){return this.addChildAt(t,this._children.length),t}addChildAt(t,e){if(!t)throw new Error("child is null");var i=this._children.length;if(e>=0&&e<=i){if(t._parent==this)this.setChildIndex(t,e);else t._parent&&t._parent.removeChild(t),e==this._children.length?this._children.push(t):this._children.splice(e,0,t),t._parent=this,t._level=this._level+1,t._setTree(this._tree),(this._tree&&this==this._tree.rootNode||this._cell&&this._cell.parent&&this._expanded)&&this._tree._afterInserted(t);return t}throw new RangeError("Invalid child index")}removeChild(t){var e=this._children.indexOf(t);return-1!=e&&this.removeChildAt(e),t}removeChildAt(t){if(t>=0&&t<this.numChildren){var e=this._children[t];return this._children.splice(t,1),e._parent=null,this._tree&&(e._setTree(null),this._tree._afterRemoved(e)),e}throw"Invalid child index"}removeChildren(t,e){t=t||0,null==e&&(e=-1),(e<0||e>=this.numChildren)&&(e=this.numChildren-1);for(var i=t;i<=e;++i)this.removeChildAt(t)}getChildAt(t){if(t>=0&&t<this.numChildren)return this._children[t];throw"Invalid child index"}getChildIndex(t){return this._children.indexOf(t)}getPrevSibling(){if(null==this._parent)return null;var t=this._parent._children.indexOf(this);return t<=0?null:this._parent._children[t-1]}getNextSibling(){if(null==this._parent)return null;var t=this._parent._children.indexOf(this);return t<0||t>=this._parent._children.length-1?null:this._parent._children[t+1]}setChildIndex(t,e){var i=this._children.indexOf(t);if(-1==i)throw"Not a child of this container";var s=this._children.length;e<0?e=0:e>s&&(e=s),i!=e&&(this._children.splice(i,1),this._children.splice(e,0,t),(this._tree&&this==this._tree.rootNode||this._cell&&this._cell.parent&&this._expanded)&&this._tree._afterMoved(t))}swapChildren(t,e){var i=this._children.indexOf(t),s=this._children.indexOf(e);if(-1==i||-1==s)throw"Not a child of this container";this.swapChildrenAt(i,s)}swapChildrenAt(t,e){var i=this._children[t],s=this._children[e];this.setChildIndex(i,e),this.setChildIndex(s,t)}get numChildren(){return this._children.length}expandToRoot(){for(var t=this;t;)t.expanded=!0,t=t.parent}get tree(){return this._tree}_setTree(t){if(this._tree=t,this._tree&&this._tree.treeNodeWillExpand&&this._expanded&&this._tree.treeNodeWillExpand(this,!0),this._children)for(var e=this._children.length,i=0;i<e;i++){var s=this._children[i];s._level=this._level+1,s._setTree(t)}}}class GTree extends GList{constructor(){super(),this._indent=15,this._rootNode=new GTreeNode(!0),this._rootNode._setTree(this),this._rootNode.expanded=!0}get rootNode(){return this._rootNode}get indent(){return this._indent}set indent(t){this._indent=t}get clickToExpand(){return this._clickToExpand}set clickToExpand(t){this._clickToExpand=t}getSelectedNode(){return-1!=this.selectedIndex?this.getChildAt(this.selectedIndex)._treeNode:null}getSelectedNodes(t){t||(t=new Array),s_list.length=0,super.getSelection(s_list);for(var e=s_list.length,i=new Array,s=0;s<e;s++){var n=this.getChildAt(s_list[s])._treeNode;i.push(n)}return i}selectNode(t,e){for(var i=t.parent;i&&i!=this._rootNode;)i.expanded=!0,i=i.parent;t._cell&&this.addSelection(this.getChildIndex(t._cell),e)}unselectNode(t){t._cell&&this.removeSelection(this.getChildIndex(t._cell))}expandAll(t){t||(t=this._rootNode),t.expanded=!0;for(var e=t.numChildren,i=0;i<e;i++){var s=t.getChildAt(i);s.isFolder&&this.expandAll(s)}}collapseAll(t){t||(t=this._rootNode),t!=this._rootNode&&(t.expanded=!1);for(var e=t.numChildren,i=0;i<e;i++){var s=t.getChildAt(i);s.isFolder&&this.collapseAll(s)}}createCell(t){var e=this.getFromPool(t._resURL);if(!(e instanceof GComponent))throw new Error("cannot create tree node object.");e._treeNode=t,t._cell=e;var i,s=e.getChild("indent");s&&(s.width=(t.level-1)*this._indent),(i=e.getController("expanded"))&&(i.on(FGUIEvent.STATUS_CHANGED,this.__expandedStateChanged,this),i.selectedIndex=t.expanded?1:0),(i=e.getController("leaf"))&&(i.selectedIndex=t.isFolder?0:1),t.isFolder&&t._cell.on(FGUIEvent.TOUCH_BEGIN,this.__cellMouseDown,this),this.treeNodeRender&&this.treeNodeRender(t,e)}_afterInserted(t){t._cell||this.createCell(t);var e=this.getInsertIndexForNode(t);this.addChildAt(t._cell,e),this.treeNodeRender&&this.treeNodeRender(t,t._cell),t.isFolder&&t.expanded&&this.checkChildren(t,e)}getInsertIndexForNode(t){var e=t.getPrevSibling();null==e&&(e=t.parent);for(var i=this.getChildIndex(e._cell)+1,s=t.level,n=this.numChildren,r=i;r<n;r++){if(this.getChildAt(r)._treeNode.level<=s)break;i++}return i}_afterRemoved(t){this.removeNode(t)}_afterExpanded(t){if(t!=this._rootNode){if(null!=this.treeNodeWillExpand&&this.treeNodeWillExpand(t,!0),null!=t._cell){this.treeNodeRender&&this.treeNodeRender(t,t._cell);var e=t._cell.getController("expanded");e&&(e.selectedIndex=1),t._cell.parent&&this.checkChildren(t,this.getChildIndex(t._cell))}}else this.checkChildren(this._rootNode,0)}_afterCollapsed(t){if(t!=this._rootNode){if(this.treeNodeWillExpand&&this.treeNodeWillExpand(t,!1),null!=t._cell){this.treeNodeRender&&this.treeNodeRender(t,t._cell);var e=t._cell.getController("expanded");e&&(e.selectedIndex=0),t._cell.parent&&this.hideFolderNode(t)}}else this.checkChildren(this._rootNode,0)}_afterMoved(t){var e,i=this.getChildIndex(t._cell);e=t.isFolder?this.getFolderEndIndex(i,t.level):i+1;var s,n,r=this.getInsertIndexForNode(t),o=e-i;if(r<i)for(s=0;s<o;s++)n=this.getChildAt(i+s),this.setChildIndex(n,r+s);else for(s=0;s<o;s++)n=this.getChildAt(i),this.setChildIndex(n,r)}getFolderEndIndex(t,e){for(var i=this.numChildren,s=t+1;s<i;s++){if(this.getChildAt(s)._treeNode.level<=e)return s}return i}checkChildren(t,e){for(var i=t.numChildren,s=0;s<i;s++){e++;var n=t.getChildAt(s);null==n._cell&&this.createCell(n),n._cell.parent||this.addChildAt(n._cell,e),n.isFolder&&n.expanded&&(e=this.checkChildren(n,e))}return e}hideFolderNode(t){for(var e=t.numChildren,i=0;i<e;i++){var s=t.getChildAt(i);s._cell&&this.removeChild(s._cell),s.isFolder&&s.expanded&&this.hideFolderNode(s)}}removeNode(t){if(t._cell&&(t._cell.parent&&this.removeChild(t._cell),this.returnToPool(t._cell),t._cell._treeNode=null,t._cell=null),t.isFolder)for(var e=t.numChildren,i=0;i<e;i++){var s=t.getChildAt(i);this.removeNode(s)}}__cellMouseDown(t){var e=GObject.cast(t.currentTarget)._treeNode;this._expandedStatusInEvt=e.expanded}__expandedStateChanged(t){t.parent._treeNode.expanded=1==t.selectedIndex}dispatchItemEvent(t,e){if(0!=this._clickToExpand){var i=t._treeNode;i&&this._expandedStatusInEvt==i.expanded&&(2==this._clickToExpand||(i.expanded=!i.expanded))}super.dispatchItemEvent(t,e)}setup_beforeAdd(t,e){super.setup_beforeAdd(t,e),t.seek(e,9),this._indent=t.readInt(),this._clickToExpand=t.readByte()}readItems(t){var e,i,s,n,r,o,h,a=0;for(e=t.readShort(),i=0;i<e;i++)if(s=t.readShort(),s+=t.position,null!=(n=t.readS())||(n=this.defaultItem)){r=t.readBool(),h=t.readByte();var l=new GTreeNode(r,n);if(l.expanded=!0,0==i)this._rootNode.addChild(l);else if(h>a)o.addChild(l);else if(h<a){for(var _=h;_<=a;_++)o=o.parent;o.addChild(l)}else o.parent.addChild(l);o=l,a=h,this.setupItem(t,l.cell),t.position=s}else t.position=s}}var s_list=new Array;class PopupMenu{constructor(t){if(!t&&!(t=UIConfig.popupMenu))throw"UIConfig.popupMenu not defined";this._contentPane=UIPackage.createObjectFromURL(t),this._contentPane.on(FGUIEvent.DISPLAY,this.onDisplay,this),this._list=this._contentPane.getChild("list"),this._list.removeChildrenToPool(),this._list.addRelation(this._contentPane,RelationType.Width),this._list.removeRelation(this._contentPane,RelationType.Height),this._contentPane.addRelation(this._list,RelationType.Height),this._list.on(FGUIEvent.CLICK_ITEM,this.onClickItem,this)}dispose(){this._contentPane.dispose()}addItem(t,e){var i=this._list.addItemFromPool();i.title=t,i.data=e,i.grayed=!1;var s=i.getController("checked");return s&&(s.selectedIndex=0),i}addItemAt(t,e,i){var s=this._list.getFromPool();this._list.addChildAt(s,e),s.title=t,s.data=i,s.grayed=!1;var n=s.getController("checked");return n&&(n.selectedIndex=0),s}addSeperator(){if(null==UIConfig.popupMenu_seperator)throw"UIConfig.popupMenu_seperator not defined";this.list.addItemFromPool(UIConfig.popupMenu_seperator)}getItemName(t){return this._list.getChildAt(t).name}setItemText(t,e){this._list.getChild(t).title=e}setItemVisible(t,e){var i=this._list.getChild(t);i.visible!=e&&(i.visible=e,this._list.setBoundsChangedFlag())}setItemGrayed(t,e){this._list.getChild(t).grayed=e}setItemCheckable(t,e){var i=this._list.getChild(t).getController("checked");i&&(e?0==i.selectedIndex&&(i.selectedIndex=1):i.selectedIndex=0)}setItemChecked(t,e){var i=this._list.getChild(t).getController("checked");i&&(i.selectedIndex=e?2:1)}isItemChecked(t){var e=this._list.getChild(t).getController("checked");return!!e&&2==e.selectedIndex}removeItem(t){var e=this._list.getChild(t);if(e){var i=this._list.getChildIndex(e);return this._list.removeChildToPoolAt(i),!0}return!1}clearItems(){this._list.removeChildrenToPool()}get itemCount(){return this._list.numChildren}get contentPane(){return this._contentPane}get list(){return this._list}show(t,e){GRoot.inst.showPopup(this.contentPane,t instanceof GRoot?null:t,e)}onClickItem(t,e){this._list._partner.callLater(i=>{this.onClickItem2(t,e)},.1)}onClickItem2(t,e){if(t instanceof GButton)if(t.grayed)this._list.selectedIndex=-1;else{var i=t.getController("checked");i&&0!=i.selectedIndex&&(1==i.selectedIndex?i.selectedIndex=2:i.selectedIndex=1),this._contentPane.parent.hidePopup(this.contentPane),t.data instanceof Function&&t.data(t,e)}}onDisplay(){this._list.selectedIndex=-1,this._list.resizeToFit(1e5,10)}}class UIObjectFactory{constructor(){}static setExtension(t,e){if(null==t)throw new Error("Invaild url: "+t);var i=UIPackage.getItemByURL(t);i&&(i.extensionType=e),UIObjectFactory.extensions[t]=e}static setLoaderExtension(t){UIObjectFactory.loaderType=t}static resolveExtension(t){var e=UIObjectFactory.extensions["ui://"+t.owner.id+t.id];e||(e=UIObjectFactory.extensions["ui://"+t.owner.name+"/"+t.name]),e&&(t.extensionType=e)}static newObject(t,e){var i;if(UIObjectFactory.counter++,"number"==typeof t)switch(t){case ObjectType.Image:return new GImage;case ObjectType.MovieClip:return new GMovieClip;case ObjectType.Component:return new GComponent;case ObjectType.Text:return new GTextField;case ObjectType.RichText:return new GRichTextField;case ObjectType.InputText:return new GTextInput;case ObjectType.Group:return new GGroup;case ObjectType.List:return new GList;case ObjectType.Graph:return new GGraph;case ObjectType.Loader:return UIObjectFactory.loaderType?new UIObjectFactory.loaderType:new GLoader;case ObjectType.Button:return new GButton;case ObjectType.Label:return new GLabel;case ObjectType.ProgressBar:return new GProgressBar;case ObjectType.Slider:return new GSlider;case ObjectType.ScrollBar:return new GScrollBar;case ObjectType.ComboBox:return new GComboBox;case ObjectType.Tree:return new GTree;case ObjectType.Loader3D:return new GLoader3D;default:return null}else(i=t.type==PackageItemType.Component?e?new e:t.extensionType?new t.extensionType:UIObjectFactory.newObject(t.objectType):UIObjectFactory.newObject(t.objectType))&&(i.packageItem=t);return i}}UIObjectFactory.counter=0,UIObjectFactory.extensions={},Decls.UIObjectFactory=UIObjectFactory;class DragDropManager{static get inst(){return DragDropManager._inst||(DragDropManager._inst=new DragDropManager),DragDropManager._inst}constructor(){this._agent=new GLoader,this._agent.draggable=!0,this._agent.touchable=!1,this._agent.setSize(100,100),this._agent.setPivot(.5,.5,!0),this._agent.align=AlignType.Center,this._agent.verticalAlign=VertAlignType.Middle,this._agent.sortingOrder=1e6,this._agent.on(FGUIEvent.DRAG_END,this.onDragEnd,this)}get dragAgent(){return this._agent}get dragging(){return null!=this._agent.parent}startDrag(t,e,i,s){if(this._agent.parent)return;this._sourceData=i,this._agent.url=e,GRoot.inst.addChild(this._agent);let n=GRoot.inst.getTouchPosition(s);n=GRoot.inst.globalToLocal(n.x,n.y),this._agent.setPosition(n.x,n.y),this._agent.startDrag(s)}cancel(){this._agent.parent&&(this._agent.stopDrag(),GRoot.inst.removeChild(this._agent),this._sourceData=null)}onDragEnd(){if(this._agent.parent){GRoot.inst.removeChild(this._agent);var t=this._sourceData;this._sourceData=null;for(var e=GRoot.inst.touchTarget;e;){if(e.node.hasEventListener(FGUIEvent.DROP))return e.requestFocus(),void e.node.emit(FGUIEvent.DROP,e,t);e=e.parent}}}}class AsyncOperation{createObject(t,e){if(this._node)throw"Already running";var i=UIPackage.getByName(t);if(!i)throw new Error("package not found: "+t);var s=i.getItemByName(e);if(!s)throw new Error("resource not found: "+e);this.internalCreateObject(s)}createObjectFromURL(t){if(this._node)throw"Already running";var e=UIPackage.getItemByURL(t);if(!e)throw new Error("resource not found: "+t);this.internalCreateObject(e)}cancel(){this._node&&(this._node.destroy(),this._node=null)}internalCreateObject(t){this._node=new Node("[AsyncCreating:"+t.name+"]"),game.addPersistRootNode(this._node),this._node.on("#",this.completed,this),this._node.addComponent(AsyncOperationRunner).init(t)}completed(t){this.cancel(),this.callback&&this.callback(t)}}class AsyncOperationRunner extends Component{constructor(){super(),this._itemList=new Array,this._objectPool=new Array}init(t){this._itemList.length=0,this._objectPool.length=0;var e={pi:t,type:t.objectType};e.childCount=this.collectComponentChildren(t),this._itemList.push(e),this._index=0}onDestroy(){this._itemList.length=0;var t=this._objectPool.length;if(t>0){for(var e=0;e<t;e++)this._objectPool[e].dispose();this._objectPool.length=0}}collectComponentChildren(t){var e,i,s,n,r,o,h=t.rawData;h.seek(0,2);var a=h.readShort();for(s=0;s<a;s++){n=h.readShort(),r=h.position,h.seek(r,0);var l=h.readByte(),_=h.readS(),d=h.readS();h.position=r,null!=_?(e={pi:i=null!=(o=null!=d?UIPackage.getById(d):t.owner)?o.getItemById(_):null,type:l},i&&i.type==PackageItemType.Component&&(e.childCount=this.collectComponentChildren(i))):(e={type:l},l==ObjectType.List&&(e.listItemCount=this.collectListChildren(h))),this._itemList.push(e),h.position=r+n}return a}collectListChildren(t){t.seek(t.position,8);var e,i,s,n,r,o=0,h=t.readS(),a=t.readShort();for(e=0;e<a;e++)i=t.readShort(),i+=t.position,null==(s=t.readS())&&(s=h),s&&(n=UIPackage.getItemByURL(s))&&(r={pi:n,type:n.objectType},n.type==PackageItemType.Component&&(r.childCount=this.collectComponentChildren(n)),this._itemList.push(r),o++),t.position=i;return o}update(){for(var t,e,i,s,n=game.totalTime/1e3,r=UIConfig.frameTimeForAsyncUIConstruction,o=this._itemList.length;this._index<o;){if((e=this._itemList[this._index]).pi)t=UIObjectFactory.newObject(e.pi),this._objectPool.push(t),constructingDepth.n++,e.pi.type==PackageItemType.Component?(i=this._objectPool.length-e.childCount-1,t.constructFromResource2(this._objectPool,i),this._objectPool.splice(i,e.childCount)):t.constructFromResource(),constructingDepth.n--;else if(t=UIObjectFactory.newObject(e.type),this._objectPool.push(t),e.type==ObjectType.List&&e.listItemCount>0){for(i=this._objectPool.length-e.listItemCount-1,s=0;s<e.listItemCount;s++)t.itemPool.returnObject(this._objectPool[s+i]);this._objectPool.splice(i,e.listItemCount)}if(this._index++,this._index%5==0&&game.totalTime/1e3-n>=r)return}var h=this._objectPool[0];this._itemList.length=0,this._objectPool.length=0,this.node.emit("#",h)}}class Injector{static Inject(t,e){e instanceof Function?this.__injectedMap.set(t,e):this.__instanceMap.set(t,e)}static GetInject(t){let e=this.__instanceMap.get(t);if(e)return e;let i=this.__injectedMap.get(t);return void 0===i?null:(e=new i,this.__instanceMap.set(t,e),e)}}Injector.__injectedMap=new Map,Injector.__instanceMap=new Map;class TickerManagerImpl{constructor(){this.__tickerList=[],this.__nextFrameCallBacks=[]}Tick(t){let e;for(;this.__nextFrameCallBacks.length;)e=this.__nextFrameCallBacks.shift(),e.callBack.apply(e.caller);for(let e=0;e<this.__tickerList.length;e++){this.__tickerList[e].Tick(t)}}AddTicker(t){if(this.__tickerList.indexOf(t)>=0)throw new Error("Ticker 重复添加！");this.__tickerList.push(t)}RemoveTicker(t){let e=this.__tickerList.indexOf(t);if(e<0)throw new Error("找不到要删除的Tick！");this.__tickerList.splice(e,1)}CallNextFrame(t,e){for(let i=0;i<this.__nextFrameCallBacks.length;i++){if(this.__nextFrameCallBacks[i].Equal(t,e))return}this.__nextFrameCallBacks.push(new NextFrameHandler(t,e))}ClearNextFrame(t,e){for(let i=0;i<this.__nextFrameCallBacks.length;i++){this.__nextFrameCallBacks[i].Equal(t,e)&&this.__nextFrameCallBacks.splice(i,1)}}}class NextFrameHandler{constructor(t,e){this.callBack=t,this.caller=e}Equal(t,e){return this.caller===e&&this.callBack===t}}class TickerManager{static Tick(t){this.impl.Tick(t)}static AddTicker(t){this.impl.AddTicker(t)}static RemoveTicker(t){this.impl.RemoveTicker(t)}static CallNextFrame(t,e){this.impl.CallNextFrame(t,e)}static ClearNextFrame(t,e){this.impl.ClearNextFrame(t,e)}static get impl(){return null==this.__impl&&(this.__impl=Injector.GetInject(this.KEY)),null==this.__impl&&(this.__impl=new TickerManagerImpl),this.__impl}}function GetClassName(t){let e;if("string"!=typeof t){e=t.toString(),e=e.replace("function ","");let i=e.indexOf("()");if(i<0)throw new Error("获取类型名称错误："+e);e=e.substring(0,i)}else e=t;return e}function URL2Key(t){return ResURLUtils.URL2Key(t)}function Key2URL(t){return ResURLUtils.Key2URL(t)}function FullURL(t){return"string"==typeof t?t:t.type==Texture2D?t.url+"/texture":t.type==SpriteFrame?t.url+"/spriteFrame":t.url}TickerManager.KEY="drongo.TickerManager";class ResURLUtils{static getAssetType(t){if(!this.__assetTypes.has(t))throw new Error("未找到对应资源类型："+t);return this.__assetTypes.get(t)}static _getURL(t){let e=t.length,i=e-8,s=t.substring(i);return"/texture"===s?t.substring(0,i):(i=e-12,s=t.substring(i),"/spriteFrame"===s?t.substring(0,i):t)}static Key2URL(t){if(t.indexOf("|")){let e=t.split("|");return{url:this._getURL(e[0]),bundle:e[1],type:this.getAssetType(e[2])}}return t}static URL2Key(t){return null==t||null==t?"":"string"==typeof t?t:t.type==SpriteFrame?t.url+"/spriteFrame|"+t.bundle+"|"+this.getAndSaveClassName(t.type):t.type==Texture2D?t.url+"/texture|"+t.bundle+"|"+this.getAndSaveClassName(t.type):t.url+"|"+t.bundle+"|"+this.getAndSaveClassName(t.type)}static getAndSaveClassName(t){let e=GetClassName(t);return this.__assetTypes.has(e)||this.__assetTypes.set(e,t),e}}ResURLUtils.__assetTypes=new Map;class DebugerImpl{constructor(){this.__logs=new Dictionary,this.__debuger=new Map}Debug(t,e){this.__debuger.set(t,e)}GetLogs(t){return null!=t&&null!=t||(t="all"),this.__logs.Has(t)?this.__logs.Get(t):null}__save(t,e,i){let s;this.__logs.Has(t)?s=this.__logs.Get(t):(s=[],this.__logs.Set(t,s));let n="["+t+"]"+e+":"+i;return s.length>=Debuger.MaxCount&&s.unshift(),s.push(n),this.__logs.Has("all")?s=this.__logs.Get("all"):(s=[],this.__logs.Set("all",s)),s.length>=Debuger.MaxCount&&s.unshift(),s.push(n),n}Log(t,e){let i=this.__save(t,"Log",e),s=!!this.__debuger.has("all")&&this.__debuger.get("all"),n=!!this.__debuger.has(t)&&this.__debuger.get(t);(s||n)&&console.log(i)}Err(t,e){let i=this.__save(t,"Error",e),s=!!this.__debuger.has("all")&&this.__debuger.get("all"),n=!!this.__debuger.has(t)&&this.__debuger.get(t);(s||n)&&console.error(i)}Warn(t,e){let i=this.__save(t,"Warn",e),s=!!this.__debuger.has("all")&&this.__debuger.get("all"),n=!!this.__debuger.has(t)&&this.__debuger.get(t);(s||n)&&console.warn(i)}Info(t,e){let i=this.__save(t,"Info",e),s=!!this.__debuger.has("all")&&this.__debuger.get("all"),n=!!this.__debuger.has(t)&&this.__debuger.get(t);(s||n)&&console.info(i)}}class Debuger{static Debug(t,e){this.impl.Debug(t,e)}static GetLogs(t){return this.impl.GetLogs(t)}static Log(t,e){this.impl.Log(t,e)}static Err(t,e){this.impl.Err(t,e)}static Warn(t,e){this.impl.Warn(t,e)}static Info(t,e){this.impl.Info(t,e)}static get impl(){return null==this.__impl&&(this.__impl=Injector.GetInject(this.KEY)),null==this.__impl&&(this.__impl=new DebugerImpl),this.__impl}}Debuger.KEY="drongo.Debuger",Debuger.DRONGO="drongo",Debuger.MaxCount=1e3;class EventDispatcher{constructor(){this.callerMap=new Map,this.keyMap=new Map,this.needEmit=[]}On(t,e,i,s=0){let n,r;if(this.keyMap.has(t)){n=this.keyMap.get(t);for(const s of n)if(s.target==i&&s.handler==e)return void Debuger.Err(Debuger.DRONGO,"重复添加同一个事件监听："+t+" "+i+" "+e)}else n=[],this.keyMap.set(t,n);if(r=new EventInfo(t,i,e),n.push(r),n.sort((t,e)=>t.priority-s),this.callerMap.has(i)){n=this.callerMap.get(i);for(const s of n)s.key==t&&s.handler==e&&Debuger.Err(Debuger.DRONGO,"事件系统 处理器关联错误："+t+" "+i+" "+e)}else n=[],this.callerMap.set(i,n);n.push(r)}Off(t,e,i){if(0==this.keyMap.has(t))return;let s,n=this.keyMap.get(t),r=null;for(let t=0;t<n.length;t++)if(s=n[t],s.target==i&&s.handler==e){r=s,n.splice(t,1);break}if(this.callerMap.has(i)){n=this.callerMap.get(i);for(let i=0;i<n.length;i++)if(s=n[i],s.key==t&&s.handler==e){r=s,n.splice(i,1);break}}r&&r.Destroy()}OffByCaller(t){let e,i=this.callerMap.get(t);if(void 0!==i&&0!=i.length){for(;i.length;)e=i[0],this.Off(e.key,e.handler,e.target);this.callerMap.delete(t)}}OffAllEvent(){this.keyMap.forEach(t=>{t.forEach(t=>{t.Destroy()})}),this.keyMap.clear(),this.callerMap.clear()}Emit(t,e){for(let i=0;i<this.needEmit.length;i++){const s=this.needEmit[i];if(s.type==t&&s.data===e)return}this.needEmit.push({type:t,data:e}),TickerManager.CallNextFrame(this.__emit,this)}__emit(){for(let t=0;t<this.needEmit.length;t++){const e=this.needEmit[t];if(0==this.keyMap.has(e.type))continue;let i,s=this.keyMap.get(e.type);for(let t=0;t<s.length;t++)i=s[t],i.handler.apply(i.target,[e.type,this,e.data])}this.needEmit.length=0}HasEvent(t){return this.keyMap.has(t)}HasEventHandler(t,e,i){if(0==this.keyMap.has(t))return!1;let s,n=this.keyMap.get(t);for(let t=0;t<n.length;t++)if(s=n[t],s.target==i&&s.handler==e)return!0;return!1}Destroy(){this.callerMap.clear(),this.keyMap.clear()}}class EventInfo{constructor(t,e,i){this.key="",this.priority=255,this.key=t,this.target=e,this.handler=i}Destroy(){this.key=null,this.target=null,this.handler=null,this.priority=0}}class Event{static GetChannel(t="main"){return this.channels.get(t)}static Emit(t,e,i="main"){if(!this.channels.has(i))return;this.channels.get(i).Emit(t,e)}static On(t,e,i,s=0,n="main"){let r;this.channels.has(n)?r=this.channels.get(n):(r=new EventDispatcher,this.channels.set(n,r)),r.On(t,e,i,s)}static Off(t,e,i,s="main"){let n;this.channels.has(s)&&(n=this.channels.get(s),n.Off(t,e,i))}static OffByCaller(t,e="main"){let i;this.channels.has(e)&&(i=this.channels.get(e),i.OffByCaller(t))}static OffAll(t="main"){let e;this.channels.has(t)&&(e=this.channels.get(t),e.OffAllEvent())}}Event.START="start",Event.PROGRESS="progress",Event.COMPLETE="complete",Event.ERROR="error",Event.SHOW="show",Event.HIDE="hide",Event.ADD="add",Event.REMOVE="remove",Event.UPDATE="update",Event.CLEAR="clear",Event.State_Changed="stateChanged",Event.channels=new Map;class Dictionary extends EventDispatcher{constructor(){super(),this.__map=new Map,this.__list=[]}Set(t,e){let i;if(this.__map.has(t)){i=this.__map.get(t);const e=this.__list.indexOf(i);if(e<0)throw new Error("Dictionary内部逻辑错误！");this.__map.delete(t),this.__list.splice(e,1),this.Emit(Event.REMOVE,i)}this.__map.set(t,e),this.__list.push(e),this.Emit(Event.ADD,e)}Has(t){return this.__map.has(t)}Get(t){return this.__map.get(t)}GetValue(t){if(t>=this.__list.length)throw new Error(t+"索引超出0-"+this.__list.length+"范围");return this.__list[t]}Delete(t){if(!this.__map.has(t))return;const e=this.__map.get(t),i=this.__list.indexOf(e);if(i<0)throw new Error("Dictionary内部逻辑错误！");return this.__list.splice(i,1),this.__map.delete(t),this.HasEvent(Event.REMOVE)&&this.Emit(Event.REMOVE,e),e}Clear(){this.__map.clear(),this.__list.length=0}get elements(){return this.__list}get size(){return this.__map.size}Destroy(){super.Destroy(),this.__map.clear(),this.__map=null,this.__list=null}}class TimerImpl{constructor(){this.__lastTime=0,this.Reset(),TickerManager.AddTicker(this)}Reset(){this.__lastTime=game.totalTime/1e3}Tick(t){this.__lastTime+=t}get currentTime(){return this.__lastTime}get absTime(){return this.Reset(),this.currentTime}}class Timer{static get currentTime(){return this.impl.currentTime}static get absTime(){return this.impl.absTime}static Reset(t){this.impl.Reset(t)}static get impl(){return null==this.__impl&&(this.__impl=Injector.GetInject(this.KEY)),null==this.__impl&&(this.__impl=new TimerImpl),this.__impl}}Timer.KEY="Timer";class ResManagerImpl{constructor(){this.__resDic=new Dictionary,this._waitDestroy=[],TickerManager.AddTicker(this)}Tick(t){ResManager.AUTO_GC&&this.GC()}AddRes(t){if(this.__resDic.Has(t.key))throw new Error("重复添加资源！");this.__resDic.Set(t.key,t),this._waitDestroy.push(t),t.lastOpTime=Timer.currentTime}HasRes(t){return this.__resDic.Has(t)}_getRes(t){return this.__resDic.Get(t)}AddResRef(t,e){if(!this.__resDic.Has(t))throw new Error("未找到资源："+t);let i=this.__resDic.Get(t),s=this._waitDestroy.indexOf(i);return s>=0&&this._waitDestroy.splice(s,1),i.lastOpTime=Timer.currentTime,i.AddRef(e)}RemoveResRef(t){if(!this.__resDic.Has(t.key))throw new Error("未找到资源："+t.key);let e=this.__resDic.Get(t.key);e.RemoveRef(t),0==e.refLength&&this._waitDestroy.push(e),e.lastOpTime=Timer.currentTime}GC(t){let e,i=Timer.currentTime;for(let s=0;s<this._waitDestroy.length;s++)e=this._waitDestroy[s],e.refCount>0||(1==t||i-e.lastOpTime>ResManager.GC_TIME)&&(this._waitDestroy.splice(s,1),this.DestroyRes(e),s--)}DestroyRes(t){this.__resDic.Delete(t.key),t.Destroy()}get resList(){return this.__resDic.elements}}class ResManager{static AddRes(t){this.impl.AddRes(t)}static HasRes(t){return this.impl.HasRes(t)}static _getRes(t){return this.impl._getRes(t)}static AddResRef(t,e){return this.impl.AddResRef(t,e)}static RemoveResRef(t){return this.impl.RemoveResRef(t)}static GC(t){return this.impl.GC(t)}static get resList(){return this.impl.resList}static get impl(){return null==this.__impl&&(this.__impl=Injector.GetInject(this.KEY)),null==this.__impl&&(this.__impl=new ResManagerImpl),this.__impl}}ResManager.KEY="drongo.ResManager",ResManager.GC_TIME=15,ResManager.AUTO_GC=!0;class ResRef{constructor(){this.key="",this.__isDispose=!1}Dispose(){if(this.__isDispose)throw new Error("重复释放资源引用");this.__isDispose=!0,ResManager.RemoveResRef(this)}get isDispose(){return this.__isDispose}Reset(){this.key="",this.refKey=void 0,this.content=null,this.__isDispose=!1}Destroy(){this.key="",this.refKey=void 0,this.content=null}}class LoaderQueue{constructor(){this.running=new Dictionary,this.waiting=new Dictionary,this.pool=new Map,TickerManager.AddTicker(this)}Tick(t){for(;this.running.size<Res.MAX_LOADER_THREAD&&this.waiting.size>0;){const t=this.waiting.elements[0],e=URL2Key(t);let i,s,n;this.waiting.Delete(e),n="string"==typeof t?"string":t.type;let r=this.pool.get(n);null==r&&(r=[],this.pool.set(n,r)),r.length>0?i=r.shift():(s="string"==typeof t?Res.GetResLoader("string"):Res.GetResLoader(t.type),i=new s),null!=i&&(this.running.Set(e,i),i.Load(t),this.__addEvent(i))}}__addEvent(t){t.On(Event.COMPLETE,this.__eventHandler,this),t.On(Event.ERROR,this.__eventHandler,this),t.On(Event.PROGRESS,this.__eventHandler,this)}__eventHandler(t,e,i){if(t!=Event.PROGRESS)if(e.OffAllEvent(),t!=Event.ERROR){if(t==Event.COMPLETE){let t;Loader.single.ChildComplete(i.url),e.Reset(),t="string"==typeof i.url?"string":i.url.type;let s=this.pool.get(t);null==s&&(s=[],this.pool.set(t,s)),s.push(e)}}else Loader.single.ChildError(i.url,i.err);else Loader.single.ChildProgress(i.url,i.progress)}Load(t){const e=URL2Key(t);this.waiting.Has(e)||this.running.Has(e)||this.waiting.Set(e,t)}static get single(){return null==this.__instance&&(this.__instance=new LoaderQueue),this.__instance}}class ResRequest{constructor(t,e,i){this.__loadedMap=new Map,Array.isArray(t)?this.urls=t:this.urls=[t],this.cb=e,this.progress=i}Load(){this.__loadedMap.clear();for(let t=0;t<this.urls.length;t++){const e=this.urls[t],i=URL2Key(e);ResManager.HasRes(i)?this.__loadedMap.set(i,1):LoaderQueue.single.Load(e)}}ChildComplete(t){const e=URL2Key(t);this.__loadedMap.set(e,1),this.checkComplete()}ChildProgress(t,e){const i=URL2Key(t);this.__loadedMap.set(i,e),this.UpdateProgress()}ChildError(t){this.cb&&this.cb(t)}UpdateProgress(){let t=this.getLoaded()/this.urls.length;this.progress&&this.progress(t)}checkComplete(){let t=this.getLoaded()/this.urls.length;this.progress&&this.progress(t),1==t&&null!=this.cb&&(this.cb(null),this.Destroy())}getLoaded(){let t=0;for(let e of this.__loadedMap.values())t+=e;return t}Destroy(){this.urls=null,this.cb=null,this.progress=null}}class Loader{constructor(){this.requests=new Map}Load(t,e,i){let s=new ResRequest(t,e,i);this.__addReqeuset(s),s.Load()}ChildComplete(t){const e=URL2Key(t);let i=this.requests.get(e);for(let e=0;e<i.length;e++){i[e].ChildComplete(t)}i.length=0,this.requests.delete(e)}ChildError(t,e){const i=URL2Key(t);let s=this.requests.get(i);for(let t=0;t<s.length;t++){s[t].ChildError(e)}let n=s.concat();for(let t=0;t<n.length;t++){const e=n[t];this.__deleteReqeuset(e),e.Destroy()}}ChildProgress(t,e){const i=URL2Key(t);let s=this.requests.get(i);for(let i=0;i<s.length;i++){s[i].ChildProgress(t,e)}}__addReqeuset(t){let e;for(let i=0;i<t.urls.length;i++){const s=URL2Key(t.urls[i]);this.requests.has(s)?e=this.requests.get(s):(e=[],this.requests.set(s,e)),e.push(t)}}__deleteReqeuset(t){let e,i=0;for(let s=0;s<t.urls.length;s++){const n=URL2Key(t.urls[s]);e=this.requests.get(n),i=e.indexOf(t),i>=0&&e.splice(i,1)}}static get single(){return null==this.__instance&&(this.__instance=new Loader),this.__instance}}class ResourceImpl{constructor(){this.state=0,this.key="",this.lastOpTime=0,this.__refs=[],this.__content=null}set content(t){this.__content=t,this.__content instanceof Asset&&this.__content.addRef()}get content(){return this.__content}AddRef(t){let e=new ResRef;return e.key=this.key,e.refKey=t,this.content instanceof Asset?(this.content instanceof Prefab?e.content=instantiate(this.content):e.content=this.content,this.content.addRef()):e.content=this.content,this.__refs.push(e),e}RemoveRef(t){let e=this.__refs.indexOf(t);if(e<0)throw new Error("未找到需要删除的引用！");if(this.content instanceof Asset){if(this.content instanceof Prefab){let e=t.content;isValid(e)&&e.destroy()}this.content.decRef()}this.__refs.splice(e,1),t.Destroy()}Destroy(){if(this.refCount>0||this.refLength>0)throw new Error("发现销毁资源时引用数量不为0");this.__content instanceof Asset?(this.__content.decRef(),this.__content.refCount<=0&&(Debuger.Log(Debuger.DRONGO,"Res:资源销毁=>"+this.key),assetManager.releaseAsset(this.__content))):this.__content.Destroy&&this.__content.Destroy(),this.key="",this.__refs.length=0,this.__content=null}get refCount(){return this.__content instanceof Asset?this.__content.refCount-1:this.__refs.length}get refLength(){return this.__refs.length}get refList(){return this.__refs}}class CCLoaderImpl extends EventDispatcher{constructor(){super()}Load(t){if(this.url=t,"string"==typeof t)throw new Error("未实现！");let e=assetManager.getBundle(t.bundle);e?this.__load(t,e):assetManager.loadBundle(t.bundle,(e,i)=>{e?this.Emit(Event.ERROR,{url:t,err:e}):this.__load(t,i)})}__load(t,e){if("string"==typeof t)throw new Error("未实现！");let i=this;e.load(FullURL(t),t.type,(e,s)=>{const n=e/s;i.Emit(Event.PROGRESS,{url:t,progress:n})},(e,s)=>{if(e)return void i.Emit(Event.ERROR,e);const n=URL2Key(t);let r=new ResourceImpl;r.key=n,r.content=s,ResManager.AddRes(r),i.Emit(Event.COMPLETE,{url:t})})}Reset(){this.url=null}}class StringUtils{static IsEmpty(t){return null==t||null==t||0==t.length}static Substitute(t,...e){if(null==t)return"";var i,s=e.length;1==s&&e[0]instanceof Array?s=(i=e[0]).length:i=e;for(var n=0;n<s;n++)t=t.replace(new RegExp("\\{"+n+"\\}","g"),i[n]);return t}static ReplaceAll(t,e,i){return t.split(e).join(i)}static SplitString(t,e,i){let s=new Array;return t.split(e).forEach((t,e)=>{let n=t.split(i);s.push(n)}),s}static GetFileSuffix(t){let e=t.lastIndexOf(".");return e<0?"":t.substring(e+1)}static ReplaceSuffix(t,e){let i=t.lastIndexOf(".");if(i<0)throw new Error(t+"没有后缀！！！");let s=t.substring(i+1);return t.replace(s,e)}}var GUIState,__awaiter$2=function(t,e,i,s){return new(i||(i=Promise))((function(n,r){function o(t){try{a(s.next(t))}catch(t){r(t)}}function h(t){try{a(s.throw(t))}catch(t){r(t)}}function a(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,h)}a((s=s.apply(t,e||[])).next())}))};class ResImpl{constructor(){this.loaderClass=new Map}SetResLoader(t,e){let i=GetClassName(t);this.loaderClass.set(i,e)}GetResLoader(t){let e=GetClassName(t);return this.loaderClass.has(e)?this.loaderClass.get(e):CCLoaderImpl}GetResRef(t,e,i){const s=URL2Key(t);if(StringUtils.IsEmpty(s))return Promise.reject("资源地址为空!");if(ResManager.HasRes(s))return Promise.resolve(ResManager.AddResRef(s,e));return new Promise((n,r)=>{Loader.single.Load(t,t=>{t?r(t):n(ResManager.AddResRef(s,e))},i)})}GetResRefList(t,e,i){return __awaiter$2(this,void 0,void 0,(function*(){let s=[];return Loader.single.Load(t,i=>{if(i)s.push(Promise.reject(i));else for(let i=0;i<t.length;i++){const n=URL2Key(t[i]);s.push(Promise.resolve(ResManager.AddResRef(n,e)))}},i),yield Promise.all(s)}))}GetResRefMap(t,e,i,s){return __awaiter$2(this,void 0,void 0,(function*(){return i=i||new Map,new Promise((n,r)=>{Loader.single.Load(t,s=>{if(s)r(s);else{for(let s=0;s<t.length;s++){const n=URL2Key(t[s]);i.set(n,ResManager.AddResRef(n,e))}n(i)}},s)})}))}}class Res{static SetResLoader(t,e){this.impl.SetResLoader(t,e)}static GetResLoader(t){return this.impl.GetResLoader(t)}static GetResRef(t,e,i){return this.impl.GetResRef(t,e,i)}static GetResRefList(t,e,i){return this.impl.GetResRefList(t,e,i)}static GetResRefMap(t,e,i,s){return this.impl.GetResRefMap(t,e,i,s)}static get impl(){return null==this.__impl&&(this.__impl=Injector.GetInject(this.KEY)),null==this.__impl&&(this.__impl=new ResImpl),this.__impl}}Res.KEY="drongo.Res",Res.MAX_LOADER_THREAD=5;class AudioChannelImpl{constructor(t,e){null==e&&(e=t.addComponent(AudioSource)),this.__node=t,this.__source=e}get url(){return this.__url}get mute(){return this.__mute}set mute(t){this.__mute!=t&&(this.__mute=t,this.__mute?(this.__volume=this.__source.volume,this.__source.volume=0):this.__source.volume=this.__volume)}Play(t,e,i,s,n=!1,r=1){this.__reset(),this.__url=t,this.__playedComplete=e,this.__isPlaying=!0,this.__speed=r,this.__loop=n,s?(s.time<=0&&(this.mute?this.__volume=i:this.__source.volume=i),null==this.__fadeData&&(this.__fadeData=new FadeData),this.__fadeData.startTime=Timer.currentTime,this.__fadeData.startValue=null==s.startVolume?this.__source.volume:s.startVolume,this.__fadeData.time=s.time,this.__fadeData.endValue=i,this.__fadeData.complete=s.complete,this.__fadeData.completeStop=s.completeStop):this.__volume=i,this.__startTime=Timer.currentTime,this.__time=Number.MAX_VALUE,Res.GetResRef(this.url,"AudioChannel").then(t=>{if(t instanceof ResRef){if(0==this.__isPlaying)return void t.Dispose();if(URL2Key(this.url)!=t.key)return void t.Dispose();this.__ref=t,this.__play()}},t=>{Debuger.Err(Debuger.DRONGO,t),this.__isPlaying=!1,this.__source.stop()})}Stop(){this.__source.playing&&this.__source.stop(),this.__isPlaying=!1,this.__reset()}get isPlaying(){return this.__isPlaying||this.__source.playing}Fade(t,e,i,s,n){this.isPlaying&&(this.__paused=!1,t<=0?(this.mute?this.__volume=e:this.__source.volume=e,n&&(this.Stop(),s&&s())):(null==this.__fadeData&&(this.__fadeData=new FadeData),this.__fadeData.startTime=Timer.currentTime,this.__fadeData.startValue=null==i?this.__source.volume:i,this.__fadeData.time=t,this.__fadeData.endValue=e,this.__fadeData.complete=s,this.__fadeData.completeStop=n))}__reset(){this.__url=null,this.__ref&&(this.__ref.Dispose(),this.__ref=null),this.__isPlaying=!1,this.__paused=!1,this.__fadeData=null}__clipLoaded(t,e){if(t)return Debuger.Err(Debuger.DRONGO,t.message),this.__isPlaying=!1,void this.__source.stop();if(0==this.__isPlaying)return void e.Dispose();URL2Key(this.url)==e.key?(this.__ref=e,this.__play()):e.Dispose()}__play(){this.__source.clip=this.__ref.content,this.__source.loop=this.__loop,this.__source.play();let t=Timer.currentTime;this.__fadeData?(this.__fadeData.startTime=t,this.mute?this.__volume=this.__fadeData.startValue:this.__source.volume=this.__fadeData.startValue):this.mute?this.__source.volume=0:this.__source.volume=this.__volume,this.__startTime=Timer.currentTime,this.__time=1e3*this.__source.duration}Tick(t){if(this.__paused||0==this.__isPlaying||null==this.__url)return;let e,i=Timer.currentTime;if(this.__fadeData){e=i-this.__fadeData.startTime;let t=e/this.__fadeData.time;if(t=t>1?1:t,this.mute?this.__volume=this.__fadeData.startValue+(this.__fadeData.endValue-this.__fadeData.startValue)*t:this.__source.volume=this.__fadeData.startValue+(this.__fadeData.endValue-this.__fadeData.startValue)*t,1==t){let t=this.__fadeData.complete;this.__fadeData.completeStop&&(this.__source.stop(),this.__isPlaying=!1,this.__reset()),t&&t(),this.__fadeData=null}}this.__loop||(e=i-this.__startTime,e/this.__time>=1&&(this.__source.stop(),this.__isPlaying=!1,this.__playedComplete&&this.__playedComplete(),this.__reset()))}Resume(){if(0==this.__paused)return;let t=Timer.currentTime-this.__pauseTime;this.__fadeData&&(this.__fadeData.startTime+=t),this.__startTime+=t,this.__source.play(),this.__paused=!1}Pause(){this.__paused||(this.__paused=!0,this.__pauseTime=Timer.currentTime,this.__source.pause())}get curVolume(){return this.__source.volume}}class FadeData{}class AudioManagerImpl{constructor(){let t;this.__musicChannelIndex=0,this.__volume=1,this.__musicVolume=1,this.__musicChannels=[],this.__soundChannels=[],TickerManager.AddTicker(this),this.__audioRoot=find("AudioManager"),null==this.__audioRoot&&(this.__audioRoot=new Node("AudioManager"),director.getScene().addChild(this.__audioRoot));for(let e=0;e<2;e++)t=new AudioChannelImpl(this.__audioRoot),this.__musicChannels.push(t)}get volume(){return this.__volume}set volume(t){if(this.__volume==t)return;let e,i;this.__volume=t;for(let t=0;t<this.__musicChannels.length;t++)i=this.__musicChannels[t],i.isPlaying&&(e=i.volume*this.__musicVolume*this.__volume,i.Fade(100,e,i.curVolume));for(let t=0;t<this.__soundChannels.length;t++)i=this.__soundChannels[t],i.isPlaying&&(e=i.volume*this.__soundVolume*this.__volume,i.Fade(100,e,i.curVolume))}set musicVolume(t){if(this.__musicVolume==t)return;if(this.__musicVolume=t,this.muteMusic)return;let e=this.__musicChannels[this.__musicChannelIndex];if(e&&e.isPlaying){let t=e.volume*this.__musicVolume*this.__volume;e.Fade(100,t,e.curVolume)}}get musicVolume(){return this.__musicVolume}get soundVolume(){return this.__soundVolume}set soundVolume(t){if(this.__soundVolume==t)return;let e;this.__soundVolume=t;for(let t=0;t<this.__soundChannels.length;t++)if(e=this.__soundChannels[t],e.isPlaying){let t=e.volume*this.__soundVolume*this.__volume;e.Fade(100,t,e.curVolume)}}set mute(t){this.__mute!=t&&(this.__mute=t,this.__changedMutes())}get mute(){return this.__mute}get muteMusic(){return this.__muteMusic}set muteMusic(t){this.__muteMusic!=t&&(this.__muteMusic=t,this.__changedMutes())}get muteSound(){return this.__muteSound}set muteSound(t){this.__muteSound!=t&&(this.__muteSound=t,this.__changedMutes())}__changedMutes(){for(let t=0;t<this.__musicChannels.length;t++){this.__musicChannels[t].mute=this.muteMusic||this.mute}for(let t=0;t<this.__soundChannels.length;t++){this.__soundChannels[t].mute=this.muteSound||this.mute}}PlayMusic(t,e,i,s){let n;n=this.muteMusic||this.mute?0:e*this.__musicVolume*this.__volume;let r,o=this.__musicChannels[this.__musicChannelIndex];o&&o.isPlaying&&URL2Key(o.url)==URL2Key(t)||(this.__musicChannelIndex++,this.__musicChannelIndex=this.__musicChannelIndex%2,0==this.__musicChannelIndex?(o=this.__musicChannels[0],r=this.__musicChannels[1]):(o=this.__musicChannels[1],r=this.__musicChannels[0]),r.isPlaying&&r.Fade(500,0,void 0,null,!0),o.volume=e,o.Play(t,null,n,{time:500,startVolume:0},!0,i))}StopMusic(){let t=this.__musicChannels[this.__musicChannelIndex];t&&t.isPlaying&&t.Stop()}PauseMusic(){let t=this.__musicChannels[this.__musicChannelIndex];t&&t.Pause()}ResumeMusic(){let t=this.__musicChannels[this.__musicChannelIndex];t&&t.Resume()}PlaySound(t,e,i,s,n){let r;r=this.muteSound||this.mute?0:this.soundVolume*i*this.__volume;let o=this.GetIdleChannel();o&&(o.volume=i,o.Play(t,e,r,null,n,s))}GetPlaying(t){for(let e=0;e<this.__soundChannels.length;e++){const i=this.__soundChannels[e];if(i.isPlaying&&URL2Key(i.url)==URL2Key(t))return i}return null}GetIdleChannel(){let t,e;for(t=0;t<this.__soundChannels.length;t++)if(e=this.__soundChannels[t],0==e.isPlaying)return e;return t<AudioManager.MAX_SOUND_CHANNEL_COUNT?(e=new AudioChannelImpl(this.__audioRoot),this.__soundChannels.push(e),e):null}Tick(t){for(let e=0;e<this.__musicChannels.length;e++){const i=this.__musicChannels[e];i.isPlaying&&i.Tick(t)}for(let e=0;e<this.__soundChannels.length;e++){const i=this.__soundChannels[e];i.isPlaying&&i.Tick(t)}}}class AudioManager{static get volume(){return this.impl.volume}static set volume(t){this.impl.volume=t}static get musicVolume(){return this.impl.musicVolume}static set musicVolume(t){this.impl.musicVolume=t}static get soundVolume(){return this.impl.soundVolume}static set soundVolume(t){this.impl.soundVolume=t}static get mute(){return this.impl.mute}static set mute(t){this.impl.mute=t}static get muteMusic(){return this.impl.muteMusic}static set muteMusic(t){this.impl.muteMusic=t}static get muteSound(){return this.impl.muteSound}static set muteSound(t){this.impl.muteSound=t}static PlayMusic(t,e=1,i=1,s=!1){this.impl.PlayMusic(t,e,i,s)}static StopMusic(){this.impl.StopMusic()}static PauseMusic(){this.impl.PauseMusic()}static ResumeMusic(){this.impl.ResumeMusic()}static PlaySound(t,e,i,s,n){this.impl.PlaySound(t,e,i,s,n)}static GetPlaying(t){return this.impl.GetPlaying(t)}static get impl(){return null==this.__impl&&(this.__impl=Injector.GetInject(this.KEY)),null==this.__impl&&(this.__impl=new AudioManagerImpl),this.__impl}}AudioManager.KEY="drongo.AudioManager",AudioManager.MAX_SOUND_CHANNEL_COUNT=30;class FunctionHookInfo{Equal(t,e,i){return this.functionName==t&&(!!e.Equal(this.preHandler)&&!!i.Equal(this.laterHandler))}}class FunctionHook{constructor(t){this.data=t,this.__functions=[],this.__preHandlerMap=new Map,this.__laterHandlerMap=new Map,this.__groupMap=new Map}AddHook(t,e,i,s){let n=this.__groupMap.get(t);n||(n=[],this.__groupMap.set(t,n));for(let t=0;t<n.length;t++){if(n[t].Equal(e,i,s))return}let r=new FunctionHookInfo;if(r.functionName=e,r.preHandler=i,r.laterHandler=s,n.push(r),this.__functions.indexOf(e)<0){let t=this.data[e];if(!t)throw new Error("方法不存在！");let i=this.__preHandlerMap.get(e);i||(i=[],this.__preHandlerMap.set(e,i));let s=this.__laterHandlerMap.get(e);s||(s=[],this.__laterHandlerMap.set(e,s));let n=function(...e){if(i&&i.length)for(let t=0;t<i.length;t++){i[t].Run(e)}if(t(e),s&&s.length)for(let t=0;t<s.length;t++){s[t].Run(e)}};this.data[e]=n,this.data["old_"+e]=t,this.__functions.push(e)}let o=this.__preHandlerMap.get(e);o||(o=[],this.__preHandlerMap.set(e,o)),o.indexOf(i)<0&&o.push(i);let h=this.__laterHandlerMap.get(e);h||(h=[],this.__laterHandlerMap.set(e,h)),h.indexOf(s)<0&&h.push(s)}RemoveHook(t,e,i,s){let n,r,o=this.__groupMap.get(t);if(o){if(!e){for(let t=0;t<o.length;t++){const e=o[t];e.preHandler&&(n=this.__preHandlerMap.get(e.functionName),r=n.indexOf(e.preHandler),r>=0&&n.splice(r,1),0==n.length&&this.__preHandlerMap.delete(e.functionName)),e.laterHandler&&(n=this.__laterHandlerMap.get(e.functionName),r=n.indexOf(e.laterHandler),r>=0&&n.splice(r,1),0==n.length&&this.__laterHandlerMap.delete(e.functionName))}return o.length=0,void this.__groupMap.delete(t)}for(let t=0;t<o.length;t++){const h=o[t];if(h.Equal(e,i,s))return o.splice(t,1),h.preHandler&&(n=this.__preHandlerMap.get(e),r=n.indexOf(h.preHandler),r>=0&&n.splice(r,1)),void(h.laterHandler&&(n=this.__laterHandlerMap.get(e),r=n.indexOf(h.laterHandler),r>=0&&n.splice(r,1)))}}}}class BindInfo{constructor(t,e,i){this.property=t,this.targetOrCallBack=e,this.tPropertyOrCaller=i}Equal(t,e,i){return t==this.property&&this.targetOrCallBack==e&&this.tPropertyOrCaller==i}}class PropertyBinder{constructor(t){this.data=t,this.__propertys=[],this.__changedPropertys=[],this.__bindedMap=new Map,this.__bindedGroupMap=new Map}Bind(t,e,i,s){let n,r=this.__bindedGroupMap.get(t);r||(r=[],this.__bindedGroupMap.set(t,r));let o,h=!1;if(Array.isArray(e))for(let t=0;t<e.length;t++){const a=e[t];this.__checkProperty(a);for(let t=0;t<r.length;t++)n=r[t],n.Equal(a,i,s)&&(h=!0);h||(n=new BindInfo(a,i,s),o=this.__bindedMap.get(a),o||(o=[],this.__bindedMap.set(a,o)),o.push(n),r.push(n),this.__propertyChanged(a))}else{this.__checkProperty(e);for(let t=0;t<r.length;t++)if(n=r[t],n.Equal(e,i,s))return;n=new BindInfo(e,i,s),o=this.__bindedMap.get(e),o||(o=[],this.__bindedMap.set(e,o)),o.push(n),r.push(n),this.__propertyChanged(e)}}Unbind(t,e,i,s){let n,r,o,h=this.__bindedGroupMap.get(t);if(h){if(null==e){for(let t=0;t<h.length;t++)n=h[t],r=this.__bindedMap.get(n.property),r&&r.length>0&&(o=r.indexOf(n),o>=0&&r.splice(o,1)),0==r.length&&this.__bindedMap.delete(n.property);return h.length=0,void this.__bindedGroupMap.delete(t)}if(Array.isArray(e)){for(let t=0;t<e.length;t++){const a=e[t];for(let t=0;t<h.length;t++)n=h[t],r=this.__bindedMap.get(n.property),n.Equal(a,i,s)&&(o=r.indexOf(n),o>=0&&r.splice(o,1),h.splice(t,1),t--)}0==h.length&&this.__bindedGroupMap.delete(t)}else{for(let t=0;t<h.length;t++)n=h[t],r=this.__bindedMap.get(n.property),n.Equal(e,i,s)&&(o=r.indexOf(n),o>=0&&r.splice(o,1),h.splice(t,1),t--);0==h.length&&this.__bindedGroupMap.delete(t)}}}__checkProperty(t){if(this.__propertys.indexOf(t)<0){let e=this.data[t];this.__defineReactive(this.data,t,e),this.__propertys.push(t)}}__defineReactive(t,e,i){let s=this;Object.defineProperty(t,e,{enumerable:!0,configurable:!0,get:function(){return i},set:function(t){i!=t&&(i=t,s.__propertyChanged(e))}})}__propertyChanged(t,e=!1){this.__changedPropertys.indexOf(t)<0&&(this.__changedPropertys.push(t),TickerManager.CallNextFrame(this.__nextFramePropertyUpdate,this))}__nextFramePropertyUpdate(t=!1){let e;for(let t=0;t<this.__changedPropertys.length;t++)e=this.__changedPropertys[t],this.__updateProperty(e);this.__changedPropertys.length=0}__updateProperty(t){let e,i=this.__bindedMap.get(t);if(i&&i.length)for(let s=0;s<i.length;s++)e=i[s],"function"!=typeof e.targetOrCallBack?e.targetOrCallBack[e.tPropertyOrCaller]=this.data[t]:e.targetOrCallBack.apply(e.tPropertyOrCaller,this.__changedPropertys)}}class BinderUtils{constructor(){}static Bind(t,e,i,s,n){let r=e.$PropertyBinder;r||(r=new PropertyBinder(e),e.$PropertyBinder=r),r.Bind(t,i,s,n)}static Unbind(t,e,i,s,n){let r=e.$PropertyBinder;r&&r.Unbind(t,i,s,n)}static AddHook(t,e,i,s,n){let r=e.$FunctionHook;r||(r=new FunctionHook(e),e.$FunctionHook=r),r.AddHook(t,i,s,n)}static RemoveHook(t,e,i,s,n){let r=e.$FunctionHook;r&&r.RemoveHook(t,i,s,n)}}class BindingUtils{constructor(){this.__bindRecords=[],this.__hookRecords=[]}__bind(t,e,i,s){for(let n=0;n<this.__bindRecords.length;n++){const r=this.__bindRecords[n];if(r.source==t&&r.property==e&&r.targetOrCallback==i&&r.targetPropertyOrCaller==s)throw new Error("重复绑定："+t+e+i+s)}this.__bindRecords.push({source:t,property:e,targetOrCallback:i,targetPropertyOrCaller:s}),BinderUtils.Bind(this,t,e,i,s)}__unbind(t,e,i,s){for(let n=0;n<this.__bindRecords.length;n++){const r=this.__bindRecords[n];r.source==t&&r.property==e&&r.targetOrCallback==i&&r.targetPropertyOrCaller==s&&this.__bindRecords.splice(n,1)}BinderUtils.Unbind(this,t,e,i,s)}__addHook(t,e,i,s){for(let n=0;n<this.__hookRecords.length;n++){const r=this.__hookRecords[n];if(r.source==t&&r.functionName==e&&i.Equal(r.preHandler)&&s.Equal(r.laterHandler))throw new Error("重复绑定："+t+" "+e)}this.__hookRecords.push({source:t,functionName:e,preHandler:i,laterHandler:s}),BinderUtils.AddHook(this,t,e,i,s)}__removeHook(t,e,i,s){for(let n=0;n<this.__hookRecords.length;n++){const r=this.__hookRecords[n];r.source==t&&r.functionName==e&&i.Equal(r.preHandler)&&s.Equal(r.laterHandler)&&this.__hookRecords.splice(n,1)}BinderUtils.RemoveHook(this,t,e,i,s)}BindAA(t,e,i,s){this.__bind(t,e,i,s)}UnbindAA(t,e,i,s){this.__unbind(t,e,i,s)}BindAM(t,e,i,s){this.__bind(t,e,i,s)}UnbidAM(t,e,i,s){this.__unbind(t,e,i,s)}BindMM(t,e,i,s){this.__addHook(t,e,i,s)}UnbindMM(t,e,i,s){this.__removeHook(t,e,i,s)}BindByRecords(){for(let t=0;t<this.__bindRecords.length;t++){const e=this.__bindRecords[t];BinderUtils.Bind(this,e.source,e.property,e.targetOrCallback,e.targetPropertyOrCaller)}for(let t=0;t<this.__hookRecords.length;t++){const e=this.__hookRecords[t];BinderUtils.AddHook(this,e.source,e.functionName,e.preHandler,e.laterHandler)}}UnbindByRecords(){for(let t=0;t<this.__bindRecords.length;t++){const e=this.__bindRecords[t];BinderUtils.Unbind(this,e.source,e.property,e.targetOrCallback,e.targetPropertyOrCaller)}for(let t=0;t<this.__hookRecords.length;t++){const e=this.__hookRecords[t];BinderUtils.RemoveHook(this,e.source,e.functionName,e.preHandler,e.laterHandler)}}Destroy(){this.__hookRecords&&(this.__hookRecords.length=0,this.__hookRecords=null),this.__bindRecords&&(this.__bindRecords.length=0,this.__bindRecords=null)}}class BaseConfigAccessor{constructor(){this.__configs=[]}Save(t){if(this.__configs.indexOf(t)>=0)return!1;this.__configs.push(t)}Get(){return this.__configs}Destroy(){this.__configs=null}}class ConfigManagerImpl{constructor(){this.__accessors=new Map}Register(t,e){this.__accessors.set(t,e)}GetAccessorClass(t){return this.__accessors.has(t)?this.__accessors.get(t):BaseConfigAccessor}GetAccessor(t){const e=URL2Key(ConfigManager.Sheet2URL(t));if(!ResManager.HasRes(e))throw new Error(t+"未加载!");return ResManager._getRes(e).content}}class ConfigManager{static Register(t,e){this.impl.Register(t,e)}static GetAccessorClass(t){return this.impl.GetAccessorClass(t)}static GetAccessor(t){return this.impl.GetAccessor(t)}static get impl(){return null==this.__impl&&(this.__impl=Injector.GetInject(this.KEY)),null==this.__impl&&(this.__impl=new ConfigManagerImpl),this.__impl}}ConfigManager.KEY="drongo.ConfigManager";class List extends EventDispatcher{constructor(t=!0){super(),this.__only=!1,this.count=0,this.__only=t,this.__element=[]}Push(t){if(this.__only){if(this.__element.indexOf(t)>=0)return!1}return this.__element.push(t),this.count=this.__element.length,this.HasEvent(Event.ADD)&&this.Emit(Event.ADD,t),!0}Unshift(t){if(this.__only){if(this.__element.indexOf(t)>=0)return!1}return this.__element.unshift(t),this.count=this.__element.length,this.HasEvent(Event.ADD)&&this.Emit(Event.ADD,t),!0}Pop(){if(this.__element.length>0){const t=this.__element.pop();return this.count=this.__element.length,this.HasEvent(Event.REMOVE)&&this.Emit(Event.REMOVE,t),t}return null}Shift(){if(this.__element.length>0){const t=this.__element.shift();return this.count=this.__element.length,this.HasEvent(Event.REMOVE)&&this.Emit(Event.REMOVE,t),t}return null}RemoveAt(t){if(t>=this.__element.length)throw new Error("删除索引超出范围！");const e=this.__element[t];return this.__element.splice(t,1),this.count=this.__element.length,this.HasEvent(Event.REMOVE)&&this.Emit(Event.REMOVE,e),e}Remove(t){let e=this.__element.indexOf(t);if(e<0)throw new Error("要删除的内容不在列表中！"+t);const i=this.__element[e];this.__element.splice(e,1),this.count=this.__element.length,this.HasEvent(Event.REMOVE)&&this.Emit(Event.REMOVE,i)}Clear(){this.count=0,this.__element.length=0,this.HasEvent(Event.CLEAR)&&this.Emit(Event.CLEAR)}Has(t){return this.Find(t)>=0}Find(t){return this.__element.indexOf(t)}FindIndex(t){return this.__element.findIndex(t)}Get(t){if(t>=this.__element.length)throw new Error("超出索引范围:"+t+"/"+this.__element.length);return this.__element[t]}get elements(){return this.__element}}class FSM extends EventDispatcher{constructor(t,e){super(),this.owner=t,this.__name=e,this.__states=new Map}Tick(t){this.__current&&this.__current.Tick(t)}AddState(t,e){this.__states.set(t,e),e.Init(this)}SwitchState(t,e){if(this.__state==t)return;let i=this.__state,s=this.__current;if(s&&(this.debug&&Debuger.Log("FSM",this.__name+" 所属:"+this.owner.name+" 退出状态==>"+this.__current.name),s.Exit()),this.__current=null,!this.__states.has(t))throw new Error("状态机:"+this.__name+" 所属:"+this.owner.name+"未找到状态==>"+t);this.__state=t,this.__current=this.__states.get(t),this.debug&&Debuger.Log("FSM",this.__name+" 所属:"+this.owner.name+" 进入状态==>"+this.__current.name),this.__current.Enter(e),this.Emit(Event.State_Changed,i)}get state(){return this.__state}get current(){return this.__current}Destroy(){this.__current&&this.__current.Exit(),this.__states.forEach(t=>{t.Destroy()}),this.__states.clear()}}!function(t){t[t.Null=0]="Null",t[t.Showing=1]="Showing",t[t.Showed=2]="Showed",t[t.Closeing=3]="Closeing",t[t.Closed=4]="Closed"}(GUIState||(GUIState={}));class Layer extends GComponent{constructor(t,e=!1){super(),this.node.name=t,this.isFullScrene=e,this.openRecord=[],this.makeFullScreen()}AddChild(t){this.addChild(t)}AddChildAt(t,e){this.addChildAt(t,e)}RemoveChild(t){this.removeChild(t)}RemoveChildAt(t){this.removeChildAt(t)}GetChildAt(t){return this.getChildAt(t)}GetCount(){return this.numChildren}}class LayerManagerImpl{constructor(){this.__layerMap=new Map}AddLayer(t,e){if(!(e instanceof Layer))throw new Error("层必须是Layer");GRoot.inst.addChild(e),this.__layerMap.set(t,e)}RemoveLayer(t){let e=this.__layerMap.get(t);if(!e)throw new Error("找不到要删除的层："+t);GRoot.inst.removeChild(e),this.__layerMap.delete(t)}GetLayer(t){return this.__layerMap.get(t)}GetAllLayer(){let t=[];return this.__layerMap.forEach((function(e,i){t.push(e)})),t}}class LayerManager{static AddLayer(t,e){this.impl.AddLayer(t,e)}static RemoveLayer(t){this.impl.RemoveLayer(t)}static GetLayer(t){return this.impl.GetLayer(t)}static GetAllLayer(){return this.impl.GetAllLayer()}static get impl(){return null==this.__impl&&(this.__impl=Injector.GetInject(this.KEY)),null==this.__impl&&(this.__impl=new LayerManagerImpl),this.__impl}}LayerManager.KEY="drongo.LayerManager";class LoadingView{static Show(){this.impl&&this.impl.Show()}static Hide(){this.impl&&this.impl.Hide()}static ChangeData(t){this.impl&&this.impl.ChangeData(t)}static get impl(){return null==this.__impl&&(this.__impl=Injector.GetInject(this.KEY)),null==this.__impl&&console.warn(this.KEY+"未注入"),this.__impl}}LoadingView.KEY="drongo.LoadingView";class RelationManager{constructor(){}static AddRelation(t,e){if(this.DEBUG&&this.__checkValidity(t,e),this.__map.has(t))throw new Error("重复注册！");this.__map.set(t,e)}static RemoveRelation(t){if(!this.__map.has(t))throw new Error("找不到要删除的内容！");this.__map.delete(t)}static __checkValidity(t,e){let i,s=t,n=e.show,r=e.hide;if(i=n.show.indexOf(s),i>=0)throw new Error("GuiRelation.config配置错误：gui:"+s+" show.show:中不能包含自身！");if(i=n.hide.indexOf(s),i>=0)throw new Error("GuiRelation.config配置错误：gui:"+s+" show.hide:中不能包含自身！");if(i=r.show.indexOf(s),i>=0)throw new Error("GuiRelation.config配置错误：gui:"+s+" hide.show:中不能包含自身！");if(i=r.hide.indexOf(s),i>=0)throw new Error("GuiRelation.config配置错误：gui:"+s+" hide.hide:中不能包含自身！");for(let t=0;t<n.show.length;t++){const e=n.show[t];if(n.hide.indexOf(e)>=0)throw new Error("GuiRelation.config配置错误：gui:"+s+" show.show和show.hide中包含相同的guikey:"+e)}for(let t=0;t<r.show.length;t++){const e=r.show[t];if(r.hide.indexOf(e)>=0)throw new Error("GuiRelation.config配置错误：gui:"+s+" hide.show和hide.hide中包含相同的guikey:"+e)}}static GetRelation(t){return this.__map.get(t)}}RelationManager.DEBUG=!1,RelationManager.__map=new Map;class FGUIResource extends ResourceImpl{constructor(){super()}Destroy(){let t=Key2URL(this.key);if("string"==typeof t)throw new Error("未处理的Fguipackage销毁！");{UIPackage.removePackage(t.url);let e=assetManager.getBundle(Drongo.UIBundle).get(t.url);assetManager.releaseAsset(e),console.log("销毁:FGUIPacage=>"+t.bundle+" "+t.url)}super.Destroy()}}class FGUILoader extends EventDispatcher{constructor(){super()}Load(t){if(this.url=t,"string"==typeof t)throw new Error("未实现："+t);{let e=assetManager.getBundle(t.bundle),i=this;e?i.loadUIPackge(t,e):assetManager.loadBundle(t.bundle,(e,s)=>{e?i.Emit(Event.ERROR,{url:t,err:e}):i.loadUIPackge(t,s)})}}loadUIPackge(t,e){if("string"==typeof t)throw new Error("未实现："+t);let i=this;UIPackage.loadPackage(e,t.url,(e,s,n)=>{const r=e/s;i.Emit(Event.PROGRESS,{url:t,progress:r})},(e,s)=>{if(e)return void i.Emit(Event.ERROR,{url:t,err:e});const n=URL2Key(t);let r=new FGUIResource;r.key=n,r.content=s,ResManager.AddRes(r),i.Emit(Event.COMPLETE,{url:t})})}Reset(){this.url=null}}class ConfigUtils{static ParseConfig(t,e,i){let s,n,r={};for(let o=0;o<e.length;o++)switch(s=t[o],n=e[o],n){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:this.__readNumber(s,n,r,i);break;case 8:r[s]=i.ReadUTF();break;case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:this.__readArray(s,n,r,i)}return r}static __readNumber(t,e,i,s){switch(e){case 0:i[t]=s.ReadByte();break;case 1:i[t]=s.ReadUnsignedByte();break;case 2:i[t]=s.ReadShort();break;case 3:i[t]=s.ReadUnsignedShort();break;case 4:i[t]=s.ReadInt();break;case 5:i[t]=s.ReadUnsignedInt();break;case 6:i[t]=s.ReadFloat();break;case 7:i[t]=s.ReadDouble();break;default:throw new Error(t+" 未知类型:"+e)}}static __readArray(t,e,i,s){let n=s.ReadUnsignedInt(),r=[];for(let i=0;i<n;i++)switch(e){case 9:r.push(s.ReadByte());break;case 10:r.push(s.ReadUnsignedByte());break;case 11:r.push(s.ReadShort());break;case 12:r.push(s.ReadUnsignedShort());break;case 13:r.push(s.ReadInt());break;case 14:r.push(s.ReadUnsignedInt());break;case 15:r.push(s.ReadFloat());break;case 16:r.push(s.ReadDouble());break;case 17:r.push(s.ReadUTF());break;default:throw new Error(t+" 未知类型:"+e)}i[t]=r}}class Endian{}Endian.LITTLE_ENDIAN="littleEndian",Endian.BIG_ENDIAN="bigEndian";class ByteArray{get endian(){return 0==this.$endian?Endian.LITTLE_ENDIAN:Endian.BIG_ENDIAN}set endian(t){this.$endian=t==Endian.LITTLE_ENDIAN?0:1}constructor(t,e=0){this.bufferExtSize=0,this.EOF_byte=-1,this.EOF_code_point=-1,e<0&&(e=0),this.bufferExtSize=e;let i,s=0;if(t){let n;if(t instanceof Uint8Array?(n=t,s=t.length):(s=t.byteLength,n=new Uint8Array(t)),0==e)i=new Uint8Array(s);else{i=new Uint8Array((1+(s/e|0))*e)}i.set(n)}else i=new Uint8Array(e);this.write_position=s,this._position=0,this._bytes=i,this.data=new DataView(i.buffer),this.endian=Endian.BIG_ENDIAN}Reset(){this.Clear()}Destroy(){this._bytes=null,this.data=null}SetArrayBuffer(t){}get readAvailable(){return this.write_position-this._position}get buffer(){return this.data.buffer.slice(0,this.write_position)}get rawBuffer(){return this.data.buffer}set buffer(t){let e,i=t.byteLength,s=new Uint8Array(t),n=this.bufferExtSize;if(0==n)e=new Uint8Array(i);else{e=new Uint8Array((1+(i/n|0))*n)}e.set(s),this.write_position=i,this._bytes=e,this.data=new DataView(e.buffer)}get bytes(){return this._bytes}get dataView(){return this.data}set dataView(t){this.buffer=t.buffer}get bufferOffset(){return this.data.byteOffset}get position(){return this._position}set position(t){this._position=t,t>this.write_position&&(this.write_position=t)}get length(){return this.write_position}set length(t){this.write_position=t,this.data.byteLength>t&&(this._position=t),this._validateBuffer(t)}_validateBuffer(t){if(this.data.byteLength<t){let e,i=this.bufferExtSize;if(0==i)e=new Uint8Array(t);else{e=new Uint8Array((1+(t/i>>0))*i)}e.set(this._bytes),this._bytes=e,this.data=new DataView(e.buffer)}}get bytesAvailable(){return this.data.byteLength-this._position}Clear(){let t=new ArrayBuffer(this.bufferExtSize);this.data=new DataView(t),this._bytes=new Uint8Array(t),this._position=0,this.write_position=0}ReadBoolean(){if(this.Validate(1))return!!this._bytes[this.position++]}ReadByte(){if(this.Validate(1))return this.data.getInt8(this.position++)}ReadBytes(t,e=0,i=0){if(!t)return;let s=this._position,n=this.write_position-s;if(n<0)return void console.error(1025);if(0==i)i=n;else if(i>n)return void console.error(1025);const r=t._position;t._position=0,t.ValidateBuffer(e+i),t._position=r,t._bytes.set(this._bytes.subarray(s,s+i),e),this.position+=i}ReadDouble(){if(this.Validate(8)){let t=this.data.getFloat64(this._position,0==this.$endian);return this.position+=8,t}}ReadFloat(){if(this.Validate(4)){let t=this.data.getFloat32(this._position,0==this.$endian);return this.position+=4,t}}ReadInt(){if(this.Validate(4)){let t=this.data.getInt32(this._position,0==this.$endian);return this.position+=4,t}}ReadShort(){if(this.Validate(2)){let t=this.data.getInt16(this._position,0==this.$endian);return this.position+=2,t}}ReadUnsignedByte(){if(this.Validate(1))return this._bytes[this.position++]}ReadUnsignedInt(){if(this.Validate(4)){let t=this.data.getUint32(this._position,0==this.$endian);return this.position+=4,t}}ReadUnsignedShort(){if(this.Validate(2)){let t=this.data.getUint16(this._position,0==this.$endian);return this.position+=2,t}}ReadUTF(){let t=this.ReadUnsignedShort();return t>0?this.ReadUTFBytes(t):""}ReadUTFBytes(t){if(!this.Validate(t))return;let e=this.data,i=new Uint8Array(e.buffer,e.byteOffset+this._position,t);return this.position+=t,this.DecodeUTF8(i)}WriteBoolean(t){this.ValidateBuffer(1),this._bytes[this.position++]=+t}WriteByte(t){this.ValidateBuffer(1),this._bytes[this.position++]=255&t}WriteBytes(t,e=0,i=0){let s;e<0||i<0||(s=0==i?t.length-e:Math.min(t.length-e,i),s>0&&(this.ValidateBuffer(s),this._bytes.set(t._bytes.subarray(e,e+s),this._position),this.position=this._position+s))}WriteDouble(t){this.ValidateBuffer(8),this.data.setFloat64(this._position,t,0==this.$endian),this.position+=8}WriteFloat(t){this.ValidateBuffer(4),this.data.setFloat32(this._position,t,0==this.$endian),this.position+=4}WriteInt(t){this.ValidateBuffer(4),this.data.setInt32(this._position,t,0==this.$endian),this.position+=4}WriteShort(t){this.ValidateBuffer(2),this.data.setInt16(this._position,t,0==this.$endian),this.position+=2}WriteUnsignedInt(t){this.ValidateBuffer(4),this.data.setUint32(this._position,t,0==this.$endian),this.position+=4}WriteUnsignedShort(t){this.ValidateBuffer(2),this.data.setUint16(this._position,t,0==this.$endian),this.position+=2}WriteUTF(t){let e=this.EncodeUTF8(t),i=e.length;this.ValidateBuffer(2+i),this.data.setUint16(this._position,i,0==this.$endian),this.position+=2,this._writeUint8Array(e,!1)}WriteUTFBytes(t){this._writeUint8Array(this.EncodeUTF8(t))}ToString(){return"[ByteArray] length:"+this.length+", bytesAvailable:"+this.bytesAvailable}_writeUint8Array(t,e=!0){let i=this._position,s=i+t.length;e&&this.ValidateBuffer(s),this.bytes.set(t,i),this.position=s}Validate(t){let e=this._bytes.length;if(e>0&&this._position+t<=e)return!0;console.error(1025)}ValidateBuffer(t){this.write_position=t>this.write_position?t:this.write_position,t+=this._position,this._validateBuffer(t)}EncodeUTF8(t){let e=0,i=this.StringToCodePoints(t),s=[];for(;i.length>e;){let t=i[e++];if(this.InRange(t,55296,57343))this.EncoderError(t);else if(this.InRange(t,0,127))s.push(t);else{let e,i;for(this.InRange(t,128,2047)?(e=1,i=192):this.InRange(t,2048,65535)?(e=2,i=224):this.InRange(t,65536,1114111)&&(e=3,i=240),s.push(this.Div(t,Math.pow(64,e))+i);e>0;){let i=this.Div(t,Math.pow(64,e-1));s.push(128+i%64),e-=1}}}return new Uint8Array(s)}DecodeUTF8(t){let e,i=0,s="",n=0,r=0,o=0,h=0;for(;t.length>i;){let a=t[i++];if(a==this.EOF_byte)e=0!=r?this.DecoderError(!1):this.EOF_code_point;else if(0==r)this.InRange(a,0,127)?e=a:(this.InRange(a,194,223)?(r=1,h=128,n=a-192):this.InRange(a,224,239)?(r=2,h=2048,n=a-224):this.InRange(a,240,244)?(r=3,h=65536,n=a-240):this.DecoderError(!1),n*=Math.pow(64,r),e=null);else if(this.InRange(a,128,191))if(o+=1,n+=(a-128)*Math.pow(64,r-o),o!==r)e=null;else{let t=n,i=h;n=0,r=0,o=0,h=0,e=this.InRange(t,i,1114111)&&!this.InRange(t,55296,57343)?t:this.DecoderError(!1,a)}else n=0,r=0,o=0,h=0,i--,e=this.DecoderError(!1,a);null!==e&&e!==this.EOF_code_point&&(e<=65535?e>0&&(s+=String.fromCharCode(e)):(e-=65536,s+=String.fromCharCode(55296+(e>>10&1023)),s+=String.fromCharCode(56320+(1023&e))))}return s}EncoderError(t){console.error(1026,t)}DecoderError(t,e){return t&&console.error(1027),e||65533}InRange(t,e,i){return e<=t&&t<=i}Div(t,e){return Math.floor(t/e)}StringToCodePoints(t){let e=[],i=0,s=t.length;for(;i<t.length;){let n=t.charCodeAt(i);if(this.InRange(n,55296,57343))if(this.InRange(n,56320,57343))e.push(65533);else if(i==s-1)e.push(65533);else{let s=t.charCodeAt(i+1);if(this.InRange(s,56320,57343)){let t=1023&n,r=1023&s;i+=1,e.push(65536+(t<<10)+r)}else e.push(65533)}else e.push(n);i+=1}return e}}class ConfigLoader extends EventDispatcher{constructor(){super()}Load(t){if(this.url=t,"string"==typeof t)throw new Error("未实现！");let e=assetManager.getBundle(t.bundle);e?this.__load(t,e):assetManager.loadBundle(t.bundle,(e,i)=>{e?this.Emit(Event.ERROR,{url:t,err:e}):this.__load(t,i)})}__load(t,e){if("string"==typeof t)throw new Error("未实现！");let i=this;e.load(FullURL(t),BufferAsset,(e,s)=>{const n=e/s;i.Emit(Event.PROGRESS,{url:t,progress:n})},(e,s)=>{if(e)return void i.Emit(Event.ERROR,{url:t,err:e});const n=URL2Key(t);let r=s._buffer,o=this.__parseConfig(t.url,r),h=new ResourceImpl;h.key=n,h.content=o,ResManager.AddRes(h),i.Emit(Event.COMPLETE,{url:t})})}__parseConfig(t,e){let i=new ByteArray(e),s=i.ReadUnsignedInt(),n=[];for(let t=0;t<s;t++)n.push(i.ReadUTF());let r,o=[];s=i.ReadUnsignedInt();for(let t=0;t<s;t++)o.push(i.ReadByte());s=i.ReadUnsignedInt();let h=ConfigManager.GetAccessorClass(t);null==h&&Debuger.Warn(Debuger.DRONGO,"配置表："+t+"未注册存取器！");let a=new h;for(let t=0;t<s;t++)r=ConfigUtils.ParseConfig(n,o,i),a.Save(r);return a}Reset(){this.url=null}}class Drongo{static Init(t,e,i,s,n){if(GRoot.create(t),Res.SetResLoader("fgui",FGUILoader),Res.SetResLoader("config",ConfigLoader),s&&(ConfigManager.Sheet2URL=t=>({url:s.preURL+t,type:"config",bundle:s.bundle}),ConfigManager.URL2Sheet=t=>{if("string"==typeof t)return t;let e;return e=t.url.indexOf(s.preURL)>=0?t.url.replace(s.preURL,""):t.url,e}),i&&i.layers&&i.layers.length>0)for(let t=0;t<i.layers.length;t++){const e=i.layers[t];i.fullScrene&&i.fullScrene.length>0?LayerManager.AddLayer(e,new Layer(e,i.fullScrene.indexOf(e)>=0)):LayerManager.AddLayer(e,new Layer(e))}Res.GetResRef(e,"Drongo").then(t=>{let e=t.content.json;for(let t=0;t<e.length;t++){const i=e[t];GUIManager.Register(i)}n()},t=>{throw new Error("初始化引擎出错,gui配置加载错误:"+URL2Key(e))})}static Tick(t){TickerManager.Tick(t)}}Drongo.UIBundle="UI",Drongo.MaskColor=new Color(0,0,0,127.5);var __awaiter$1=function(t,e,i,s){return new(i||(i=Promise))((function(n,r){function o(t){try{a(s.next(t))}catch(t){r(t)}}function h(t){try{a(s.throw(t))}catch(t){r(t)}}function a(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,h)}a((s=s.apply(t,e||[])).next())}))};class ServiceStarter{constructor(t,e){this.__name=t,this.__serviceClass=e}Start(){return __awaiter$1(this,void 0,void 0,(function*(){return this.__result||(this.__result=new Promise((t,e)=>{this.__service=new this.__serviceClass,this.__service.name=this.__name,this.__service.Init((i,s)=>{i?e(i):t(s)})})),this.__result}))}Destroy(){this.__name=void 0,this.__serviceClass=void 0,this.__result=void 0,this.__service.Destroy(),this.__service=null}}class ServiceManager{static GetService(t){const e=GetClassName(t);if(this.__starters.has(e))return this.__starters.get(e).Start();let i=new ServiceStarter(e,t);return this.__starters.set(e,i),i.Start()}static Uninstall(t){const e=GetClassName(t);if(!this.__starters.has(e))return;this.__starters.get(e).Destroy(),this.__starters.delete(e)}}ServiceManager.__starters=new Map;var LoadState,FindPosition,__awaiter=function(t,e,i,s){return new(i||(i=Promise))((function(n,r){function o(t){try{a(s.next(t))}catch(t){r(t)}}function h(t){try{a(s.throw(t))}catch(t){r(t)}}function a(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,h)}a((s=s.apply(t,e||[])).next())}))};!function(t){t[t.Null=0]="Null",t[t.Loading=1]="Loading",t[t.Loaded=2]="Loaded"}(LoadState||(LoadState={}));class GUIProxy{constructor(t){if(this.closeTime=0,this.zIndex=0,this.__resRef=null,this.__showing=!1,this.__loadState=LoadState.Null,this.info=t,!this.info)throw new Error("UI信息不能为空！")}__loadCodeBundle(){this.__startTime=Timer.currentTime,this.__loadState=LoadState.Loading,assetManager.getBundle(this.info.bundleName)?this.__codeBundleLoaded():assetManager.loadBundle(this.info.bundleName,this.__codeBundleLoaded.bind(this))}__codeBundleLoaded(){this.__uiURL={url:this.info.packageName,type:"fgui",bundle:Drongo.UIBundle},this.__loadAssets()}__loadAssets(){Res.GetResRef(this.__uiURL,this.info.key,this.__loadAssetProgress.bind(this)).then(this.__loadAssetComplete.bind(this),this.__loadAssetError.bind(this))}__loadAssetProgress(t){LoadingView.ChangeData({label:this.info.key+" asset loading...",progress:t})}__loadAssetError(t){t&&LoadingView.ChangeData({label:t})}__loadAssetComplete(t){if(URL2Key(this.__uiURL)==t.key){if(this.__resRef=t,!this.__resRef)throw new Error("加载UI资源失败:"+this.info.packageName+" ");this.__createUIMediator()}else t.Dispose()}__createUIMediator(){let t=GUIProxy.createNode.addComponent(this.info.key+"ViewCreator"),e=t;if(!e)throw new Error(this.info.key+"ViewCreator类不存在或未实现IViewCreator!");this.mediator=e.createMediator(),t.destroy(),this.mediator.services?this.__initServices():this.__createUI()}__initServices(){return __awaiter(this,void 0,void 0,(function*(){for(let t=0;t<this.mediator.services.length;t++){const e=this.mediator.services[t];yield ServiceManager.GetService(e)}this.__createUI()}))}__createUI(){this.mediator.CreateUI(this.info,this.__createUICallBack.bind(this))}__createUICallBack(){this.__loadState=LoadState.Loaded,this.mediator.Init(),this.mediator.inited=!0,this.__showing&&this.__show()}__addToLayer(){this.layer.AddChildAt(this.mediator.viewComponent,this.zIndex),this.mediator.viewComponent.visible=!0}Tick(t){if(this.__loadState!=LoadState.Loading)this.__loadState==LoadState.Loaded&&this.mediator&&this.mediator.Tick(t);else{Timer.currentTime-this.__startTime>1&&LoadingView.Show()}}Show(t){this.__showing=!0,this.zIndex=this.getLayerChildCount(),this.data=t,this.__show()}ShowedUpdate(t){this.mediator&&this.__showing&&this.mediator.ShowedUpdate(t)}__show(){if(this.__loadState==LoadState.Null)this.__loadCodeBundle();else if(this.__loadState==LoadState.Loading);else{if(this.__addToLayer(),LoadingView.Hide(),this.mediator.Show(this.data),this.data=null,!GUIManager.IsOpen(this.info.key))return;this.mediator.PlayShowAnimation?this.mediator.PlayShowAnimation(this.__showAnimationPlayed):Event.Emit(Event.SHOW,this.info.key)}}__showAnimationPlayed(){Event.Emit(Event.SHOW,this.info.key)}Hide(){this.__loadState==LoadState.Loading?this.__loadState=LoadState.Null:this.__loadState==LoadState.Loaded&&this.__showing&&(this.mediator.PlayHideAnimation?this.mediator.PlayHideAnimation(this.__hideAnimationPlayed):this.__hide())}__hideAnimationPlayed(){this.__showing&&this.__hide()}__hide(){this.mediator.viewComponent.visible=!1,this.mediator.Hide(),this.__showing=!1,Event.Emit(Event.HIDE,this.info.key)}Destroy(){var t;console.log("UI销毁=>"+(null===(t=this.info)||void 0===t?void 0:t.key)),this.mediator.Destroy(),this.mediator=void 0,this.info=void 0,this.data=null,this.__resRef&&(this.__resRef.Dispose(),this.__resRef=null)}getLayerChildCount(){return this.layer.GetCount()}get layer(){let t=LayerManager.GetLayer(this.info.layer);if(void 0===t)throw new Error("layer："+this.info.layer+"不存在！");return t}getComponent(t){return this.mediator?this.mediator.GetUIComponent(t):null}}GUIProxy.createNode=new Node("createHelpNode");class GUIManagerImpl{constructor(){this.__registered=new Map,this.__instances=new Map,this.__destryList=[],TickerManager.AddTicker(this),Event.On(Event.SHOW,this.__showedHandler,this),Event.On(Event.HIDE,this.__closedHandler,this)}GetUIComponent(t,e){if(!this.__instances.has(t))throw new Error("GUI："+t+"实例，不存在！");return this.__instances.get(t).getComponent(e)}GetMediatorByKey(t){return this.__instances.has(t)?this.__instances.get(t).mediator:null}__showedHandler(t,e,i){let s=i;this.SetGUIState(s,GUIState.Showed)}__closedHandler(t,e,i){let s=i;this.SetGUIState(s,GUIState.Closed)}Register(t){if(this.__registered.has(t.key))throw new Error("重复注册！");this.__registered.set(t.key,t)}Unregister(t){if(!this.__registered.has(t))throw new Error("未找到要注销的界面信息！");this.__registered.delete(t)}Tick(t){this.__destryList.length=0;let e=Timer.currentTime;if(this.__instances.forEach((i,s,n)=>{i.info.state==GUIState.Showed?i.Tick(t):i.info.state==GUIState.Closed&&(i.info.permanence||e-i.closeTime>GUIManager.GUI_GC_INTERVAL&&this.__destryList.push(s))}),this.__destryList.length>0){let t;for(let e=0;e<this.__destryList.length;e++){const i=this.__destryList[e];t=this.__instances.get(i),t.info.state=GUIState.Null,this.__instances.delete(i),t.Destroy()}}}Open(t,e){this.__open(t,e),this.__checkRelation(t,!0)}__open(t,e){let i,s=this.GetGUIState(t);if(s==GUIState.Null){let s=this.__registered.get(t);return i=new GUIProxy(s),i.info.state=GUIState.Showing,this.__instances.set(s.key,i),this.CheckFullLayer(i),void i.Show(e)}return s==GUIState.Showing?(i=this.__instances.get(t),this.CheckFullLayer(i),void i.Show(e)):s==GUIState.Showed?(i=this.__instances.get(t),this.CheckFullLayer(i),i.ShowedUpdate(e),void LoadingView.Hide()):s==GUIState.Closeing||s==GUIState.Closed?(i=this.__instances.get(t),i.info.state=GUIState.Showing,this.CheckFullLayer(i),void i.Show(e)):void 0}CheckFullLayer(t){let e=LayerManager.GetLayer(t.info.layer);if(e.isFullScrene){for(let i=0;i<e.openRecord.length;i++){const s=e.openRecord[i];s!=t.info.key&&this.__close(s)}e.openRecord.push(t.info.key)}}Close(t,e=!0){this.__close(t,e),this.__checkRelation(t,!1)}CloseAll(){this.__instances.forEach((t,e,i)=>{this.Close(e,!1)})}__close(t,e=!1){let i,s=this.GetGUIState(t);if(s==GUIState.Null||s==GUIState.Closed||s==GUIState.Closeing)return;if(i=this.__instances.get(t),i.closeTime=Timer.currentTime,i.info.state=GUIState.Closeing,i.Hide(),!e)return;let n=LayerManager.GetLayer(i.info.layer);if(n.isFullScrene&&n.openRecord.length>1){n.openRecord.pop();let t=n.openRecord.pop();this.__open(t)}}__checkRelation(t,e){let i,s=RelationManager.GetRelation(t);if(s){let t;i=e?s.show:s.hide;for(let e=0;e<i.show.length;e++)t=i.show[e],this.__open(t);for(let e=0;e<i.hide.length;e++)t=i.hide[e],this.__close(t)}}GetPrevLayer(){let t=LayerManager.GetAllLayer();for(let e=0,i=t.length;e<i;e+=1)if(t[e].isFullScrene){if(t[e].openRecord.length>1)return t[e].openRecord[t[e].openRecord.length-2];break}}GetGUIState(t){if(!this.__registered.has(t))throw new Error("GUI:"+t+"未注册！");if(!this.__instances.has(t))return GUIState.Null;return this.__instances.get(t).info.state}SetGUIState(t,e){if(!this.__registered.has(t))throw new Error("GUI:"+t+"未注册！");this.__registered.get(t).state=e}IsOpen(t){let e=this.GetGUIState(t);return e==GUIState.Showing||e==GUIState.Showed}}class GUIManager{static Register(t){return this.impl.Register(t)}static Unregister(t){return this.impl.Unregister(t)}static Open(t,e){this.impl.Open(t,e)}static Close(t,e=!0){this.impl.Close(t,e)}static CloseAll(){this.impl.CloseAll()}static GetGUIState(t){return this.impl.GetGUIState(t)}static IsOpen(t){return this.impl.IsOpen(t)}static GetUIComponent(t,e){return this.impl.GetUIComponent(t,e)}static GetMediatorByKey(t){return this.impl.GetMediatorByKey(t)}static GetPrevLayer(){return this.impl.GetPrevLayer()}static get impl(){return null==this.__impl&&(this.__impl=Injector.GetInject(this.KEY)),null==this.__impl&&(this.__impl=new GUIManagerImpl),this.__impl}}GUIManager.KEY="drongo.GUIManager",GUIManager.GUI_GC_INTERVAL=30;class BaseMediator{constructor(){this.ui=null,this.inited=!1,this.__bindEvents=[],this.__bindingUtils=new BindingUtils}Init(){}Tick(t){}Show(t){this.data=t,this._addBindedEvents(),this.__bindingUtils.BindByRecords()}ShowedUpdate(t){this.data=t}Hide(){this._removeBindedEvents(),this.__bindingUtils.UnbindByRecords()}Destroy(){this.__bindEvents.length=0,this.__bindEvents=null,this.__bindingUtils.Destroy(),this.__bindingUtils=null}GetUIComponent(t){let e,i=t.split("/"),s=this.ui,n=0;for(;s&&n<i.length;)e=i[n],e.startsWith("m_")&&(e=e.replace("m_","")),s=s.getChild(e),n++;return s}BindAA(t,e,i,s){this.__bindingUtils.BindAA(t,e,i,s)}UnbindAA(t,e,i,s){this.__bindingUtils.UnbindAA(t,e,i,s)}BindAM(t,e,i,s){this.__bindingUtils.BindAM(t,e,i,s)}UnbidAM(t,e,i,s){this.__bindingUtils.UnbidAM(t,e,i,s)}BindMM(t,e,i,s){this.__bindingUtils.BindMM(t,e,i,s)}UnbindMM(t,e,i,s){this.__bindingUtils.UnbindMM(t,e,i,s)}BindEvent(t,e,i,s){for(let n=0;n<this.__bindEvents.length;n++){const r=this.__bindEvents[n];if(r.target==t&&r.eventType==e&&r.handler==i&&r.caller==s)throw new Error("重复绑定UI事件："+t+e+i+s)}this.inited?t.on(e,i,s):this.__bindEvents.push({target:t,eventType:e,handler:i,caller:s})}UnbindEvent(t,e,i,s){for(let n=0;n<this.__bindEvents.length;n++){const r=this.__bindEvents[n];r.target==t&&r.eventType==e&&r.handler==i&&r.caller==s&&(this.__bindEvents.splice(n,1),this.inited&&t.off(e,i,s))}}_addBindedEvents(){if(0!=this.__bindEvents.length)for(let t=0;t<this.__bindEvents.length;t++){const e=this.__bindEvents[t];e.target.on(e.eventType,e.handler,e.caller)}}_removeBindedEvents(){if(0!=this.__bindEvents.length)for(let t=0;t<this.__bindEvents.length;t++){const e=this.__bindEvents[t];e.target.off(e.eventType,e.handler,e.caller)}}}class GUIMediator extends BaseMediator{constructor(){super(),this.info=null,this.viewComponent=null,this.__mask=null}CreateUI(t,e){if(this.info=t,null==this.info)throw new Error("GUI 信息不能为空");this.__createdCallBack=e,null!=this.$configs&&0!=this.$configs.length?this.__loadConfigs():this.__createUI(!0)}__loadConfigs(){let t=[];for(let e=0;e<this.$configs.length;e++){const i=this.$configs[e],s=ConfigManager.Sheet2URL(i);t.push(s)}Res.GetResRefList(t,this.info.comName).then(t=>{this.$configRefs=t,this.__createUI(!0)},t=>{throw new Error("UI:"+this.info.comName+"依赖的配置加载出错:"+t)})}__createUI(t){let e=this.info.packageName;if(t)this.__asyncCreator=new AsyncOperation,this.__asyncCreator.callback=this.__uiCreated.bind(this),this.__asyncCreator.createObject(e,this.info.comName);else try{let t=UIPackage.createObject(e,this.info.comName);this.__uiCreated(t)}catch(t){throw new Error("创建界面失败："+this.info.packageName+" "+this.info.comName)}}__uiCreated(t){let e=t.asCom;e.makeFullScreen(),this.info.modal?(this.ui=e,this.viewComponent=new GComponent,this.viewComponent.makeFullScreen(),this.__mask=new GGraph,this.__mask.makeFullScreen(),this.__mask.drawRect(0,Color.BLACK,Drongo.MaskColor),this.viewComponent.addChild(this.__mask),this.info.modalClose&&this.__mask.onClick(this._maskClickHandler,this),this.viewComponent.addChild(this.ui)):this.ui=this.viewComponent=e,this.ui.name=this.info.key,this.__createdCallBack&&(this.__createdCallBack(),this.__createdCallBack=null)}_maskClickHandler(){GUIManager.Close(this.info.key)}Init(){}Show(t){if(super.Show(t),this.$subMediators)for(let e=0;e<this.$subMediators.length;e++){this.$subMediators[e].Show(t)}}ShowedUpdate(t){if(super.ShowedUpdate(t),this.$subMediators)for(let e=0;e<this.$subMediators.length;e++){this.$subMediators[e].ShowedUpdate(t)}}Hide(){if(super.Hide(),this.$subMediators)for(let t=0;t<this.$subMediators.length;t++){this.$subMediators[t].Hide()}}Close(t=!0){GUIManager.Close(this.info.key,t)}Tick(t){if(this.$subMediators)for(let e=0;e<this.$subMediators.length;e++){this.$subMediators[e].Tick(t)}}Destroy(){if(this.__mask&&(this.__mask.offClick(this._maskClickHandler,this),this.__mask.dispose(),this.__mask=null),this.viewComponent.dispose(),this.info=null,this.$subMediators)for(let t=0;t<this.$subMediators.length;t++){this.$subMediators[t].Destroy()}for(let t=0;t<this.$configRefs.length;t++){this.$configRefs[t].Dispose()}this.$configs=null,this.$configRefs=null}}class SubGUIMediator extends BaseMediator{constructor(t,e){super(),this.ui=t,this.owner=e,this.Init(),this.inited=!0}Destroy(){super.Destroy(),this.owner=null,this.ui=null}}!function(t){t[t.ShortSideFit=0]="ShortSideFit",t[t.BottomLeft=1]="BottomLeft",t[t.ContactPoint=2]="ContactPoint",t[t.LongSideFit=3]="LongSideFit",t[t.AreaFit=4]="AreaFit"}(FindPosition||(FindPosition={}));class Rect{constructor(){this.x=0,this.y=0,this.width=0,this.height=0,this.isRotated=!1}Clone(){const t=new Rect;return t.x=this.x,t.y=this.y,t.height=this.height,t.width=this.width,t.info=this.info,t}IsIn(t){return this.x>=t.x&&this.y>=t.y&&this.x+this.width<=t.x+t.width&&this.y+this.height<=t.y+t.height}get isEmpty(){return 0==this.x&&0==this.y&&0==this.width&&0==this.height}}class MaxRectBinPack{constructor(t,e,i){this.freeRects=[],this.usedRects=[],this.containerHeight=e,this.containerWidth=t,this.allowRotate=!0===i;const s=new Rect;s.x=0,s.y=0,s.width=t,s.height=e,this.freeRects.push(s)}Insert(t,e,i){if(t<=0||e<=0)throw new Error(`width & height should greater than 0, but got width as ${t}, height as ${e}`);(i<=FindPosition.ShortSideFit||i>=FindPosition.AreaFit)&&(i=FindPosition.ShortSideFit);let s=new Rect;const n={value:0},r={value:0};switch(i){case FindPosition.ShortSideFit:s=this.FindPositionForNewNodeBestShortSideFit(t,e,n,r);break;case FindPosition.BottomLeft:s=this.FindPositionForNewNodeBottomLeft(t,e,n,r);break;case FindPosition.ContactPoint:s=this.FindPositionForNewNodeContactPoint(t,e,n);break;case FindPosition.LongSideFit:s=this.FindPositionForNewNodeBestLongSideFit(t,e,r,n);break;case FindPosition.AreaFit:s=this.FindPositionForNewNodeBestAreaFit(t,e,n,r)}return 0===s.height||(this.allowRotate&&(s.height===e&&s.width===t?s.isRotated=!1:s.isRotated=!0),this.PlaceRectangle(s)),s}get occupancy(){let t=0;for(const e of this.usedRects)t+=e.width*e.height;return t/(this.containerWidth*this.containerHeight)}EraseNoce(t){let e=this.usedRects.indexOf(t);-1!=e&&this.usedRects.splice(e,1),e=this.freeRects.indexOf(t),-1==e&&(this.freeRects.push(t),this.PruneFreeList())}PlaceRectangle(t){let e=this.freeRects.length;for(let i=0;i<e;i++)this.SplitFreeNode(this.freeRects[i],t)&&(this.freeRects.splice(i,1),i--,e--);this.PruneFreeList(),this.usedRects.push(t)}ScoreRectangle(t,e,i,s,n){let r=new Rect;switch(s.value=1/0,n.value=1/0,i){case FindPosition.ShortSideFit:r=this.FindPositionForNewNodeBestShortSideFit(t,e,s,n);break;case FindPosition.BottomLeft:r=this.FindPositionForNewNodeBottomLeft(t,e,s,n);break;case FindPosition.ContactPoint:r=this.FindPositionForNewNodeContactPoint(t,e,s),s.value=-s.value;break;case FindPosition.LongSideFit:r=this.FindPositionForNewNodeBestLongSideFit(t,e,n,s);break;case FindPosition.AreaFit:r=this.FindPositionForNewNodeBestAreaFit(t,e,s,n)}return 0===r.height&&(s.value=1/0,n.value=1/0),r}FindPositionForNewNodeBottomLeft(t,e,i,s){this.freeRects;const n=new Rect;let r;i.value=1/0;for(const o of this.freeRects)o.width>=t&&o.height>=e&&(r=o.y+e,(r<i.value||r===i.value&&o.x<s.value)&&(n.x=o.x,n.y=o.y,n.width=t,n.height=e,i.value=r,s.value=o.x)),this.allowRotate&&o.width>=e&&o.height>=t&&(r=o.y+t,(r<i.value||r===i.value&&o.x<s.value)&&(n.x=o.x,n.y=o.y,n.width=e,n.height=t,i.value=r,s.value=o.x));return n}FindPositionForNewNodeBestShortSideFit(t,e,i,s){const n=new Rect;let r,o,h,a;i.value=1/0;for(const l of this.freeRects){let _,d,c,u;l.width>=t&&l.height>=e&&(r=Math.abs(l.width-t),o=Math.abs(l.height-e),h=Math.min(r,o),a=Math.max(r,o),(h<i.value||h===i.value&&a<s.value)&&(n.x=l.x,n.y=l.y,n.width=t,n.height=e,i.value=h,s.value=a)),this.allowRotate&&l.width>=e&&l.height>=t&&(_=Math.abs(l.width-e),d=Math.abs(l.height-t),c=Math.min(_,d),u=Math.max(_,d),(c<i.value||c===i.value&&u<s.value)&&(n.x=l.x,n.y=l.y,n.width=e,n.height=t,i.value=c,s.value=u))}return n}FindPositionForNewNodeBestLongSideFit(t,e,i,s){const n=new Rect;let r,o,h,a;s.value=1/0;for(const l of this.freeRects)l.width>=t&&l.height>=e&&(r=Math.abs(l.width-t),o=Math.abs(l.height-e),h=Math.min(r,o),a=Math.max(r,o),(a<s.value||a===s.value&&h<i.value)&&(n.x=l.x,n.y=l.y,n.width=t,n.height=e,i.value=h,s.value=a)),this.allowRotate&&l.width>=e&&l.height>=t&&(r=Math.abs(l.width-e),o=Math.abs(l.height-t),h=Math.min(r,o),a=Math.max(r,o),(a<s.value||a===s.value&&h<i.value)&&(n.x=l.x,n.y=l.y,n.width=e,n.height=t,i.value=h,s.value=a));return n}FindPositionForNewNodeBestAreaFit(t,e,i,s){const n=new Rect;let r,o,h,a;i.value=1/0;for(const l of this.freeRects)a=l.width*l.height-t*e,l.width>=t&&l.height>=e&&(r=Math.abs(l.width-t),o=Math.abs(l.height-e),h=Math.min(r,o),(a<i.value||a===i.value&&h<s.value)&&(n.x=l.x,n.y=l.y,n.width=t,n.height=e,s.value=h,i.value=a)),this.allowRotate&&l.width>=e&&l.height>=t&&(r=Math.abs(l.width-e),o=Math.abs(l.height-t),h=Math.min(r,o),(a<i.value||a===i.value&&h<s.value)&&(n.x=l.x,n.y=l.y,n.width=e,n.height=t,s.value=h,i.value=a));return n}CommonIntervalLength(t,e,i,s){return e<i||s<t?0:Math.min(e,s)-Math.max(t,i)}ContactPointScoreNode(t,e,i,s){let n=0;0!==t&&t+i!==this.containerWidth||(n+=s),0!==e&&e+s!==this.containerHeight||(n+=i);for(const r of this.usedRects)r.x!==t+i&&r.x+r.width!==t||(n+=this.CommonIntervalLength(r.y,r.y+r.height,e,e+s)),r.y!==e+s&&r.y+r.height!==e||(n+=this.CommonIntervalLength(r.x,r.x+r.width,t,t+i));return n}FindPositionForNewNodeContactPoint(t,e,i){const s=new Rect;let n;i.value=-1;for(const r of this.freeRects)r.width>=t&&r.height>=e&&(n=this.ContactPointScoreNode(r.x,r.y,t,e),n>i.value&&(s.x=r.x,s.y=r.y,s.width=t,s.height=e,i.value=n)),this.allowRotate&&r.width>=e&&r.height>=t&&(n=this.ContactPointScoreNode(r.x,r.y,e,t),n>i.value&&(s.x=r.x,s.y=r.y,s.width=e,s.height=t,i.value=n));return s}SplitFreeNode(t,e){const i=this.freeRects;if(e.x>=t.x+t.width||e.x+e.width<=t.x||e.y>=t.y+t.height||e.y+e.height<=t.y)return!1;let s;return e.x<t.x+t.width&&e.x+e.width>t.x&&(e.y>t.y&&e.y<t.y+t.height&&(s=t.Clone(),s.height=e.y-s.y,i.push(s)),e.y+e.height<t.y+t.height&&(s=t.Clone(),s.y=e.y+e.height,s.height=t.y+t.height-(e.y+e.height),i.push(s))),e.y<t.y+t.height&&e.y+e.height>t.y&&(e.x>t.x&&e.x<t.x+t.width&&(s=t.Clone(),s.width=e.x-s.x,i.push(s)),e.x+e.width<t.x+t.width&&(s=t.Clone(),s.x=e.x+e.width,s.width=t.x+t.width-(e.x+e.width),i.push(s))),!0}PruneFreeList(){const t=this.freeRects;for(let e=0;e<t.length;e++)for(let i=e+1;i<t.length;i++){if(t[e].IsIn(t[i])){t.splice(e,1);break}t[i].IsIn(t[e])&&t.splice(i,1)}}}class Pool{static allocate(t,e){let i,s=GetClassName(t);return this.__pools.has(s)?i=this.__pools.get(s):(i=new PoolImpl(t,e),this.__pools.set(s,i)),i.allocate()}static recycle(t){let e=GetClassName(t);if(!this.__pools.has(e))throw new Error("对象池不存在:"+e);this.__pools.get(e).recycle(t)}static recycleList(t){for(let e=0;e<t.length;e++){const i=t[e];this.recycle(i)}}static recycleAll(t){let e=GetClassName(t);if(!this.__pools.has(e))throw new Error("对象池不存在:"+e);this.__pools.get(e).recycleAll()}}Pool.__pools=new Map;class PoolImpl{constructor(t,e){if(this.__cacheStack=new Array,this.__usingArray=new Array,this.__maxCount=0,this.__class=t,!this.__class)throw new Error("构造函数不能为空！");this.__maxCount=null==e?Number.MAX_SAFE_INTEGER:e}get count(){return this.__cacheStack.length}get usingCount(){return this.__usingArray.length}allocate(){if(this.count+this.usingCount<this.__maxCount){let t=this.__cacheStack.length>0?this.__cacheStack.pop():new this.__class;return this.__usingArray.push(t),t}throw new Error("对象池最大数量超出："+this.__maxCount)}recycle(t){if(this.__cacheStack.indexOf(t)>-1)throw new Error("重复回收！");let e=this.__usingArray.indexOf(t);if(e<0)throw new Error("对象不属于该对象池！");t.Reset(),this.__usingArray.splice(e,1),this.__cacheStack.push(t)}recycleList(t){for(let e=0;e<t.length;e++){const i=t[e];this.recycle(i)}}recycleAll(){for(let t=0;t<this.__usingArray.length;t++){const e=this.__usingArray[t];this.recycle(e)}}destroy(){this.recycleAll();for(let t=0;t<this.__cacheStack.length;t++){this.__cacheStack[t].Destroy()}this.__cacheStack.length=0,this.__cacheStack=null,this.__usingArray.length=0,this.__usingArray=null}}class BaseService{constructor(){}Init(t){this.__initCallback=t,null==this.$configs||this.$configs.length<=0?this.__configLoaded():this.__loadConfigs()}__loadConfigs(){let t=[];for(let e=0;e<this.$configs.length;e++){const i=this.$configs[e],s=ConfigManager.Sheet2URL(i);t.push(s)}Res.GetResRefList(t,this.name).then(t=>{this.$configRefs=t,this.__configLoaded()},t=>{throw new Error(this.name+"依赖的配置加载出错:"+t)})}__configLoaded(){null==this.$assets||this.$assets.length<=0?this.$configAndAssetReady():this.__loadAssets()}__loadAssets(){Res.GetResRefList(this.$assets,this.name).then(t=>{this.$assetRefs=t,this.$configAndAssetReady()},t=>{throw new Error(this.name+"依赖资源加载出错:"+t)})}$configAndAssetReady(){}$initComplete(){this.__initCallback&&(this.__initCallback(null,this),this.__initCallback=null)}Destroy(){this.name=void 0,this.__initCallback=null,this.$configs=null,this.$assets.length=0,this.$assets=null;for(let t=0;t<this.$configRefs.length;t++){this.$configRefs[t].Dispose()}this.$configRefs=null;for(let t=0;t<this.$assetRefs.length;t++){this.$assetRefs[t].Dispose()}this.$assetRefs=null}}class LocalStorage{static Init(t){this.impl.Init(t)}static GetItem(t){this.impl.GetItem(t)}static SetItem(t,e){this.impl.SetItem(t,e)}static ClearItem(t){this.impl.ClearItem(t)}static ClearAll(){this.impl.ClearAll()}static get impl(){if(null==this.__impl&&(this.__impl=Injector.GetInject(this.KEY)),null==this.__impl)throw new Error(this.KEY+"未注入!");return this.__impl}}LocalStorage.KEY="drongo.LocalStorage";class LocalStorageImpl{Init(t){this.__gameName=t;let e=sys.localStorage.getItem(this.__gameName);this.data=e?JSON.parse(e):{}}GetItem(t){return this.data[t]}SetItem(t,e){this.data[t]=e,TickerManager.CallNextFrame(this.__save,this)}ClearItem(t){delete this.data[t],TickerManager.CallNextFrame(this.__save,this)}ClearAll(){this.data={},TickerManager.CallNextFrame(this.__save,this)}__save(){let t=JSON.stringify(this.data);sys.localStorage.setItem(this.__gameName,t)}}class TaskQueue extends EventDispatcher{constructor(){super(),this.__index=0,this.__taskList=[]}AddTask(t){if(this.__taskList.indexOf(t)>=0)throw new Error("重复添加！");this.__taskList.push(t)}RemoveTask(t){let e=this.__taskList.indexOf(t);if(e<0)throw new Error("未找到要删除的内容！");this.__taskList.splice(e,1)}Start(t){this.__index=0,this.__tryNext()}__tryNext(){if(this.__index<this.__taskList.length){let t=this.__taskList[this.__index];t.On(Event.COMPLETE,this.__subTaskEventHandler,this),t.On(Event.PROGRESS,this.__subTaskEventHandler,this),t.On(Event.ERROR,this.__subTaskEventHandler,this),t.Start()}else this.Emit(Event.COMPLETE)}__subTaskEventHandler(t,e,i){if(t!=Event.PROGRESS)e.OffAllEvent(),t!=Event.ERROR?(e.Destroy(),this.__index++,this.__tryNext()):this.Emit(Event.ERROR,i);else{let t=null==Number(i)?0:Number(i),e=(this.__index+t)/this.__taskList.length;this.Emit(Event.PROGRESS,e)}}Destroy(){super.Destroy(),this.__taskList.length=0,this.__index=0}}class TaskSequence extends EventDispatcher{constructor(){super(),this.__taskList=new Array,this.__index=0}AddTask(t){if(this.__taskList.indexOf(t)>=0)throw new Error("重复添加！");this.__taskList.push(t)}RemoveTask(t){let e=this.__taskList.indexOf(t);if(e<0)throw new Error("找不到要删除的内容!");this.__taskList.splice(e,1)}Start(t){for(let t=0;t<this.__taskList.length;t++){const e=this.__taskList[t];e.On(Event.COMPLETE,this.__subTaskEventHandler,this),e.On(Event.ERROR,this.__subTaskEventHandler,this),e.On(Event.PROGRESS,this.__subTaskEventHandler,this),e.Start()}}__subTaskEventHandler(t,e,i){t!=Event.PROGRESS?(e.OffAllEvent(),t!=Event.ERROR?(this.__index++,this.__index<this.__taskList.length||(e.Destroy(),this.Emit(Event.COMPLETE))):this.Emit(Event.ERROR,i)):this.Emit(Event.PROGRESS,this.__index/this.__taskList.length)}Destroy(){super.Destroy(),this.__taskList.length=0,this.__index=0}}class BitFlag{constructor(){this.__flags=0,this.__elements=[]}Add(t){this.__flags|=t,this.__elements.indexOf(t)<0&&this.__elements.push(t)}Remove(t){this.__flags^=t;let e=this.__elements.indexOf(t);e>=0&&this.__elements.splice(e,1)}Has(t){return(this.__flags&t)==t}get flags(){return this.__flags}get elements(){return this.__elements}Destroy(){this.__flags=0,this.__elements.length=0,this.__elements=null}}class Handler{constructor(){this.once=!0,this.isOver=!1}Run(...t){this.method&&!this.isOver&&(this.method.apply(this.caller,t),this.once&&(this.isOver=!0))}Equal(t){return this.method==t.method&&this.caller==t.caller}static Create(t,e,i=!1){var s=new Handler;return s.caller=t,s.method=e,s.once=i,s.isOver=!1,s}}export{AsyncOperation,AudioChannelImpl,AudioManager,AudioManagerImpl,BaseConfigAccessor,BaseMediator,BaseService,BinderUtils,BindingUtils,BitFlag,BlendMode,ByteArray,ByteBuffer,CCLoaderImpl,ConfigManager,Controller,Debuger,DebugerImpl,Dictionary,DragDropManager,Drongo,EaseType,Event,EventDispatcher,FGUIEvent,FGUILoader,FGUIResource,FSM,FindPosition,FullURL,FunctionHook,GButton,GComboBox,GComponent,GGraph,GGroup,GImage,GLabel,GList,GLoader,GLoader3D,GMovieClip,GObject,GObjectPool,GProgressBar,GRichTextField,GRoot,GScrollBar,GSlider,GTextField,GTextInput,GTree,GTreeNode,GTween,GTweener,GUIManager,GUIManagerImpl,GUIMediator,GUIProxy,GUIState,GearAnimation,GearBase,GearColor,GearDisplay,GearDisplay2,GearFontSize,GearIcon,GearLook,GearSize,GearText,GearXY,GetClassName,Handler,Image,Injector,Key2URL,Layer,LayerManager,LayerManagerImpl,List,Loader,LoaderQueue,LoadingView,LocalStorage,LocalStorageImpl,MaxRectBinPack,MovieClip,PackageItem,Pool,PopupMenu,PropertyBinder,Rect,RelationManager,RelationType,Res,ResImpl,ResManager,ResManagerImpl,ResRef,ResRequest,ResourceImpl,ScrollPane,ServiceManager,StringUtils,SubGUIMediator,TaskQueue,TaskSequence,TickerManager,TickerManagerImpl,Timer,TimerImpl,Transition,TranslationHelper,UBBParser,UIConfig,UIObjectFactory,UIPackage,URL2Key,Window,registerFont};